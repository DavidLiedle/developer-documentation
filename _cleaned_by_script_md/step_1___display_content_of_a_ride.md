1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>

 Developer : Migrating to eZ Platform - Follow the Ibex! 



Are you considering a move to eZ Platform? Worried about switching to a new technology? Unsure how to migrate your existing content?

Take a look at our guides for moving to eZ Platform from other solutions below. If you're looking for what's new from eZ Publish to eZ Platform, check this [Feature Comparison](https://doc.ez.no/x/jpTUAQ).

 

-   [Coming to eZ Platform from eZ Publish Platform](Coming-to-eZ-Platform-from-eZ-Publish-Platform_31429598.html)
    -   [Upgrading from 5.4.x and 2014.11 to 16.xx](Upgrading-from-5.4.x-and-2014.11-to-16.xx_31430322.html)
        -   [Migrating legacy Page field (ezflow) to Landing Page (Enterprise)](31431405.html)
-   [Migration from eZ Publish](Migration-from-eZ-Publish_31430320.html)

 

 

## Comments:

<table>
<colgroup>
<col width="100%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><a href=""></a>
<p><span class="jira-issue"> <a href="https://jira.ez.no/browse/EZP-26204?src=confmacro" class="jira-issue-key"><img src="https://jira.ez.no/images/icons/issuetypes/epic.png" class="icon" />EZP-26204</a> - <span class="summary">Provide information for developers coming to eZ from other platforms</span> <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-complete jira-macro-single-issue-export-pdf">Open</span> </span></p>
<div class="smallfont" align="left" style="color: #666666; width: 98%; margin-bottom: 10px;">
<img src="images/icons/contenttypes/comment_16.png" width="16" height="16" /> Posted by david.liedle@ez.no at Aug 24, 2016 16:00
</div></td>
</tr>
</tbody>
</table>






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Get Started with eZ Platform](Get-Started-with-eZ-Platform_31429520.html)</span>

 Developer : Step 0: Requirements & System Configuration 



# Platform as a Service (PaaS)

If you're using a PaaS provider such as our partner <a href="https://platform.sh/hosting/php/ez/">Platform.sh</a>, where we have an single-server setup, and in the future also clustered setup, you can [skip](https://doc.ez.no/pages/viewpage.action?pageId=31429552) this step.

# Server

eZ software is built to rely on existing technologies and standards. The minimal setup is `PHP`,  `MySQL/MariaDB`, and `Apache/Nginx`. Recommendation for production setups is to use `Varnish`, and  `Memcached`, `NFS` `and ``Solr` in a [<span class="confluence-link">clustered</span> setup](Clustering_31430387.html).

<span>For supported versions of these technologies see Recommended and Supported setups below.</span>

## Recommended setups

These setups are tested by QA and are generally recommended setups. For security and performance we furthermore recommend use of the newer versions of components below.

 
Debian

<span>Ubuntu</span>
<span style="color: rgb(0,98,147);">RHEL / CentOS</span>
**Operating system**

8.x "Jessie"

<span style="color: rgb(128,128,128);"><span style="color: rgb(0,0,0);">16.04LTS</span></span>

7.x

**Web Server**

Nginx 1.6
Apache 2.4 <sup><span style="color: rgb(128,128,128);">(prefork\\ mode)</span></sup><span>
</span>

<span>Nginx 1.10
Apache 2.4 <sup><span style="color: rgb(128,128,128);">(prefork\\ mode)</span></sup></span><span style="color: rgb(255,102,0);">
</span>

<span>Nginx 1.8 </span><sup><span style="color: rgb(128,128,128);">(via\\ <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Software_Collections/2/html/2.1_Release_Notes/index.html">RHSCL</a>)</span></sup>
Apache 2.4 <sup><span style="color: rgb(128,128,128);">(prefork\\ mode)</span></sup><span style="color: rgb(128,128,128);">
</span>

**DBMS**

MariaDB 10.0
MySQL 5.5

<span>MySQL 5.7
MariaDB 10.0</span><span>
</span>

<span>MariaDB 10.1 </span><sup><span style="color: rgb(128,128,128);">(via\\ <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Software_Collections/2/html/2.2_Release_Notes/index.html">RHSCL</a>)
</span></sup>MariaDB 10.0 <sup><span style="color: rgb(128,128,128);">(via\\ <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Software_Collections/2/html/2.1_Release_Notes/index.html">RHSCL</a>)
</span></sup>MySQL 5.6 <sup><span style="color: rgb(128,128,128);">(via\\ <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Software_Collections/2/html/2.1_Release_Notes/index.html">RHSCL</a>)
</span></sup>MariaDB 5.5

**PHP**

PHP<span style="color: rgb(255,0,0);"> <span style="color: rgb(34,34,34);">5.6</span></span><span> </span><span style="color: rgb(128,128,128);"><sup>(via\\ libapache2-mod-php5\\ for\\ Apache)</sup></span>

PHP 7.0<span> </span>

<span>PHP 7.0 </span><sup><span style="color: rgb(128,128,128);">(via\\ <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Software_Collections/2/html/2.3_Release_Notes/index.html">RHSCL</a>)</span></sup>

PHP 5.6 <sup><span style="color: rgb(128,128,128);">(via\\ <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Software_Collections/2/html/2.1_Release_Notes/index.html">RHSCL</a>)</span></sup>

**PHP <span style="color: rgb(34,34,34);">packages</span>**

<span>php5-cli
php5-fpm <sup><span style="color: rgb(128,128,128);">(<span style="color: rgb(128,128,128);">for\\ use\\ </span>with\\ nginx</span><span style="color: rgb(128,128,128);">)</span></sup>
php5-readline</span>
<span>php5-mysqlnd *<span style="color: rgb(128,128,128);">or </span>*</span>php5-pgsql
<span>php5-json
php5-xsl
php5-intl
php5-mcrypt
<span>php5-curl</span></span>
<span><span>php5-gd
</span></span>php5-imagick <span style="color: rgb(128,128,128);">(optional)</span>
php5-twig <sup><span style="color: rgb(128,128,128);">(optional,\\ improves\\ performance</span><span style="color: rgb(128,128,128);">)
</span></sup>php5-memcached <sup><span style="color: rgb(128,128,128);"><span>(<span>recommended</span>,\\ improves\\ performance)</span></span></sup>

php-cli
php-fpm <sup><span style="color: rgb(128,128,128);">(for\\ use\\ with\\ nginx</span><span style="color: rgb(128,128,128);">)</span></sup>
php-readline
php-mysql *<span style="color: rgb(128,128,128);">or </span>*php-pgsql
php-json
php-xml
php-mbstring
php-intl
php-mcrypt
php-curl
php-gd *<span style="color: rgb(128,128,128);">or </span>*php-imagick

<span>php-memcached </span><sup><span style="color: rgb(128,128,128);">(recommended,\\ via\\ <a href="https://pecl.php.net/package/memcached">pecl</a></span><span style="color: rgb(128,128,128);">)</span></sup>

 

<span>php-cli
php-fpm<span> </span><sup><span style="color: rgb(128,128,128);">(for\\ use\\ with\\ <span style="color: rgb(128,128,128);">nginx</span></span><span style="color: rgb(128,128,128);">)</span></sup>
<span>php-<span>mysqlnd </span></span></span><span>*<span style="color: rgb(128,128,128);">or </span>*</span><span>php-pgsql
php-xml
php-mbstring
php-process
php-intl
php-pear <span style="color: rgb(128,128,128);"><sup>(optional,\\ provides\\ *pecl*)</sup></span>
php-gd *<span style="color: rgb(128,128,128);">or </span>*<span>php-imagick<span> </span><sup><span style="color: rgb(128,128,128);">(via\\ <a href="https://pecl.php.net/package/imagick">pecl</a></span><span style="color: rgb(128,128,128);">)</span></sup></span></span><span>
php-memcached </span><sup><span style="color: rgb(128,128,128);">(recommended,\\ via\\ <a href="https://pecl.php.net/package/memcached">pecl</a></span><span style="color: rgb(128,128,128);">)</span></sup>

<span style="color: rgb(128,128,128);"><span>
</span></span>

**Search**
Solr <sup><span style="color: rgb(128,128,128);">(recommended,\\ for\\ better\\ performance\\ and\\ scalability\\ of\\ all\\ API\\ Queries)</span></sup>

-   Solr 4.10

<span style="color: rgb(0,0,0);">Oracle Java/Open JDK: 7 *<span style="color: rgb(128,128,128);">or</span>* 8 <sup><span style="color: rgb(128,128,128);">(needed\\ for\\ Solr,\\ <a href="https://lucene.apache.org/solr/4_10_4/SYSTEM_REQUIREMENTS.html">version\ 8\ recommended</a></span></sup></span><sup><span style="color: rgb(128,128,128);">)</span></sup>

**Graphic Handler**

GraphicsMagick *<span style="color: rgb(128,128,128);">or</span>* ImageMagick *<span style="color: rgb(128,128,128);">or</span>* GD

**<span class="confluence-link">[Clustering](Clustering_31430387.html)</span>**

Linux NFS<sup><span style="color: rgb(128,128,128);">\\ (for\\ IO,\\ aka\\ binary\\ files\\ stored\\ in\\ content\\ repository)</span></sup>
Memcached <sup><span style="color: rgb(128,128,128);">(for\\ Persistence\\ cache\\ &\\ Sessions)</span></sup>
Varnish <sup><span style="color: rgb(128,128,128);">(for\\ HttpCache)</span></sup>

**Filesystem**

Linux ext3 / ext4

**Package manager**
Composer

## Supported setups

<span class="status-macro aui-lozenge aui-lozenge-current">WORK IN PROGRESS FOR FUTURE RELEASE, SEE ABOVE FOR NOW</span>

Supported setups are those we perform automated testing on. For security and performance we recommend use of the newer versions of components below.

-   OS: Linux
-   Web Servers:
    -   Apache 2.2, 2.4
    -   Nginx 1.6, 1.8. 1.10
-   DBMS
    -   MySQL 5.5, 5.6, 5.7
    -   MariaDB 5.5, 10.0, 10.1
-   PHP
    -   5.6
    -   7.0 - 7.1

-   PHP extensions/modules
    -   curl
    -   ctype
    -   fileinfo
    -   iconv
    -   intl
    -   json
    -   mbstring
    -   opcache <span style="color: rgb(128,128,128);">*(recommended over APC)*</span>
    -   pdo
        -   pdo mysql <span style="color: rgb(128,128,128);">*(with mysqlnd)*</span>
    -   posix
    -   readline
    -   reflection
    -   xml
    -   xsl
    -   zip
    -   php-memcached *(<span style="color: rgb(128,128,128);">3.x on PHP 7, 2.2 on PHP 5)</span>*

## Development & Experimental setups

eZ Platform, the foundation of all eZ software, can theoretically run and execute on many more setups than the ones listed as recommended and supported, including any <a href="https://wiki.php.net/platforms">operating system supported by PHP</a>, on a PHP 5.6 version or higher that pass the <a href="http://symfony.com/doc/current/reference/requirements.html">Symfony requirements</a>, using cache solutions technically supported by <a href="http://www.stashphp.com/Drivers.html">Stash</a>, using databases supported by <a href="http://doctrine-dbal.readthedocs.org/en/latest/reference/configuration.html#driver">Doctrine DBAL</a>, and using a binary file storage solution supported by <a href="https://github.com/thephpleague/flysystem#adapters">FlySystem</a>.

Examples of Development setups:

-   OS: Windows, Mac OS X, Linux
-   Filesystem: NTFS, <span style="color: rgb(34,34,34);">, </span>HFS+, ..

Examples of Experimental setups:

-   OS: Any system supported by PHP
-   Persistence Cache: Redis *(php-redis is known to be unstable with Stash under load, if you experience this consider using custom Predis Stash driver)*
-   Filesystem: BTRFS, AUFS, A<span style="color: rgb(34,34,34);">PFS,</span> ...
-   IO: S3, Azure, (S)FTP, GridFS, <a href="https://flysystem.thephpleague.com/core-concepts/#adapters">...</a>
-   Databases: Postgres, MSSQL, Oracle <span style="color: rgb(128,128,128);"><sup>*(As\\ in\\ technically\\ supported\\ by\\ Doctrine\\ DBAL\\ which\\ we\\ use,\\ but\\ none\\ supported\\ by\\ our\\ installer\\ at\\ the moment,\\ and\\ Oracle\\ and\\ MSSQL\\ is\\ not\\ covered\\ by\\ automated\\ testing)*</sup></span>

 

**While all these options are not supported by eZ Systems**, they are community supported, meaning contributions and efforts made to improve support for these technologies are welcome and can contribute to the technology being supported by the eZ Systems team in the future.

 

# <span id="Step0:Requirements&SystemConfiguration-client" class="confluence-anchor-link"></span>Client

<span style="color: rgb(79,79,79);">eZ software is developed to work with *any* web browser that support modern standards, on *any* screen resolution suitable for web, running on *any* device. </span><span style="color: rgb(79,79,79);">However for the Editorial and Administration User Interfaces you'll need; a minimum of 1024-by-768 screen resolution, a desktop or tablet device, and a recommended/supported browsers found below.</span>

## Recommended browsers

These setups have been undergone some additional manual testing and is known to work.

-   <span style="color: rgb(0,0,0);"><span>Mozilla® Firefox® most recent stable version <sup><span style="color: rgb(128,128,128);">(t</span></sup></span><sup><span style="color: rgb(128,128,128);">ested\\ on\\ Firefox\\ 50</span></sup></span><sup><span style="color: rgb(128,128,128);">)</span></sup>

-   <span style="color: rgb(0,0,0);"><span>Google Chrome™ most recent stable version <span style="color: rgb(128,128,128);"><sup>(t</sup></span></span><span style="color: rgb(128,128,128);"><sup>ested\\ on\\ Chrome\\ 55</sup></span></span><span><span style="color: rgb(0,0,0);"><span style="color: rgb(128,128,128);"><sup>)</sup></span> </span></span>

-   <span style="color: rgb(0,0,0);">Microsoft® </span><span>Edge<span style="color: rgb(0,0,0);">® <span style="color: rgb(0,0,0);">most recent stable version</span> <span style="color: rgb(128,128,128);"><sup>(tested\\ on Edge\\ 38)</sup></span></span><span style="color: rgb(0,0,0);"> </span></span>

## Supported browsers

-   <span style="color: rgb(0,0,0);">Apple® Safari® <span style="color: rgb(0,0,0);">most recent stable version</span></span><span style="color: rgb(0,0,0);"><span style="color: rgb(0,0,0);">, desktop<span> *and* tablet</span></span></span>

-   <span style="color: rgb(0,0,0);"><span><span style="color: rgb(0,0,0);">Opera® <span style="color: rgb(0,0,0);">most recent stable version</span>, or higher, <span style="color: rgb(0,0,0);">desktop *and* mobile</span></span><span style="color: rgb(0,0,0);"> </span></span></span>

Please note that the user interface might not look or behave exactly the same across all browsers as it will gracefully degrade if browser does not support certain features.

 

#### In this topic:

-   [Platform as a Service (PaaS)](#Step0:Requirements&SystemConfiguration-PlatformasaService(PaaS))
-   [Server](#Step0:Requirements&SystemConfiguration-Server)
    -   [Recommended setups](#Step0:Requirements&SystemConfiguration-Recommendedsetups)
    -   [Supported setups](#Step0:Requirements&SystemConfiguration-Supportedsetups)
    -   [Development & Experimental setups](#Step0:Requirements&SystemConfiguration-Development&Experimentalsetups)
-   [Client](#Step0:Requirements&SystemConfiguration-clientClient)
    -   [Recommended browsers](#Step0:Requirements&SystemConfiguration-Recommendedbrowsers)
    -   [Supported browsers](#Step0:Requirements&SystemConfiguration-Supportedbrowsers)

#### Related:

-   [Clustering](Clustering_31430387.html)
-   [Performance](Performance_33555232.html)

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Get Started with eZ Platform](Get-Started-with-eZ-Platform_31429520.html)</span>

 Developer : Step 1: Installation 



## Install All The Things!

Well, at least the things required to run your chosen distribution:

General installation guide for all eZ distributions

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<span id="Step1:Installation-InstallationLinks" class="confluence-anchor-link"></span>This installation guide can be followed with any eZ distribution based on the Symfony framework. Here's a list of available <span>distributions from eZ</span>:

| Type                                                                                      | Archive                                                                                                                                     | License                                                                                                                                                                | GIT */ Composer*                                                                                                                          |
|-------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| **eZ Platform**<span style="color: rgb(128,128,128);">*                                   
 "clean" distribution*</span>                                                               | <a href="http://share.ez.no/downloads/downloads">share.ez.no/downloads/downloads</a>                                  | GPLv2                                                                                                                                                                  | <a href="https://github.com/ezsystems/ezplatform">ezsystems/ezplatform</a>                                          
                                                                                                                                                                                                                                                                                                                                                                                                                    (<a href="https://github.com/ezsystems/ezplatform/blob/master/INSTALL.md">INSTALL.md</a>)                            |
| <span>eZ Platform Demo                                                                    
 </span><span style="color: rgb(128,128,128);">*Not for production use*</span>              | <span style="color: rgb(128,128,128);"> *Available via Git / Composer* </span>                                                              | GPLv2                                                                                                                                                                  | <a href="https://github.com/ezsystems/ezplatform-demo">ezsystems/ezplatform-demo</a>                                |
| **eZ Platform Enterprise Edition**                                                        
 <span style="color: rgb(128,128,128);">*"clean" distribution* </span>                      | <span style="color: rgb(153,153,153);"> <a href="https://support.ez.no/Downloads">support.ez.no/Downloads</a> </span> | BUL <span style="color: rgb(128,128,128);">(***Requires <a href="http://ez.no/Products/eZ-Enterprise">eZ Enterprise</a> subscription)*** </span> | <a href="https://github.com/ezsystems/ezplatform-ee">ezsystems/ezplatform-ee</a>                                    
                                                                                                                                                                                                                                                                                                                                                                                                                    <span>(</span> <a href="https://github.com/ezsystems/ezstudio/blob/master/INSTALL.md">INSTALL.md</a> <span>)</span>  |
| eZ Platform <span>Enterprise Edition Demo</span><span style="color: rgb(128,128,128);"> * 
 Not for production use*</span>                                                             | <span style="color: rgb(153,153,153);"> <a href="https://support.ez.no/Downloads">support.ez.no/Downloads</a> </span> | BUL <span style="color: rgb(128,128,128);">(**R*equires <a href="http://ez.no/Products/eZ-Enterprise">eZ Enterprise</a> subscription)*** </span> | <a href="https://github.com/ezsystems/ezplatform-ee-demo">ezsystems/ezplatform-ee-demo</a>                          |

## Choose Your Adventure!

Instructions vary depending on your desired operating system and method of installation. We recommend using Composer:

-   [Installation Using Composer](Installation-Using-Composer_31429546.html)
-   [Manual Installation Guides](Manual-Installation-Guides_31431727.html)
    -   [Installation Guide for OS X](Installation-Guide-for-OS-X_31431738.html)
    -   [Installation Guide for Unix-Based Systems](Installation-Guide-for-Unix-Based-Systems_31431755.html)
        -   [Setup folder rights](Setup-folder-rights_32866325.html)
        -   [Set up Swap on Debian 8.x](Set-up-Swap-on-Debian-8.x_32114141.html)
    -   [Manual Installation on Windows](Manual-Installation-on-Windows_32113648.html)
-   [Starting eZ Platform](Starting-eZ-Platform_31429550.html)
    -   [Web Server](Web-Server_31429554.html)
    -   [PHP's built-in server](31429556.html)
-   [Hello World!](31429552.html)
-   [Installation Using Docker](Installation-Using-Docker_32113397.html)
-   [Avoiding Problems](Avoiding-Problems_32113599.html)

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Get Started with eZ Platform](Get-Started-with-eZ-Platform_31429520.html)</span>

 Developer : Step 2: Going Deeper 



Now that you have eZ Platform installed, what's next?

 

-   Follow one of the tutorials that will lead you step-by-step through some of the operations you can do.
    (See [Next Steps: Follow a Tutorial Path](31429565.html).)
-   Play with a ready-to-use demo that lets you see and investigate how an example website is built.
    (See [eZ Platform Demo](eZ-Platform-Demo_31429540.html).)
-   Learn what eZ Enterprise has to offer on top of eZ Platform.
    (See [Get Started with eZ Enterprise](Get-Started-with-eZ-Enterprise_31429569.html).)

 

-   [Using Composer](Using-Composer_31431588.html)
-   [Next Steps: Follow a Tutorial Path](31429565.html)
-   [eZ Platform Features](eZ-Platform-Features_32866981.html)
-   [eZ Platform Demo](eZ-Platform-Demo_31429540.html)
-   [Get Started with eZ Enterprise](Get-Started-with-eZ-Enterprise_31429569.html)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Get Started with eZ Platform](Get-Started-with-eZ-Platform_31429520.html)</span>
4.  <span>[Step 1: Installation](31429538.html)</span>

 Developer : Hello World! 



Now your installation is ready and you're on your way to starting work with eZ Platform.

To access the back office of your installation, append `/ez` to its path: &lt;`your_installation path>/ez`. You will be prompted for the username and password, which by default are:

username: admin
password: publish

 

A clean installation of eZ Platform is empty, so you only get a single page with a rudimentary content model. This is a blank canvas for you to create and customize your own structure.

If you'd like to take a look at an example of using the system to construct a fully functional page, you can also [install eZ Platform with the Demo Bundle](eZ-Platform-Demo_31429540.html).

 

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Get Started with eZ Platform](Get-Started-with-eZ-Platform_31429520.html)</span>
4.  <span>[Step 1: Installation](31429538.html)</span>
5.  <span>[Starting eZ Platform](Starting-eZ-Platform_31429550.html)</span>

 Developer : PHP's built-in server 



## <span style="color: rgb(0,98,147);">Description</span>

PHP, in 5.4 and later, comes with a <a href="http://php.net/manual/en/features.commandline.webserver.php">built-in webserver for development purposes</a>. This is very handy, as it allows you to **kickstart development quickly**, avoiding having to install and configure <a href="https://github.com/ezsystems/ezplatform/tree/master/doc/apache2">Apache</a> / <a href="https://github.com/ezsystems/ezplatform/tree/master/doc/nginx">Nginx</a>. All you need here is PHP 5.4+ with command line binary.

## Usage

Symfony comes with a wrapper script for booting the built-in webserver: `server:run`. It's a nice shortcut as it will correctly set the web root depending on your configuration, and with eZ Platform it can be used as is.

<span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
Use this command for **local development purpose only**!
DO NOT use this on production servers, the use of `--env=prod` below is just showcasing that you can use the command both with Symfony's dev and prod environment depending on if you are debugging or just testing out your application locally.

##### Examples

The following example will start the webserver on <a href="http://127.0.0.1:8000" class="uri">http://127.0.0.1:8000</a> on your machine, in Symfony dev environment for debug use:

**Debug example**

``` brush:
php app/console server:run
```

The following example will start the webserver on <a href="http://localhost:8000/">http://localhost:8000</a> on your machine, in Symfony prod environment for demo/testing use:

**Testing/Demo example**

``` brush:
php app/console server:run --env=prod localhost:8000
```

 

##### **Help with the command**

As with any Symfony command, you may execute the command with a `-h` flag to get up-to-date help text for the command:

**Help info example**

``` brush:
php app/console server:run -h
```

 

 

#### Further reading:

<a href="http://symfony.com/doc/current/cookbook/web_server/built_in.html" class="uri">http://symfony.com/doc/current/cookbook/web_server/built_in.html</a>






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Get Started with eZ Platform](Get-Started-with-eZ-Platform_31429520.html)</span>
4.  <span>[Step 2: Going Deeper](31429542.html)</span>

 Developer : Next Steps: Follow a Tutorial Path 



With your system configured and eZ Platform up and running, you're ready to dive in and follow a tutorial.

 

You may want to start by [Building a Bicycle Route Tracker in eZ Platform](Building-a-Bicycle-Route-Tracker-in-eZ-Platform_31431606.html), in which you'll learn how to build an eZ Platform website from the ground up.

 

#### All available tutorials:

-   [Building a Bicycle Route Tracker in eZ Platform](Building-a-Bicycle-Route-Tracker-in-eZ-Platform_31431606.html) — <span class="smalltext">This tutorial is a step-by-step guide to building an eZ Platform website from the ground up. </span>
-   [eZ Enterprise Beginner Tutorial - It's a Dog's World](32868209.html) — <span class="smalltext">This tutorial will guide you through the process of making and customizing a front page for your website. For this purpose we will use a feature of eZ Platform Enterprise Edition called Landing Page.</span>
-   [Creating a Tweet Field Type](Creating-a-Tweet-Field-Type_31429766.html) — <span class="smalltext">This tutorial aims at covering the creation and development of a custom eZ Platform Field Type https://doc.ez.no/display/DEVELOPER/Field+Types+reference.</span>
-   [Extending PlatformUI with new navigation](Extending-PlatformUI-with-new-navigation_31430235.html) — <span class="smalltext">This tutorial aims at providing a step-by-step guide on how to extend the JavaScript application provided by the PlatformUI bundle https://github.com/ezsystems/PlatformUIBundle.</span>

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Community Resources](Community-Resources_31429530.html)</span>
4.  <span>[How to Contribute](How-to-Contribute_31429587.html)</span>

 Developer : Report and follow issues: The bugtracker 



The development of eZ projects is organized using a bugtracker. It can be found here: <a href="https://jira.ez.no" class="uri">https://jira.ez.no</a>. Its role is to centralize references to all improvements, bug fixes and documentation being added to eZ projects.

The first thing you should do in order to be able to get involved and have feedback on what is happening on eZ projects is to create a JIRA account.

**Note:** The term "issue" is used to refer to a bugtracker item regardless of its type (bug, improvement, story, etc.)

# How to find an existing issue

When you have a great idea or if you have found a bug, you may want to create a new issue to let everyone know about it. Before doing that, you should make sure no one has made a similar report before.

In order to do that, you should use the search page available in the top menu (under **Issues/Search for issues**) or the search box in the top right corner. Using filters and keywords you should be able to search and maybe find an issue to update instead of creating a new one.

# How to improve existing issues

Existing issues need to be monitored, sorted and updated in order to be processed in the best way possible.

In case of bugs, trying to reproduce them, in order to confirm that they are (still) valid, is a great help for developers who will later troubleshoot and fix them. By doing that you can also provide extra information, if needed, such as:

-   Extra steps to reproduce
-   Context/environment-specific information
-   Links to duplicate or related issues

In case of improvements, you can add extra use cases and spot behaviors that might be tricky or misleading.

# How to follow an issue

Every issue has a "Start watching this issue" link. It lets you receive notifications each time the issue is updated.

This way you can get and provide feedback during the issue's life. You are also informed about ongoing development regarding the issue and can try out patches before they are integrated into the product.

# How to report an issue

If you cannot find an issue matching what you are about to report using the search page, you need to create a new one.
Click **Create** at the top of the bugtracker window and fill in the form:

-   **Project**: Select **eZ Publish/Platform** if your issue affects platform as a standalone project, or **eZ Studio** if eZ Platform Enterprise Edition is needed in order to reproduce the issue.
-   **Issue type**: Choose **Bug** or **Improvement** depending on what you are reporting, do not use other issue types (they are for internal use only).
-   **Summary**: Write a short sentence describing what you are reporting.
-   **Security level**: Select security if you are reporting a security issue. It will make your issue visible only to you and the core dev team until it is fixed and distributed.
-   **Priority**: Select the priority you consider the issue to be. Please try to keep a cool head while selecting it. A 1 pixel alignment bug is not a "blocker" :)
-   **Component/s**: This is important, as it will make your issue appear on the radar (dashboards, filters) of people dealing with various parts of eZ projects.
-   **Affect version/s**: Add the versions of the application you experienced the issue on.
-   **Fix version/s**: Leave blank.
-   **Assignee**: Leave blank, unless you are willing to work on the issue yourself.
-   **Reporter**: Leave as is (yourself).
-   **Environment**: Enter specific information regarding your environment that could be relevant in the context of the issues.
-   **Description**: This is the most important part of the issue report. In case of a bug, it **must** contain explicit steps to reproduce to your issue. Anybody should be able to reproduce it at first try. In case of an improvement, it needs to contain use cases and detailed information regarding the expected behavior.
-   **Labels**: Leave blank.
-   **Epic Link**: Leave blank.
-   **Sprint**: Leave blank.

 

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : Under the Hood: How eZ Platform Works 



Contributing to the doc

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
This part of the documentation is still a <span class="status-macro aui-lozenge aui-lozenge-current">WORK-IN-PROGRESS</span>. Would you like to contribute to it?

If you have any thoughts or tips to share, let us know in the comments below, visit our <a href="http://ez-community-on-slack.herokuapp.com/">Slack channel</a> or take a look at other ways to [Contribute to Documentation](https://doc.ez.no/display/DEVELOPER/Contribute+to+Documentation).

-   [Philosophy & Guiding Principles: The eZ Way](31429705.html)
-   [Architecture: An Open Source PHP CMS Built On Symfony2 Full Stack](31429707.html)
-   [Content Model: Content is King!](31429709.html)
-   [Interfacing with eZ: APIs and GUIs](31429711.html)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Introduction](Introduction_31429657.html)</span>

 Developer : What is eZ Platform? 



eZ Platform is an open-source, Symfony-based CMS. With its modern architecture and flexibility it lets you customize, extend and scale your sites and apps with ease. It is built on top of the Symfony full-stack framework and enables you to tailor your content model and distribute your content however you like.

 

**Take control of your content:**

Seamlessly deliver content on your site or app and use our fully featured REST API to integrate content from apps or deliver Content as a Service.

**Take advantage of Symfony, the leading PHP framework:**

Develop in a very similar way to pure Symfony, with the same templating system, Twig, the same library for deployment and version dependency, Composer, and many other Symfony bundles and components.

**Speed up time-to-market:**

Developers who use Symfony can start customizing and extending eZ Platform right out of the gate. New to Symfony? You have plenty to gain.

**Start with clean code:**

eZ carries a substantially low level of technical debt compared to many other CMSs.

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Introduction](Introduction_31429657.html)</span>

 Developer : What is eZ Platform Enterprise Edition? 



eZ Platform Enterprise Edition is a commercial addition and extension to eZ Platform. It makes use of everything that the platform has to offer, and expands it capabilities.

Enterprise contains a new intuitive, easy-to-learn editing interface called Studio UI, but also adds new functionalities to the existing interfaces. The main features available in eZ Enterprise are:

 

**Inline editing of content:**

eZ Enterprise's Studio UI lets you create block-based Landing Pages using drag-and-drop. This makes building them easy for editors even with no web design experience or HTML knowledge, using prebuilt elements such as headers, banners, image galleries, content lists, tags and more. At the same time, developers can customize Landing Pages by creating adaptable layouts and offering their own custom blocks to be placed in them.

<span class="confluence-link"><span class="confluence-link">[Working with a Landing Page](https://doc.ez.no/display/USER/3.+Creating+content%2C+basic#id-3.Creatingcontent,basic-WorkingwithaLandingPage(Enterprise))</span></span> (in the User doc) describes how to use the Inline editor.

**Creating Landing Pages with customizable blocks:**

You can quickly switch between working on and previewing Landing Pages, which makes for comfortable editing and better control of your content.

[Creating Landing Page blocks (Enterprise)](31430614.html) shows how to create and customize you own blocks.

**Scheduling automatic publication of content on Landing Pages:**

Using a special Schedule Block you can set up content on your Landing Pages to be published according to a custom schedule, at predefined dates and times. A Timeline slider lets you preview what the pages will look like at any time.

<span class="confluence-link"> </span>[<span class="confluence-link">Scheduling</span>](https://doc.ez.no/display/USER/5.+Publishing#id-5.Publishing-Scheduling(Enterprise)) (User doc) presents how to use this block to plan airtimes.

**Content review workflow:**

Flex Workflow is a collaboration feature. You can send your content draft to any user and let them look through, modify it and send it onward through your review process.

<span class="confluence-link"> </span>[<span class="confluence-link">Review workflow</span>](https://doc.ez.no/display/USER/5.+Publishing#id-5.Publishing-Reviewworkflow(Enterprise)) (User doc) describes how to send and receive content for review.

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Introduction](Introduction_31429657.html)</span>

 Developer : Why eZ? 



<span class="jira-issue"> <a href="https://jira.ez.no/browse/COM-19966?src=confmacro" class="jira-issue-key"><img src="https://jira.ez.no/images/icons/issuetypes/newfeature.png" class="icon" />COM-19966</a> - <span class="summary">Developer Feedback Section</span> <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-complete jira-macro-single-issue-export-pdf">Open</span> </span>






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>

 Developer : Philosophy & Guiding Principles: The eZ Way 








1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>

 Developer : Architecture: An Open Source PHP CMS Built On Symfony2 Full Stack 



<span style="color: rgb(0,0,0);">This page describes the new generation eZ CMS architecture introduced as of eZ Platform and eZ Studio in 2015. However, this architecture has already been battle-tested by large multinational companies as part of eZ Publish Platform 5.x series since 2012.</span>

<span style="color: rgb(0,0,0);">
</span>

# Overview

<span style="color: rgb(128,128,128);">TODO: Illustration of layers: Symfony &gt; eZ Platform &gt; eZ Services</span>

## Symfony Full stack

## eZ Platform

# eZ Platform Architecture details

<span style="color: rgb(0,0,0);text-decoration: none;"> </span><span style="color: rgb(0,0,0);text-decoration: none;"> </span>

<span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img src="attachments/31429707/31431654.png" class="confluence-embedded-image" width="600" /></span>

<span style="color: rgb(0,0,0);text-decoration: none;">
</span>

<span style="color: rgb(0,0,0);text-decoration: none;">The architecture is layered and uses clearly defined APIs between the layers.</span>

-   <span style="color: rgb(0,0,0);text-decoration: none;">The **business logic** is defined in a new kernel. This business logic is exposed to applications via an API (the <span style="color: rgb(0,0,0);text-decoration: none;"><span style="color: rgb(0,0,0);text-decoration: none;">[Public API](eZ-Platform-Public-PHP-API_31429583.html)</span></span>). Developers rely on this to develop websites and web applications using Symfony to organize the way they develop the user interface layer. </span>

-   <span style="color: rgb(0,0,0);text-decoration: none;">User interfaces are developed using the Twig template engine but directly querying the <span style="color: rgb(0,0,0);text-decoration: none;"><span style="color: rgb(0,0,0);text-decoration: none;"><span style="color: rgb(0,0,0);text-decoration: none;">[Public API](eZ-Platform-Public-PHP-API_31429583.html)</span></span></span>.</span>

-   <span style="color: rgb(0,0,0);text-decoration: none;">Integration of eZ Platform in other applications is done using the <span style="color: rgb(0,0,0);text-decoration: none;"> </span>[<span style="color: rgb(0,0,0);text-decoration: none;"><span class="confluence-link">Rest API</span></span>](REST-API-Guide_31430286.html), which itself relies also on the <span style="color: rgb(0,0,0);text-decoration: none;"><span style="color: rgb(0,0,0);text-decoration: none;"><span style="color: rgb(0,0,0);text-decoration: none;">[Public API](eZ-Platform-Public-PHP-API_31429583.html)</span></span></span>.</span>

-   <span style="color: rgb(0,0,0);text-decoration: none;">Finally, the development of extensions for eZ Platform is done using the Symfony framework when it comes to the structure of the code, and once again relying on the Public API when it comes to accessing content management functions.</span>

<span style="color: rgb(0,0,0);text-decoration: none;">At a lower level, the new architecture also totally redefined the way the system stores data. While this is not finalized in version 5.0 (where the new storage system is only shipped with MySQL support), the architecture, when finalized will rely on a storage API that will be used to develop drivers to any kind of storage subsystem.</span>

<span style="color: rgb(0,0,0);text-decoration: none;">A motto for this new architecture is to **heavily use APIs** that will be maintained on the long term to **ease upgrades and provide lossless couplings** between all parts of the architecture, <span style="color: rgb(0,0,0);text-decoration: none;">at the same time</span> improving the migration capabilities of the system. </span>

 

 

#### In this topic:

-   [Overview](#Architecture:AnOpenSourcePHPCMSBuiltOnSymfony2FullStack-Overview)
    -   [Symfony Full stack](#Architecture:AnOpenSourcePHPCMSBuiltOnSymfony2FullStack-SymfonyFullstack)
    -   [eZ Platform](#Architecture:AnOpenSourcePHPCMSBuiltOnSymfony2FullStack-eZPlatform)
-   [eZ Platform Architecture details](#Architecture:AnOpenSourcePHPCMSBuiltOnSymfony2FullStack-eZPlatformArchitecturedetails)

## Attachments:

<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [ez5-architecture 5.4.5.png](attachments/31429707/31431654.png) (image/png)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>

 Developer : Content Model: Content is King! 



Everyone knows that Content is King, and in eZ Platform, everything is Content!

Take a look at the content model underlying eZ Platform.

 

### Content model overview

The content structure in eZ is based on ideas borrowed from Object-Oriented programming, as seen in popular languages such as C\#, Java or PHP.

In this understanding an "object" in the eZ Platform is called a Content Item and represents <span class="DEF">a single piece of content: an article, a blog post, an image, a product, etc.</span> Each Content item is an instance of a "class," called a Content Type.

 

 

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
An introduction to the eZ content model aimed at non-developer users, is available at [Under the hood, concepts and organization](https://doc.ez.no/display/USER/2.+Under+the+hood%2C+concepts+and+organization).

 

 

#### Related topics:

[Content items, Content Types and Fields](31430275.html)

[Locations](https://doc.ez.no/display/DEVELOPER/Repository#Repository-LocationsLocations)

[Content Relations](Repository_31432023.html#Repository-ContentRelations)

[Internationalization](Internationalization_31429671.html)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>

 Developer : Interfacing with eZ: APIs and GUIs 



You can interface with eZ Platform using both APIs and a GUI.

eZ Platform offers two APIs:

-   the [REST API](REST-API-Guide_31430286.html) allows you to interact with an eZ Platform installation using the HTTP protocol, following a <span>REST</span> interaction model,
-   the [Public (PHP) API](Public-API-Guide_31430303.html) exposes a Repository which allows you to create, read, update, manage and delete all objects available in eZ Platform, first and foremost content, but also related objects like sections, locations, content types, content types groups, languages and so on.

 

The graphical interface available through the [backend interface](Extending-eZ-Platform_31429689.html) allows editors and content managers to easily create and manipulate content without developer knowledge. The GUI also covers a number of fundamental administrative operations available in an Admin Panel.

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
You can find a description and guide for using the GUI for non-developers in a [separate documentation center](https://doc.ez.no/display/USER/Documentation).

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>
4.  <span>[Creating a Tweet Field Type](Creating-a-Tweet-Field-Type_31429766.html)</span>

 Developer : Implement the Tweet\\Value class 



The Value class of a Field Type is by design very simple. It is meant to be stateless, and as lightweight as possible. Therefore, this class must contain as little logic as possible, as this is the responsibility of the Type class .

The Value will at least contain:

-   public properties, used to store the actual data 

-   an implementation of the `__toString()` method (required by the Value interface we inherit from)

By default, the constructor from `      FieldType\Value    ` will be used, and allows you to pass a hash of property/value pairs. In our example, we can see that we can override it as well if we want.

The Tweet Field Type is going to store three things:

-   The tweet’s URL

-   The tweet’s author URL

-   The body, as an HTML string  

At this point, we don’t care where those are stored. All we care about is what we want our Field Type to expose as an API. We end up with the following properties:

**eZ/FieldType/Tweet/Value.php**

``` brush:
/**
* Tweet URL on twitter.com (http://twitter.com/UserName/status/id).
* @var string
*/
public $url;

 
/**
* Author's tweet URL (http://twitter.com/UserName)
* @var string
*/
public $authorUrl;

 
/**
* The tweet's embed HTML
* @var string
*/
public $contents;
```

The only thing left to honor the `      FieldType\Value    ` interface is the `      __toString()` method. Let’s say that ours will return the tweet’s URL:

**eZ/FieldType/Tweet/Value.php**

``` brush:
public function __toString()
{
   return $this->url;
}
```

**Tutorial path**






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>
4.  <span>[Creating a Tweet Field Type](Creating-a-Tweet-Field-Type_31429766.html)</span>

 Developer : Implement the Tweet\\Type class 



As said in the introduction, the Type class of a Field Type must implement `eZ\Publish\SPI\FieldType\FieldType` (later referred to as "Field Type interface").

All native Field Types also extend the `eZ\Publish\Core\FieldType\FieldType` abstract class that implements this interface and provides implementation facilities through a set of abstract methods of its own. In this case, Type classes implement a mix of methods from the Field Type interface and from the abstract Field Type.

Let’s go over those methods and their implementation.

#### Identification method: `getFieldTypeIdentifier()`

It must return the string that uniquely identifies this Field Type (DataTypeString in legacy). We will use "`eztweet`":

**eZ/FieldType/Tweet/Type**

``` brush:
public function getFieldTypeIdentifier()
{
   return 'eztweet';
}
```

#### Value handling methods: `createValueFromInput()` and `checkValueStructure()`

Both methods are used by the abstract Field Type implementation of `acceptValue()`. This Field Type interface method checks and transforms various input values into the type's own Value class: `eZ\FieldType\Tweet\Value`. This method must:

-   either return the Value object it was able to create out of the input value,
-   or return this value untouched. The API will detect this and inform that the input value was not accepted.

The only acceptable value for our type is the URL of a tweet (we could of course imagine more possibilities). This should do:

 

``` brush:
protected function createValueFromInput( $inputValue )
{
   if ( is_string( $inputValue ) )
   {
       $inputValue = new Value( array( 'url' => $inputValue ) );
   }
 
   return $inputValue;
}
```

Use this method to provide convenient ways to set an attribute’s value using the API. This can be anything from primitives to complex business objects.

Next, we will implement `     checkValueStructure()`. It is called by the abstract Field Type to ensure that the Value fed to the Type is acceptable. In our case, we want to be sure that `Tweet` `     \Value::$url` is a string:

 

``` brush:
protected function checkValueStructure( BaseValue $value )
{
   if ( !is_string( $value->url ) )
   {
       throw new eZ\Publish\Core\Base\Exceptions\InvalidArgumentType(
           '$value->url',
           'string',
           $value->url
       );
   }
}
```

Yes, we execute the same check as in `createValueFromInput()`. But both methods aren't responsible for the same thing. The first will, *if given something else than a Value of its type*, try to convert it to one. `checkValueStructure()` will always be used, even if the Field Type is directly fed a `Value` object, and not a string.

#### Value initialization: `getEmptyValue()`

This method provides what is considered as an empty value of this type, depending on our business requirements. No extra initialization is required in our case.

 

``` brush:
public function getEmptyValue()
{
   return new Value;
}
```

If you run the unit tests at this point, you should get about five failures, all of them on the `fromHash()` or `     toHash()` methods.

#### Validation methods: `validateValidatorConfiguration()` and `validate()`

The Type class is also responsible for validating input data (to a `Field`), as well as configuration input data (to a `FieldDefinition`). In this tutorial, we will run two validation operations on input data:

-   validate submitted urls, ensuring they actually reference a twitter status;

-   limit input to a known list of authors, as an optional validation step.

`     validateValidatorConfiguration()` will be called when an instance of the Field Type is added to a Content Type, to ensure that the validator configuration is valid. For a TextLine (length validation), it means checking that both min length and max length are positive integers, and that min is lower than max.

When an instance of the type is added to a Content Type, `validateValidatorConfiguration()` receives the configuration for the validators used by the Type as an array. It must return an array of error messages if errors are found in the configuration, and an empty array if no errors were found.

For TextLine, the provided array looks like this:

 

``` brush:
array(
   'StringLengthValidator' => array(
       'minStringLength' => 0,
       'maxStringLength' => 100
   )
);
```

The structure of this array is totally free, and up to each type implementation. We will in this tutorial mimic what is done in native Field Types:

Each level one key is the name of a validator, as acknowledged by the Type. That key contains a set of parameter name / parameter value rows. We must check that:

-   all the validators in this array are known to the type

-   arguments for those validators are valid and have sane values

We do not need to include mandatory validators if they don’t have options. Here is an example of what our Type expects as validation configuration:

 

``` brush:
array(
   ‘TweetAuthorValidator’ => array(
       ‘AuthorList’ => array( ‘johndoe’, ‘janedoe’ )
   )
);
```

The configuration says that tweets must be either by johndoe or by janedoe. If we had not provided TweetAuthorValidator at all, it would have been ignored.

We will iterate over the items in `$validatorConfiguration` and:

add errors for those we don’t know about;

check that provided arguments are known and valid:

-   TweetAuthorValidator accepts a non-empty array of valid Twitter usernames

 

``` brush:
public function validateValidatorConfiguration( $validatorConfiguration )
{
   $validationErrors = array();

   foreach ( $validatorConfiguration as $validatorIdentifier => $constraints )
   {
       // Report unknown validators
       if ( !$validatorIdentifier != 'TweetAuthorValidator' )
       {
           $validationErrors[] = new ValidationError( "Validator '$validatorIdentifier' is unknown" );
           continue;
       }
 
       // Validate arguments from TweetAuthorValidator
       if ( !isset( $constraints['AuthorList'] ) || !is_array( $constraints['AuthorList'] ) )
       {
           $validationErrors[] = new ValidationError( "Missing or invalid AuthorList argument" );
           continue;
       }
 
       foreach ( $constraints['AuthorList'] as $authorName )
       {
           if ( !preg_match( '/^[a-z0-9_]{1,15}$/i', $authorName ) )
           {
               $validationErrors[] = new ValidationError( "Invalid twitter username" );
           }
       }
   }

 
   return $validationErrors;
}
```

`     validate()` is the method that runs the actual validation on data, when a content item is created with a Field of this type:

 

``` brush:
   public function validate( FieldDefinition $fieldDefinition, SPIValue $fieldValue )
   {
       $errors = array();

       if ( $this->isEmptyValue( $fieldValue ) )
       {
           return $errors;
       }
 
       // Tweet Url validation
       if ( !preg_match( '#^https?://twitter.com/([^/]+)/status/[0-9]+$#', $fieldValue->url, $m ) )
           $errors[] = new ValidationError( "Invalid twitter status url %url%", null, array( $fieldValue->url ) );

       $validatorConfiguration = $fieldDefinition->getValidatorConfiguration();
       if ( isset( $validatorConfiguration['TweetAuthorValidator'] ) )
       {
           if ( !in_array( $m[1], $validatorConfiguration['TweetAuthorValidator']['AuthorList'] ) )
           {
               $errors[] = new ValidationError(
                   "Twitter user %user% is not in the approved author list",
                   null,
                   array( $m[1] )
               );
           }
       }
 
       return $errors;
   }
```

First, we validate the url with a regular expression. If it doesn’t match, we add an instance of `     ValidationError   ` to the return array. Note that the tested value isn’t directly embedded in the message but passed as an argument. This ensures that the variable is properly encoded in order to prevent attacks, and allows for singular/plural phrases using the second parameter.

Then, if our Field Type instance’s configuration contains a `     TweetAuthorValidator   ` key, we check that the username in the status url matches one of the valid authors.

#### Metadata handling methods: `getName()` and `getSortInfo()`.

Field Types require two methods related to Field metadata:

-   ` getName()       ` is used to generate a name out of a Field value, either to name a Content item (naming pattern in legacy) or to generate a part for an URL Alias.

-   ` getSortInfo()       ` is used by the persistence layer to obtain the value it can use to sort & filter on a Field of this type

Obviously, a tweet’s full URL isn’t really suitable as a name. Let’s use a subset of it: `     <username>-<tweetId>   ` should be reasonable enough, and suitable for both sorting and naming.

 

We can assume that this method will not be called if the Field is empty, and will assume that the URL is a valid twitter URL:

 

``` brush:
public function getName( SPIValue $value )
{
   return preg_replace(
       '#^https?://twitter\.com/([^/]+)/status/([0-9]+)$#',
       '$1-$2',
       (string)$value->url );
}

 
protected function getSortInfo( CoreValue $value )
{
   return $this->getName( $value );
}
```

In `     getName()` we run a regular expression replace on the URL to extract the part we’re interested in.

This name is a perfect match for `     getSortInfo()` as it allows us to sort on the tweet’s author and on the tweet’s ID.

#### Field Type serialization methods: `fromHash()` and `toHash()`

Both methods defined in the Field Type interface, are core to the REST API. They are used to export values to serializable hashes.

In our case, it is quite easy:

-   ` toHash()       ` will build a hash with every property from `Tweet\Value`;

-   ` fromHash()       ` will instantiate a `Tweet\Value` with the hash it receives.  

 

``` brush:
public function fromHash( $hash )
{
   if ( $hash === null )
   {
       return $this->getEmptyValue();
   }
   return new Value( $hash );
}
 
public function toHash( SPIValue $value )
{
   if ( $this->isEmptyValue( $value ) )
   {
       return null;
   }
   return array(
       'url' => $value->url
   );
}
```

#### Persistence methods: `fromPersistenceValue` and `toPersistenceValue`

Storage of Field Type data is done through the persistence layer (SPI).

Field Types use their own Value objects to expose their contents using their own domain language. However, to store those objects, the Type needs to map this custom object to a structure understood by the persistence layer: `PersistenceValue`. This simple value object has three properties:

-   `data` – standard data, stored using the storage engine's native features
-   `externalData` – external data, stored using a custom storage handler
-   `sortKey` – sort value used for sorting

The role of those mapping methods is to convert a `Value` of the Field Type into a `PersistenceValue` and the other way around.

About external storage

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Whatever is stored in {{externalData}} requires an external storage handler to be written. Read more about external storage on [Field Type API and best practices](Field-Type-API-and-best-practices_31430767.html).

External storage is beyond the scope of this tutorial, but many examples can be found in existing Field Types.

We will follow a simple implementation here: the `Tweet\Value` object will be serialized as an array to the `code` property using `fromHash()` and `toHash()`:

**Tweet\\Type**

``` brush:
/**
 * @param \EzSystems\TweetFieldTypeBundle\eZ\Publish\FieldType\Tweet\Value $value
 * @return \eZ\Publish\SPI\Persistence\Content\FieldValue
 */
public function toPersistenceValue( SPIValue $value )
{
    if ( $value === null )
    {
        return new PersistenceValue(
            array(
                "data" => null,
                "externalData" => null,
                "sortKey" => null,
            )
        );
    }
    return new PersistenceValue(
        array(
            "data" => $this->toHash( $value ),
            "sortKey" => $this->getSortInfo( $value ),
        )
    );
}
/**
 * @param \eZ\Publish\SPI\Persistence\Content\FieldValue $fieldValue
 * @return \EzSystems\TweetFieldTypeBundle\eZ\Publish\FieldType\Tweet\Value
 */
public function fromPersistenceValue( PersistenceValue $fieldValue )
{
    if ( $fieldValue->data === null )
    {
        return $this->getEmptyValue();
    }
    return new Value( $fieldValue->data );
}
```

 

##### Fetching data from the Twitter API

As explained in the tutorial's introduction, we will enrich our tweet's URL with the embed version, fetched using the Twitter API. To do so, we will, when `toPersistenceValue()` is called, fill in the value's contents property from this method, before creating the `PersistenceValue` object.

First, we need a twitter client in `Tweet\Type`. For convenience, we provide one in this tutorial's bundle:

-   The `Twitter\TwitterClient` class:
-   The `Twitter\TwitterClientInterface` interface
-   An `ezsystems.tweetbundle.twitter.client` service that uses the class above.

The interface has one method: `getEmbed( $statusUrl )` that, given a tweet's URL, returns the embed code as a string. The implementation is very simple, for the sake of simplicity, but gets the job done. Ideally, it should at the very least handle errors, but it is not necessary here.

###### Injecting the Twitter client into `Tweet\Type`

Our Field Type doesn't have a constructor yet. We will create one, with an instance of `Twitter\TwitterClientInterface` as the argument, and store it in a new protected property:

**eZ/Publish/FieldType/Tweet/Type.php:**

``` brush:
use EzSystems\TweetFieldTypeBundle\Twitter\TwitterClientInterface;
 
class Type extends FieldType
{
    /** @var TwitterClientInterface */
    protected $twitterClient;

    public function __construct( TwitterClientInterface $twitterClient )
    {
        $this->twitterClient = $twitterClient;
    }
}
```

###### Completing the value using the twitter client

As described above, before creating the `PersistenceValue` object in `toPersistenceValue`, we will fetch the tweet's embed contents using the client, and assign it to `Tweet\Value::$data`:

**eZ/Publish/FieldType/Tweet/Type.php**

``` brush:
 public function toPersistenceValue( SPIValue $value )
{
    // if ( $value === null )
    // {...}


    if ( $value->contents === null )
    {
        $value->contents = $this->twitterClient->getEmbed( $value->url );
    }
    return new PersistenceValue(
    // array(...)
}
```

And that's it! When the persistence layer stores content from our type, the value will be completed with what the twitter API returns.

 

**Tutorial path**






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Cookbook](Cookbook_31429528.html)</span>

 Developer : Creating Landing Page layouts (Enterprise) 



# Description

<span class="status-macro aui-lozenge aui-lozenge-current">V1.2</span>

A Landing Page has a customizable <span class="DEF"><span class="DEF">layout</span></span> with multiple zones where you can place predefined blocks with content.

By default eZ Enterprise comes with a number of preset layouts. You can, however, add custom layouts with zones to your configuration.

# Solution

## Defining the layout

A Landing Page layout is composed of zones.

### Zone structure

Each zone contains the following parameters: **<span style="color: rgb(255,0,0);">
</span>**

| Name             | Description                  |
|------------------|------------------------------|
| &lt;zone\_id&gt; | *Required*. A unique zone ID |
| &lt;name&gt;     | *Required*. Zone name        |

### Defining a zone layout

You can define a new layout file (e.g. in Twig) for a zone and include it in a Landing page layout.<span style="color: rgb(255,0,0);">
</span>

A Zone is a container for blocks. The best way to display blocks in the zone is to iterate over a blocks array and render the blocks in a loop.

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
 For eZ Enterprise, the `data-studio-zone` attribute is required to allow dropping the Content into specific zones.

**Example zone.html.twig**

``` brush:
<div data-studio-zone="{{ zones[0].id }}">                                       
    {# If a zone with [0] index contains any blocks #}
    {% if zones[0].blocks %}                                                    
        {# for each block #}
        {% for block in zone[0].blocks %}                                               
            {# create a new layer with appropriate id #}
            <div class="landing-page__block block_{{ block.type }}">            
                {# render the block by using the "ez_block:renderBlockAction" controller #}
                {{ render_esi(controller('ez_block:renderBlockAction', {        
                        {# id of the current content #}
                        'contentId': contentInfo.id,                            
                        {# id of the current block #}
                        'blockId': block.id                                     
                    })) 
                }}
            </div>        
        {% endfor %}    
    {% endif %}
</div>
```

 

## Creating and configuring layouts

In the Demo installation the layout configuration is stored in ezstudio-demo-bundle/Resources/config/default\_layouts.yml:

**Example default\_layouts.yml**

``` brush:
layouts:
    1:  
        identifier: 1                       
        name: One column
        description: 'One column'
        thumbnail: '/bundles/ezstudiodemo/images/layouts/1.png'
        template: eZStudioDemoBundle:layouts:1.html.twig
        zones:
            first:
                name: First zone

    1_2:
        identifier: 1_2 
        name: Two zones in columns, narrow left, wide right
        description: Two zones in columns, narrow left, wide right
        thumbnail: '/bundles/ezstudiodemo/images/layouts/1_2.png'
        template: eZStudioDemoBundle:layouts:1_2.html.twig
        zones:
            first:
                name: First zone
            second:
                name: Second zone

    1_2__1:   
        identifier: 1_2__1
        name: Three zones, two columns, narrow left, wide right in first row and one row
        description: Three zones, two columns, narrow left, wide right in first row and one row
        thumbnail: '/bundles/ezstudiodemo/images/layouts/1_2__1.png'
        template: eZStudioDemoBundle:layouts:1_2__1.html.twig
        zones:
            first:
                name: First zone
            second:
                name: Second zone
            third:
                name: Third zone
```

 

The following parameters need to be included in the settings of the default\_layouts.yml file:

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Parameter</th>
<th align="left">Type</th>
<th align="left">Description</th>
<th align="left">Required</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><strong>layouts</strong></p></td>
<td align="left">string</td>
<td align="left">Layout config root</td>
<td align="left">Yes</td>
</tr>
<tr class="even">
<td align="left"><p><strong>number</strong></p></td>
<td align="left">string</td>
<td align="left">Unique key of the layout</td>
<td align="left">Yes</td>
</tr>
<tr class="odd">
<td align="left"><p>{ID}/<strong>identifier</strong></p></td>
<td align="left">string</td>
<td align="left">ID of the Layout</td>
<td align="left">Yes</td>
</tr>
<tr class="even">
<td align="left"><p>{ID}/<strong>name</strong></p></td>
<td align="left">string</td>
<td align="left">Name of the Layout</td>
<td align="left">Yes</td>
</tr>
<tr class="odd">
<td align="left"><p>{ID}/<strong>description</strong></p></td>
<td align="left">string</td>
<td align="left">Description of Layout</td>
<td align="left">Yes</td>
</tr>
<tr class="even">
<td align="left"><p>{ID}/<strong>thumbnail</strong></p></td>
<td align="left">string</td>
<td align="left">&lt;path&gt; to thumbnail image</td>
<td align="left">Yes</td>
</tr>
<tr class="odd">
<td align="left"><p>{ID}/<strong>template</strong></p></td>
<td align="left">string</td>
<td align="left"><p>&lt;path&gt; to template View</p>
<p>For example:<br />
<em>eZStudioDemoBundle:layouts:1.html.twig</em></p>
<p><em>&lt;bundle&gt;:&lt;directory&gt;:&lt;file name&gt;</em></p></td>
<td align="left">Yes</td>
</tr>
<tr class="even">
<td align="left"><p>{ID}/<strong>zones</strong></p></td>
<td align="left">string</td>
<td align="left"><p>Collection of zones</p></td>
<td align="left">Yes</td>
</tr>
<tr class="odd">
<td align="left">{ID}/{zone}/<strong>zone_id</strong></td>
<td align="left">string</td>
<td align="left">ID of the zone</td>
<td align="left">Yes</td>
</tr>
<tr class="even">
<td align="left">{ID}/{zone}/<strong>name</strong></td>
<td align="left">string</td>
<td align="left">Zone name</td>
<td align="left">Yes</td>
</tr>
</tbody>
</table>

 

 

#### In this topic:

-   [Description](#CreatingLandingPagelayouts(Enterprise)-Description)
-   [Solution](#CreatingLandingPagelayouts(Enterprise)-Solution)
    -   [Defining the layout](#CreatingLandingPagelayouts(Enterprise)-Definingthelayout)
        -   [Zone structure](#CreatingLandingPagelayouts(Enterprise)-Zonestructure)
        -   [Defining a zone layout](#CreatingLandingPagelayouts(Enterprise)-Definingazonelayout)
    -   [Creating and configuring layouts](#CreatingLandingPagelayouts(Enterprise)-Creatingandconfiguringlayouts)

 

#### Related topics:

[Landing Page Field Type (Enterprise)](31430521.html)

[Creating Landing Page blocks (Enterprise)](31430614.html)

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>

 Developer : Content items, Content Types and Fields 



# <span id="Contentitems,ContentTypesandFields-Content_items" class="confluence-anchor-link"></span>Content items

A Content item is the basic unit of content that is managed in the platform.

The substance of a Content item is made up of different Fields and their values, as defined by the Content Type. These Fields can cover data ranging from single variables or text lines to media files or passages of formatted text.

Aside from the Fields, each Content item is also characterized by general data that controls the Content item's place in the system.

### Content item general information

**Content ID** – <span class="inline-comment-marker" data-ref="23099922-bf2a-4357-ac57-0617cef6131b">a unique number by which</span> the Content item is identified in the system. These numbers are not recycled, so if an item is deleted, its ID number will not be reused when a new one is created.

**Name** – a user-friendly name for the Content item. The name is generated automatically based on a pattern specified in the Content Type definition.

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Content item Name is always searchable, even if the Field(s) used to generate it are not.

**Type** – the Content Type on which the Content item is based.

**Owner** – a reference to the user who initially created the Content item. This reference is set by the system the first time the Content item is published. The ownership of an item cannot be modified and will not change even if the owner is removed from the system.

**Creation time** – exact date and time when the Content item was published for the first time. This is set by the system and cannot be modified.

**Modification time** – exact date and time when the Content item was last modified. This is set by the system and cannot be modified manually, but will change every time the item is published again.

**Status** – the current state of the Content item. It can have three statuses: 0 – Draft, 1 – Published and 2 – Archived. When an item is created, its status is set to *draft*. After publishing the status changes to *published*. When a published Content item is moved to T<span class="inline-comment-marker" data-ref="54c5c2c9-a808-45d5-a670-ad18d2c155d3">rash</span>, this item becomes *archived*. If a published item is removed from the Trash (or removed without being put in the Trash first), it will be permanently deleted. 

**Section ID** – <span class="inline-comment-marker" data-ref="08edbf1a-ee6c-4e7c-9895-0194a2d8be23">the unique number of the Section</span> to which the Content item belongs. New Content items are placed in the Standard section by default. <span class="inline-comment-marker" data-ref="d3ba0868-4c89-4866-8f45-fed10ec1dce8">This behavior can be changed</span>, but content must always belong to some Section.

**Versions** – total number of versions of this Content item. A new version is created every time the Content item is modified and it is this new version that is edited. The previous / published version along with earlier versions remain untouched and its status changed to *<span class="inline-comment-marker" data-ref="7b35161c-ef49-4c9f-8f92-095c9c0d8279">Archived</span>*. A Content item always has at least one version. 

<span class="confluence-embedded-file-wrapper image-center-wrapper"><img src="attachments/31430275/31431657.png" alt="Diagram of an example Content item" class="confluence-embedded-image image-center" /></span>

The Fields that are available in a Content item are defined by the Content Type to which the Content item belongs.

 

# <span id="Contentitems,ContentTypesandFields-Content_Types" class="confluence-anchor-link"></span>Content Types

### Content Type metadata

Each Content Type is characterized by a set of metadata which define the general behavior of its instances:

**Name** – a user-friendly name that describes the Content Type. This name is used in the interface, but not internally by the system. It can consist of letters, digits, spaces and special characters; the maximum length is 255 characters. (Mandatory.)

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Note that even if your Content Type defines a Field meant to store a name for the Content item (for example, a title of an article or product name), this will not be the same as this Name, as this one is a piece of metadata, not a Field.

**Identifier** – an identifier for internal use in configuration files, templates, PHP code, etc<span class="inline-comment-marker" data-ref="7c6fcdc9-2b3e-42b3-9cb3-23d12d166141">. It must be unique, can only contain lowercase letters, digits and underscores; the maximum length is 50 characters. (Mandatory.)
</span>

**Description** – a detailed description of the Content Type. (Optional.)

**Content name pattern** – a pattern for naming a new Content item based on this Content Type. The pattern usually consists of [Field identifiers](#Contentitems,ContentTypesandFields-Field_identifier) that tell the system about which Fields it should use when generating the name of a Content item. Each Field identifier has to be surrounded with angle brackets. Text outside the angle brackets will be included literally. If no pattern is provided, the system will automatically use the first Field. (Optional.)

**<span class="inline-comment-marker" data-ref="5f116753-2ea1-4670-a688-d832390debe6">URL alias name pattern</span>** – a pattern which controls how the virtual URLs of the Locations will be generated when Content items are created based on this Content Type. Note that only the last part of the virtual URL is affected. The pattern works in the same way as the Content name pattern. Text outside the angle brackets will be converted using the selected method of URL transformation. If no pattern is provided, the system will automatically use the name of the Content item itself. (Optional.)

**Container** – a flag which indicates if Content items based on this Content Type are allowed to have sub-items or not.

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
This flag was added for convenience and only affects the interface. In other words, it doesn't control any actual low-level logic, it simply controls the way the graphical user interface behaves.

**Default field for sorting children** – rule for sorting sub-items. If the instances of this Content Type can serve as containers, their children will be sorted according to what is selected here.

**Default sort order** – another rule for sorting sub-items. This decides the sort order for the criterion chosen above.

**Default content availability** – a flag which indicates if Content items of this Content Type should be available even without a corresponding language version. If this flag is not set, a Content item of this Type will not be available when it does not have a language version corresponding to the current siteaccess. By setting this flag you can make instances of this Content Type available regardless of the language criterion.

<span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img src="attachments/31430275/31431659.png" alt="Creating a new Content Type" class="confluence-embedded-image image-center" width="500" /></span>

### Field definitions

Aside from the metadata, a Content Type contains any number of Field definitions (but has to contain at least one). They determine what Fields of what Field Types will be included in all Content items created based on this Content Type.

A Content Type and its Field definitions can be modified after creation, even if there are already Content items based on it in the system. When a Content Type is modified, each of its instances will be changed as well. If a new Field definition is added to a Content Type, this Field will appear (empty) in every relevant Content item. If a Field definition is deleted from the Content Type, all the corresponding Fields will be removed from Content items of this type.

<span class="confluence-embedded-file-wrapper image-center-wrapper"><img src="attachments/31430275/31431660.png" alt="Diagram of an example Content Type" class="confluence-embedded-image image-center" /></span>

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<span class="status-macro aui-lozenge aui-lozenge-current">V1.3</span>

You can assign each Field defined in a Content Type to a group by selecting one of the groups in the Category drop-down. [Available groups can be configured in the content repository](Repository_31432023.html#Repository-ContentRepositoryConfiguration).

 

 

# <span id="Contentitems,ContentTypesandFields-Fields" class="confluence-anchor-link"></span>Fields

A Field is the smallest unit of storage in the content model and the building block that all Content items consist of. Every Field belongs to a Field Type.

### Field value validation

The values entered in a field may undergo validation, which means the system makes sure that they are correct for the chosen Field Type and can be used without a problem.

Whether validation is performed or not depends on the settings of a particular Field Type. Validation cannot be turned off for a Field if its Field Type supports it.

### Field details

Aside from the Field Type, the Field definition in a Content Type provides the following information:

**Name** – a user-friendly name that describes the Field. This name is used in the interface, but not internally by the system. It can consist of letters, digits, spaces and special characters; the maximum length is 255 characters. If no name is provided, a unique one is automatically generated.

**<span id="Contentitems,ContentTypesandFields-Field_identifier" class="confluence-anchor-link"></span>Identifier** – an identifier for internal use in configuration files, templates, PHP code, etc. It can only contain lowercase letters, digits and underscores; the maximum length is 50 characters. This identifier is also used in name patterns for the Content Type.

**Description** – a detailed description of the Field.

**Required** – a flag which indicates if the Field must have a value for the system to accept the Content item. In other words, if a Field is flagged as Required, a user will not be able to save or publish a Content item without filling in this Field.

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Note that the Required flag is in no way related to Field validation. A Field's value is validated whether the Field is set as required or not.

[**Searchable**](Search_31429673.html)– a flag which indicates if the value of the Field will be indexed for searching.

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
The Searchable flag is not available for some Fields, because some Field Types do not allow searching through their values.

**[Translatable](Internationalization_31429671.html)** – a flag which indicates if the value of the Field can be translated. This is independent of the Field Type, which means that even Fields of Types such as "Float" or "Image" can be set as translatable.

 

Depending on the Field Type, there may also be other, specific information to fill in. For example, the "Country" Field Type allows you to select the default country, as well as to allow selecting multiple countries at the same time.

<span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img src="attachments/31430275/31431661.png" alt="Diagram of content model" class="confluence-embedded-image" width="610" /></span>

 

#### In this topic:

-   [Content items](#Contentitems,ContentTypesandFields-Content_itemsContentitems)
    -   [Content item general information](#Contentitems,ContentTypesandFields-Contentitemgeneralinformation)
-   [Content Types](#Contentitems,ContentTypesandFields-Content_TypesContentTypes)
    -   [Content Type metadata](#Contentitems,ContentTypesandFields-ContentTypemetadata)
    -   [Field definitions](#Contentitems,ContentTypesandFields-Fielddefinitions)
-   [Fields](#Contentitems,ContentTypesandFields-FieldsFields)
    -   [Field value validation](#Contentitems,ContentTypesandFields-Fieldvaluevalidation)
    -   [Field details](#Contentitems,ContentTypesandFields-Fielddetails)

 

## Attachments:

<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [content\_model\_item\_diagram.png](attachments/31430275/31431657.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [Admin Panel - New Content Type.png](attachments/31430275/31431659.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [content\_model\_type\_diagram.png](attachments/31430275/31431660.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [content\_model\_diagram.png](attachments/31430275/31431661.png) (image/png)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[API](API_31429524.html)</span>
4.  <span>[eZ Platform Public PHP API](eZ-Platform-Public-PHP-API_31429583.html)</span>
5.  <span>[Public API Guide](Public-API-Guide_31430303.html)</span>

 Developer : Browsing, finding, viewing 



We will start by going through the various ways to find and retrieve content from eZ Platform using the API. While this will be covered in further dedicated documentation, it is necessary to explain a few basic concepts of the Public API. In the following recipes, you will learn about the general principles of the API as they are introduced in individual recipes.

## Displaying values from a Content item

In this recipe, we will see how to fetch a Content item from the repository, and obtain its Field's content. 

Let's first see the full code. You can see the Command line version at <a href="https://github.com/ezsystems/CookbookBundle/blob/master/Command/ViewContentCommand.php" class="uri">https://github.com/ezsystems/CookbookBundle/blob/master/Command/ViewContentCommand.php</a>.

**Viewing content**

``` brush:
$repository = $this->getContainer()->get( 'ezpublish.api.repository' );
$contentService = $repository->getContentService();
$contentTypeService = $repository->getContentTypeService();
$fieldTypeService = $repository->getFieldTypeService();

try
{
    $content = $contentService->loadContent( 66 );
    $contentType = $contentTypeService->loadContentType( $content->contentInfo->contentTypeId );
    // iterate over the field definitions of the content type and print out each field's identifier and value
    foreach( $contentType->fieldDefinitions as $fieldDefinition )
    {
        $output->write( $fieldDefinition->identifier . ": " );
        $fieldType = $fieldTypeService->getFieldType( $fieldDefinition->fieldTypeIdentifier );
        $field = $content->getField( $fieldDefinition->identifier );

        // We use the Field's toHash() method to get readable content out of the Field
        $valueHash = $fieldType->toHash( $field->value );
        $output->writeln( $valueHash );
    }
}
catch( \eZ\Publish\API\Repository\Exceptions\NotFoundException $e )
{
    // if the id is not found
    $output->writeln( "No content with id $contentId" );
}
catch( \eZ\Publish\API\Repository\Exceptions\UnauthorizedException $e )
{
    // not allowed to read this content
    $output->writeln( "Anonymous users are not allowed to read content with id $contentId" );
}
```

Let's analyze this code block by block.

``` brush:
$repository = $this->getContainer()->get( 'ezpublish.api.repository' );
$contentService = $repository->getContentService();
$contentTypeService = $repository->getContentTypeService();
$fieldTypeService = $repository->getFieldTypeService();
```

This is the initialization part. As explained above, everything in the Public API goes through the repository via dedicated services. We get the repository from the service container, using the method `get()` of our container, obtained via `$this->getContainer()`. Using our `$repository` variable, we fetch the two services we will need using `getContentService()` and `getFieldTypeService()`.

``` brush:
try
{
    // iterate over the field definitions of the content type and print out each field's identifier and value
    $content = $contentService->loadContent( 66 );
```

Everything starting from line 5 is about getting our Content and iterating over its Fields. You can see that the whole logic is part of a `try/catch` block. Since the Public API uses Exceptions for error handling, this is strongly encouraged, as it will allow you to conditionally catch the various errors that may happen. We will cover the exceptions we expect in a later paragraph.

The first thing we do is use the Content Service to load a Content item using its ID, 66: `$contentService->loadContent   ` `( 66 )`. As you can see on the API doc page, this method expects a Content ID, and returns a <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/Content.html">Content Value Object</a>.

``` brush:
foreach( $contentType->fieldDefinitions as $fieldDefinition )
{
    // ignore ezpage
    if( $fieldDefinition->fieldTypeIdentifier == 'ezpage' )
        continue;
    $output->write( $fieldDefinition->identifier . ": " );
    $fieldType = $fieldTypeService->getFieldType( $fieldDefinition->fieldTypeIdentifier );
    $fieldValue = $content->getFieldValue( $fieldDefinition->identifier );
    $valueHash = $fieldType->toHash( $fieldValue );
    $output->writeln( $valueHash );
}
```

This block is the one that actually displays the value.

It iterates over the Content item's Fields using the Content Type's FieldDefinitions (`$contentType->fieldDefinitions`).

For each Field Definition, we start by displaying its identifier (`$fieldDefinition->identifier`). We then get the Field Type instance using the Field Type Service (`$fieldTypeService->getFieldType( $fieldDefinition->fieldTypeIdentifier )`). This method expects the requested Field Type's identifier, as a string (ezstring, ezxmltext, etc.), and returns an `eZ\Publish\API\Repository\FieldType` object.

The Field Value object is obtained using the `getFieldValue()` method of the Content Value Object which we obtained using `ContentService::loadContent()`.

Using the Field Type object, we can convert the Field Value to a hash using the `toHash()` method, provided by every Field Type. This method returns a primitive type (string, hash) out of a Field instance.

With this example, you should get a first idea on how you interact with the API. Everything is done through services, each service being responsible for a specific part of the repository (Content, Field Type, etc.).

Loading Content in different languages

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Since we didn't specify any language code, our Field object is returned in the given Content item's main language. If you'd prefer it to fall back to the SiteAccess language(s), then take advantage of TranslationHelpers. Or if you want to use an altogether different language, you can specify a language code in the `getField()` call:

``` brush:
$content->getFieldValue( $fieldDefinition->identifier, 'fre-FR' )
```

**Exceptions handling**

``` brush:
catch ( \eZ\Publish\API\Repository\Exceptions\NotFoundException $e )
{
    $output->writeln( "<error>No content with id $contentId found</error>" );
}
catch ( \eZ\Publish\API\Repository\Exceptions\UnauthorizedException $e )
{
    $output->writeln( "<error>Permission denied on content with id $contentId</error>" );
}
```

As said earlier, the Public API uses <a href="http://php.net/exceptions">Exceptions</a> to handle errors. Each method of the API may throw different exceptions, depending on what it does. Which exceptions can be thrown is usually documented for each method. In our case, `loadContent()` may throw two types of exceptions: `NotFoundException`, if the requested ID isn't found, and `UnauthorizedException` if the currently logged in user isn't allowed to view the requested content.

It is a good practice to cover each exception you expect to happen. In this case, since our Command takes the Content ID as a parameter, this ID may either not exist, or the referenced Content item may not be visible to our user. Both cases are covered with explicit error messages.

## Traversing a Location subtree

This recipe will show how to traverse a Location's subtree. The full code implements a command that takes a Location ID as an argument and recursively prints this location's subtree.

Full code

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<a href="https://github.com/ezsystems/CookbookBundle/blob/master/Command/BrowseLocationsCommand.php" class="uri">https://github.com/ezsystems/CookbookBundle/blob/master/Command/BrowseLocationsCommand.php</a>

In this code, we introduce the <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/LocationService.html">LocationService</a>. This service is used to interact with Locations. We use two methods from this service: <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/LocationService.html#method_loadLocation"><code>loadLocation()</code></a>, and `     loadLocationChildren()   `.

**Loading a Location**

``` brush:
try
{
    // load the starting location and browse
    $location = $this->locationService->loadLocation( $locationId );
    $this->browseLocation( $location, $output );
}
catch ( \eZ\Publish\API\Repository\Exceptions\NotFoundException $e )
{
    $output->writeln( "<error>No location found with id $locationId</error>" );
}
catch( \eZ\Publish\API\Repository\Exceptions\UnauthorizedException $e )
{
    $output->writeln( "<error>Current users are not allowed to read location with id $locationId</error>" );
}
```

As for the ContentService, `loadLocation()` returns a Value Object, here a `     Location   `. Errors are handled with exceptions: `     NotFoundException   ` if the Location ID couldn't be found, and `     UnauthorizedException   ` if the current repository user isn't allowed to view this Location.

**Iterating over a Location's children**

``` brush:
private function browseLocation( Location $location, OutputInterface $output, $depth = 0 )
{
    $childLocationList = $this->locationService->loadLocationChildren( $location, $offset = 0, $limit = -1 );
    // If offset and limit had been specified to something else then "all", then $childLocationList->totalCount contains the total count for iteration use
    foreach ( $childLocationList->locations as $childLocation )
    {
        $this->browseLocation( $childLocation, $output, $depth + 1 );
    }
}
```

`LocationService::loadLocationChildren()` returns a <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Publish/API/Repository/Values/Content/LocationList.php">LocationList</a> Value Objects that we can iterate over.

Note that unlike `loadLocation()`, we don't need to care for permissions here: the currently logged-in user's permissions will be respected when loading children, and Locations that can't be viewed won't be returned at all.

Full code

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Should you need more advanced children fetching methods, the `         SearchService       ` is what you are looking for.

## Viewing Content Metadata

Content is a central piece in the Public API. You will often need to start from a Content item, and dig in from its metadata. Basic content metadata is made available through `     ContentInfo   ` objects. This Value Object mostly provides primitive fields: `contentTypeId`, `publishedDate` or `mainLocationId`. But it is also used to request further Content-related Value Objects from various services.

The full example implements an `ezpublish:cookbook:view_content_metadata` command that prints out all the available metadata, given a Content ID.

Full code

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<a href="https://github.com/ezsystems/CookbookBundle/blob/master/Command/ViewContentMetaDataCommand.php" class="uri">https://github.com/ezsystems/CookbookBundle/blob/master/Command/ViewContentMetaDataCommand.php</a>

We introduce here several new services: <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/URLAliasService.html"><code>URLAliasService</code></a>, <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/UserService.html"><code>UserService</code></a> and <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/SectionService.html"><code>SectionService</code></a>. The concept should be familiar to you now.

**Services initialization**

``` brush:
/** @var $repository \eZ\Publish\API\Repository\Repository */
$repository = $this->getContainer()->get( 'ezpublish.api.repository' );
$contentService = $repository->getContentService();
$locationService = $repository->getLocationService();
$urlAliasService = $repository->getURLAliasService();
$sectionService = $repository->getSectionService();
$userService = $repository->getUserService();
```

### Setting the Repository User

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
In a command line script, the repository runs as if executed by the anonymous user. In order to identify it as a different user, you need to use the `         UserService       ` as follows:

``` brush:
$administratorUser = $userService->loadUser( 14 );
$repository->setCurrentUser( $administratorUser );
```

This may be crucial when writing maintenance or synchronization scripts.

This is of course not required in template functions or controller code, as the HTTP layer will take care of identifying the user, and automatically set it in the repository.

<span class="status-macro aui-lozenge aui-lozenge-current">V1.6</span>

Since v1.6.0, as the `setCurrentUser` method is deprecated, you need to use the following code:

``` brush:
$permissionResolver = $repository->getPermissionResolver();
$user = $userService->loadUserByLogin('admin');
$permissionResolver->setCurrentUserReference($permissionResolver);
```

### The ContentInfo Value Object

We will now load a `ContentInfo` object using the provided ID and use it to get our Content item's metadata

``` brush:
$contentInfo = $contentService->loadContentInfo( $contentId );
```

### Locations

**Getting Content Locations**

``` brush:
// show all locations of the content
$locations = $locationService->loadLocations( $contentInfo );
$output->writeln( "<info>LOCATIONS</info>" );
foreach ( $locations as $location )
{
    $urlAlias = $urlAliasService->reverseLookup( $location );
    $output->writeln( "  $location->pathString  ($urlAlias->path)" );
}
```

We first use `     LocationService     ::loadLocations()` to **get** the **Locations** for our `ContentInfo`. This method returns an array of <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/Location.html"><code>Location</code></a> Value Objects. In this example, we print out the Location's path string (/path/to/content). We also use <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/URLAliasService.html#method_reverseLookup">URLAliasService::reverseLookup()</a> to get the Location's main <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/URLAlias.html">URLAlias</a>.

 

### Relations

We now want to list relations from and to our Content. Since relations are versioned, we need to feed the <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/ContentService.html#method_loadRelations"><code>ContentService::loadRelations()</code></a> with a `     VersionInfo   ` object. We can get the current version's `VersionInfo` using <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/ContentService.html#method_loadVersionInfo"><code>ContentService::loadVersionInfo()</code></a>. If we had been looking for an archived version, we could have specified the version number as the second argument to this method.

**Browsing a Content's relations**

``` brush:
// show all relations of the current version
$versionInfo = $contentService->loadVersionInfo( $contentInfo );
$relations = $contentService->loadRelations( $versionInfo );
if ( !empty( $relations ) )
{
    $output->writeln( "<info>RELATIONS</info>" );
    foreach ( $relations as $relation )
    {
        $name = $relation->destinationContentInfo->name;
        $output->write( "  Relation of type " . $this->outputRelationType( $relation->type ) . " to content $name" );
    }
}
```

We can iterate over the <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/Relation.html">Relation</a> objects array we got from `loadRelations()`, and use these Value Objects to get data about our relations. It has two main properties: `destinationContentInfo`, and `sourceContentInfo`. They also hold the relation type (embed, common, etc.), and the optional Field this relations is made with.

### ContentInfo properties

We can of course get our Content item's metadata by using the Value Object's properties.

**Primitive object metadata**

``` brush:
// show meta data
$output->writeln( "\n<info>METADATA</info>" );
$output->writeln( "  <info>Name:</info> " . $contentInfo->name );
$output->writeln( "  <info>Type:</info> " . $contentType->identifier );
$output->writeln( "  <info>Last modified:</info> " . $contentInfo->modificationDate->format( 'Y-m-d' ) );
$output->writeln( "  <info>Published:</info> ". $contentInfo->publishedDate->format( 'Y-m-d' ) );
$output->writeln( "  <info>RemoteId:</info> $contentInfo->remoteId" );
$output->writeln( "  <info>Main Language:</info> $contentInfo->mainLanguageCode" );
$output->writeln( "  <info>Always available:</info> " . ( $contentInfo->alwaysAvailable ? 'Yes' : 'No' ) );
```

### Owning user

We can use <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/UserService.html#method_loadUser"><code>UserService::loadUser()</code></a> with Content `ownerId` property of our `ContentInfo` to load the Content's owner as a `     User   ` Value Object.

``` brush:
$owner = $userService->loadUser( $contentInfo->ownerId );
$output->writeln( "  <info>Owner:</info> " . $owner->contentInfo->name );
```

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
To get the current version's creator, and not the content's owner, you need to use the `creatorId` property from the current version's `VersionInfo` object.

### Section

The Section's ID can be found in the `sectionId` property of the `ContentInfo` object. To get the matching Section Value Object, you need to use the `SectionService::loadSection()` method.

``` brush:
$section = $sectionService->loadSection( $contentInfo->sectionId );
$output->writeln( "  <info>Section:</info> $section->name" );
```

### Versions

To conclude we can also iterate over the Content's version, as `     VersionInfo   ` Value Objects.

``` brush:
$versionInfoArray = $contentService->loadVersions( $contentInfo );
if ( !empty( $versionInfoArray ) )
{
    $output->writeln( "\n<info>VERSIONS</info>" );
    foreach ( $versionInfoArray as $versionInfo )
    {
        $creator = $userService->loadUser( $versionInfo->creatorId );
        $output->write( "  Version $versionInfo->versionNo " );
        $output->write( " by " . $creator->contentInfo->name );
        $output->writeln( " " . $this->outputStatus( $versionInfo->status ) . " " . $versionInfo->initialLanguageCode );
    }
}
```

We use the `     ContentService::loadVersions()   ` method and get an array of `VersionInfo` objects.

## Search

In this section we will cover how the <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/SearchService.html"><code>SearchService</code></a> can be used to search for Content, by using a <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/Query.html"><code>Query</code></a> and a combinations of <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/Query/Criterion.html"><code>Criteria</code></a> you will get a <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/Search/SearchResult.html"><code>SearchResult</code></a> object back containing list of Content and count of total hits. In the future this object will also include facets, spell checking and "more like this" when running on a backend that supports it *(for instance Solr)*.

##### Difference between filter and query

Query object contains two properties you can set criteria on, `filter` and `query`, and while you can mix and match use and use both at the same time, there is one distinction between the two:

-   `query:` Has an effect on scoring *(relevancy)* calculation, and thus also on the default sorting if no `sortClause` is specified, *when used with Solr and Elastic.*
    -   Typically you'll use this for `FullText` search criterion, and otherwise place everything else on `filter`.

### Performing a simple full text search

Full code

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<a href="https://github.com/ezsystems/CookbookBundle/blob/master/Command/FindContentCommand.php" class="uri">https://github.com/ezsystems/CookbookBundle/blob/master/Command/FindContentCommand.php</a>

In this recipe, we will run a simple full text search over every compatible attribute.

#### Query and Criterion objects

We introduce here a new object: `Query`. It is used to build up a Content query based on a set of `Criterion` objects.

 

``` brush:
$query = new \eZ\Publish\API\Repository\Values\Content\Query();
// Use 'query' over 'filter' for FullText to get hit score (relevancy) with Solr/Elastic
$query->query = new Query\Criterion\FullText( $text );
```

 

Multiple criteria can be grouped together using "logical criteria", such as <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/Query/Criterion/LogicalAnd.html">LogicalAnd</a> or <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/Query/Criterion/LogicalOr.html">LogicalOr</a>. Since in this case we only want to run a text search, we simply use a <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/Query/Criterion/FullText.html"><code>FullText</code></a> criterion object.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
The full list of criteria can be found on your installation in the following directory <a href="https://github.com/ezsystems/ezpublish-kernel/tree/master/eZ/Publish/API/Repository/Values/Content/Query/Criterion">vendor/ezsystems/ezpublish-kernel/eZ/Publish/API/Repository/Values/Content/Query/Criterion</a>. Additionally you may look at integration tests like <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Publish/API/Repository/Tests/SearchServiceTest.php">vendor/ezsystems/ezpublish-kernel/eZ/Publish/API/Repository/Tests/SearchServiceTest.php</a> for more details on how these are used.

 

#### Running the search query and using the results

The `Query` object is given as an argument to <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/SearchService.html#method_findContent"><code>SearchService::findContent()</code></a>. This method returns a `SearchResult` object. This object provides you with various information about the search operation (number of results, time taken, spelling suggestions, or facets, as well as, of course, the results themselves.

``` brush:
$result = $searchService->findContent( $query );
$output->writeln( 'Found ' . $result->totalCount . ' items' );
foreach ( $result->searchHits as $searchHit )
{
    $output->writeln( $searchHit->valueObject->contentInfo->name );
}
```

The `searchHits` properties of the `SearchResult` object is an array of `SearchHit` objects. In `valueObject` property of `SearchHit`, you will find the `Content` object that matches the given `Query`.

Tip

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
 If you you are searching using a unique identifier, for instance using the Content ID or Content remote ID criterion, then you can use <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/SearchService.html#method_findSingle"><code>SearchService::findSingle()</code></a>, this takes a Criterion and returns a single Content item, or throws a `NotFound` exception if none is found.

 

### Retrieving Sort Clauses for parent location

<span class="status-macro aui-lozenge aui-lozenge-current">V1.7.0</span>

You can use the method $parentL`ocation->getSortClauses()` to return an array of Sort Clauses for direct use on `LocationQuery->sortClauses`.

 

### Performing an advanced search

Full code

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<a href="https://github.com/ezsystems/CookbookBundle/blob/master/Command/FindContent2Command.php" class="uri">https://github.com/ezsystems/CookbookBundle/blob/master/Command/FindContent2Command.php</a>

As explained in the previous chapter, Criterion objects are grouped together using logical criteria. We will now see how multiple criteria objects can be combined into a fine grained search `Query`.

``` brush:
use eZ\Publish\API\Repository\Values\Content\Query\Criterion;
use eZ\Publish\API\Repository\Values\Content;
 
// [...]
 
$query = new Query();
$criterion1 = new Criterion\Subtree( $locationService->loadLocation( 2 )->pathString );
$criterion2 = new Criterion\ContentTypeIdentifier( 'folder' );
$query->filter = new Criterion\LogicalAnd(
    array( $criterion1, $criterion2 )
);
 
$result = $searchService->findContent( $query );
```

A <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/Query/Criterion/Subtree.html"><code>Subtree</code></a> criterion limits the search to the subtree with pathString, which looks like: `/1/2/`. A <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/Query/Criterion/ContentTypeId.html"><code>ContentTypeId</code></a> Criterion to limit the search to Content of Content Type 1. Those two criteria are grouped with a `LogicalAnd` operator. The query is executed as before, with `SearchService::findContent()`.

### Performing a fetch like search

Full code

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<a href="https://github.com/ezsystems/CookbookBundle/blob/master/Command/FindContent3Command.php" class="uri">https://github.com/ezsystems/CookbookBundle/blob/master/Command/FindContent3Command.php</a>

A search isn't only meant for searching, it also provides the future interface for what you in eZ Publish 4.x would know as a content "fetch". And as this is totally backend agnostic, in future versions this will be powered by either Solr or ElasticSearch meaning it also replaces "ezfind" fetch functions.

Following the examples above we now change it a bit to combine several criteria with both an AND and an OR condition.

``` brush:
use eZ\Publish\API\Repository\Values\Content\Query\Criterion;
use eZ\Publish\API\Repository\Values\Content;
 
// [...]
 
$query = new Query();
$query->filter = new Criterion\LogicalAnd(
    array(
        new Criterion\ParentLocationId( 2 ),
        new Criterion\LogicalOr(
            array(
                new Criterion\ContentTypeIdentifier( 'folder' ),
                new Criterion\ContentTypeId( 2 )
            )
        )
    )
);
 
$result = $searchService->findContent( $query );
```

A `     ParentLocationId   ` criterion limits the search to the children of location 2. An array of "`ContentTypeId"` Criteria to limit the search to Content of ContentType's with id 1 or 2 grouped in a `LogicalOr` operator. Those two criteria are grouped with a `LogicalAnd` operator. As always the query is executed as before, with `SearchService::findContent()`.

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
Want to do a subtree filter? Change the location filter to use the Subtree criterion filter as shown in the advanced search example above.

 

#### Using in() instead of OR

The above example is fine, but it can be optimized a bit by taking advantage of the fact that all filter criteria support being given an array of values (IN operator) instead of a single value (EQ operator).

You can also use the <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/Query/Criterion/ContentTypeIdentifier.html"><code>ContentTypeIdentifier</code></a> Criterion:

``` brush:
use eZ\Publish\API\Repository\Values\Content\Query\Criterion;
use eZ\Publish\API\Repository\Values\Content;
 
// [...]
 
$query = new Query();
$query->filter = new Criterion\LogicalAnd(
    array(
        new Criterion\ParentLocationId( 2 ),
        new Criterion\ContentTypeIdentifier( array( 'article', 'folder' ) )
    )
);
 
$result = $searchService->findContent( $query );
```

Tip

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
All filter criteria are capable of doing an "IN" selection, the ParentLocationId<span> above could, for example, have been provided "array( 2, 43 )" to include second level children in both your content tree (2) and your media tree (43).</span>

### Performing a Faceted Search

<span class="status-macro aui-lozenge aui-lozenge-current">DOC IS WIP (EZP-26453)</span>

Under construction

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Faceted Search is not fully implemented yet, only partial implementation exists for use with Content *(and ContentInfo)* search on Solr, limited to visitors for:

-   `ContentType` & `Section`<span>, </span><span>with</span><span> limitations:</span>
    -   <span>FacetBuilder: Only uses `minCount` and `limit` properties.</span>
    -   <span>Facet:</span><span> Returns</span><span> </span>`entries` group data as id's, while it is going to be returned as identifiers as stated in <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Publish/API/Repository/Values/Content/Search/Facet/ContentTypeFacet.php#L21">API documentation</a>.
-   `User`<span>, with limitations:</span>
    -   FacetBuilder: Only uses `minCount` and `limit` properties, hard-coded to creator as `type` which has not been documented in API while owner, group and modifier is currently not supported.
-   For further info see the corresponding Epic: <span class="jira-issue"> <a href="https://jira.ez.no/browse/EZP-26465?src=confmacro" class="jira-issue-key"><img src="https://jira.ez.no/images/icons/issuetypes/epic.png" class="icon" />EZP-26465</a> - <span class="summary">Search Facets</span> <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-current jira-macro-single-issue-export-pdf">Specification</span> </span>

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
<span>You can register </span><a href="https://github.com/ezsystems/ezplatform-solr-search-engine/blob/v1.1.1/lib/Resources/config/container/solr/facet_builder_visitors.yml">custom facet builder visitors</a> with Solr for Content(Info) search.

Contribution wanted

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<span>The link above is also the starting point for contributing visitors for other API </span><a href="https://github.com/ezsystems/ezpublish-kernel/tree/master/eZ/Publish/API/Repository/Values/Content/Query/FacetBuilder">FacetBuilders</a><span> and </span><a href="https://github.com/ezsystems/ezpublish-kernel/tree/master/eZ/Publish/API/Repository/Values/Content/Search/Facet">Facets</a><span>. As for integration tests, fixtures that will need adjustments are found in</span><a href="https://github.com/ezsystems/ezpublish-kernel/tree/master/eZ/Publish/API/Repository/Tests/_fixtures/Solr">ezpublish-kernel</a><span>, and those missing in that link but <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Publish/API/Repository/Tests/SearchServiceTest.php#L2474">defined in SearchServiceTest</a>, are basically not implemented yet.</span>

To be able to take advantage of facets, we can set the `Query->facetBuilders` property, which will result in relevant facets being returned on `SearchResult->facets`. All facet builders can share the following properties:

-   `minCount`: The minimum of hits of a given grouping, e.g. minimum number of content items in a given facet for it to be returned
-   `limit`: Maximum number of facets to be returned; only X number of facets with the greatest number of hits will be returned.

As an example, let's `apply UserFacet`<span> to be able to group content according to the creator:</span>

``` brush:
use eZ\Publish\API\Repository\Values\Content\Query\Criterion;
use eZ\Publish\API\Repository\Values\Content\Query\FacetBuilder;
 
// [...]
 
$query = new Query();
$query->filter = new Criterion\ContentTypeIdentifier(['article']);
$query->facetBuilders[] = new FacetBuilder\UserFacetBuilder(
    [
        // 'type' => 'creator', // this is currently implied, expect api change here once facets are implemented fully
        'minCount' => 2,
        'limit' => 5
    ]
);
 
$result = $searchService->findContentInfo( $query );
list( $userId, $articleCount ) = $result->facets[0]->entries;
```

### Performing a pure search count

In many cases you might need the number of Content items matching a search, but with no need to do anything else with the results.

Thanks to the fact that the " searchHits " property of the <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/Search/SearchResult.html"><code>SearchResult</code></a> object always refers to the total amount, it is enough to run a standard search and set $limit to 0. This way no results will be retrieved, and the search will not be slowed down, even when the number of matching results is huge.

 

``` brush:
use eZ\Publish\API\Repository\Values\Content\Query;
 
// [...]
 
$query = new Query();
$query->limit = 0;
 
// [...] ( Add criteria as shown above )
 
$resultCount = $searchService->findContent( $query )->totalCount;
```

 

 

#### In this topic:

-   [Displaying values from a Content item](#Browsing,finding,viewing-DisplayingvaluesfromaContentitem)
-   [Traversing a Location subtree](#Browsing,finding,viewing-TraversingaLocationsubtree)
-   [Viewing Content Metadata](#Browsing,finding,viewing-ViewingContentMetadata)
    -   [Setting the Repository User](#Browsing,finding,viewing-SettingtheRepositoryUser)
    -   [The ContentInfo Value Object](#Browsing,finding,viewing-TheContentInfoValueObject)
    -   [Locations](#Browsing,finding,viewing-Locations)
    -   [Relations](#Browsing,finding,viewing-Relations)
    -   [ContentInfo properties](#Browsing,finding,viewing-ContentInfoproperties)
    -   [Owning user](#Browsing,finding,viewing-Owninguser)
    -   [Section](#Browsing,finding,viewing-Section)
    -   [Versions](#Browsing,finding,viewing-Versions)
-   [Search](#Browsing,finding,viewing-Search)
    -   [Performing a simple full text search](#Browsing,finding,viewing-Performingasimplefulltextsearch)
    -   [Retrieving Sort Clauses for parent location](#Browsing,finding,viewing-RetrievingSortClausesforparentlocation)
    -   [Performing an advanced search](#Browsing,finding,viewing-Performinganadvancedsearch)
    -   [Performing a fetch like search](#Browsing,finding,viewing-Performingafetchlikesearch)
    -   [Performing a Faceted Search](#Browsing,finding,viewing-PerformingaFacetedSearch)
    -   [Performing a pure search count](#Browsing,finding,viewing-Performingapuresearchcount)

## Comments:

<table>
<colgroup>
<col width="100%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><a href=""></a>
<p>Note that when making searches for front end use you should use the `$languageFilter` parameter of the `findLocations` and `findContent` functions and `Criterion\Visibility::VISIBLE` to filter the results accordingly.  If not you may get results you do not wish.<br />
<br />
Example:</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="brush: php; gutter: false; theme: Eclipse" style="font-size:12px;"><code>
$query = new LocationQuery([
 &#39;filter&#39; =&gt; new Criterion\LogicalAnd([
 new Criterion\Visibility(Criterion\Visibility::VISIBLE),
 new Criterion\ParentLocationId($parentLocation-&gt;id),
 ];),
 &#39;sortClauses&#39; =&gt; $parentLocation-&gt;getSortClauses(),
]);
$searchService-&gt;findLocations($query,
 [&#39;languages&#39; =&gt; $configResolver-&gt;getParameter(&#39;languages&#39;)]);</code></pre>
</div>
</div>
<div class="smallfont" align="left" style="color: #666666; width: 98%; margin-bottom: 10px;">
<img src="images/icons/contenttypes/comment_16.png" width="16" height="16" /> Posted by wizhippo at Jan 13, 2017 19:28
</div></td>
</tr>
</tbody>
</table>






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>
6.  <span>[Content items, Content Types and Fields](31430275.html)</span>
7.  <span>[Field Types reference](Field-Types-reference_31430495.html)</span>

 Developer : Landing Page Field Type (Enterprise) 



Landing Page Field Type represents a page with a layout consisting of multiple zones; each of which can in turn contain blocks.

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Landing Page Field Type is only used in the Landing Page Content Type that is included in eZ Enterprise.

The structure of the Landing Page Content Type should not be modified, as it may cause errors.

| Name           | Internal name   | Expected input  |
|----------------|-----------------|-----------------|
| `Landing page` | `ezlandingpage` | `string (JSON)` |

 

# Layout and zones

Layout is the way in which a Landing Page is divided into zones. <span class="DEF"><span class="DEF">Zones are organized structures that are deployed over a layout in a particular position</span></span>.

The placement of zones is defined in a template which is a part of the layout configuration. You can modify the template in order to define your own system of zones.

For information on how to create and configure new blocks for the Landing Page, see [Creating Landing Page layouts (Enterprise)](31430259.html).

 

# Blocks

For information on how to create and configure new blocks for the Landing Page, see [Creating Landing Page blocks (Enterprise).](31430614.html)

 

# Rendering Landing Pages

<span lang="en">Landing page rendering takes place while editing or viewing.</span>

When rendering a Landing Page, its zones are passed to the layout as a `zones` array with a `blocks` array each. You can simply access them using twig (e.g.** **`{{ zones[0].id }}` ).

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Each div that's a zone or zone's container should have data attributes:

-   `data-studio-zones-container` for a div containing zones
-   `data-studio-zone` with zone ID as a value for a zone container

 

To render a block inside the layout, use twig `render_esi()` function to call `           ez_block:renderBlockAction`.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
`               ez_block             ` is an alias to `EzSystems\LandingPageFieldTypeBundle\Controller\BlockControlle`**`r`**

 

An action has the following parameters:

-   `             contentId` – ID of content which can be accessed by `             contentInfo.id           `
-   `             blockId` – ID of block which you want to render

 

Example usage:

``` brush:
{{ render_esi(controller('ez_block:renderBlockAction', {
        'contentId': contentInfo.id,
        'blockId': block.id
    })) 
}}
```

 

As a whole a sample layout could look as follows:

**landing\_page\_simple\_layout.html.twig**

``` brush:
{# a layer of the required "data-studio-zones-container" attribute, in which zones will be displayed #}
<div data-studio-zones-container>
     {# a layer of the required attribute for the displayed zone #}
     <div data-studio-zone="{{ zones[0].id }}">                                     
        {# If a zone with [0] index contains any blocks #}
        {% if zones[0].blocks %}                                                    
            {# for each block #}
            {% for block in blocks %}                                               
                {# create a new layer with appropriate id #}
                <div class="landing-page__block block_{{ block.type }}">            
                    {# render the block by using the "ez_block:renderBlockAction" controller #}   
                    {# contentInfo.id is the id of the current content item, block.id is the id of the current block #}
                    {{ render_esi(controller('ez_block:renderBlockAction', {        
                            'contentId': contentInfo.id,                            
                            'blockId': block.id                                     
                        })) 
                    }}
                </div>
            {% endfor %}
        {% endif %}
    </div>
</div>
```

 

## Viewing template

Your view is populated with data (parameters) retrieved from the `getTemplateParameters()` method which must be implemented in your block's class.

Example:

``` brush:
/**
    * @param \EzSystems\LandingPageFieldTypeBundle\FieldType\LandingPage\Model\BlockValue $blockValue
    *
    * @return array
    */
   public function getTemplateParameters(BlockValue $blockValue)
   {
       $attributes = $blockValue->getAttributes();
       $limit = (isset($attributes['limit'])) ? $attributes['limit'] : 10;
       $offset = (isset($attributes['offset'])) ? $attributes['offset'] : 0;
       $parameters = [
           'title' => $attributes['title'],
           'limit' => $limit,
           'offset' => $offset,
           'feeds' => $this->RssProvider->getFeeds($attributes['url']),
       ];
       return $parameters;
   }
```

 

 

#### In this topic:

-   [Layout and zones](#LandingPageFieldType(Enterprise)-Layoutandzones)
-   [Blocks](#LandingPageFieldType(Enterprise)-Blocks)
-   [Rendering Landing Pages](#LandingPageFieldType(Enterprise)-RenderingLandingPages)
    -   [Viewing template](#LandingPageFieldType(Enterprise)-Viewingtemplate)

#### Related topics:

[Creating Landing Page layouts (Enterprise)](31430259.html)

[Creating Landing Page blocks (Enterprise)](31430614.html)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Cookbook](Cookbook_31429528.html)</span>

 Developer : Creating Landing Page blocks (Enterprise) 



# Description

<span class="status-macro aui-lozenge aui-lozenge-current">V1.2</span>

A Landing Page has a customizable <span class="DEF"><span class="DEF">layout</span></span> with multiple zones where you can place predefined blocks with content.

By default eZ Enterprise comes with a number of preset Landing Page blocks. You can, however, add custom blocks to your configuration.

# Solution

## Block configuration

In the Demo installation the layout configuration is stored in `ezstudio-demo-bundle/Resources/config/default_layouts.yml`:

**Example default\_layouts.yml**

``` brush:
blocks:
    gallery:
        views:
            gallery:
                template: eZStudioDemoBundle:blocks:gallery.html.twig
                name: Default Gallery Block template
    keyword:
        views:
            keyword:
                template: eZStudioDemoBundle:blocks:keyword.html.twig
                name: Default Keyword Block template
    rss:
        views:
            rss:
                template: eZStudioDemoBundle:blocks:rss.html.twig
                name: Default RSS Block template
    tag:
        views:
            tag:
                template: eZStudioDemoBundle:blocks:tag.html.twig
                name: Default Tag Block template
```

 

## Creating a new block

### Creating a class for the block

The class for the block must implement the `BlockType` interface:

``` brush:
EzSystems\LandingPageFieldTypeBundle\FieldType\LandingPage\Model\BlockType
```

Most methods are implemented in a universal way by using <span>the `AbstractBlockType` abstract class:</span>

``` brush:
EzSystems\LandingPageFieldTypeBundle\FieldType\LandingPage\Model\AbstractBlockType 
```

If your block does not have specific attributes or a structure, you can extend the `           AbstractBlockType         ` **** class, which contains simple generic converters designated for the block attributes.

<span>For example:</span>

``` brush:
<?php
namespace AcmeDemoBundle\Block;

use EzSystems\LandingPageFieldTypeBundle\FieldType\LandingPage\Model\AbstractBlockType;

/**
* RSS block
* Renders feed from a given URL.
*/
class RSSBlock extends AbstractBlockType
{
   // Class body
}
```

<span>
</span>

### Describing a class definition

A block **must** have a definition set using two classes:

#### BlockAttributeDefinition

The `               BlockAttributeDefinition             ` class defines the attributes of a block<span>:
</span>

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Attribute</th>
<th align="left">Type</th>
<th align="left">Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">$id</td>
<td align="left">string</td>
<td align="left">block attribute ID</td>
</tr>
<tr class="even">
<td align="left">$name</td>
<td align="left">string</td>
<td align="left">block attribute name</td>
</tr>
<tr class="odd">
<td align="left">$type</td>
<td align="left">string</td>
<td align="left">block attribute type, available options are:<br />

<ul>
<li><code>                         integer                       </code></li>
<li><code>                         string                       </code></li>
<li><code>                         url                       </code></li>
<li><code>                         text                       </code></li>
<li><code>                         embed                       </code></li>
<li><code>                         select                       </code></li>
<li><code>                         multiple                       </code></li>
</ul></td>
</tr>
<tr class="even">
<td align="left">$regex</td>
<td align="left">string</td>
<td align="left">block attribute regex used for validation</td>
</tr>
<tr class="odd">
<td align="left">$regexErrorMessage</td>
<td align="left">string</td>
<td align="left">message displayed when regex does not match</td>
</tr>
<tr class="even">
<td align="left">$required</td>
<td align="left">bool</td>
<td align="left"><code>TRUE</code> if attribute is required</td>
</tr>
<tr class="odd">
<td align="left">$inline</td>
<td align="left">bool</td>
<td align="left">indicates whether block attribute input should be rendered inline in a form</td>
</tr>
<tr class="even">
<td align="left">$values</td>
<td align="left">array</td>
<td align="left">array of chosen values</td>
</tr>
<tr class="odd">
<td align="left">$options</td>
<td align="left">array</td>
<td align="left">array of available options</td>
</tr>
</tbody>
</table>

<span style="color: rgb(0,0,0);">
</span>

#### BlockDefinition

The `               BlockDefinition             ` class describes a block:

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Attribute</th>
<th align="left">Type</th>
<th align="left">Definition</th>
<th align="left">Note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p>$type</p></td>
<td align="left">string</td>
<td align="left">block type</td>
<td align="left"> </td>
</tr>
<tr class="even">
<td align="left">$name</td>
<td align="left">string</td>
<td align="left">block name</td>
<td align="left"> </td>
</tr>
<tr class="odd">
<td align="left">$category</td>
<td align="left">string</td>
<td align="left">block category</td>
<td align="left"> </td>
</tr>
<tr class="even">
<td align="left">$thumbnail</td>
<td align="left">string</td>
<td align="left">path to block thumbnail image</td>
<td align="left"> </td>
</tr>
<tr class="odd">
<td align="left">$templates</td>
<td align="left">array</td>
<td align="left">array of available paths of templates</td>
<td align="left"><p>Retrieved from the config file (default_layouts.yml)</p></td>
</tr>
<tr class="even">
<td align="left">$attributes</td>
<td align="left">array</td>
<td align="left">array of block attributes (objects of <code>                     BlockAttributeDefinition                   </code> class)</td>
<td align="left"> </td>
</tr>
</tbody>
</table>

<span style="color: rgb(0,0,0);">
</span>

 

When extending `AbstractBlockType` you **must** implement at least 3 methods:

<span class="expand-control-icon"><img src="images/icons/grey_arrow_down.png" class="expand-control-image" /></span><span class="expand-control-text">createBlockDefinition()</span>

This method must return an **` EzSystems\LandingPageFieldTypeBundle\FieldType\LandingPage\Definition\BlockDefinition`**  object.

Example of a Gallery block:

``` brush:
/**
 * Creates BlockDefinition object for block type.
 *
 * @return \EzSystems\LandingPageFieldTypeBundle\FieldType\LandingPage\Definition\BlockDefinition
 */
public function createBlockDefinition()
{
    return new BlockDefinition(
        'gallery',
        'Gallery Block',
        'default',
        'bundles/ezsystemslandingpagefieldtype/images/thumbnails/gallery.svg',
        [], 
        [
            new BlockAttributeDefinition(
                'contentId',
                'Folder',
                'embed',
                '/^([a-zA-Z]:)?(\/[a-zA-Z0-9_\/-]+)+\/?/',
                'Choose an image folder'
            ),
        ]
    );
}
```

<span class="expand-control-icon"><img src="images/icons/grey_arrow_down.png" class="expand-control-image" /></span><span class="expand-control-text">getTemplateParameters(BlockValue $blockValue)</span>

This method returns an array of parameters to be displayed in rendered view of block. <span>You can access them directly in a block template (e. g. via twig </span> `{{ title }}` <span>).</span>

 

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
When parameters are used in the template you call them directly without the `parameters` array name:

| Correct                                                                | Not Correct                                                                               |
|------------------------------------------------------------------------|-------------------------------------------------------------------------------------------|
| `                         <h1>{{ title }}</h1>                       ` | ~~`                           <h1>{{ parameters.title }}</h1>                         `~~ |

 

Example of the `getTemplateParameters()` method implementation:

``` brush:
/**
* @param \EzSystems\LandingPageFieldTypeBundle\FieldType\LandingPage\Model\BlockValue $blockValue
*
* @return array
*/
public function getTemplateParameters(BlockValue $blockValue)
{
    $attributes = $blockValue->getAttributes();
    $limit = (isset($attributes['limit'])) ? $attributes['limit'] : 10;
    $offset = (isset($attributes['offset'])) ? $attributes['offset'] : 0;
    $parameters = [
        'title' => $attributes['title'],
        'limit' => $limit,
        'offset' => $offset,
        'feeds' => $this->RssProvider->getFeeds($attributes['url']),
    ];
    
    return $parameters;
}
```

<span> </span> <span>
</span>

<span class="expand-control-icon"><img src="images/icons/grey_arrow_down.png" class="expand-control-image" /></span><span class="expand-control-text">checkAttributesStructure(array $attributes)</span>

This method validates the input fields for a block. You can specify your own conditions to throw the `InvalidBlockAttributeException` exception.

This `InvalidBlockAttributeException` exception has the following parameters:

| Name                                                                                                                                                                                                                                                     | Description                                                                                                                                                                                                                                                                   |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span class="pl-s1"> <span class="pl-smi"> **blockType** </span> </span>                                                                                                                                                                                 | <span class="pl-s1"> <span class="pl-smi">name of a block</span> </span>                                                                                                                                                                                                      |
| <span class="pl-s1"> <span class="pl-smi"> <span class="pl-s1"> <span class="pl-smi"> **attribute** </span> </span> </span> </span>                                                                                                                      | <span class="pl-s1"> <span class="pl-smi"> <span class="pl-s1"> <span class="pl-smi">name of the block's attribute which failed validation</span> </span> </span> </span>                                                                                                     |
| <span class="pl-s1"> <span class="pl-smi"> <span class="pl-s1"> <span class="pl-smi"> <span class="pl-s1"> <span class="pl-smi"> **message** </span> </span> </span> </span> </span> </span>                                                             | <span class="pl-s1"> <span class="pl-smi"> <span class="pl-s1"> <span class="pl-smi"> <span class="pl-s1"> <span class="pl-smi">a short information about an error</span> </span> </span> </span> </span> </span>                                                             |
| <span class="pl-s1"> <span class="pl-smi"> <span class="pl-s1"> <span class="pl-smi"> <span class="pl-s1"> <span class="pl-smi"> <span class="pl-s1"> <span class="pl-smi"> **previous** </span> </span> </span> </span> </span> </span> </span> </span> | <span class="pl-s1"> <span class="pl-smi"> <span class="pl-s1"> <span class="pl-smi"> <span class="pl-s1"> <span class="pl-smi"> <span class="pl-s1"> <span class="pl-smi">previous exception, null by default</span> </span> </span> </span> </span> </span> </span> </span> |

<span class="pl-s1"> </span> <span class="pl-s1"> <span class="pl-smi"> <span class="pl-s1"> <span class="pl-smi"> <span class="pl-s1"> <span class="pl-smi"> <span class="pl-s1"> <span class="pl-smi">
</span> </span> </span> </span> </span> </span> </span> </span>

<span>For example:</span>

``` brush:
/**
 * Checks if block's attributes are valid.
 *
 * @param array $attributes
 *
 * @throws \EzSystems\LandingPageFieldTypeBundle\Exception\InvalidBlockAttributeException
 */
public function checkAttributesStructure(array $attributes)
{
    if (!isset($attributes['url'])) {
        throw new InvalidBlockAttributeException('RSS', 'url', 'URL must be set.');
    }

    if (isset($attributes['limit']) && (($attributes['limit'] < 1) || (!is_numeric($attributes['limit'])))) {
        throw new InvalidBlockAttributeException('RSS', 'limit', 'Limit must be a number greater than 0.');
    }

    if (isset($attributes['offset']) && (($attributes['offset'] < 0) || (!is_numeric($attributes['limit'])))) {
        throw new InvalidBlockAttributeException('RSS', 'offset', 'Offset must be a number no less than 0.');
    }
}
```

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
When the class is created make sure it is added to a container.

 

### Adding the class to the container

 The **services.yml** file must contain info about your block class.

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
The description of your class must contain a tag which provides:

-   tag name: **landing\_page\_field\_type.block\_type**
-   tag alias: &lt;name of a block&gt;

 

For example:

``` brush:
acme.landing_page.block.rss:                                             # service id
       class: AcmeDemoBundle\FieldType\LandingPage\Model\Block\RSSBlock # block's class with namespace
       tags:                                                            # service definition must contain tag with 
           - { name: landing_page_field_type.block_type, alias: rss}    # "landing_page_field_type.block_type" name and block name as an alias
```

## Custom editing UI

If you want to add a custom editing UI to your new block, you need to provide the code for the custom popup UI in Javascript (see the code for <a href="https://github.com/ezsystems/StudioUIBundle/blob/ea683e0443bc3660e9ee25fe24e435d99e1133ff/Resources/public/js/views/blocks/ezs-scheduleblockview.js">eZS.ScheduleBlockView</a> or <a href="https://github.com/ezsystems/StudioUIBundle/blob/162d6b9b967cb549f32bc06c4405d3809d8546f0/Resources/public/js/views/blocks/ezs-tagblockview.js">eZS.TagBlockView</a> for examples).

Once it is ready, create a plugin for `eZS.LandingPageCreatorView` that makes a use of the `addBlock` public method from `eZS.LandingPageCreatorView`, see the example below:

``` brush:
YUI.add('ezs-addcustomblockplugin', function (Y) {
    'use strict';

    var namespace = 'Any.Namespace.Of.Your.Choice',

    Y.namespace(namespace);
    NS = Y[namespace];

    NS.Plugin.AddCustomBlock = Y.Base.create('addCustomBlockPlugin', Y.Plugin.Base, [], {
        initializer: function () {
            this.get('host').addBlock('custom', NS.CustomBlockView);
        },
    }, {
        NS: 'dashboardPlugin'
    });

    Y.eZ.PluginRegistry.registerPlugin(
        NS.Plugin.AddCustomBlock, ['landingPageCreatorView']
    );
});
```

Upcoming feature - multiple block templates

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
The ability to configure different templates (views) for one Landing Page block is upcoming. See <a href="https://jira.ez.no/browse/EZS-1008">EZS-1008</a> to follow its progress.

 

# Example

### Block Class

**TagBlock.php**

``` brush:
<?php
/**
 * @copyright Copyright (C) eZ Systems AS. All rights reserved.
 * @license For full copyright and license information view LICENSE file distributed with this source code.
 */
namespace EzSystems\LandingPageFieldTypeBundle\FieldType\LandingPage\Model\Block;

use EzSystems\LandingPageFieldTypeBundle\Exception\InvalidBlockAttributeException;
use EzSystems\LandingPageFieldTypeBundle\FieldType\LandingPage\Definition\BlockDefinition;
use EzSystems\LandingPageFieldTypeBundle\FieldType\LandingPage\Definition\BlockAttributeDefinition;
use EzSystems\LandingPageFieldTypeBundle\FieldType\LandingPage\Model\AbstractBlockType;
use EzSystems\LandingPageFieldTypeBundle\FieldType\LandingPage\Model\BlockType;
use EzSystems\LandingPageFieldTypeBundle\FieldType\LandingPage\Model\BlockValue;

/**
 * Tag block
 * Renders simple HTML.
 */
class TagBlock extends AbstractBlockType implements BlockType
{
    /**
     * Returns array of parameters required to render block template.
     *
     * @param array $blockValue Block value attributes
     *
     * @return array Template parameters
     */
    public function getTemplateParameters(BlockValue $blockValue)
    {
        return ['block' => $blockValue];
    }

    /**
     * Creates BlockDefinition object for block type.
     *
     * @return \EzSystems\LandingPageFieldTypeBundle\FieldType\LandingPage\Definition\BlockDefinition
     */
    public function createBlockDefinition()
    {
        return new BlockDefinition(
            'tag',
            'Tag Block',
            'default',
            'bundles/ezsystemslandingpagefieldtype/images/thumbnails/tag.svg',
            [],
            [
                new BlockAttributeDefinition(
                    'content',
                    'Content',
                    'text',
                    '/[^\\s]/',
                    'Provide html code'
                ),
            ]
        );
    }

    /**
     * Checks if block's attributes are valid.
     *
     * @param array $attributes
     *
     * @throws \EzSystems\LandingPageFieldTypeBundle\Exception\InvalidBlockAttributeException
     */
    public function checkAttributesStructure(array $attributes)
    {
        if (!isset($attributes['content'])) {
            throw new InvalidBlockAttributeException('Tag', 'content', 'Content must be set.');
        }
    }
}
```

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
<span class="status-macro aui-lozenge aui-lozenge-current">V1.7</span>

If you want to make sure that your block is only available in the Element menu in a specific situation, you can override the `isAvailable` method, which makes the block accessible by default:

``` brush:
public function isAvailable()
    {
        return true;
    }
```

 

### service.yml configuration

**services.yml**

``` brush:
ezpublish.landing_page.block.tag:
    class: EzSystems\LandingPageFieldTypeBundle\FieldType\LandingPage\Model\Block\TagBlock
    tags:
        - { name: landing_page_field_type.block_type, alias: tag }
```

### <span>Block template</span>

    {{ block.attributes.content|raw }}

 

#### In this topic:

-   [Description](#CreatingLandingPageblocks(Enterprise)-Description)
-   [Solution](#CreatingLandingPageblocks(Enterprise)-Solution)
    -   [Block configuration](#CreatingLandingPageblocks(Enterprise)-Blockconfiguration)
    -   [Creating a new block](#CreatingLandingPageblocks(Enterprise)-Creatinganewblock)
        -   [Creating a class for the block](#CreatingLandingPageblocks(Enterprise)-Creatingaclassfortheblock)
        -   [Describing a class definition](#CreatingLandingPageblocks(Enterprise)-Describingaclassdefinition)
        -   [Adding the class to the container](#CreatingLandingPageblocks(Enterprise)-Addingtheclasstothecontainer)
    -   [Custom editing UI](#CreatingLandingPageblocks(Enterprise)-CustomeditingUI)
-   [Example](#CreatingLandingPageblocks(Enterprise)-Example)
    -   [Block Class](#CreatingLandingPageblocks(Enterprise)-BlockClass)
    -   [service.yml configuration](#CreatingLandingPageblocks(Enterprise)-service.ymlconfiguration)
    -   [Block template](#CreatingLandingPageblocks(Enterprise)-Blocktemplate)

 

#### Related topics:

[Creating Landing Page layouts (Enterprise)](31430259.html)

[Landing Page Field Type (Enterprise)](31430521.html)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Migrating to eZ Platform - Follow the Ibex!](31429532.html)</span>
4.  <span>[Coming to eZ Platform from eZ Publish Platform](Coming-to-eZ-Platform-from-eZ-Publish-Platform_31429598.html)</span>
5.  <span>[Upgrading from 5.4.x and 2014.11 to 16.xx](Upgrading-from-5.4.x-and-2014.11-to-16.xx_31430322.html)</span>

 Developer : Migrating legacy Page field (ezflow) to Landing Page (Enterprise) 



To move your legacy Page field / eZ Flow configuration to eZ Platform Enterprise Edition you can use a script that will aid in the migration process.

The script will automatically migrate only data – to move custom views, layouts, blocks etc., you will have to provide their business logic again.

<span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
The migration script will operate on your current database.

Make sure to **back up your database** in case of an unexpected error.

 

To use the script, do the following:

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Make a note of the paths to .ini files which define your legacy blocks. You will need these paths later.

**1.** Add `ezflow-migration-toolkit` to `composer.json` in your clean Platform installation.

**composer.json**

``` brush:
"ezsystems/ezflow-migration-toolkit": "^1.0.0"
```

**2.** Add `ezflow-migration-toolkit` to `AppKernel.php`.

**AppKernel.php**

``` brush:
new EzSystems\EzFlowMigrationToolkitBundle\EzSystemsEzFlowMigrationToolkitBundle()
```

**3.** Clear cache.

``` brush:
app/console cache:clear
```

**4.** Run the script with the following parameters:

-   absolute path of your legacy application
-   list of .ini files which define your legacy blocks

**Script command**

``` brush:
app/console ezflow:migrate <legacy path> —ini=<block definitions> [—ini=<another block definition> ...]
```

**Example of the migration script command**

``` brush:
app/console ezflow:migrate /var/www/legacy.application.com/ —ini=extension/myapplication/settings/block.ini.append.php
```

**5.** You will be warned about the need to create a backup of your database. **Proceed only if you are sure you have done it.**

A `MigrationBundle` will be generated in the `src/` folder.

You will see a report summarizing the results of the migration.

**6.** Add `MigrationBundle` to `AppKernel.php`.

**AppKernel.php**

``` brush:
new MigrationBundle\MigrationBundle()
```

**7.** Clear cache again.

 

At this point you can already view the initial effects of the migration, but they will still be missing some of your custom content.

The `MigrationBundle` generates placeholders for layouts in the form of frames with a data dump.

For blocks that could not be mapped to existing Landing Page blocks, it will also generate PHP file templates that you need to fill with your own business logic.

 

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>
4.  <span>[Building a Bicycle Route Tracker in eZ Platform](Building-a-Bicycle-Route-Tracker-in-eZ-Platform_31431606.html)</span>

 Developer : Part 1: Setting up eZ Platform 



<span class="confluence-embedded-file-wrapper image-right-wrapper confluence-embedded-manual-size"><img src="attachments/31431610/31431916.png" class="confluence-embedded-image image-right" height="250" /></span>

The first step is to get eZ Platform running on your server. In Part 1, we'll walk you through that, step by step.

-   [Step 1 - Getting Ready](Step-1---Getting-Ready_31431834.html)
-   [Step 2 - Create your content model](Step-2---Create-your-content-model_31431844.html)
-   [Step 3 - Customizing the general layout](Step-3---Customizing-the-general-layout_31428488.html)

**Tutorial path**

## Attachments:

<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [Content\_Repository.png](attachments/31431610/31431916.png) (image/png)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>
4.  <span>[Building a Bicycle Route Tracker in eZ Platform](Building-a-Bicycle-Route-Tracker-in-eZ-Platform_31431606.html)</span>

 Developer : Part 2: Working on the Ride 



You will now work on the display of a single Ride on its own page. <span class="confluence-embedded-file-wrapper image-right-wrapper confluence-embedded-manual-size"><img src="attachments/30708529/31427691.png" class="confluence-embedded-image image-right" height="250" /></span>

-   [Step 1 - Display content of a Ride](Step-1---Display-content-of-a-Ride_31431852.html)
-   [Step 2 - Display the list of Rides on the homepage](Step-2---Display-the-list-of-Rides-on-the-homepage_32866555.html)
-   [Congrats!](31431873.html)

**Tutorial path**






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>
4.  <span>[Building a Bicycle Route Tracker in eZ Platform](Building-a-Bicycle-Route-Tracker-in-eZ-Platform_31431606.html)</span>

 Developer : Part 3: Adding features 



**A sneak peak...**

If you would like a sneak peak at our efforts, take a look at the <a href="https://jira.ez.no/issues/?jql=component%20%3D%20%22Beginner%20Tutorial%22%20AND%20project%20%3D%20EZP">Beginner Tutorial Component in Jira</a>.

**We're constantly improving and extending this tutorial, and our process is open.**

We're preparing a lot of training material on the Bike Ride theme for you for tutorials, developer training, and certification:

-   <a href="https://jira.ez.no/issues/?jql=component%20%3D%20%22BikeRide%2FTutorial%22%20AND%20project%20%3D%20EZP">Bike Ride Tutorial in JIRA</a>
-   <a href="https://jira.ez.no/issues/?jql=component%20%3D%20%22BikeRide%2FDevTrain%22">Bike Ride Developer Training in JIRA</a>
-   <a href="https://jira.ez.no/issues/?jql=component%20%3D%20%22BikeRide%2FCert%22">Bike Ride Certification Course in JIRA</a>

**Want to join in the fun ?**

Read about how you can [Contribute to Documentation](Contribute-to-Documentation_31429594.html)!

Questions ?

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
If you have any questions, feel free to reach out to us or our <a href="http://share.ez.no/get-involved/exchange">awesome community</a> for help!

 

 

 

<span class="status-macro aui-lozenge aui-lozenge-current">TO BE CONTINUED</span>

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>
4.  <span>[Building a Bicycle Route Tracker in eZ Platform](Building-a-Bicycle-Route-Tracker-in-eZ-Platform_31431606.html)</span>
5.  <span>[Part 2: Working on the Ride](31431613.html)</span>

 Developer : Congrats! 



<span class="confluence-embedded-file-wrapper image-right-wrapper confluence-embedded-manual-size"><img src="attachments/thumbnails/30711113/30711865" class="confluence-embedded-image confluence-thumbnail image-right" height="150" /></span>

### Success: you have just built your first website

Now you have created your first website with eZ Platform.

The website is simple and efficient.

**You learned**

-   How to do a quick install of eZ Platform
-   How the files in an eZ Platform project are organized
-   Where you should put your asset files
-   How to param your eZ Platform to use templating
-   How to use Twig templates to display the content from your database

 

<span class="status-macro aui-lozenge aui-lozenge-current">WORK IN PROGRESS</span>

> This tutorial will evolve quickly, let us know on <a href="http://share.ez.no/get-involved/exchange#slack">Slack</a>, <a href="http://share.ez.no/forums/suggestions">Forums</a> or even comments on this page what Features you want to implement first after this Tutorial. Thank you!

**Tutorial path**






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>

 Developer : eZ Enterprise Beginner Tutorial - It's a Dog's World 



This tutorial will guide you through the process of making and customizing a front page for your website. For this purpose we will use a feature of eZ Platform Enterprise Edition called **Landing Page**. 

Landing Page is a special type of page that lets <span class="inline-comment-marker" data-ref="7c3e91d5-8490-4e10-9868-0d6533f19dcd">the Editor</span> easily create and customize a complex, multi-zone entrance point to your website. In this tutorial you will learn both how to make use of out-of-the-box elements of the feature and how to extend it to fit your specific needs.

## Intended audience

This tutorial is intended for a beginner with basic knowledge of the workings of eZ Platform. Ideally, you should be familiar with the concepts covered in the [Building a Bicycle Route Tracker in eZ Platform tutorial](Building-a-Bicycle-Route-Tracker-in-eZ-Platform_31431606.html).

## Learning outcomes

After going through this tutorial, you will:

-   Have a working knowledge of Landing Page functionality and architecture
-   Be able to create a Landing Page and customize its layout
-   Be able to prepare and customize Schedule Blocks
-   Be able to create a custom block to be placed on a Landing Page

# The Story Behind the Tutorial

*You have been commissioned with creating a website for the It's a Dog's World magazine, a periodical for dog owners. It's a Dog's World is a magazine focused on content-rich articles, a comprehensive encyclopedia of <span class="inline-comment-marker" data-ref="79690b32-2a5f-490c-9ad3-9bdee7ff5359">dog breeds</span> and useful dog care advice.*

*Your main objective is to create a welcome page that would showcase the magazine's three most important types of content: articles, dog breed information and tips.*

We will do this by means of a Landing Page, making use of its specific blocks, and crafting our own as well.

<span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img src="attachments/32868209/32868208.png" title="It&#39;s a Dog&#39;s World - final result" alt="It&#39;s a Dog&#39;s World - final result" class="confluence-embedded-image image-center" width="600" /></span>

### Why use a Landing Page?

A Landing Page is particularly fitted to what you need to do in this tutorial. You can build and customize it once, and later the magazine's editor can create and publish <span class="inline-comment-marker" data-ref="836a2b30-3b87-4ec8-a381-29ccddff48e5">new content</span> that will automatically land in the correct place on the front page.

For showcasing articles we will use a Schedule Block, a special Landing Page element that lets you plan the times and order at which content will air.

We will display entries from the Dog Breed encyclopedia using a Content List Block. This block will automatically find all Dog Breed Content items and display their previews in a separate column.

Finally, we will display one random tip of the day using a special, custom block we will build during this tutorial.

## Table of contents

The tutorial goes through four steps:

-   [Step 1 - Getting your starter website](Step-1---Getting-your-starter-website_32868226.html)
-   [Step 2 - Preparing the Landing Page](Step-2---Preparing-the-Landing-Page_32868235.html)
-   [Step 3 - Using existing blocks](Step-3---Using-existing-blocks_32868245.html)
-   [Step 4 - Creating a custom block](Step-4---Creating-a-custom-block_32868249.html)

 

------------------------------------------------------------------------

 

 

[Start the tutorial](Step-1---Getting-your-starter-website_32868226.html) <span class="confluence-link" title="Black Rightwards Arrow">➡</span>

**Tutorial path**

## Attachments:

<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [iadw\_main\_screen.png](attachments/32868209/32868528.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [iadw\_main\_screen.png](attachments/32868209/32869503.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [iadw\_main\_screen.png](attachments/32868209/32868208.png) (image/png)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : API Reference 



<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
See the online [API](API_31429524.html) reference for full API documentation

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>

 Developer : API 



An Application Programming Interface (API) allows you to connect your code to eZ Platform.

From the eZ Blog: <a href="http://ez.no/Blog/How-would-you-explain-what-an-API-is-to-your-mom" class="uri">http://ez.no/Blog/How-would-you-explain-what-an-API-is-to-your-mom</a>

eZ Platform offers two APIs:

1.  The [REST API](https://doc.ez.no/display/DEVELOPER/REST+API+Guide) allows you to interact with an eZ Platform installation using the HTTP protocol, following a <span>REST</span> interaction model
2.  The [Public (PHP) API](https://doc.ez.no/display/DEVELOPER/Public+API+Guide) exposes a Repository which allows you to create, read, update, manage and delete all objects available in eZ Platform, first and foremost content, but also related objects like sections, locations, content types, content types groups, languages and so on.

There is also a [JavaScript API Client](JS-Client_31429579.html), useful for working with eZ Platform as a <a href="http://ez.no/Blog/Content-as-a-Service-CaaS-Decoupled-CMS-and-Headless-CMS-101">headless CMS</a>.

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>
4.  <span>[Extending PlatformUI with new navigation](Extending-PlatformUI-with-new-navigation_31430235.html)</span>

 Developer : Alter the JavaScript Application routing 



## PlatformUI routing mechanism

The essential task of the PlatformUI Application component is to handle the routing. It is based on <a href="http://yuilibrary.com/yui/docs/app/#hash-based-urls-only">the routing capabilities provided by the YUI App component</a> and it uses hash-based URIs. By default, the PlatformUI Application will recognize and handle <a href="https://github.com/ezsystems/PlatformUIBundle/blob/master/Resources/public/js/apps/ez-platformuiapp.js#L720">several routes which are declared in the app component itself</a>.

A route is described by an object with the following properties:

-   `path`: the path to match
-   `view`: the identifier of the main view to render when the route is matched
-   `callbacks`: a list of *middlewares* to execute
-   `name`: an optional name to generate links
-   `sideViews`: an optional side view configuration
-   `service`: an optional reference to a view service constructor

## Modifying the routing from the bundle with a plugin

To tweak any behavior in the application, the way to go is to write a plugin and in this case a plugin for the Application.

### Declaring the module providing plugin

The module has to be declared in the extension bundle's `yui.yml` file. It can be done in the following way:

``` brush:
system:
    default:
        yui:
            modules:
                # use your own prefix, not "ez-"
                ezconf-listapplugin: # module identifier
                    dependencyOf: ['ez-platformuiapp']
                    requires: ['ez-pluginregistry', 'plugin', 'base'] # depends on the plugin code
                    path: %extending_platformui.public_dir%/js/apps/plugins/ezconf-listappplugin.js
```

This configuration means we are declaring a module whose identifier is `ezconf-listapplugin`. It will be added to the dependency list of the module `ez-platformuiapp` (the one providing the application component). The plugin module requires `ez-pluginregistry`, `plugin` and `base.` It is stored on the disk in `%extending_platformui.public_dir%/js/apps/plugins/ezconf-listappplugin.js`.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
`%extending_platformui.public_dir%` is a container parameter which was added in the previous step. It is here to avoid repeating again and again the base path to the public directory. Of course, it is also perfectly possible to write the full path to the module.

### Module creation

Before creating the actual plugin code, we have to first create the module in the configured file. The minimal module code is:

**%extending\_platformui.public\_dir%/js/apps/plugins/ezconf-listappplugin.js**

``` brush:
YUI.add('ezconf-listapplugin', function (Y) {
    // module code goes here!
    // this function will executed when the module loaded in the app,
    // not when the file is loaded by the browser
    // the Y parameter gives access to the YUI env, for instance the components
    // defined by others modules.
}); 
```

<span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
The first parameter of `YUI.add` should be exactly the module identifier used in `yui.yml` otherwise the module won't be correctly loaded in the application. If the module code does not seem to be taken into account, it is the very first thing to check.

### Base plugin code

After the module creation, it is time to create the minimal Application plugin:

**%extending\_platformui.public\_dir%/js/apps/plugins/ezconf-listappplugin.js**

``` brush:
YUI.add('ezconf-listapplugin', function (Y) {
    // Good practices:
    // * use a custom namespace. 'eZConf' is used as an example here.
    // * put the plugins in a 'Plugin' sub namespace
    Y.namespace('eZConf.Plugin');

    Y.eZConf.Plugin.ListAppPlugin = Y.Base.create('ezconfListAppPlugin', Y.Plugin.Base, [], {
        initializer: function () {
            var app = this.get('host'); // the plugged object is called host

            console.log("Hey, I'm a plugin for PlatformUI App!");
            console.log("And I'm plugged in ", app);
        },
    }, {
        NS: 'ezconfTypeApp' // don't forget that
    });

    // registering the plugin for the app
    // with that, the plugin is automatically instantiated and plugged in
    // 'platformuiApp' component.
    Y.eZ.PluginRegistry.registerPlugin(
        Y.eZConf.Plugin.ListAppPlugin, ['platformuiApp']
    );
});
```

The added code creates a plugin class and registers it under `Y.eZConf.Plugin.ListAppPlugin`, then the PlatformUI plugin registry is configured so that this plugin is automatically instantiated and plugged in the PlatformUI App component.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
The PlatformUI's plugin system comes almost entirely from <a href="http://yuilibrary.com/yui/docs/plugin/">the YUI plugin</a>. While that's not a strict requirement, you should use the *Advanced Plugins* strategy mentioned in the YUI documentation. That's why in this example and in most cases, the plugin will have the `plugin` and `base` YUI plugin as dependencies. `base` also provides the low level foundations for most PlatformUI component, so reading <a href="http://yuilibrary.com/yui/docs/base/">the Base YUI documentation</a> will also help you understand several concepts used all over the application.

At this point, if you open PlatformUI in your favorite browser with the console open, you should see the result of the `console.log` calls in the above code.

### Adding a route to the application

Finally, the plugin is ready to add a new route to the application. As written in the previous code sample, the plugged object, the application here, is available through `this.get('host')` in the plugin. The App object provides <a href="http://yuilibrary.com/yui/docs/api/classes/App.html#method_route">a <code>route</code> method</a> allowing to add route.

**%extending\_platformui.public\_dir%/js/apps/plugins/ezconf-listappplugin.js**

``` brush:
YUI.add('ezconf-listapplugin', function (Y) {
    Y.namespace('eZConf.Plugin');

    Y.eZConf.Plugin.ListAppPlugin = Y.Base.create('ezconfListAppPlugin', Y.Plugin.Base, [], {
        initializer: function () {
            var app = this.get('host'); // the plugged object is called host

            app.route({
                name: "eZConfList",
                path: "/ezconf/list",
                view: "dashboardView", // let's display the dashboard since we don't have a custom view... yet :)
                // we want the navigationHub (top menu) but not the discoveryBar
                // (left bar), we can try different options
                sideViews: {'navigationHub': true, 'discoveryBar': false},
                callbacks: ['open', 'checkUser', 'handleSideViews', 'handleMainView'],
            });
        },
    }, {
        NS: 'ezconfTypeApp' // don't forget that
    });

    Y.eZ.PluginRegistry.registerPlugin(
        Y.eZConf.Plugin.ListAppPlugin, ['platformuiApp']
    );
});
```

Now, if you refresh your browser, you still need not see any visible change but the application should recognize the `/ezconf/list` hash URI. Going to `/ez#/ezconf/list` should display the same thing as `/ez#/dashboard`.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
The PlatformUI Application component extends the YUI App component, as a result <a href="http://yuilibrary.com/yui/docs/api/classes/App.html">the complete API of this component</a> can be used.

Results and next step:

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
The resulting code can be seen in <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/tree/3_routing">the 3_routing tag on GitHub</a>, this step result can also be viewed as <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/compare/2_configuration...3_routing">a diff between tags <code>2_configuration</code> and <code>3_routing</code></a>.

The next step is then [to define a new view and to use it when the newly added route is matched](Define-a-View_31430243.html).

**Tutorial path**






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Extending eZ Platform](Extending-eZ-Platform_31429689.html)</span>

 Developer : An Introduction to Extending eZ Platform 



Contributing to the doc

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
This part of the documentation is still a <span class="status-macro aui-lozenge aui-lozenge-current">WORK-IN-PROGRESS</span>. Would you like to contribute to it?

If you have any thoughts or tips to share, let us know in the comments below, visit our <a href="http://ez-community-on-slack.herokuapp.com/">Slack channel</a> or take a look at other ways to [Contribute to Documentation](Contribute-to-Documentation_31429594.html).

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : Asset Management 



eZ Platform supports multiple binary file handling mechanisms by means of an `IOHandler` interface. This feature is used by the <span class="confluence-link"> [BinaryFile](BinaryField-Field-Type_31430501.html) </span>, [<span class="confluence-link">Media</span>](Media-Field-Type_31430525.html)and [<span class="confluence-link">Image</span>](Image-Field-Type_31430513.html)Field Types.

# Native IO handler 

The IO API is organized around two types of handlers:

-   `eZ\Publish\IO\IOMetadataHandler`: Stores & reads metadata (validity, size, etc.)
-   `eZ\Publish\IO\IOBinarydataHandler`: Stores & reads binarydata (actual contents)

The IOService uses both.

## Configuration

IO handling can now be configured using semantic configuration. Assigning the IO handlers to ezplatform itself is configurable per siteaccess. This is the default configuration:

``` brush:
ezpublish:
    system:
        default:
            io:
                metadata_handler: default
                binarydata_handler: default
```

Metadata and binarydata handlers are configured in the `ez_io` extension. This is what the configuration looks like for the default handlers. It declares a metadata handler and a binarydata handler, both labelled 'default'. Both handlers are of type 'flysystem', and use the same flysystem adapter, labelled 'default' as well.

``` brush:
ez_io:
    metadata_handlers:
        default:
            flysystem:
                adapter: default
    binarydata_handlers:
        default:
            flysystem:
                adapter: default
```

The 'default' flysystem adapter's directory is based on your site settings, and will automatically be set to `%ezpublish_legacy.root_dir%/$var_dir$/$storage_dir$` (example: `/path/to/ezpublish_legacy/var/ezdemo_site/storage`).

### Configure the permissions of generated files

<span class="status-macro aui-lozenge aui-lozenge-current">V1.5</span>

``` brush:
ezpublish:
    system:
        default:
            io:
                permissions: 
                    files: 0750 #default is 0644
                    directories: 0640 #default is 0755
```

Both `files` and `directories` rules are optional.

Default values are 0644 for files and 0755 for directories.

## <a href="https://github.com/ezsystems/ezpublish-kernel/blob/native_io_spec/doc/specifications/io/native_io_handlers.md#the-native-flysystem-handler"></a>The native Flysystem handler

<a href="https://github.com/ezsystems/ezpublish-kernel/blob/native_io_spec/doc/specifications/io/flysystem.thephpleague.com">league/flysystem</a> (along with <a href="https://github.com/1up-lab/OneupFlysystemBundle/">FlysystemBundle</a>) is an abstract file handling library.

It is used as the default way to read & write content binary files in eZ Platform. It can use the `local` filesystem *(our default configuration and the one we officially support)*, but is also able to read/write to `sftp`, `zip` or cloud filesystems *(`azure`, `rackspace`, `S3`)*.

### Handler options

#### Adapter

The adapter is the 'driver' used by flysystem to read/write files. Adapters can be declared using `oneup_flysystem` as follows:

``` brush:
oneup_flysystem:
    adapters:
        default:
            local:
                directory: "/path/to/directory"
```

 

The way to configure other adapters can be found on the <a href="https://github.com/1up-lab/OneupFlysystemBundle/blob/master/Resources/doc/index.md#step3-configure-your-filesystems">bundle's online documentation</a>. Note that we do not use the Filesystem configuration described in this documentation, only the adapters.

## The DFS Cluster handler

For clustering use we provide a custom metadata handler that stores metadata about your assets in the database. This is done as it is faster then accessing the remote NFS or S3 instance in order to read metadata. For further reading on setting this up, see [Clustering](Clustering_31430387.html).

 

#### In this topic:

-   [Native IO handler ](#AssetManagement-NativeIOhandler)
    -   [Configuration](#AssetManagement-Configuration)
        -   [Configure the permissions of generated files](#AssetManagement-Configurethepermissionsofgeneratedfiles)
    -   [The native Flysystem handler](#AssetManagement-ThenativeFlysystemhandler)
        -   [Handler options](#AssetManagement-Handleroptions)
    -   [The DFS Cluster handler](#AssetManagement-TheDFSClusterhandler)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Cookbook](Cookbook_31429528.html)</span>

 Developer : Authenticating a user with multiple user providers 



# Description

Symfony provides native support for <a href="http://symfony.com/doc/2.3/book/security.html#using-multiple-user-providers">multiple user providers</a>. This makes it easy to integrate any kind of login handlers, including SSO and existing 3rd party bundles (e.g. <a href="https://github.com/Maks3w/FR3DLdapBundle">FR3DLdapBundle</a>, <a href="https://github.com/hwi/HWIOAuthBundle">HWIOauthBundle</a>, <a href="https://github.com/FriendsOfSymfony/FOSUserBundle">FOSUserBundle</a>, <a href="http://github.com/BeSimple/BeSimpleSsoAuthBundle">BeSimpleSsoAuthBundle</a>, etc.).

However, to be able to use *external* user providers with eZ, a valid eZ user needs to be injected into the repository. This is mainly for the kernel to be able to manage content-related permissions (but not limited to this).

Depending on your context, you will either want to create an eZ user `on-the-fly`, return an existing user, or even always use a generic user.

# Solution

Whenever an *external* user is matched (i.e. one that does not come from eZ repository, like coming from LDAP), eZ kernel fires an `MVCEvents::INTERACTIVE_LOGIN` event. Every service listening to this event will receive an `eZ\Publish\Core\MVC\Symfony\Event\InteractiveLoginEvent` object which contains the original security token (that holds the matched user) and the request.

It's then up to the listener to retrieve an eZ user from the repository and to assign it back to the event object. This user will be injected into the repository and used for the rest of the request.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
If no eZ user is returned, the anonymous user will be used.

### User exposed and security token

When an *external* user is matched, a different token will be injected into the security context, the `InteractiveLoginToken`. This token holds a `UserWrapped` instance which contains the originally matched user and the *API user* (the one from the eZ repository).

Note that the *API user* is mainly used for permission checks against the repository and thus stays *under the hood*.

### Customizing the user class

It is possible to customize the user class used by extending `ezpublish.security.login_listener` service, which defaults to `eZ\Publish\Core\MVC\Symfony\Security\EventListener\SecurityListener`.

You can override `getUser()` to return whatever user class you want, as long as it implements `eZ\Publish\Core\MVC\Symfony\Security\UserInterface`.

# Example

<span>Here is a very simple example using the in-memory user provider.</span>

**app/config/security.yml**

``` brush:
security:
    providers:
        # Chaining in_memory and ezpublish user providers
        chain_provider:
            chain:
                providers: [in_memory, ezpublish]
        ezpublish:
            id: ezpublish.security.user_provider
        in_memory:
            memory:
                users:
                    # You will then be able to login with username "user" and password "userpass"
                    user:  { password: userpass, roles: [ 'ROLE_USER' ] }
    # The "in memory" provider requires an encoder for Symfony\Component\Security\Core\User\User
 encoders:
        Symfony\Component\Security\Core\User\User: plaintext
```

### Implementing the listener

**services.yml in your AcmeTestBundle**

``` brush:
parameters:
    acme_test.interactive_event_listener.class: Acme\TestBundle\EventListener\InteractiveLoginListener

services:
    acme_test.interactive_event_listener:
        class: %acme_test.interactive_event_listener.class%
        arguments: [@ezpublish.api.service.user]
        tags:
            - { name: kernel.event_subscriber } 
```

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Do not mix `MVCEvents::INTERACTIVE_LOGIN` event (specific to eZ Platform) and `SecurityEvents::INTERACTIVE_LOGIN` event (fired by Symfony security component)

**Interactive login listener**

``` brush:
<?php
namespace Acme\TestBundle\EventListener;

use eZ\Publish\API\Repository\UserService;
use eZ\Publish\Core\MVC\Symfony\Event\InteractiveLoginEvent;
use eZ\Publish\Core\MVC\Symfony\MVCEvents;
use Symfony\Component\EventDispatcher\EventSubscriberInterface;

class InteractiveLoginListener implements EventSubscriberInterface
{
    /**
     * @var \eZ\Publish\API\Repository\UserService
     */
    private $userService;

    public function __construct( UserService $userService )
    {
        $this->userService = $userService;
    }

    public static function getSubscribedEvents()
    {
        return array(
            MVCEvents::INTERACTIVE_LOGIN => 'onInteractiveLogin'
        );
    }

    public function onInteractiveLogin( InteractiveLoginEvent $event )
    {
        // We just load a generic user and assign it back to the event.
        // You may want to create users here, or even load predefined users depending on your own rules.
        $event->setApiUser( $this->userService->loadUserByLogin( 'lolautruche' ) );
    }
} 
```

**
**

#### In this topic:

-   [Description](#Authenticatingauserwithmultipleuserproviders-Description)
-   [Solution](#Authenticatingauserwithmultipleuserproviders-Solution)
    -   [User exposed and security token](#Authenticatingauserwithmultipleuserproviders-Userexposedandsecuritytoken)
    -   [Customizing the user class](#Authenticatingauserwithmultipleuserproviders-Customizingtheuserclass)
-   [Example](#Authenticatingauserwithmultipleuserproviders-Example)
    -   [Implementing the listener](#Authenticatingauserwithmultipleuserproviders-Implementingthelistener)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>
6.  <span>[Content items, Content Types and Fields](31430275.html)</span>
7.  <span>[Field Types reference](Field-Types-reference_31430495.html)</span>

 Developer : Author Field Type 



<span class="sd">Field Type representing a list of authors, consisting of author name, and author email.</span>

 

| Name     | Internal name | Expected input | Output   |
|----------|---------------|----------------|----------|
| `Author` | `ezauthor`    | `Mixed`        | `String` |

## Description

This Field Type allows the storage and retrieval of additional authors. For each author, it is capable of handling a name and an e-mail address. It is typically useful when there is a need for storing information about additional authors who have written/created different parts of a Content item.

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Get Started with eZ Platform](Get-Started-with-eZ-Platform_31429520.html)</span>
4.  <span>[Step 1: Installation](31429538.html)</span>

 Developer : Avoiding Problems 



<span class="status-macro aui-lozenge aui-lozenge-current">WORK-IN-PROGRESS</span>

This page will list many potential problems and gotchas that you may encounter while installing, configuring, and running eZ Platform. If you stumble upon an obstacle, take a look here to see if your case isn't covered. Want to add to this page? Check out our instructions for [contributing to our documentation](https://doc.ez.no/display/DEVELOPER/Contribute+to+Documentation).

## Enable Swap on Systems with Limited RAM

If you're having difficulty completing installation on a system with limited RAM (1GB or 2GB, for example), check that you've enabled swap. This allows your Operating System to use the hard disk to supplement RAM when it runs out. Running \``php -d memory_limit=-1 app/console ezplatform:install --env prod clean`\` on a system with swap enabled should yield success. When a system runs out of RAM, you may see \`Killed\` when trying to clear the cache (e.g., \`php app/console --env=prod cache:clear\` from your project's root directory).

## Upload Size Limit

To make use of PlatformUI, you need to define the maximum upload sizeto be consistent with the maximum file size defined in the Content Type using a File, Media or Image Field Definition.

This is done by setting `LimitRequestBody` for Apache or` client_max_body_size` for Nginx.

For instance, if one of those Field definitions is configured to accept files up to 10MB, then `client_max_body_size` (in case of Nginx) should be set above 10MB, with a safe margin, for example to 15MB.

## Initial Install Options

If you accepted all the defaults when doing a \`composer install\`, but realize you need to go back and change some of those options, look in \`app/config/parameters.yml\` – that's where they're stored.

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : Best Practices 



# Structuring an eZ Platform Project

Since release 2015.10, eZ Platform is very close to the <a href="https://github.com/symfony/symfony-standard">standard Symfony distribution</a>. It comes with default settings that will let you get started in a few minutes.

## The AppBundle

Most projects can use the provided `AppBundle`, in the `src` folder. It is enabled by default. The project's PHP code (controllers, event listeners, etc.) can be placed there.<span> </span>

<span>Reusable libraries should be packaged so that they can easily be managed using Composer.</span>

## <span>Templates</span>

<span>Project templates should go into `app/Resources/views`.</span>

<span>They can then be referenced in code without any prefix, for example `app/Resources/views/content/full.html.twig` can be referenced in twig templates or PHP as `content/full.html.twig`.</span>

## <span>Assets</span>

<span>Project assets should go into the `web` folder, and can be referenced as relative to the root, for example `web/js/script.js` can be referenced as `js/script.js` from templates.</span>

<span><span style="color: rgb(44,45,48);">All project assets are accessible through the `web/assets` path.</span></span>

## Configuration

Configuration may go into `app/config`. However, services definitions from `AppBundle` should go into `src/AppBundle/Resources/config`.

## Versioning a project

The recommended method is to version the whole ezplatform repository. Per installation configuration should use `parameters.yml`.

 

# eZ Platform Configuration

eZ Platform configuration is delivered using a number of dedicated configuration files. This config covers everything from selecting the content repository to siteaccesses to language settings.

## Configuration format

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Config files can have different formats. The recommended one is YAML, which is used by default in the kernel (and in examples throughout the documentation). However, you can also have configuration in XML or PHP formats.

 

Basic configuration handling in eZ Platform is similar to the usual Symfony config. To use it, you define key/value pairs in your configuration files. Internally and by convention, keys follow a dot syntax where the different segments follow your configuration hierarchy. Keys are usually prefixed by a namespace corresponding to your application. Values can be anything, including arrays and deep hashes.

## Configuration files

Main configuration files are located in the `app/config` folder.

If you use the provided `AppBundle`, service definitions from it should go into `src/AppBundle/Resources/config`.

-   `parameters.yml` contains infrastructure-related configuration. It is created based on the default settings defined in `parameters.yml.dist`.
-   `config.yml` contains configuration stemming from Symfony and covers settings such as search engine or cache configuration.
-   `ezplatform.yml` contains general configuration that is specific for eZ Platform, like for example siteaccess settings.
-   `security.yml` is the place for security-related settings.
-   `routing.yml` defines routes that will be used throughout the application.

Configuration can be made environment-specific using separate files for each environment. These files will contain additional settings and point to the general (not environment-specific) configuration that will be applied in other cases.

Here you can read more about <a href="http://symfony.com/doc/current/best_practices/configuration.html">how configuration is handled in Symfony</a>.

## Specific configuration

The configuration of specific aspects of eZ Platform is described in the respective topics in [The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html).

#### Selected configuration topics:

-   <span class="confluence-link">[View provider
    ](Content-Rendering_31429679.html#ContentRendering-Viewproviderconfiguration)</span>
-   [Logging and debug](Devops_31432029.html#Devops-LoggingandDebugConfiguration)
-   [Content repository](Repository_31432023.html#Repository-ContentRepositoryConfiguration)
-   <span class="confluence-link">[Authentication](Security_31429685.html#Security-Configuration)</span>
-   [Sessions](Sessions_31429667.html#Sessions-Configuration)
-   [Siteaccess](SiteAccess_31429665.html#SiteAccess-Basics)

#### In this topic:

-   [Structuring an eZ Platform Project](#BestPractices-StructuringaneZPlatformProject)
    -   [The AppBundle](#BestPractices-TheAppBundle)
    -   [Templates](#BestPractices-Templates)
    -   [Assets](#BestPractices-Assets)
    -   [Configuration](#BestPractices-Configuration)
    -   [Versioning a project](#BestPractices-Versioningaproject)
-   [eZ Platform Configuration](#BestPractices-eZPlatformConfiguration)
    -   [Configuration format](#BestPractices-Configurationformat)
    -   [Configuration files](#BestPractices-Configurationfiles)
    -   [Specific configuration](#BestPractices-Specificconfiguration)

#### Related topics:

<span class="confluence-link">[Creating a new design using Bundle Inheritance](Design_31429681.html#Design-CreatinganewdesignusingBundleInheritance)</span>






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>
6.  <span>[Content items, Content Types and Fields](31430275.html)</span>
7.  <span>[Field Types reference](Field-Types-reference_31430495.html)</span>

 Developer : BinaryField Field Type 



This Field Type represents and handles a binary file. It also counts the number of times the file has been downloaded from the `content/download` module.

| Name         | Internal name  | Expected input | Output  |
|--------------|----------------|----------------|---------|
| `BinaryFile` | `ezbinaryfile` | `Mixed`        | `Mixed` |

## Description

This Field Type allows the storage and retrieval of a single file. It is capable of handling virtually any file type and is typically used for storing legacy document types such as PDF files, Word documents, spreadsheets, etc. The maximum allowed file size is determined by the "Max file size" class attribute edit parameter and the "`upload_max_filesize`" directive in the main PHP configuration file ("php.ini").

## PHP API Field Type 

### Value Object

`eZ\Publish\Core\FieldType\BinaryFile\Value` offers the following properties.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Note that both `BinaryFile` and Media Value and Type inherit from the `BinaryBase` abstract Field Type, and share common properties.

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Attribute</th>
<th align="left">Type</th>
<th align="left">Description</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>id</code></td>
<td align="left">string</td>
<td align="left"><span>Binary file identifier. This ID depends on the </span><a href="https://doc.ez.no/display/DEVELOPER/Clustering#Clustering-Binaryfilesclustering">IO Handler</a><span> that is being used. With the native, default handlers (FileSystem and Legacy), the ID is the file path, relative to the binary file storage root dir (<code>var/&lt;vardir&gt;/storage/original</code> by default).</span></td>
<td align="left">application/63cd472dd7819da7b75e8e2fee507c68.pdf</td>
</tr>
<tr class="even">
<td align="left"><code>fileName</code></td>
<td align="left">string</td>
<td align="left">The human readable file name, as exposed to the outside. Used when sending the file for download in order to name the file.</td>
<td align="left">20130116_whitepaper_ezpublish5 light.pdf</td>
</tr>
<tr class="odd">
<td align="left"><code>fileSize</code></td>
<td align="left">int</td>
<td align="left">File size, in bytes.</td>
<td align="left">1077923</td>
</tr>
<tr class="even">
<td align="left"><code>mimeType</code></td>
<td align="left">string</td>
<td align="left">The file's mime type.</td>
<td align="left">application/pdf</td>
</tr>
<tr class="odd">
<td align="left"><code>uri</code></td>
<td align="left">string</td>
<td align="left"><p>The binary file's content/download URI. If the URI doesn't include a host or protocol, it applies to the request domain.</p></td>
<td align="left">/content/download/210/2707</td>
</tr>
<tr class="even">
<td align="left"><code>downloadCount</code></td>
<td align="left">integer</td>
<td align="left">Number of times the file was downloaded</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left"><code>path</code></td>
<td align="left">string</td>
<td align="left"><p><strong>*deprecated*<br />
</strong> Renamed to <code>id</code> starting from eZ Publish 5.2. Can still be used, but it is recommended not to use it anymore as it will be removed.</p></td>
<td align="left"> </td>
</tr>
</tbody>
</table>

### Hash format

The hash format mostly matches the value object. It has the following keys:

-   `id`
-   `path` (for backwards compatibility)
-   `fileName`
-   `fileSize`
-   `mimeType`
-   `uri`
-   `downloadCount`

## REST API specifics

Used in the REST API, a BinaryFile Field will mostly serialize the hash described above. However there are a couple specifics worth mentioning.

### Reading content: url property

When reading the contents of a field of this type, an extra key is added: url. This key gives you the absolute file URL, protocol and host included.

Example: <a href="http://example.com/var/ezdemo_site/storage/original/application/63cd472dd7819da7b75e8e2fee507c68.pdf" class="uri">http://example.com/var/ezdemo_site/storage/original/application/63cd472dd7819da7b75e8e2fee507c68.pdf</a>

### Creating content: data property

When creating BinaryFile content with the REST API, it is possible to provide data as a base64 encoded string, using the "`data`" fieldValue key:

``` brush:
<field>
    <fieldDefinitionIdentifier>file</fieldDefinitionIdentifier>
    <languageCode>eng-GB</languageCode>
    <fieldValue>
        <value key="fileName">My file.pdf</value>
        <value key="fileSize">17589</value>
        <value key="data"><![CDATA[/9j/4AAQSkZJRgABAQEAZABkAAD/2wBDAAIBAQIBAQICAgICAgICAwUDAwMDAwYEBAMFBwYHBwcG
...
...]]></value>
    </fieldValue>
</field>
```

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Repository](Repository_31432023.html)</span>
5.  <span>[List of Limitations](List-of-Limitations_31430459.html)</span>

 Developer : BlockingLimitation 



A generic Limitation type to use when no other Limitation has been implemented. Without any limitation assigned, a LimitationNotFoundException is thrown.

It is called "blocking" because it will always tell the permissions system that the User does not have access to any Policy it is assigned to, making the permissions system move on to the next Policy.

 

|                 |                                                                                       |
|-----------------|---------------------------------------------------------------------------------------|
| Identifier      | `n/a` (configured for `ezjscore` limitation `           FunctionList` out of the box) |
| Value Class     | `eZ\Publish\API\Repository\Values\User\Limitation\BlockingLimitation`                 |
| Type Class      | `eZ\Publish\Core\Limitation\BlockingLimitationType`                                   |
| Criterion used  | MatchNone                                                                             |
| Role Limitation | no                                                                                    |

###### Possible values

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">Value</td>
<td align="left">UI value</td>
<td align="left">Description</td>
</tr>
<tr class="even">
<td align="left"><code>&lt;mixed&gt;</code></td>
<td align="left"><code>&lt;mixed&gt;</code></td>
<td align="left"><p>This is a generic Limitation which does not validate the values provided to it. Make sure to validate the values passed to this limitation in your own logic.</p></td>
</tr>
</tbody>
</table>

###### Configuration

As this is a generic Limitation, you can configure your custom Limitations to use it, out of the box FunctionList uses it in the following way:

``` brush:
    # FunctionList is a ezjscore limitations, it only applies to ezjscore policies not used by
    # API/platform stack so configuring to use "blocking" limitation to avoid LimitationNotFoundException
    ezpublish.api.role.limitation_type.function_list:
        class: %ezpublish.api.role.limitation_type.blocking.class%
        arguments: ['FunctionList']
        tags:
            - {name: ezpublish.limitationType, alias: FunctionList}
```

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>
4.  <span>[Creating a Tweet Field Type](Creating-a-Tweet-Field-Type_31429766.html)</span>

 Developer : Build the bundle 



<span>FieldTypes, like any other eZ Platform extensions, must be provided as Symfony 2 bundles. This chapter covers the creation and organization of this bundle.</span>

First, we explain how to generate the skeleton for a standard Symfony 2 bundle using the console: [Create the bundle](Create-the-bundle_31429782.html). Then, we explain what structure we suggest for storing a Field Type inside a bundle: [Structure the bundle](Structure-the-bundle_31429784.html).

**Tutorial path**






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>
4.  <span>[Extending PlatformUI with new navigation](Extending-PlatformUI-with-new-navigation_31430235.html)</span>

 Developer : Build the content list 



## Two ways to generate pages in PlatformUI

As written in the [PlatformUI technical introduction](Extending-eZ-Platform_31429689.html), pages in PlatformUI can be generated either by the browser based on the REST API (or any other API) responses or by doing part of the rendering on the server side for instance with some Twig templates called by a Symfony controller. Both options are perfectly valid and choosing one or the other is mainly a matter of taste. This step will examine both strategies even if the later steps will be based on the server-side rendering.

## Browser side rendering

In this case, the browser uses the REST API to fetch the necessary objects/structures and then the logic of transforming that to an HTML page is written in JavaScript and executed by the browser.

### View service to fetch the Location list

#### Minimal view service

The first thing to do is to create a view service. A view service is a component extending `Y.eZ.ViewService`. So we first need to declare and create a module and then this module will create the minimal view service class:

**yui.yml**

``` brush:
ezconf-listviewservice:
     requires: ['ez-viewservice']
     path: %extending_platformui.public_dir%/js/views/services/ezconf-listviewservice.js
```

Then in `ezconf-listviewservice.js` we can write the minimal view service:

**Minimal ListViewService**

``` brush:
YUI.add('ezconf-listviewservice', function (Y) {
    Y.namespace('eZConf');

    Y.eZConf.ListViewService = Y.Base.create('ezconfListViewService', Y.eZ.ViewService, [], {
        initializer: function () {
            console.log("Hey, I'm the ListViewService");
        },
    });
});
```

This is the minimal view service, it only writes a "hello world" message in the console when instantiated but for now it's not used anywhere in the application.

#### Configure the route to use the view service

To really use our view service in the application, we have to change the route so that the PlatformUI application instantiates and uses the view service when building the page. To do that, we have to add the route `service` property to hold the constructor function of the view service so the application plugin that adds the route will also have to require the `ezconf-listviewservice` module:

**yui.yml**

``` brush:
 ezconf-listapplugin:
     requires: ['ez-pluginregistry', 'plugin', 'base', 'ezconf-listview', 'ezconf-listviewservice'] # the view module has been added
     dependencyOf: ['ez-platformuiapp']
```

After doing that, `Y.eZConf.ListViewService` becomes available in the application plugin code and we can change the `eZConfList` route to:

**Creating a route with a view service**

``` brush:
app.route({
    name: "eZConfList",
    path: "/ezconf/list",
    view: "ezconfListView",
    service: Y.eZConf.ListViewService, // constructor function to use to instantiate the view service
    sideViews: {'navigationHub': true, 'discoveryBar': false},
    callbacks: ['open', 'checkUser', 'handleSideViews', 'handleMainView'],
});
```

After this change, the `Y.eZConf.ListViewService` is used when a user reaches the `eZConfList` route.

#### Fetching Locations from the view service

A view service is responsible for fetching data so it can be rendered. For a given route, the view service is instantiated the first time the route is accessed and then the same instance is reused. On that instance, the `_load` method is automatically called. This is where the loading logic should be in most cases. This method also receives a callback as its only parameter. This callback function should be called once the loading is finished. Typically, a view service will use the <a href="http://ezsystems.github.io/javascript-rest-client/">JavaScript REST Client</a> to request <span class="confluence-link">[eZ Platform REST API](REST-API-Guide_31430286.html)</span>. To do that, a JavaScript REST Client instance is available in the `capi` attribute of the view service.

In this tutorial, we want to display the Content in a flat list and filter this list by Content Types. For now, let's fetch everything; to do that, the view service will create a REST view to search for every Location in the repository:

**ezconf-listviewservice.js**

``` brush:
YUI.add('ezconf-listviewservice', function (Y) {
    Y.namespace('eZConf');

    Y.eZConf.ListViewService = Y.Base.create('ezconfListViewService', Y.eZ.ViewService, [], {
        initializer: function () {
            console.log("Hey, I'm the ListViewService");
        },

        // _load is automatically called when the view service is configured for
        // a route. callback should be executed when everything is finished
        _load: function (callback) {
            var capi = this.get('capi'), // REST API JavaScript client
                contentService = capi.getContentService(),
                query = contentService.newViewCreateStruct('ezconf-list', 'LocationQuery');

            // searching for "everything"
            query.body.ViewInput.LocationQuery.Criteria = {SubtreeCriterion: "/1/"};
            contentService.createView(query, Y.bind(function (err, response) {
                // parsing the response and storing the location list in the "location" attribute
                var locations;

                locations = Y.Array.map(response.document.View.Result.searchHits.searchHit, function (hit) {
                    var loc = new Y.eZ.Location({id: hit.value.Location._href});

                    loc.loadFromHash(hit.value.Location);
                    return loc;
                });
                this.set('locations', locations);
                callback();
            }, this));
        },
    }, {
        ATTRS: {
            locations: {
                value: [],
            }
        }
    });
});
```

At this point, if you refresh the PlatformUI application and follow the link added [in the previous step](Configure-the-navigation_31430245.html), you should see a new REST API request to `/api/ezp/v2/views` in the network panel of the browser:

<span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img src="attachments/31430249/31430248.png" class="confluence-embedded-image confluence-content-image-border" height="400" /></span>

The Locations are built in the application but not yet used anywhere.

#### Passing the Location to the view

Now that we have the Locations, we have to give them to the view. For that, we have to implement the `_getViewParameters` method in the view service. This method is automatically called when view service loading is finished, it should return an object that will be used as a configuration object for the main view.

In our case, we just want to give the Location list to the view, so the `_getViewParameters` method is quite simple:

**\_getViewParameters of the view service**

``` brush:
_getViewParameters: function () {
    return {
        locations: this.get('locations'),
    };
},
```

With that code, the view will receive the Location list as an attribute under the name `locations`.

Why implement \_load and \_getViewParameters and not load and getViewParameters?

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
When implementing a custom view service, you should always implement the protected `_load` and `_getViewParameters` methods, not their public counterparts `load` and `getViewParameters`. By implementing the protected versions, you keep the opportunity for a developer to write a plugin to enhance your view service.

### View to display a list of Location

The view now receives the Location list in the `locations` attribute so we have to change the view to take that into account. For now, let's change it to just display the Location it receives as an unordered HTML list of links to those Locations. To do that, we have to:

1.  Declare the `locations` attribute in the view
2.  Give that list to the template in a form it can understand
3.  Update the template to generate the list

Point 2 is required because Handlebars is not able to understand the complex model objects generated by YUI. So we have to transform those complex object into plain JavaScript objects. After doing the changes in steps 1 and 2, the view looks like this:

**ezconf-listview.js**

``` brush:
YUI.add('ezconf-listview', function (Y) {
    Y.namespace('eZConf');

    Y.eZConf.ListView = Y.Base.create('ezconfListView', Y.eZ.TemplateBasedView, [], {
        initializer: function () {
            console.log("Hey, I'm the list view");
        },

        render: function () {
            this.get('container').setHTML(
                this.template({
                    locations: this._getJsonifiedLocations(),
                })
            );
            return this;
        },

        _getJsonifiedLocations: function () {
            // to get usable objects in the template
            return Y.Array.map(this.get('locations'), function (loc) {
                return loc.toJSON();
            });
        },
    }, {
        ATTRS: {
            locations: {
                value: [],
            }
        }
    });
});
```

Then the template has to be changed to something like:

**ezconflistview.hbt**

``` brush:
<h1 class="ezconf-list-title">List view</h1>

<ul class="ezconf-list">
{{#each locations}}
    <li><a href="{{path 'viewLocation' id=id languageCode=contentInfo.mainLanguageCode}}">{{ contentInfo.name }}</a></li>
{{/each}}
</ul>
```

PlatformUI provides a `path` template helper that allows you to generate a route URL in PlatformUI. It expects a route name and the route parameters.

Results

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
The resulting code can be been in <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/releases/tag/6_1_list_client">the <code>6_1_list_client</code> tag on GitHub</a>, this step result can also be viewed as <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/compare/5_navigation...6_1_list_client">a diff between tags <code>5_navigation</code> and <code>6_1_list_client</code></a>.

The rest of this tutorial is focused on the server side rendering strategy. Completing the browser side rendering strategy to get the expected features is left as an exercise.

## Server side rendering

In this case a part of the rendering is delegated to the server. When building a PlatformUI page this way, the application will just do one or more AJAX request(s) and inject the result in the UI. The PlatformUI *Admin part* is built this way. To be easily usable in the JavaScript application, the server response has to be structured so that the application can retrieve and set the page title, the potential notifications to issue and the actual page content. This is done by generating an HTML fragment, in the following way:

**Example of server side response**

``` brush:
<div data-name="title">Title to set in the application</div>
<div data-name="html">
    <p>Page content</p>
</div>
<ul data-name="notification">
    <li data-state="done">I'm a "done" notification to display in the application</li>
</ul>
```

### View service to fetch an HTML fragment

#### Minimal view service

In the case, the minimal view service is exactly the same as the one produced in [the previous Minimal view service paragraph](#Buildthecontentlist-Buildthecontentlist-Minimalviewservice).

#### Configure the route to use the view service

The eZConfList route also has to be configured exactly in the same way as in [the previous Configure the route to use the view service paragraph](#Buildthecontentlist-Buildthecontentlist-Configuretheroutetousetheviewservice).

#### Generate the HTML fragment server side

This will be done by a Symfony Controller that will use the Search Service and a Twig template to generate the HTML code. As you can see in <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/commit/01c43cee899e295109060ab89a7ea705e8171cd0#diff-2e1a19129e23e2d757512a5da45ffa54R1">this Github commit</a>, it's a very basic Symfony Controller that extends `EzSystems\PlatformUIBundle\Controller\Controller`.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Extending `EzSystems\PlatformUIBundle\Controller\Controller` is not strictly required. By doing that, the actions provided by the controller are automatically restricted to authenticated users. This base controller also provides the base API to handle notifications if needed.

To learn how to write Symfony controllers, please read <a href="http://symfony.com/doc/current/book/controller.html">the Symfony Controller documentation</a>.

The `list` action in `ListController` uses the following Twig template:

**list.html.twig**

``` brush:
{% extends "eZPlatformUIBundle::pjax_admin.html.twig" %}

{% block header_title %}
    <h1 class="ezconf-list-title">List view</h1>
{% endblock %}

{% block content %}
<ul class="ezconf-list">
{% for value in results.searchHits %}
    <li><a href="">{{ value.valueObject.contentInfo.name }}</a></li>
{% endfor %}
</ul>
{% endblock %}

{% block title %}List{% endblock %}
```

Again, it's a quite a regular template but to ease the generation of the expected structured HTML fragment, this template extends` eZPlatformUIBundle::pjax_admin.html.twig` and redefines a few blocks, the main one being `content` where the actual page content is supposed to be generated.

#### Update the view service to fetch the generated HTML fragment

We now have a Symfony Controller able to generate our Location list but this list is not yet available in the application. As in [Fetching Locations from the view service](#Buildthecontentlist-Buildthecontentlist-FetchingLocationsfromtheviewservice) and <span class="toc-item-body"><a href="http://doc.ez.no#Buildthecontentlist-PassingtheLocationtotheview">Passing the Location to the view</a></span>, we have to add the code in the view service. But in the case of a server side rendering, we can reuse <span class="blob-code-inner">`Y.eZ.`<span class="pl-smi x x-first x-last">`ServerSideViewService` which provides the base API to parse an HTML fragment which also provides a ready to use `_getViewParameters` method. All we have to do then is to implement the loading logic in `_load`:</span></span>

**ezconf-listviewservice.js**

``` brush:
YUI.add('ezconf-listviewservice', function (Y) {
    Y.namespace('eZConf');

    Y.eZConf.ListViewService = Y.Base.create('ezconfListViewService', Y.eZ.ServerSideViewService, [], {
        initializer: function () {
            console.log("Hey, I'm the ListViewService");
        },

        _load: function (callback) {
            var uri = this.get('app').get('apiRoot') + 'list';

            Y.io(uri, { // YUI helper to do AJAX request, see http://yuilibrary.com/yui/docs/io/
                method: 'GET',
                on: {
                    success: function (tId, response) {
                        this._parseResponse(response); // provided by Y.eZ.ServerSideViewService
                        callback(this);
                    },
                    failure: this._handleLoadFailure, // provided by Y.eZ.ServerSideViewService
                },
                context: this,
            });
        },
    });
});
```

The resulting `_load` method will just do an AJAX request to the action provided by our Symfony controller.

At this point, if you refresh your browser, nothing should have changed but you should see the AJAX request in the network panel of your browser.

<span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img src="attachments/31430249/31430247.png" class="confluence-embedded-image confluence-content-image-border" width="916" height="400" /></span>

### View to handle the server side generated code

#### Change the view to be server side view

To have a visual change, we now have to change the `ListView` to be a server side view. This operations involves removing some code added in [the Define a View step](Define-a-View_31430243.html). Basically, the View does not need any template but it will inherit from `Y.eZ.ServerSideView`. As a result, the view module definition becomes:

**View module definition**

``` brush:
ezconf-listview:
    requires: ['ez-serversideview']
    path: %extending_platformui.public_dir%/js/views/ezconf-listview.js
```

And the View component also has to be simplified to:

**ezconf-listview.js**

``` brush:
YUI.add('ezconf-listview', function (Y) {
    Y.namespace('eZConf');

    Y.eZConf.ListView = Y.Base.create('ezconfListView', Y.eZ.ServerSideView, [], {
        initializer: function () {
            console.log("Hey, I'm the list view");
            this.containerTemplate = '<div class="ez-view-ezconflistview"/>'; // make sure we keep the same class on the container
        },
    });
});
```

At this point, you should see the same list as the one that was generated in [Browser side rendering](#Buildthecontentlist-Buildthecontentlist-Browsersiderendering) section. The only difference lies in the non-working links being generated in the server side solution.

#### Navigating in the app from the view

There are several ways to fix the link issue. In this step we are going to add some metadata to the generated HTML links, then we'll change the view to recognize the enhanced links and finally we'll change the server side view to achieve the navigation.

The server side code has no knowledge of the JavaScript application routing mechanism as a result, it can not directly generate any PlatformUI Application URI, but we know while generating the HTML fragment that we want each link to allow the navigation to the `viewLocation` route for the Location being displayed. We can then change the Twig template to add the necessary metadata on each link so that the application has a way of guessing where the user is supposed to go when clicking on the link:

**"content" block in the Twig template**

``` brush:
{% block content %}
<ul class="ezconf-list">
{% for value in results.searchHits %}
    <li><a class="ezconf-list-location" href=""
        data-route-name="viewLocation"
        data-route-id="{{ path('ezpublish_rest_loadLocation', {locationPath: value.valueObject.pathString|trim('/')}) }}"
        data-route-languageCode="{{ value.valueObject.contentInfo.mainLanguageCode }}"
        >{{ value.valueObject.contentInfo.name }}</a></li>
{% endfor %}
</ul>
{% endblock %}
```

For each link we are basically saying to the application that the user should directed to the `viewLocation` route for the given Location id and the given language code.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
In PlatformUI code, the Locations, Content items and Content Types are identified by their REST id, that is the REST resource URL which allows you to fetch the object in the REST API. That's why we are using the `path` Twig template function to build the Location id.

Then we have to change the view to add a special behavior when the user clicks on them. The view can not directly trigger the navigation to the expected route. So in this case, we are firing an application level event with all the data we have on the link and we'll let the view service handle this application level event to take the user to the expected page. So, we have to configure our view to recognize the click on the links and to fire the `navigateTo` custom event:

**ezconf-listview.js**

``` brush:
YUI.add('ezconf-listview', function (Y) {
    Y.namespace('eZConf');

    Y.eZConf.ListView = Y.Base.create('ezconfListView', Y.eZ.ServerSideView, [], {
        // this is YUI View mechanic to subscribe to DOM events (click, submit,
        // ...) and synthetic event (some custom event provided by YUI) like
        // 'tap' here.
        events: {
            '.ezconf-list-location': {
                // tap is 'fast click' (touch friendly)
                'tap': '_navigateToLocation'
            }
        },

        initializer: function () {
            console.log("Hey, I'm the list view");
            this.containerTemplate = '<div class="ez-view-ezconflistview"/>';
        },

        _navigateToLocation: function (e) {
            var link = e.target;

            e.preventDefault(); // don't want the normal link behavior

            // tell the view service we want to navigate somewhere
            // it's a custom event that will be bubble up to the view service
            // (and the app)
            // the second parameter is the data to add in the event facade, this
            // can be used by any event handler function bound to this event.
            this.fire('navigateTo', {
                routeName: link.getData('route-name'),
                routeParams: {
                    id: link.getData('route-id'),
                    languageCode: link.getData('route-languagecode'),
                }
            });
        },
    });
});
```

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
The DOM event handling is one of the main YUI View features. It is documented in <a href="http://yuilibrary.com/yui/docs/view/#handling-dom-events">the YUI View guide</a>.

Now the click on the Location link is transformed in a `navigateTo` event, we have to subscribe to that event in the view service to trigger the expected navigation:

**ezconf-listviewservice.js**

``` brush:
YUI.add('ezconf-listviewservice', function (Y) {
    Y.namespace('eZConf');

    Y.eZConf.ListViewService = Y.Base.create('ezconfListViewService', Y.eZ.ServerSideViewService, [], {
        initializer: function () {
            console.log("Hey, I'm the ListViewService");

            // we catch the `navigateTo` event no matter from where it comes
            // when bubbling, the event is prefixed with the name of the
            // component which fired the event first.
            // so in this case we could also write
            // this.on('ezconflistview:navigateTo', function (e) {});
            // `e` is the event facade. It contains various informations about
            // the event and if any the custom data passed to fire().
            this.on('*:navigateTo', function (e) {
                this.get('app').navigateTo(
                    e.routeName,
                    e.routeParams
                );
            });
        },

        _load: function (callback) {
            // [...] skip to keep the example short
        },
    });
});
```

With that in place and after a refresh, the Location list should allow you to the navigate to the expected Location in PlatformUI.

Application level events

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
PlatformUI uses a lot of custom application level events thanks to <a href="http://yuilibrary.com/yui/docs/event-custom/">the EventTarget YUI component</a>. Those events are very similar to <a href="http://yuilibrary.com/yui/docs/event/">DOM events</a> but they are attached to the application components instead of the DOM elements. Like for DOM events, there is <a href="http://yuilibrary.com/yui/docs/event-custom/#bubbling">a bubbling mechanism</a>. For instance, here the view is firing an event and unless the propagation of the event is stopped, it will bubble to the view service and then to the application. The event basically follows [the components tree until the application](Extending-eZ-Platform_31429689.html). **An application level event is way for a deeply nested component to communicate with a higher level component.**

Results and next step

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
The resulting code can be seen in <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/releases/tag/6_2_list_server">the <code>6_2_list_server</code> tag on GitHub</a>, this step result can also be viewed as <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/compare/5_navigation...6_2_list_server">a diff between tags <code>5_navigation</code> and <code>6_2_list_server</code></a>.

The next step is then [to add the pagination](Paginate-results_31430251.html).

**Tutorial path**

## Attachments:

<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [nw\_panel.png](attachments/31430249/31430247.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [restview.png](attachments/31430249/31430248.png) (image/png)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>

 Developer : Building a Bicycle Route Tracker in eZ Platform 



# Building a Website with eZ Platform

<span class="confluence-embedded-file-wrapper image-right-wrapper confluence-embedded-manual-size"><img src="attachments/31431606/31431605.png" class="confluence-embedded-image image-right" height="250" /></span>

 This tutorial is a step-by-step guide to building an eZ Platform website from the ground up. <span style="color: rgb(0,51,102);">All instructions and steps are based on version [<span style="color: rgb(0,51,102);">1.7.0</span>](eZ-Platform-v1.7.0-LTS_32868941.html)</span><span style="color: rgb(0,51,102);"> of eZ Platform released on December 15, 2016.</span>

This tutorial applies a learning-by-doing method to demonstrate how <a href="https://ezplatform.com/">eZ Platform</a> can be used to build a great website.

Throughout this guide we will take you through the process of building a website in a series of steps using best practices for the most effective developer experience.

 

## Intended Audience

This tutorial is intended for users who have little or no previous experience with the eZ Platform user interface.

Some general knowledge of web development would certainly be helpful.

To follow this tutorial, you should:

-   Have basic knowledge of HTML and CSS.
-   Have basic knowledge of the database you've selected.

 

<span class="confluence-embedded-file-wrapper"><img src="attachments/32868603/32868702.png" class="confluence-embedded-image" /></span>
 

## Learning Outcomes

After going through this tutorial, you will:

-   Have a basic understanding of setting up an eZ Platform application.

-   Have some hands-on experience designing, developing and deploying a demo eZ Platform website.
-   Have developed the skills to run your own eZ Platform website.

# The Story Behind the Tutorial - Bike Rides

We'll work according to the following story:

**The Story**

*A good friend has a spreadsheet which details all her bike rides, and she knows you are a professional webmaster. She asks for your help in building a website detailing the rides. She wants to upload photos from each ride.*
*She has no experience with web development. Some of her friends are interested in browsing and searching her "ride log". In the near future, she wants to be able to add rides by herself, and even open this possibility to her friends.*

**Specifications**

The "customer" requirements are:

-   A list of all rides in table form
-   Viewing photos of a ride

**More to come...**

-   <span class="status-macro aui-lozenge aui-lozenge-current aui-lozenge-subtle">WORK IN PROGRESS</span> *Ordering rides
    *
-   <span class="status-macro aui-lozenge aui-lozenge-current aui-lozenge-subtle">WORK IN PROGRESS</span> *Searching for a ride by starting place or length in km*
-   <span class="status-macro aui-lozenge aui-lozenge-current aui-lozenge-subtle">WORK IN PROGRESS</span> *Commenting on rides*

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
# Getting Help

If you have any questions, feel free to reach out to us or our <a href="http://share.ez.no/get-involved/exchange">awesome community</a> for help!

<span class="char" title="Black Rightwards Arrow"> </span>
<span class="char" title="Black Rightwards Arrow"> </span>

 

Next: <span class="confluence-link">[Part 1: Setting up eZ Platform](31431610.html)</span> <span class="char" title="Black Rightwards Arrow">➡
</span>

<span class="char" title="Black Rightwards Arrow">
</span>

 

 

 

**Tutorial path**

 

 

 

 

## Attachments:

<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [pulley-ibex.png](attachments/31431606/32113253.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [pulley\_ibex.png](attachments/31431606/32113252.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [pulley-ibex.png](attachments/31431606/31431605.png) (image/png)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : Bundles 



# Introduction

eZ CMS is based on the Symfony2 framework and follows its organization of the app. Like in Symfony, where <a href="http://symfony.com/doc/current/book/bundles.html">&quot;everything is a bundle&quot;</a>, your eZ application is going to be a collection of bundles.

## What is a bundle?

A bundle in Symfony (and eZ) is a separate part of your application that implements a feature. You can create bundles yourself or make use of available open-source bundles. You can also reuse the bundles you create in other projects or share them with the community.

Many eZ CMS functionalities are provided through separate bundles included in the installation.

## How to use bundles?

By default, a clean eZ Platform installation contains an AppBundle where you can place your code.

To learn more about organizing your eZ project, see [Best Practices](Best-Practices_31429687.html).

## How to create bundles?

You can generate a new bundle using a `generate:bundle` command. See <a href="http://symfony.com/doc/current/bundles/SensioGeneratorBundle/commands/generate_bundle.html">Symfony documentation on generating bundles</a>.

In addition to <a href="http://symfony.com/doc/bundles/">Symfony Bundles</a>, eZ provides a set of bundles out of the box and some optional ones.

### How to remove a bundle?

To remove a bundle (either one you created yourself, or an out-of-the-box one that you do not need) see the <a href="http://symfony.com/doc/current/bundles/remove.html">How to Remove a Bundle</a>instruction in Symfony doc.

# Configuration

## EzPublishCoreBundle Configuration

 

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
To get an overview of EzPublishCoreBundle's configuration, run the following command-line script:

``` brush:
php app/console config:dump-reference ezpublish
```

## Default page

Default page is the default page to show or redirect to.

If set, it will be used for default redirection after user login, overriding Symfony's `default_target_path`, giving the opportunity to configure it by siteaccess.

**ezplatform.yml**

``` brush:
ezpublish:
    system:
        ezdemo_site:
            default_page: "/Getting-Started"

        ezdemo_site_admin:
            # For admin, redirect to dashboard after login.
            default_page: "/content/dashboard"
```

This setting **does not change anything to Symfony behavior** regarding redirection after login. If set, it will only substitute the value set for `default_target_path`. It is therefore still possible to specify a custom target path using a dedicated form parameter.

**Order of precedence is not modified.**

 

#### In this topic:

-   [Introduction](#Bundles-Introduction)
    -   [What is a bundle?](#Bundles-Whatisabundle?)
    -   [How to use bundles?](#Bundles-Howtousebundles?)
    -   [How to create bundles?](#Bundles-Howtocreatebundles?)
        -   [How to remove a bundle?](#Bundles-Howtoremoveabundle?)
-   [Configuration](#Bundles-Configuration)
    -   [EzPublishCoreBundle Configuration](#Bundles-EzPublishCoreBundleConfiguration)
    -   [Default page](#Bundles-Defaultpage)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>
6.  <span>[Content items, Content Types and Fields](31430275.html)</span>
7.  <span>[Field Types reference](Field-Types-reference_31430495.html)</span>

 Developer : Checkbox Field Type 



This field type represents a Checkbox status, checked or unchecked.

| Name       | Internal name | Expected input type |
|------------|---------------|---------------------|
| `Checkbox` | `ezboolean`   | `boolean`           |

## Description

The Checkbox Field Type stores the current status for a checkbox input, checked of unchecked, by storing a boolean value.

## PHP API Field Type 

### Value object

##### Properties

The Value class of this Field Type contains the following properties:

| Property | Type      | Default value | Description                                                                                       |
|----------|-----------|---------------|---------------------------------------------------------------------------------------------------|
| `$bool`  | `boolean` | `false`       | This property will be used for the checkbox status, which will be represented by a boolean value. |

**Value object content examples**

``` brush:
use eZ\Publish\Core\FieldType\Checkbox\Type;
 
// Instantiates a checkbox value with a default state (false)
$checkboxValue = new Checkbox\Value();
 
// Checked
$value->bool = true; 
 
// Unchecked
$value->bool = false;
```

##### Constructor

<span>The </span>`Checkbox\Value`<span> constructor accepts a boolean value:</span>

**Constructor example**

``` brush:
use eZ\Publish\Core\FieldType\Checkbox\Type;
 
// Instantiates a checkbox value with a checked state
$checkboxValue = new Checkbox\Value( true );
```

##### String representation

As this Field Type is not a string but a bool, it will return "1" (true) or "0" (false) in cases where it is cast to string.

 

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : Clustering 



# Introduction

Clustering in eZ Platform refers to setting up your install with several web servers for handling more load and/or for failover.

## Server setup overview

This diagram illustrates how clustering of eZ Platform is typically set up, the parts illustrate the different roles needed for a successful cluster setup. The number of web servers, Memcached servers, Solr servers, Varnish servers, Database servers, NFS servers, as well as whether some servers play several of these roles *(typically running Memcached across the web server)* is up to you and your performance needs.

The minimal requirements are the following *(with what is currently supported in italics)*:

-   Shared HTTP cache *(using Varnish)*
-   Shared Persistence cache and Sessions *(using Memcached, or experimentally also Redis)*
-   Shared Database *(using MySQL/MariaDB)*
-   Shared Filesystem *(using NFS, or experimentally also S3)*

For further details on requirements, see <span class="confluence-link"> [Requirements page](31429536.html) </span>.

While this is not a complete list, further recommendations include:

-   Using [Solr](Solr-Bundle_31430592.html) for better search and better search performance
-   Using a CDN for improved performance and faster ping time worldwide
-   Using Active/Passive Database for failover
-   In general: Make sure to use later versions of PHP and MySQL/MariaDB within [<span class="confluence-link">what is supported</span>](31429536.html) <span class="confluence-link"> </span> for your eZ Platform version to get more performance out of each server.

<span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img src="attachments/31430387/31430385.png" class="confluence-embedded-image" width="500" /></span>

## Binary files clustering

eZ Platform supports multi-server by means of custom IO handlers. They will make sure that files are correctly synchronized among the multiple clients that might use the data.

# Configuration

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Memcached must not be bound to the local address if clusters are in use, or user logins will fail. To avoid this, in `/etc/memcached.conf` take a look under `# Specify which IP address to listen on. The default is to listen on all IP addresses`

For development environments, change the address below to `                 -l 0.0.0.0               `

For production environments, follow this more secure instruction from the memcached man:

> -l &lt;addr&gt;
> Listen on &lt;addr&gt;; default to INADDR\_ANY. &lt;addr&gt; may be specified as host:port. If you don't specify a port number, the value you specified with -p or -U is used. You may specify multiple addresses separated by comma or by using -l multiple times. This is an important option to consider as there is no other way to secure the installation. Binding to an internal or firewalled network interface is suggested.

## DFS IO Handler

### What it is meant for

The DFS IO handler (`legacy_dfs_cluster)` can be used to store binary files on an NFS server. It will use a database to manipulate metadata, making up for the potential inconsistency of network based filesystems.

### <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/doc/specifications/io/legacy_dfs_cluster.md#configuration"></a>Configuration

You need to configure both metadata and binarydata handlers.

As the binarydata handler, create a new Flysystem local adapter configured to read/write to the NFS mount point on each local server. As metadata handler handler, create a dfs one, configured with a doctrine connection. 

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
<span class="status-macro aui-lozenge aui-lozenge-current">V1.8.0</span>

Note: the default database install will now include the dfs table *in the same database*

For production, we strongly recommend creating the DFS table in its own database, using the `vendor/ezsystems/ezpublish-kernel/data/mysql/dfs_schema.sql` file.
In our example, we will use one named `dfs`. 

``` brush:
# new doctrine connection for the dfs legacy_dfs_cluster metadata handler.
doctrine:
    dbal:
        connections:
            dfs:
                driver: pdo_mysql
                host: 127.0.0.1
                port: 3306
                dbname: ezdfs
                user: root
                password: "rootpassword"
                charset: UTF8

# define the flysystem handler
oneup_flysystem:
    adapters:
        nfs_adapter:
            local:
                directory: "/<path to nfs>/$var_dir$/$storage_dir$"

# define the ez handlers
ez_io:
    binarydata_handlers:
        nfs:
            flysystem:
                adapter: nfs_adapter
    metadata_handlers:
        dfs:
            legacy_dfs_cluster:
                connection: doctrine.dbal.dfs_connection

# set the application handlers
ezpublish:
    system:
        default:
            io:
                metadata_handler: dfs
                binarydata_handler: nfs
```

#### Customizing the storage directory

eZ Publish 5.x required the NFS adapter directory to be set to `$var_dir$/$storage_dir$` part for the NFS path. This is no longer required with eZ Platform, but the default prefix used to serve binary files will still match this expectation.

If you decide to change this setting, make sure you also set `io.url_prefix` to a matching value. If you set the NFS adapter's directory to "/path/to/nfs/storage", use this configuration so that the files can be served by Symfony:

``` brush:
ezpublish:
    system:
        default:
            io:
                url_prefix: "storage"
```

<span>
</span>

<span>As an alternative, you may serve images from NFS using a dedicated web server. If in the example above, this server listens on </span> <a href="http://static.example.com/">http://static.example.com</a> <span> and uses </span> `/path/to/nfs/storage` <span> as the document root, configure </span> `io.url_prefix` <span> as follows:</span>

 

``` brush:
ezpublish:
    system:
        default:
            io:
                url_prefix: "http://static.example.com/"
```

You can read more about that on [Binary files URL handling](Repository_31432023.html#Repository-BinaryfilesURLhandling).

### Web server rewrite rules

The default eZ Platform rewrite rules will let image requests be served directly from disk. With native support, files matching `^/var/([^/]+/)?storage/images(-versioned)?/.*` have to be passed through `/web/app.php`.

In any case, this specific rewrite rule must be placed without the ones that "ignore" image files and just let the web server serve the files.

#### <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/doc/specifications/io/legacy_dfs_cluster.md#apache"></a>Apache

``` brush:
RewriteRule ^/var/([^/]+/)?storage/images(-versioned)?/.* /app.php [L]
```

#### <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/doc/specifications/io/legacy_dfs_cluster.md#nginx"></a>nginx

``` brush:
rewrite "^/var/([^/]+/)?storage/images(-versioned)?/(.*)" "/app.php" break;
```

 

 

#### In this topic:

-   [Introduction](#Clustering-Introduction)
    -   [Server setup overview](#Clustering-Serversetupoverview)
    -   [Binary files clustering](#Clustering-Binaryfilesclustering)
-   [Configuration](#Clustering-Configuration)
    -   [DFS IO Handler](#Clustering-DFSIOHandler)
        -   [What it is meant for](#Clustering-Whatitismeantfor)
        -   [Configuration](#Clustering-Configuration.1)
        -   [Web server rewrite rules](#Clustering-Webserverrewriterules)

#### Related:

-   [Overview of steps to set up Cluster](Steps-to-set-up-Cluster_31432321.html)[:](#Clustering-Persistencecacheconfiguration)
    -   [Configure Persistence Cache](Repository_31432023.html#Repository-Persistencecacheconfiguration)
    -   [Set up Varnish](HTTP-Cache_31430152.html#HTTPCache-UsingVarnish)
    -   <span class="confluence-link"> [Configure sessions](Sessions_31429667.html) </span>
-   [Performance](Performance_33555232.html)

## Attachments:

<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [Server setup.png](attachments/31430387/31430385.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [Server setup 5.x doc.png](attachments/31430387/31430386.png) (image/png)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Migrating to eZ Platform - Follow the Ibex!](31429532.html)</span>

 Developer : Coming to eZ Platform from eZ Publish Platform 



eZ Publish Platform (5.x) was a transitional version of the eZ CMS, bridging the gap between the earlier generation called eZ Publish (sometimes referred to as *legacy*), and the current eZ Platform Enterprise Edition for Developers.

<span class="confluence-embedded-file-wrapper image-left-wrapper confluence-embedded-manual-size"><img src="attachments/31429520/32866977.png" class="confluence-embedded-image image-left" height="250" /></span>

eZ Publish Platform introduced a new Symfony-based technology stack that could be run along the old (*legacy*) one. This fluid change allows eZ Publish users to migrate to eZ Platform Enterprise Edition for Developers in two steps, using the 5.x version as an intermediary stepping stone.

The migration process from eZ Publish Platform to eZ Platform Enterprise Edition for Developers is described in [Upgrading from 5.4.x and 2014.11 to 16.xx](Upgrading-from-5.4.x-and-2014.11-to-16.xx_31430322.html).

 

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>

 Developer : Community Resources 



## Let's Connect!

In the course of its development eZ Platform has been deeply rooted in its community. This remains true, with many invaluable contributions by dedicated community members who play a key role in the continuous development of eZ Platform. 

eZ partners, customers, independent developers, designers, and digital content enthusiasts can contribute to important web projects, influence the [eZ roadmap](https://doc.ez.no/display/MAIN/eZ+Platform+and+eZ+Studio+Release+Process+and+Roadmap), and ensure the platform stays on top of market trends and organizations' needs.

This section provides information about the benefits you can draw from the community and about how you can contribute to eZ Platform's development yourself.

 

 

-   [Professional Training Services](Professional-Training-Services_31429585.html)
-   [Resources](Resources_31429588.html)
-   [How to Contribute](How-to-Contribute_31429587.html)
    -   [GitHub 101](GitHub-101_31429590.html)
    -   [Report and follow issues: The bugtracker](31429592.html)
    -   [Contribute to Documentation](Contribute-to-Documentation_31429594.html)
    -   [Development guidelines](Development-guidelines_31430575.html)
    -   [Contributing translations](Contributing-translations_34079215.html)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Get Started with eZ Platform](Get-Started-with-eZ-Platform_31429520.html)</span>
4.  <span>[Step 2: Going Deeper](31429542.html)</span>
5.  <span>[Using Composer](Using-Composer_31431588.html)</span>

 Developer : Composer for Frontend Developers 



If you are a web designer or working on the CSS on your website, this page contains is all you need to know about Composer.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<a href="https://getcomposer.org/">Composer</a> is an opensource PHP packaging system to manage dependencies.

This makes it easy to adapt package installs and updates to your workflow, allowing you to test new/updated packages in a development environment, put the changes in your version control system (git, Subversion, Mercurial, etc.), pull in those changes on a staging environment and, when approved, put it in production.

# Troubleshooting

You may experience some latency in dependency resolution: everything is going normally.

If you are interested by the process, do your Composer commands with the `--verbose` option activated.

### Option `verbose -v`

Increase the verbosity of messages: 1 for normal output, 2 for more verbose output and 3 for debug.

#### Usage:

``` brush:
php -d memory_limit=-1 composer.phar <command> --verbose (-v|vv|vvv)
```

# Useful commands

## install

The `install` command reads the composer.lock file from the current directory, processes it, and downloads and installs all the libraries and dependencies outlined in that file. If the file does not exist it will look for composer.json and do the same.

### Usage

``` brush:
php -d memory_limit=-1 composer.phar install --dry-run --prefer-dist
```

In this example the `dry-run` option is mentioned to prevent you from doing anything critical. (This option outputs the operations but will not execute anything and implicitly enables the verbose mode).

### Documentation with complete usage:

``` brush:
php -d memory_limit=-1 composer.phar install [--prefer-source] [--prefer-dist] [--dry-run] [--dev] [--no-dev] [--no-plugins] [--no-custom-installers] [--no-scripts] [--no-progress] [-v|vv|vvv|--verbose] [-o|--optimize-autoloader] [packages1] ... [packagesN]
```

## update

 The `update` command reads the composer.json file from the current directory, processes it, and updates, removes or installs all the dependencies.

### Interesting options:

To limit the update operation to a few packages, you can list the package(s) you want to update as such:

``` brush:
php -d memory_limit=-1 composer.phar update vendor/package1 foo/mypackage 
```

 You may also use an asterisk (\*) pattern to limit the update operation to package(s) from a specific vendor:

``` brush:
php -d memory_limit=-1 composer.phar update vendor/package1 foo/* 
```

 

 

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Get Started with eZ Platform](Get-Started-with-eZ-Platform_31429520.html)</span>
4.  <span>[Step 2: Going Deeper](31429542.html)</span>
5.  <span>[Using Composer](Using-Composer_31431588.html)</span>

 Developer : Composer for System Administrators 



<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<a href="https://getcomposer.org/">Composer</a> is an opensource PHP packaging system to manage dependencies.

This makes it easy to adapt package installs and updates to your workflow, allowing you to test new/updated packages in a development environment, put the changes in your version control system (git, Subversion, Mercurial, etc.), pull in those changes on a staging environment and, when approved, put it in production.

composer.phar or composer ?

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
The following examples use a `composer install` global command, as alternative use `php composer.phar <command>`.
Read the answer in the FAQ:[What Composer command-line do you have to use ?](https://doc.ez.no/pages/viewpage.action?pageId=23529122)

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
See <a href="https://getcomposer.org/doc/00-intro.md">the Composer documentation</a> for further information

# Technical prerequisites

Composer requires PHP 5.3.2+ to run.

# Useful Composer commands for System Administrators

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Note: as usual with CLI, you can type:

    $> php composer.phar help [--xml] [--format="..."] [--raw] [command_name]

to get help for the command.

 

On this page you will find some useful commands and an extract of the Composer Documentation. The interesting options part is an extract of available options

## show

The `show` command displays detailed information about a package, or lists all available packages.

### Usage:

``` brush:
 php composer.phar show [-i|--installed] [-p|--platform] [-a|--available] [-s|--self] [-N|--name-only] [-P|--path] [package] [version]
```

## require

The `require` command adds required packages to your composer.json and installs them. If you do not want to install the new dependencies immediately, you can call it with `--no-update`

### Usage:

``` brush:
php composer.phar require [--dev] [--prefer-source] [--prefer-dist] [--no-progress] [--no-update] [--update-no-dev] [--update-with-dependencies] [packages1] ... [packagesN]
```

### Interesting options

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"> </th>
<th align="left"> </th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"> --prefer-source</td>
<td align="left">Forces installation from package sources when possible, including VCS information.</td>
</tr>
<tr class="even">
<td align="left"> --prefer-dist</td>
<td align="left"><p>Forces installation from package dist even for dev versions.</p></td>
</tr>
<tr class="odd">
<td align="left"> --no-progress</td>
<td align="left"><p>Do not output download progress.</p></td>
</tr>
<tr class="even">
<td align="left"> --no-update</td>
<td align="left"><p>Disables the automatic update of the dependencies.</p></td>
</tr>
<tr class="odd">
<td align="left"> --update-with-dependencies</td>
<td align="left"><p>Allows inherited dependencies to be updated with explicit dependencies.</p></td>
</tr>
</tbody>
</table>

 

## search

The `search` command searches for packages by its name.

### Example :

``` brush:
$> php composer.phar search symfony composer
```

 can return to you a list like this:

 

**** <span class="collapse-source expand-control"><span class="expand-control-icon icon"> </span><span class="expand-control-text">Expand source</span></span>

``` brush:
symfony/assetic-bundle Integrates Assetic into Symfony2
symfony/monolog-bundle Symfony MonologBundle
ezsystems/ngsymfonytools-bundle Bundle of the legacy netgen/ngsymfonytools extension
symfony-cmf/routing Extends the Symfony2 routing component for dynamic routes and chaining several routers
doctrine/doctrine-bundle Symfony DoctrineBundle
nelmio/cors-bundle Adds CORS (Cross-Origin Resource Sharing) headers support in your Symfony2 application
tedivm/stash-bundle Incorporates the Stash caching library into Symfony.
egulias/listeners-debug-command-bundle Symfony 2 console command to debug listeners
hautelook/templated-uri-router Symfony2 RFC-6570 compatible router and URL Generator
hautelook/templated-uri-bundle Symfony2 Bundle that provides a RFC-6570 compatible router and URL Generator.
symfony/swiftmailer-bundle Symfony SwiftmailerBundle
white-october/pagerfanta-bundle Bundle to use Pagerfanta with Symfony2
symfony/icu Contains an excerpt of the ICU data and classes to load it.
symfony/symfony The Symfony PHP framework
sensio/distribution-bundle The base bundle for the Symfony Distributions
symfony/symfony The Symfony PHP framework
symfony/console Symfony Console Component
symfony/filesystem Symfony Filesystem Component
symfony/finder Symfony Finder Component
symfony/process Symfony Process Component
symfony/yaml Symfony Yaml Component
symfony/translation Symfony Translation Component
symfony/debug Symfony Debug Component
symfony/routing Symfony Routing Component
symfony/icu Contains an excerpt of the ICU data to be used with symfony/intl.
symfony/config Symfony Config Component
symfony/validator Symfony Validator Component
symfony/stopwatch Symfony Stopwatch Component
symfony-cmf/symfony-cmf Symfony Content Management Framework
```

## validate

The `validate` command validates a given composer.json.

###  Usage

``` brush:
 $> php composer.phar validate [--no-check-all] [file]
```

### Interesting options

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">option</th>
<th align="left">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p> --no-check-all </p></td>
<td align="left">Do not make a complete validation</td>
</tr>
<tr class="even">
<td align="left"><p> --profile </p></td>
<td align="left">Display timing and memory usage information</td>
</tr>
<tr class="odd">
<td align="left"> --working-dir (-d)</td>
<td align="left">If specified, use the given directory as working directory.</td>
</tr>
</tbody>
</table>

# Automate installation

Note that you can add some scripts to the Composer dependencies installation.

The available events are :

-   **pre-install-cmd**
-   **post-install-cmd**
-   **pre-update-cmd**
-   **post-update-cmd**
-   **pre-status-cmd**
-   **post-status-cmd**
-   **pre-package-install**
-   **post-package-install**
-   **pre-package-update**
-   **post-package-update**
-   **pre-package-uninstall**
-   **post-package-uninstall**
-   **pre-autoload-dump**
-   **post-autoload-dump**
-   **post-root-package-install**
-   **post-create-project-cmd**
-   **pre-archive-cmd**
-   **post-archive-cmd**

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
See <a href="https://getcomposer.org/doc/articles/scripts.md">the Composer documentation</a> about scripts for more information

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>
4.  <span>[Extending PlatformUI with new navigation](Extending-PlatformUI-with-new-navigation_31430235.html)</span>

 Developer : Conclusion 



## Potential improvements and bugs

We now have a basic interface but it already has some bugs and it could be improved in a lots of ways. Here is a list of things that are left as exercises:

-   Improve the look and feel and output: it's partially of done in commit <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/commit/13d5a0b2f4d957425a751a2cc4cbd6566ed0b57a">13d5a0b2</a> but can probably improved further.
-   Reload only the table, not the full view when filtering.
-   Sorting.
-   More filters, more columns, etc.
-   The server side code deserves to be refactored.
-   Unit tests.
-   **\[bug\]** Highlight is buggy in navigation because we have several routes while the navigation item added in [Configure the navigation](Configure-the-navigation_31430245.html) only recognizes the first route we add.
-   **\[bug\]** 'eng-GB' hardcoded when getting Content Type name.

## Documentation pages to go further

This tutorial talks and uses a lots of concepts coming from Symfony, eZ Platform, PlatformUI itself or YUI. Here is a list of documentation pages that are worth reading to completely understand what's going on behind the scenes:

### Symfony-related documentation pages

-   From a Symfony point of view, in this tutorial we mainly wrote a controller and with the associated routing configuration, <a href="http://symfony.com/doc/current/book/controller.html">the Controller book page</a> is definitively the most important Symfony related page to read
-   We also defined a Controller as a service in this tutorial, this is detailed in <a href="http://symfony.com/doc/current/cookbook/controller/service.html">How to Define Controllers as Services</a>.
-   <a href="http://twig.sensiolabs.org/doc/templates.html">Twig for Template Designers</a> explains how to write Twig templates

### eZ Platform-related documentation pages

-   The Public API is described in both the <span class="confluence-link"> </span> <span class="confluence-link"> <span class="confluence-link"> [Public API basics page](Getting-started-with-the-Public-API_31430305.html) </span> </span> and in [the Public API Cookbook](Public-API-Guide_31430303.html).
-   For any usage beyond what is covered in those pages, you can refer to <a href="http://apidoc.ez.no/sami/trunk/NS/html/index.html">the auto-generated API doc</a>.
-   While extending PlatformUI, you'll also have to work with the [REST API which has its own section in the documentation](REST-API-Guide_31430286.html).
-   There is also <a href="http://ezsystems.github.io/javascript-rest-client/">an auto-generated API doc for the JavaScript REST Client</a>.

### PlatformUI-related documentation pages

-   [The PlatformUI technical introduction](https://doc.ez.no/display/DEVELOPER/Backend+interface) gives an overview of the architecture and explains some its concepts.
-   PlaformUI also has <a href="http://ezsystems.github.io/platformui-javascript-api/">an auto-generated API doc</a>.

### YUI-related documentation pages

The whole YUI documentation could be useful when working with PlatformUI, but amongst others things here is a list of the most important pages:

-   For the very low level foundations, the guides about <a href="http://yuilibrary.com/yui/docs/attribute/">Attribute</a> and <a href="http://yuilibrary.com/yui/docs/base/">Base</a> (almost everything in PlatformUI is YUI Base object with attributes), <a href="http://yuilibrary.com/yui/docs/event-custom/">EventTarget</a> (custom events) and <a href="http://yuilibrary.com/yui/docs/plugin/">Plugin</a> (for tweaking almost any PlatformUI components) can be very useful
-   A large part of the application is about manipulating the DOM and subscribing to DOM events, this is covered in the <a href="http://yuilibrary.com/yui/docs/node/">Node</a> and <a href="http://yuilibrary.com/yui/docs/event/">DOM Events</a> guides.
-   The PlatformUI Application is based on the YUI App Framework which itself is mainly described in <a href="http://yuilibrary.com/yui/docs/app/">the App Framework</a>, <a href="http://yuilibrary.com/yui/docs/router/">Router</a> and <a href="http://yuilibrary.com/yui/docs/view/">View</a> guides.

**Tutorial path**






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>
4.  <span>[Extending PlatformUI with new navigation](Extending-PlatformUI-with-new-navigation_31430235.html)</span>

 Developer : Configure the navigation 



## PlatformUI Navigation Hub

As written in the [PlatformUI technical introduction](Extending-eZ-Platform_31429689.html), the Navigation Hub gives access to 4 navigation zones which have a set of navigation items. Each Navigation Item is actually a View in the Navigation Hub which can generate one or more links in the menu. Most Navigation Items can even be seen as a View of a given application route. A Navigation Item View is also responsible for handling its *selected state*. This means that the Navigation Items are notified when the application matches a new route and the view can then decide to react accordingly.

PlatformUI comes with 3 different implementations of Navigation Item. They all generate a link to a route with a given anchor text and they differ by the ability to check if the newly matched route in the application is the route they represent:

-   the base implementation is `Y.eZ.NavigationItemView`. When the matched application route changes, it sets its selected state if the navigation item route name matches the name of the new matched route in the application
-   the `Y.eZ.NavigationItemParameterView` implementation adds a check on a route parameter. So to appear selected, the route names must match and a given route parameter should be the same in both the application matched route and in the route the view is representing
-   the `Y.eZ.NavigationItemSubtreeView` also adds a match on a route parameter, but in this case it considers the `id` route parameter and checks whether the matched id in the application route is a descendant of a given Location id.

The default structure of the Navigation Hub is defined in the <a href="https://github.com/ezsystems/PlatformUIBundle/blob/master/Resources/public/js/views/services/ez-navigationhubviewservice.js#L377">Navigation Hub view service attributes</a>.

## Adding a new navigation item

### Plugin for the Navigation Hub view service

Since the menu structure is defined in the Navigation Hub view service, we need to write a plugin for the Navigation Hub view service. Again, we'll create a module that will define a plugin. So the first thing to do is to declare our new module in `yui.yml`:

**yui.yml**

``` brush:
ezconf-navigationplugin:
    requires: ['ez-pluginregistry', 'ez-viewservicebaseplugin'] # ez-viewservicebaseplugin instead of plugin, base for plugins for view services
    dependencyOf: ['ez-navigationhubviewservice']
    path: %extending_platformui.public_dir%/js/views/services/plugins/ezconf-navigationplugin.js
```

View service plugins are a bit special, they need to follow a specific interface provided by `Y.eZ.Plugin.ViewServiceBase` which is defined in the `ez-viewservicebaseplugin` module, so our module needs to require it.

Then, the base plugin can be written on disk. It is very close to the base plugin written in the [Alter the JavaScript Application routing step](Alter-the-JavaScript-Application-routing_31430241.html):

**ezconf-navigationplugin.js**

``` brush:
YUI.add('ezconf-navigationplugin', function (Y) {
    Y.namespace('eZConf.Plugin');

    // view service plugins must extend Y.eZ.Plugin.ViewServiceBase
    // Y.eZ.Plugin.ViewServiceBase provides several method allowing to deeply
    // hook into the view service behaviour
    Y.eZConf.Plugin.NavigationPlugin = Y.Base.create('ezconfNavigationPlugin', Y.eZ.Plugin.ViewServiceBase, [], {
        initializer: function () {
            var service = this.get('host'); // the plugged object is called host

            console.log("Hey, I'm a plugin for NavigationHubViewService");
            console.log("And I'm plugged in ", service);
        },
    }, {
        NS: 'ezconfNavigation'
    });

    Y.eZ.PluginRegistry.registerPlugin(
        Y.eZConf.Plugin.NavigationPlugin, ['navigationHubViewService']
    );
});
```

At this point, if you refresh you browser, the navigation hub should remain the same but you should see new messages in the console.

### Adding a new navigation item

Now that we have plugin plugged in the Navigation Hub View service, we can change the menu structure. Among others methods, the Navigation Hub view service has an <a href="http://ezsystems.github.io/platformui-javascript-api/classes/eZ.NavigationHubViewService.html#method_addNavigationItem"><code>addNavigationItem</code> method</a> to add a navigation item in a given zone, so we can use it in our plugin to add a new item:

**ezconf-navigationplugin.js**

``` brush:
YUI.add('ezconf-navigationplugin', function (Y) {
    Y.namespace('eZConf.Plugin');

    Y.eZConf.Plugin.NavigationPlugin = Y.Base.create('ezconfNavigationPlugin', Y.eZ.Plugin.ViewServiceBase, [], {
        initializer: function () {
            var service = this.get('host');

            console.log("Hey, I'm a plugin for NavigationHubViewService");
            console.log("And I'm plugged in ", service);

            console.log("Let's add the navigation item in the Content zone");
            service.addNavigationItem({
                Constructor: Y.eZ.NavigationItemView,
                config: {
                    title: "List contents",
                    identifier: "ezconf-list-contents",
                    route: {
                        name: "eZConfList" // same route name of the one added in the app plugin
                    }
                }
            }, 'platform'); // identifier of the zone called "Content" in the UI
        },
    }, {
        NS: 'ezconfNavigation'
    });

    Y.eZ.PluginRegistry.registerPlugin(
        Y.eZConf.Plugin.NavigationPlugin, ['navigationHubViewService']
    );
});
```

At this point, if you refresh you browser, you should see a new entry in the *Content* zone called *List contents*. Clicking on this link should even get you to the page defined [in the previous step](Define-a-View_31430243.html). And you can also notice that the navigation item gets a special style (a green bottom border) when the `eZConfList` route is matched and that it loses this style if you navigate elsewhere.

Results and next step:

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
The resulting code can be seen in <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/releases/tag/5_navigation">the 5_navigation tag on GitHub</a>, this step result can also be viewed as <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/compare/4_view...5_navigation">a diff between tags <code>4_view</code> and <code>5_navigation</code></a>.

The next step is then [to build and display the content list](Build-the-content-list_31430249.html).

**Tutorial path**






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : Content Rendering 



# Introduction

## The ViewController

eZ Platform comes with a native controller to display your content, known as the **`ViewController`** . It is called each time you try to reach a Content item from its **Url Alias** (human readable, translatable URI generated for any content based on URL patterns defined per Content Type). It is able to render any content created in the admin interface or via the [Public API Guide](Public-API-Guide_31430303.html).

It can also be called straight by its direct URI: 

`/view/content/<contentId>/full/true/<locationId>`

` /view/content/<contentId>`

A Content item can also have different **view types** (full page, abstract in a list, block in a landing page, etc.). By default the view type is **full** (for full page), but it can be anything (*line*, *block, etc*.).

# Configuration

## View provider configuration

The **configured ViewProvider** allows you to configure template selection when using the `ViewController`, either directly from a URL or via a sub-request.

eZ Publish 4.x terminology

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
In eZ Publish 4.x, it was known as **template override system *by configuration*** (`override.ini`).
However this only reflects old overrides for `node/view/*.tpl` and `content/view/*.tpl`.

### Principle

The **configured ViewProvider** takes its configuration from your siteaccess in the `           content_view         ` <span> section</span>. This configuration is a hash built in the following way:

**app/config/ezplatform.yml**

``` brush:
ezpublish:
    system:
        # Can be a valid siteaccess, siteaccess group or even "global"
        front_siteaccess:
            # Configuring the ViewProvider
            content_view:
                # The view type (full/line are standard, but you can use custom ones)
                full:
                    # A simple unique key for your matching ruleset
                    folderRuleset:
                        # The template identifier to load, following the Symfony bundle notation for templates
                        # See http://symfony.com/doc/current/book/controller.html#rendering-templates
                        template: eZDemoBundle:full:small_folder.html.twig
                        # Hash of matchers to use, with their corresponding values to match against
                        match:
                            # Key is the matcher "identifier" (class name or service identifier)
                            # Value will be passed to the matcher's setMatchingConfig() method.
                            Identifier\ContentType: [small_folder, folder]
```

Important note about template matching

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
**Template matching will NOT work if your content contains a Field Type that is not supported by the repository**. It can be the case when you are in the process of migrating from eZ Publish 4.x, where custom datatypes have been developed.

In this case the repository will throw an exception, which is caught in the `ViewController`, <span>and *if* you are using LegacyBridge it will end up doing a </span> [**<span class="confluence-link">fallback to legacy kernel</span>**](https://doc.ez.no/display/EZP/Legacy+template+fallback).

The list of Field Types supported out of the box [is available here](Field-Types-reference_31430495.html).

Tip

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
You can define your template selection rules in a different configuration file. <span class="confluence-link"> [Read the cookbook recipe to learn more about it](Importing-settings-from-a-bundle_31429803.html) </span>.

<span>You can also </span> <span class="confluence-link"> <span> <span class="confluence-link"> [use your own custom controller to render a content/location](#ContentRendering-Customcontrollers) </span> </span> </span> <span>.</span>

#### Deprecated `location_view         `

Until eZ Publish Platform 5.4, the main view action was `location_view`. This is deprecated since eZ Platform 15.12 (1.0). Only `content_view` should be used to view content, with a location as an option.

Existing `location_view` rules will be, *when possible*, converted transparently to `content_view`, with a deprecation notice. However, it is not possible to do so when the rule uses a custom controller.
In any case, `location_view` rules should be converted to `content_view` ones, as `location_view` will be removed in the next kernel major version.

## View Matchers

To be able to select the right templates for the right conditions, the view provider uses matcher objects which implement the `eZ\Publish\Core\MVC\Symfony\View\ContentViewProvider\Configured\Matcher` interface.

#### Matcher identifier

The matcher identifier can comply to 3 different formats:

1.  **Relative qualified class name** (e.g. `Identifier\ContentType`). This is the most common case and used for native matchers. It will then be relative to `eZ\Publish\Core\MVC\Symfony\Matcher\ContentBased`.
2.  **Full qualified class name** (e.g. `\Foo\Bar\MyMatcher`). This is a way to specify a **custom matcher** that doesn't need specific dependency injection. Please note that it **must** start with a `\`.
3.  **Service identifier**, as defined in Symfony service container. This is the way to specify a more **complex custom matcher** that has dependencies.

Injecting the Repository

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
If your matcher needs the repository, simply make it implement `eZ\Publish\Core\MVC\RepositoryAwareInterface` or extend the `eZ\Publish\Core\MVC\RepositoryAware` abstract class. The repository will then be correctly injected before matching.

#### Matcher value

The value associated with the matcher is being passed to its `setMatchingConfig()` method. It can be anything that is supported by the matcher.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Native matchers support both **scalar values** or **arrays of scalar values**. Passing an array amounts to applying a logical OR.

#### Combining matchers

It is possible to combine multiple matchers:

``` brush:
# ...
match:
    Identifier\ContentType: [small_folder, folder]
    Identifier\ParentContentType: frontpage
```

The example above can be translated as "Match any content whose **ContentType** identifier is ***small\_folder* OR *folder*** , **AND** having *frontpage* as **ParentContentType** identifier".

### <span id="ContentRendering-Available_matchers" class="confluence-anchor-link"></span>Available matchers

The following table presents all native matchers.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Identifier</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>Id\Content</code></td>
<td align="left">Matches the ID number of the Content item.</td>
</tr>
<tr class="even">
<td align="left"><code>Id\ContentType</code></td>
<td align="left">Matches the ID number of the Content Type that the Content item is an instance of.</td>
</tr>
<tr class="odd">
<td align="left"><code>Id\ContentTypeGroup</code></td>
<td align="left"><span>Matches the ID number of the group containing the Content Type that the Content item is an instance of.<br />
</span></td>
</tr>
<tr class="even">
<td align="left"><code>Id\Location</code></td>
<td align="left">Matches the ID number of a Location.<br />
<em>In the case of a Content item, matched against the main location.</em></td>
</tr>
<tr class="odd">
<td align="left"><code>Id\ParentContentType</code></td>
<td align="left">Matches the ID number of the parent Content Type.<br />
<em>In the case of a Content item, matched against the main location.</em></td>
</tr>
<tr class="even">
<td align="left"><code>Id\ParentLocation</code></td>
<td align="left"><p>Matches the ID number of the parent Location.<br />
<em>In the case of a Content item, matched against the main location.</em></p></td>
</tr>
<tr class="odd">
<td align="left"><code>Id\Remote</code></td>
<td align="left">Matches the remoteId of either content or Location, depending on the object matched.</td>
</tr>
<tr class="even">
<td align="left"><code>Id\Section</code></td>
<td align="left">Matches the ID number of the Section that the Content item belongs to.</td>
</tr>
<tr class="odd">
<td align="left"><code>Id\State</code></td>
<td align="left"><em>Not supported yet.</em></td>
</tr>
<tr class="even">
<td align="left"><code>Identifier\ContentType</code></td>
<td align="left"><span>Matches the identifier of the Content Type that the Content item is an instance of.</span></td>
</tr>
<tr class="odd">
<td align="left"><code>Identifier\ParentContentType</code></td>
<td align="left"><p><span>Matches the identifier of the parent Content Type.<br />
<em>In the case of a Content item, matched against the main Location.</em> </span></p></td>
</tr>
<tr class="even">
<td align="left"><code>Identifier\Section</code></td>
<td align="left">Matches the identifier of the Section that the Content item belongs to.</td>
</tr>
<tr class="odd">
<td align="left"><code>Identifier\State</code></td>
<td align="left"><em>Not supported yet.</em></td>
</tr>
<tr class="even">
<td align="left"><code>Depth</code></td>
<td align="left"><span>Matches the depth of the Location. The depth of a top level Location is 1.</span></td>
</tr>
<tr class="odd">
<td align="left"><code>UrlAlias</code></td>
<td align="left"><p><span>Matches the virtual URL of the Location (i.e. <code>/My/Content-Uri</code>).</span></p>
<p><span> <strong>Important: Matches when the UrlAlias of the location starts with the value passed.</strong><br />
<em>Not supported for Content (aka content_view).</em> </span></p></td>
</tr>
</tbody>
</table>

## <span class="confluence-link">Default view templates</span>

<span class="confluence-link">Content view</span> uses default templates to render content unless custom view rules are used.

Those templates can be customized by means of container- and siteaccess-aware parameters.

### Overriding the default template for common view types

Templates for the most common view types (content/full, line, embed, or block) can be customized by setting one the `ezplatform.default.content_view_templates` variables:

| Controller                                              | ViewType | Parameter                                         | Default value                                           |
|---------------------------------------------------------|----------|---------------------------------------------------|---------------------------------------------------------|
| `ez_content:viewAction`                                 | `full`   | `ezplatform.default_view_templates.content.full`  | `"EzPublishCoreBundle:default:content/full.html.twig"`  |
| `                 ez_content:viewAction               ` | `line`   | `ezplatform.default_view_templates.content.line`  | `"EzPublishCoreBundle:default:content/line.html.twig"`  |
| `                 ez_content:viewAction               ` | `embed`  | `ezplatform.default_view_templates.content.embed` | `"EzPublishCoreBundle:default:content/embed.html.twig"` |
| `ez_page:viewAction`                                    | `n/a`    | `ezplatform.default_view_templates.block`         | `"EzPublishCoreBundle:default:block/block.html.twig"`   |

#### Example

Add this configuration to `app/config/config.yml` to use `app/Resources/content/view/full.html.twig` as the default template when viewing Content with the `full` view type:

``` brush:
parameters:
    ezplatform.default_view_templates.content.full: "content/view/full.html.twig"
```

### Customizing the default controller

The controller used to render content by default can also be changed. The `ezsettings.default.content_view_defaults` container parameter contains a hash that defines how content is rendered by default. It contains a set of classic <a href="https://github.com/ezsystems/ezpublish-kernel/blob/v6.0.0/eZ/Bundle/EzPublishCoreBundle/Resources/config/default_settings.yml#L21-L33">content view rules for the common view types</a>. This hash can be redefined to whatever suits your requirements, including custom controllers, or even matchers.

# Usage

## Content view templates

A content view template is like any other template, with several specific aspects.

### <span id="ContentRendering-Availablevariables" class="confluence-anchor-link"></span>Available variables

| Variable name                                    | Type                                                                                                                                                                                            | Description                                                                                                                                                                                                                   |
|--------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **`location`**                                   | <a href="https://github.com/ezsystems/ezp-next/blob/master/eZ/Publish/Core/Repository/Values/Content/Location.php">eZ\Publish\Core\Repository\Values\Content\Location</a> | The Location object. Contains meta information on the content (<a href="https://github.com/ezsystems/ezp-next/blob/master/eZ/Publish/Core/Repository/Values/Content/ContentInfo.php">ContentInfo</a>)   
                                                                                                                                                                                                                                                      (only when accessing a Location)                                                                                                                                                                                               |
| `                 content               `        | <a href="https://github.com/ezsystems/ezp-next/blob/master/eZ/Publish/Core/Repository/Values/Content/Content.php">eZ\Publish\Core\Repository\Values\Content\Content</a>   | The Content item, containing all Fields and version information (<a href="https://github.com/ezsystems/ezp-next/blob/master/eZ/Publish/Core/Repository/Values/Content/VersionInfo.php">VersionInfo</a>) |
| `                 noLayout               `       | Boolean                                                                                                                                                                                         | If true, indicates if the Content item/Location is to be displayed without any pagelayout (i.e. AJAX, sub-requests, etc.).                                                                                                    
                                                                                                                                                                                                                                                      It's generally `false` when displaying a Content item in view type **full**.                                                                                                                                                   |
| `                 viewBaseLayout               ` | String                                                                                                                                                                                          | The base layout template to use when the view is requested to be generated outside of the pagelayout (when `noLayout` is true).                                                                                               |

### Template inheritance and sub-requests

Like any template, a content view template can use <a href="http://symfony.com/doc/current/book/templating.html#template-inheritance-and-layouts">template inheritance</a>. However keep in mind that your content may be also requested via <a href="http://symfony.com/doc/current/book/templating.html#embedding-controllers">sub-requests</a> (see below how to render [embedded content items](#ContentRendering-EmbeddingContentitems)), in which case you probably don't want the global layout to be used.

If you use different templates for embedded content views, this should not be a problem. If you'd rather use the same template, you can use an extra `noLayout` view parameter for the sub-request, and conditionally extend an empty pagelayout:

``` brush:
{% extends noLayout ? viewbaseLayout : "AcmeDemoBundle::pagelayout.html.twig" %}

{% block content %}
...
{% endblock %}
```

## Content and Location view providers

### View\\Manager & View\\Provider

The role of the `           (eZ\Publish\Core\MVC\Symfony\)View\Manager         ` is to select the right template for displaying a given Content item or Location. It aggregates objects called *Content and Location view providers* which respectively implement the `eZ\Publish\Core\MVC\Symfony\View\Provider\Content` and `eZ\Publish\Core\MVC\Symfony\View\Provider\Location` interfaces.

Each time a content item is to be displayed through the `Content\ViewController`, the `View\Manager` iterates over the registered Content or Location `View\Provider` objects and calls `getView` `()`.

#### Provided View\\Provider implementations

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Usage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>                  View provider configuration                </code></td>
<td align="left"><p>Based on application configuration.<br />
Formerly known as <em>Template override system</em>.</p></td>
</tr>
<tr class="even">
<td align="left"><p><code>eZ\Publish\Core\MVC\Legacy\View\Provider\Content</code></p>
<p><code>eZ\Publish\Core\MVC\Legacy\View\Provider\Location</code></p></td>
<td align="left"><p>Forwards view selection to the legacy kernel by running the old content/view module.<br />
Pagelayout used is the one configured in <code>ezpublish_legacy.&lt;scope&gt;.view_default_layout</code>.<br />
For more details about the <code>&lt;scope&gt;</code> please refer to the <a href="https://doc.ez.no/display/DEVELOPER/SiteAccess#SiteAccess-Configuration">scope configuration</a> documentation.</p></td>
</tr>
</tbody>
</table>

### Custom View\\Provider

#### Difference between `View\Provider\Location` and `View\Provider\Content`

-   A `View\Provider\Location` only deals with `Location` objects and implements `eZ\Publish\Core\MVC\Symfony\View\Provider\Location` interface.
-   A `View\Provider\Content` only deals with `ContentInfo` objects and implements `eZ\Publish\Core\MVC\Symfony\View\Provider\Content` interface.

#### When to develop a custom `View\Provider\(Location|Content)`

-   You want a custom template selection based on a very specific state of your application
-   You depend on external resources for view selection
-   You want to override the default one (based on configuration) for some reason

`View\Provider` objects need to be properly registered in the service container with the `           ezpublish.location_view_provider         ` or `           ezpublish.content_view_provider         ` service tag.

``` brush:
parameters:
    acme.location_view_provider.class: Acme\DemoBundle\Content\MyLocationViewProvider

services:
    acme.location_view_provider:
        class: %ezdemo.location_view_provider.class%
        tags:
            - {name: ezpublish.location_view_provider, priority: 30}
```

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Tag attribute name</th>
<th align="left">Usage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">priority</td>
<td align="left"><p>An integer giving the priority to the <code>                   View\Provider\(Content|Location)                 </code> in the <code>View\Manager</code>.</p>
<p>The priority range is <strong>from -255 to 255</strong></p></td>
</tr>
</tbody>
</table>

#### Example

**Custom View\\Provider\\Location**

``` brush:
<?php

namespace Acme\DemoBundle\Content;

use eZ\Publish\Core\MVC\Symfony\View\ContentView;
use eZ\Publish\Core\MVC\Symfony\View\Provider\Location as LocationViewProvider;
use eZ\Publish\API\Repository\Values\Content\Location;

class MyLocationViewProvider implements LocationViewProvider
{
    /**
     * Returns a ContentView object corresponding to $location, or void if not applicable
     *
     * @param \eZ\Publish\API\Repository\Values\Content\Location $location
     * @param string $viewType
     * @return \eZ\Publish\Core\MVC\Symfony\View\ContentView|null
     */
    public function getView( Location $location, $viewType )
    {
        // Let's check location Id
        switch ( $location->id )
        {
            // Special template for home page, passing "foo" variable to the template
            case 2:
                return new ContentView( "AcmeDemoBundle:$viewType:home.html.twig", array( 'foo' => 'bar' ) );
        }
 
        // ContentType identifier (formerly "class identifier")
        switch ( $location->contentInfo->contentType->identifier )
        {
            // For view full, it will load AcmeDemoBundle:full:small_folder.html.twig
            case 'folder':
                return new ContentView( "AcmeDemoBundle:$viewType:small_folder.html.twig" );
        }
    }
}
```

## <span style="color: rgb(0,98,147);">Rendering Content items
</span>

### <span style="color: rgb(0,98,147);">Content item Fields</span>

As stated above, a view template receives the requested Content item, holding all Fields.

In order to display the Fields' value the way you want, you can either manipulate the Field Value object itself, or use a custom template.

#### Getting raw Field value

Having access to the Content item in the template, you can use <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Publish/Core/Repository/Values/Content/Content.php">its public methods</a> to access all the information you need. You can also use the **ez\_field\_value** helper to get the <span class="confluence-link"> [field's value only](Field-Types-reference_31430495.html)</span>. It will return the correct language if there are several, based on language priorities.

``` brush:
{# With the following, myFieldValue will be in the Content item's main language, regardless of the current language #}
{% set myFieldValue = content.getFieldValue( 'some_field_identifier' ) %}
 
{# Here myTranslatedFieldValue will be in the current language if a translation is available. If not, the Content item's main language will be used #}
{% set myTranslatedFieldValue = ez_field_value( content, 'some_field_identifier' ) %}
```

#### Using the Field Type's template block

All built-in Field Types come with <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Bundle/EzPublishCoreBundle/Resources/views/content_fields.html.twig">their own Twig template</a>. You can render any Field using this default template using the `ez_render_field()` helper.

``` brush:
{{ ez_render_field( content, 'some_field_identifier' ) }}
```

Refer to [<span class="confluence-link">ez\_render\_field</span>](#ContentRendering-ez_render_field)<span class="confluence-link"> </span> for further information.

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
As this makes use of reusable templates, **using `ez_render_field()` is the recommended way and is to be considered the best practice**.

### Content name

The **name** of a Content item is its generic "title", generated by the repository based on the Content Type's naming pattern. It often takes the form of a normalized value of the first field, but might be a concatenation of several fields. There are 2 different ways to access this special property:

-   Through the name property of ContentInfo (not translated).
-   Through VersionInfo with the TranslationHelper (translated).

#### Translated name

<span>The *translated name* is held in a `VersionInfo` object, in the names property which consists of hash indexed by locale. You can easily retrieve it in the right language via the `TranslationHelper` service.</span>

``` brush:
<h2>Translated content name: {{ ez_content_name( content ) }}</h2>
<h3>Also works from ContentInfo: {{ ez_content_name( content.contentInfo ) }}</h3>
```

The helper will by default follow the prioritized languages order. If there is no translation for your prioritized languages, the helper will always return the name in the main language.

You can also **force a locale** in a second argument:

``` brush:
{# Force fre-FR locale. #}
<h2>{{ ez_content_name( content, 'fre-FR' ) }}</h2>
```

#### Name property in ContentInfo

This property is the actual content name, but **in main language only** (so it is not translated).

``` brush:
<h2>Content name: {{ content.contentInfo.name }}</h2>
```

``` brush:
$contentName = $content->contentInfo->name;
```

#### <span>Exposing additional variables</span>

It is possible to expose additional variables in a content view template. See<span class="confluence-link"> [parameters injection in content views](Injecting-parameters-in-content-views_31430331.html)</span>.

## Embedding images

<span class="status-macro aui-lozenge aui-lozenge-current">V1.4</span>

The Rich Text Field allows you to embed other Content items within the Field.

Content items that are identified as images will be rendered in the Rich Text Field using a dedicated template.

You can determine which Content Types will be treated as images and rendered using this template in the `ezplatform.content_view.image_embed_content_types_identifiers` parameter. By default it is set to cover the Image Content Type, but you can add other types that you want to be treated as images, for example:

``` brush:
parameters:
    ezplatform.content_view.image_embed_content_types_identifiers: ['image', 'photo', 'banner']
```

The template used when rendering embedded images can be set in the `ezplatform.default_view_templates.content.embed_image` container parameter:

``` brush:
parameters:
    ezplatform.default_view_templates.content.embed_image: 'content/view/embed/image.html.twig
```

## Adding Links

### Links to other Locations

Linking to other locations is fairly easy and is done with a <a href="http://symfony.com/doc/2.3/book/templating.html#linking-to-pages">native <code>path()</code> Twig helper</a> (or `url()` if you want to generate absolute URLs). You just have to pass it the Location object and `path()` will generate the URLAlias for you.

``` brush:
{# Assuming "location" variable is a valid eZ\Publish\API\Repository\Values\Content\Location object #}
<a href="{{ path( location ) }}">Some link to a location</a>
```

If you don't have the Location object, but only its ID, you can generate the URLAlias the following way:

``` brush:
<a href="{{ path( "ez_urlalias", {"locationId": 123} ) }}">Some link to a location, with its Id only</a>
```

You can also use the Content ID. In that case the generated link will point to the Content item's main Location.

``` brush:
<a href="{{ path( "ez_urlalias", {"contentId": 456} ) }}">Some link from a contentId</a>
```

Under the hood

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
In the backend, `path()` uses the Router to generate links.

This makes it also easy to generate links from PHP, via the `router` service.

See also: [Cross-siteaccess links](https://doc.ez.no/display/DEVELOPER/SiteAccess#SiteAccess-Cross-siteacesslinks)

## Embedding Content items

Rendering an embedded content from a Twig template is pretty straightforward as you just need to **do a subrequest with `ez_content` controller**.

### Using `ez_content` controller

This controller is exactly the same as [the ViewController presented above](#ContentRendering-TheViewController). It has one main `viewAction`, that renders a Content item.

You can use this controller from templates with the following syntax:

``` brush:
{{ render(controller("ez_content:viewAction", {"contentId": 123, "viewType": "line"})) }}
```

The example above renders the Content item whose ID is **123** with the view type **line**.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Reference of `ez_content` controller follows the syntax of *controllers as a service*, <a href="http://symfony.com/doc/current/cookbook/controller/service.html">as explained in Symfony documentation</a>.

#### Available arguments

As with any controller, you can pass arguments to `ez_content:viewLocation` or `ez_content:viewContent` to fit your needs.

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Description</th>
<th align="left">Type</th>
<th align="left">Default value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>contentId</code></td>
<td align="left"><p>ID of the Content item you want to render.<br />
<strong>Only for <code>ez_content:viewContent</code></strong>  </p></td>
<td align="left">integer</td>
<td align="left">N/A</td>
</tr>
<tr class="even">
<td align="left"><code>locationId</code></td>
<td align="left">ID of the Location you want to render.<br />
<strong>Only for <code>ez_content:viewLocation</code></strong>  </td>
<td align="left">integer</td>
<td align="left">Content item's main location, if defined</td>
</tr>
<tr class="odd">
<td align="left"><code>viewType</code></td>
<td align="left"><p>The view type you want to render your Content item/Location in.<br />
Will be used by the ViewManager to select a corresponding template, according to defined rules. </p>
<p>Example: full, line, my_custom_view, etc.</p></td>
<td align="left">string</td>
<td align="left">full</td>
</tr>
<tr class="even">
<td align="left"><code>layout</code></td>
<td align="left"><p>Indicates if the sub-view needs to use the main layout (see<span class="confluence-link"> </span> <a href="#ContentRendering-Availablevariables"><span class="confluence-link">available variables in a view template</span></a>)</p>
<p> </p></td>
<td align="left">boolean</td>
<td align="left">false</td>
</tr>
<tr class="odd">
<td align="left"><code>params</code></td>
<td align="left"><p>Hash of variables you want to inject to sub-template, key being the exposed variable name.</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="brush: php; gutter: false; theme: Eclipse" style="font-size:12px;"><code>{{ render(
      controller( 
          &quot;ez_content:viewAction&quot;, 
          {
              &quot;contentId&quot;: 123,
              &quot;viewType&quot;: &quot;line&quot;,
              &quot;params&quot;: { &quot;some_variable&quot;: &quot;some_value&quot; }
          }
      )
) }}</code></pre>
</div>
</div></td>
<td align="left">hash</td>
<td align="left">empty hash</td>
</tr>
</tbody>
</table>

## <span class="js-issue-title">Rendering blocks</span>

You can specify which controller will be called for a specific block view match, much like defining custom controllers for location view or content view match.

Also, since there are two possible actions with which one can view a block: `ez_page:viewBlock` and `ez_page:viewBlockById`, it is possible to specify a controller action with a signature matching either one of the original actions.

Example of configuration in `app/config/ezplatform.yml`:

``` brush:
ezpublish:
    system:
        eng_frontend_group:
            block_view:
                ContentGrid:
                    template: NetgenSiteBundle:block:content_grid.html.twig
                    controller: NetgenSiteBundle:Block:viewContentGridBlock
                    match:
                        Type: ContentGrid
```

## Binary and Media download

Unlike image files, files stored in BinaryFile or Media Fields may be limited to certain User Roles. As such, they are not publicly downloadable from disk, and are instead served by Symfony, using a custom route that runs the necessary checks. This route is automatically generated as the `url` property for those Fields values.

### The content/download route

The route follows this pattern: `/content/download/{contentId}/{fieldIdentifier}/{filename}`. Example: `/content/download/68/file/My-file.pdf.`

It also accepts optional query parameters:

-   `version`: <span>the version number that the file must be downloaded for. Requires the versionview permission. If not specified, the published version is used.</span>
-   `inLanguage`: <span>The language the file should be downloaded in. If not specified, the most prioritized language for the siteaccess will be used.</span>

The [<span class="confluence-link">ez\_render\_field</span>](#ContentRendering-ez_render_field) <span class="confluence-link"> </span>twig helper will by default generate a working link.

#### REST API: The `uri` property contains a valid download URL

The `uri` property of Binary Fields in REST contain a valid URL, of the same format as the Public API, prefixed with the same host as the REST Request.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
For [<span class="confluence-link">more information about REST API</span> see the documentation](REST-API-Guide_31430286.html).

## []()Custom controllers

In some cases, displaying a Content item/Location via the built-in `ViewController` is not sufficient to show everything you want. In such cases you may want to **use your own custom controller** to display the current Content item/Location instead.

Typical use cases include access to:

-   Settings (coming from `ConfigResolver` or `ServiceContainer`)
-   Current Content item's `ContentType` object
-   Current Location's parent
-   Current Location's children count
-   Main Location and alternative Locations for the current Content item
-   etc.

There are three ways in which you can apply a custom controller:

-   Configure a custom controller alongside regular matcher rules to use **both** your custom controller and the `ViewController` (recommended).
-   **Override** the built-in `ViewController` with the custom controller in a specific situation.
-   **Replace** the `ViewController` with the custom controller for the whole bundle.

### Enriching ViewController with a custom controller

**This is the recommended way of using a custom controller**

To use your custom controller on top of the built-in `ViewController` you need to point to both the controller and the template in the configuration, for example:

**ezplatform.yml**

``` brush:
ezpublish:
    system:
        default:
            content_view:
                full:
                    article:
                        controller: AcmeTestBundle:Default:articleViewEnhanced
                        template: AcmeTestBundle:full:article.html.twig
                        match:
                            Identifier\ContentType: [article]
```

With this configuration, the following controller will forward the request to the built-in `ViewController` with some additional parameters:

**Controller**

``` brush:
<?php

namespace Acme\TestBundle\Controller;

use Symfony\Component\HttpFoundation\Response;
use eZ\Bundle\EzPublishCoreBundle\Controller;

class DefaultController extends Controller
{
    public function articleViewEnhancedAction( $locationId, $viewType, $layout = false, array $params = array() )
    {
        // Add custom parameters to existing ones.
        $params += array( 'myCustomVariable' => "Hey, I'm a custom message!" );
        // Forward the request to the original ViewController
        // And get the response. Possibly alter it (here we change the smax-age for cache).
        $response = $this->get( 'ez_content' )->viewLocation( $locationId, $viewType, $layout, $params );
        $response->setSharedMaxAge( 600 );

        return $response;
    }
}
```

Always ensure that you add new parameters to existing `$params` associative array using <a href="http://php.net/manual/en/language.operators.array.php"><strong><code>+</code></strong> union operator</a> or `array_merge()`. **Not doing so (e.g. only passing your custom parameters array) can result in unexpected issues with content preview**. Previewed content and other parameters are indeed passed in `$params`.

These parameters can then be used in templates, for example:

**article.html.twig**

``` brush:
{% extends noLayout ? viewbaseLayout : "eZDemoBundle::pagelayout.html.twig" %}

{% block content %}
    <h1>{{ ez_render_field( content, 'title' ) }}</h1>
    <h2>{{ myCustomVariable }}</h2>
    {{ ez_render_field( content, 'body' ) }}
{% endblock %}
```

### Using only your custom controller

If you want to apply only your custom controller in a given match situation and not use the `ViewController` at all, in the configuration you need to indicate the controller, but no template, for example:

**ezplatform.yml**

``` brush:
ezpublish:
    system:
        default:
            content_view:
                full:
                    folder:
                        controller: AcmeTestBundle:Default:viewFolder
                        match:
                            Identifier\ContentType: [folder]
                            Identifier\Section: [standard]
```

In this example, as the `ViewController` is not applied, the custom controller takes care of the whole process of displaying content, including pointing to the template to be used (in this case, `AcmeTestBundle::custom_controller_folder.html.twig`):

**Controller**

``` brush:
<?php

namespace Acme\TestBundle\Controller;

use Symfony\Component\HttpFoundation\Response;
use eZ\Bundle\EzPublishCoreBundle\Controller;

class DefaultController extends Controller
{
    public function viewFolderAction( $locationId, $layout = false, $params = array() )
    {
        $repository = $this->getRepository();
        $location = $repository->getLocationService()->loadLocation( $locationId );
        // Check if content is not already passed. Can be the case when using content preview.
        $content = isset( $params['content'] ) ? $params['content'] : $repository->getContentService()->loadContentByContentInfo( $location->getContentInfo() )
        $response = new Response();
        $response->headers->set( 'X-Location-Id', $locationId );
        // Caching for 1h and make the cache vary on user hash
        $response->setSharedMaxAge( 3600 );
        $response->setVary( 'X-User-Hash' );
        return $this->render(
            'AcmeTestBundle::custom_controller_folder.html.twig',
            array(
                'location' => $location,
                'content' => $content,
                'foo' => 'Hey world!!!',
                'osTypes' => array( 'osx', 'linux', 'windows' )
            ) + $params
        );
    }
}
```

Here again custom parameters can be used in the template, e.g.:

**custom\_controller\_folder.html.twig**

``` brush:
{% extends "eZDemoBundle::pagelayout.html.twig" %}

{% block content %}
<h1>{{ ez_render_field( content, 'title' ) }}</h1>
    <h1>{{ foo }}</h1>
    <ul>
    {% for os in osTypes %}
        <li>{{ os }}</li>
    {% endfor %}
    </ul>
{% endblock %}
```

### Overriding the built-in ViewController

One other way to keep control of what is passed to the view is to use your own controller instead of the built-in `ViewController`. As base `ViewController` is defined as a service, with a service alias, this can be easily achieved from your bundle's configuration:

``` brush:
parameters:
    my.custom.view_controller.class: Acme\TestBundle\MyViewController

services:
    my.custom.view_controller:
        class: %my.custom.view_controller.class%
        arguments: [@some_dependency, @other_dependency]

    # Change the alias here and make it point to your own controller
    ez_content:
        alias: my.custom.view_controller
```

<span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
Doing so will completely override the built-in `ViewController`! Use this at your own risk!

### Custom controller structure

Your custom controller can be any kind of <a href="http://symfony.com/doc/current/book/page_creation.html#step-2-create-the-controller">controller supported by Symfony</a> (including <a href="http://symfony.com/doc/current/cookbook/controller/service.html">controllers as a service</a>).

The only requirement here is that your action method must have a similar signature to `ViewController::viewLocation()` or `ViewController::viewContent()` (depending on what you're matching of course). However, note that not all arguments are mandatory, since <a href="http://symfony.com/doc/current/book/routing.html#route-parameters-and-controller-arguments">Symfony is clever enough to know what to inject into your action method</a>. That is why **you aren't forced to mimic the `ViewController`'s signature strictly**. For example, if you omit `$layout` and `$params` arguments, it will still be valid. Symfony will just avoid injecting them into your action method.

#### Built-in ViewController signatures

**viewLocation() signature**

``` brush:
/**
 * Main action for viewing content through a location in the repository.
 *
 * @param int $locationId
 * @param string $viewType
 * @param boolean $layout
 * @param array $params
 *
 * @throws \Symfony\Component\Security\Core\Exception\AccessDeniedException
 * @throws \Exception
 *
 * @return \Symfony\Component\HttpFoundation\Response
 */
public function viewLocation( $locationId, $viewType, $layout = false, array $params = array() )
```

**viewContent() signature**

``` brush:
/**
 * Main action for viewing content.
 *
 * @param int $contentId
 * @param string $viewType
 * @param boolean $layout
 * @param array $params
 *
 * @throws \Symfony\Component\Security\Core\Exception\AccessDeniedException
 * @throws \Exception
 *
 * @return \Symfony\Component\HttpFoundation\Response
 */
public function viewContent( $contentId, $viewType, $layout = false, array $params = array() )
```

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Controller selection doesn't apply to `block_view` since you can already [use your own controller to display blocks](https://doc.ez.no/display/DEVELOPER/Content+Rendering#ContentRendering-Renderingblocks).

Caching

<span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
When you use your own controller, **it is your responsibility to define cache rules**, like with every custom controller!

So don't forget to **set cache rules** and the appropriate **`X-Location-Id` header** in the returned `Response` object.

<a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Publish/Core/MVC/Symfony/Controller/Content/ViewController.php#L76">See built-in ViewController</a> for more details on this.

## Query controller

<span class="status-macro aui-lozenge aui-lozenge-current">V1.4</span>

The Query controller is a predefined custom content view controller that runs a Repository Query.

It is meant to be used as a custom controller in a view configuration, along with match rules. It can use properties of the viewed Content item or Location as parameters to the Query. It makes it easy to retrieve content without writing custom PHP code and display the results in a template.

### Use-case examples

-   List of Blog posts in a Blog
-   List of Images in a Gallery

### Usage example

We will take the blog posts use case mentioned above as an example. It assumes a "Blog" container that contains a set of "Blog post" items. The goal is, when viewing a Blog, to list the Blog posts it contains.

Three items are required:

-   a `LocationChildren` QueryType - It will generate a Query retrieving the children of a given location id
-   a View template - It will render the Blog, and list the Blog posts it contains
-   a `content_view` configuration - It will instruct Platform, when viewing a Content item of type Blog, to use the Query Controller, the view template, and the `LocationChildren` QueryType. It will also map the id of the viewed Blog to the QueryType parameters, and set which twig variable the results will be assigned to.

#### The LocationChildren QueryType

QueryTypes are described in more detail in the [next section](#ContentRendering-QueryTypesobjects). In short, a QueryType can build a Query object, optionally based on a set of parameters. The following example will build a Query that retrieves the sub-items of a Location:

**src/AppBundle/QueryType/LocationChildrenQueryType.php**

``` brush:
<?php
namespace AppBundle\QueryType;

use eZ\Publish\API\Repository\Values\Content\LocationQuery;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion\ParentLocationId;
use eZ\Publish\Core\QueryType\QueryType;

class LocationChildrenQueryType implements QueryType
{
    public function getQuery(array $parameters = [])
    {
        return new LocationQuery([
            'filter' => new ParentLocationId($parameters['parentLocationId']),
        ]);
    }

    public function getSupportedParameters()
    {
        return ['parentLocationId'];
    }

    public static function getName()
    {
        return 'LocationChildren';
    }
}
```

Any class will be registered as a QueryType when it:

-   implements the QueryType interface,
-   is located in the QueryType subfolder of a bundle, and in a file named "SomethingQueryType.php"

If the QueryType has dependencies, it can be manually tagged as a service using the `ezpublish.query_type` service tag, but it is not required in that case.

#### The content\_view configuration

We now need a view configuration that matches content items of type "Blog", and uses the QueryController to fetch the blog posts:

**app/config/ezplatform.yml**

``` brush:
ezpublish:
      system:
            site_group:
                content_view:
                    full:
                        blog:
                            controller: "ez_query:locationQueryAction"
                            template: "content/view/full/blog.html.twig"
                            match:
                                Identifier\ContentType: "blog"
                            params:
                                query:
                                    query_type: 'LocationChildren'
                                    parameters:
                                        parentLocationId: "@=location.id"
                                    assign_results_to: 'blog_posts'
```

The view's controller action is set to the QueryController's `locationQuery` action (`ez_query:locationQueryAction`). Other actions are available that run a different type of search (contentInfo or content).

The QueryController is configured in the `query` array, inside the `params` of the content\_view block:

-   `query_type` specifies the QueryType to use, based on its name.
-   `parameters` is a hash where parameters from the QueryType are set. Arbitrary values can be used, as well as properties from the currently viewed location and content. In that case, the id of the currently viewed location is mapped to the QueryType's `parentLocationId` parameter: `             parentLocationId: "@=location.id"           `
-   <span> `assign_results_to` sets which twig variable the search results will be assigned to.</span>

#### <span>The view template</span>

<span>Results from the search are assigned to the `blog_posts` variable as a `SearchResult` object. In addition, since the usual view controller is used, the currently viewed `location` and `content` are also available.</span>

**app/Resources/views/content/full/blog.html.twig**

``` brush:
<h1>{{ ez_content_name(content) }}</h1>
 
{% for blog_post in blog_posts.searchHits %}
  <h2>{{ ez_content_name(blog_post.valueObject.contentInfo) }}</h2>
{% endfor %} 
```

### Configuration details

#### `controller`

Three Controller Actions are available, each for a different type of search:

-   `locationQueryAction` runs a Location Search
-   `contentQueryAction` runs a Content Search
-   `contentInfoQueryAction` runs a Content Info search

 

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
See [Search](Search_31429673.html) documentation page for more details about different types of search

#### `params`

The Query is configured in a `query` hash in `params`, you could specify the QueryType name, additional parameters and the Twig variable that you will assign the results to for use in the template.

-   #### `query_type`

    -   Name of the Query Type that will be used to run the query, defined by the class name.

-   #### `parameters`

    -   Query Type parameters that can be provided in two ways:

    1.  As scalar values, for example an identifier, an id, etc.
    2.  Using the Expression language. This simple script language, similar to Twig syntax, lets you write expressions that get value from the current content and/or location:

    -   -   For example, `@=location.id                   ` will be evaluated to the currently viewed location's ID.`                     content`, `location` and `view` are available as variables in expressions.

-   #### `assign_results_to`

    -   This is the name of the Twig variable that will be assigned the results.
    -   Note that the results are the SearchResult object returned by the SearchService.

### <span>Query Types objects</span>

QueryTypes are objects that build a Query. They are different from [Public API queries](https://doc.ez.no/display/DEVELOPER/Public+API+Guide).

To make a new QueryType available to the Query Controller, you need to create a PHP class that implements the QueryType interface, then register it as such in the Service Container.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
For more information about the [Service Container](Service-Container_31432100.html), read the page

### <span class="anchor">The QueryType interface</span>

There you can view the PHP QueryType interface. Three methods are described:

1.  `getQuery()`
2.  `getSupportedParameters()`
3.  `getName()`

**** <span class="collapse-source expand-control"><span class="expand-control-icon icon"> </span><span class="expand-control-text">Expand source</span></span>

``` brush:
interface QueryType
{
 /**
 * Builds and returns the Query object
 *
 * The Query can be either a Content or a Location one.
 *
 * @param array $parameters A hash of parameters that will be used to build the Query
 * @return \eZ\Publish\API\Repository\Values\Content\Query
 */
 public function getQuery(array $parameters = []);
 
 /**
 * Returns an array listing the parameters supported by the QueryType
 * @return array
 */
 public function getSupportedParameters();
 
 /**
 * Returns the QueryType name
 * @return string
 */
 public static function getName();
}
```

#### Parameters

A QueryType may accept parameters, including string, arrays and other types, depending on the implementation. They can be used in any way, such as:

-   customizing an element's value (limit, ContentType identifier, etc)
-   conditionally adding/removing criteria from the query
-   setting the limit/offset

The implementations should use Symfony's `OptionsResolver` for parameters handling and resolution.

### <span class="anchor">QueryType example: latest content</span>

Let's see an example for QueryType creation.

This QueryType returns a Query that searches for **the 10 last published Content items, order by reverse publishing date**.
It accepts an optional `type` parameter, that can be set to a ContentType identifier:

 

``` brush:
<?php
namespace AppBundle\QueryType;
use eZ\Publish\Core\QueryType\QueryType;
use eZ\Publish\API\Repository\Values\Content\Query;
class LatestContentQueryType implements QueryType
{
    public function getQuery(array $parameters = [])
    {
        $criteria[] = new Query\Criterion\Visibility(Query\Criterion\Visibility::VISIBLE);
        if (isset($parameters['type'])) {
            $criteria[] = new Query\Criterion\ContentTypeIdentifier($parameters['type']);
        }
        // 10 is the default limit we set, but you can have one defined in the parameters
        return new Query([
            'filter' => new Query\Criterion\LogicalAnd($criteria),
            'sortClauses' => [new Query\SortClause\DatePublished()],
            'limit' => isset($parameters['limit']) ? $parameters['limit'] : 10,
        ]);
    }
    public static function getName()
    {
        return 'AppBundle:LatestContent';
    }
    /**
     * Returns an array listing the parameters supported by the QueryType.
     * @return array
     */
    public function getSupportedParameters()
    {
        return ['type', 'limit'];
    }
}
```

### <span class="anchor">Naming of QueryTypes</span>

Each QueryType is named after what is returned by `getName()`. **Names must be unique.** A warning will be thrown during compilation if there is a conflict, and the resulting behavior will be unpredictable.

QueryType names should use a unique namespace, in order to avoid conflicts with other bundles. We recommend that the name is prefixed with the bundle's name: `AcmeBundle:LatestContent`. A vendor/company's name could also work for QueryTypes that are reusable throughout projects: `Acme:LatestContent`.

### <span class="anchor">Registering the QueryType into the service container</span>

In addition to creating a class for a `QueryType`, you must also register the QueryType with the Service Container. This can be done in two ways: by convention, and with a service tag.

#### <span class="anchor">By convention</span>

Any class named `<Bundle>\QueryType\*QueryType`, that implements the QueryType interface, will be registered as a custom QueryType.
Example: `AppBundle\QueryType\LatestContentQueryType`.

#### <span class="anchor">Using a service tag</span>

If the proposed convention doesn't work for you, QueryTypes can be manually tagged in the service declaration:

``` brush:
acme.query.latest_content:
    class: AppBundle\Query\LatestContent
    tags:
        - {name: ezpublish.query_type}
```

The effect is exactly the same as registering by convention.

More content...

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Follow the FieldType creation Tutorial and learn how to [Register the Field Type as a service](Register-the-Field-Type-as-a-service_31429774.html)

### <span class="anchor">The OptionsResolverBasedQueryType abstract class</span>

An abstract class based on Symfony's `OptionsResolver` eases implementation of QueryTypes with parameters.

It provides final implementations of `getQuery()` and `getDefinedParameters()`.

A `doGetQuery()` method must be implemented instead of `getQuery()`. It is called with the parameters processed by the OptionsResolver, meaning that the values have been validated, and default values have been set.

In addition, the `configureOptions(OptionsResolver $resolver)` method must configure the OptionsResolver.

The LatestContentQueryType can benefit from the abstract implementation:

-   validate that `type` is a string, but make it optional
-   validate that `limit` is an int, with a default value of 10

 

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
For further information see the <a href="http://symfony.com/doc/current/components/options_resolver.html">Symfony's Options Resolver documentation page</a>

``` brush:
<?php
namespace AppBundle\QueryType;
use eZ\Publish\API\Repository\Values\Content\Query;
use Symfony\Component\OptionsResolver\OptionsResolver;
class OptionsBasedLatestContentQueryType extends OptionsResolverBasedQueryType implements QueryType
{
    protected function doGetQuery(array $parameters)
    {
        $criteria[] = new Query\Criterion\Visibility(Query\Criterion\Visibility::VISIBLE);
        if (isset($parameters['type'])) {
            $criteria[] = new Query\Criterion\ContentTypeIdentifier($parameters['type']);
        }
        return new Query([
            'criterion' => new Query\Criterion\LogicalAnd($criteria),
            'sortClauses' => [new Query\SortClause\DatePublished()],
            'limit' => $parameters,
        ]);
    }
    public static function getName()
    {
        return 'AppBundle:LatestContent';
    }
    protected function configureOptions(OptionsResolver $resolver)
    {
        $resolver->setAllowedTypes('type', 'string');
        $resolver->setAllowedValues('limit', 'int');
        $resolver->setDefault('limit', 10);
    }
}
```

### <span class="anchor">Using QueryTypes from PHP code</span>

All QueryTypes are registered in a registry, the QueryType registry.

It is available from the container as `ezpublish.query_type.registry`

``` brush:
<?php
class MyCommand extends ContainerAwareCommand
{
    protected function execute(InputInterface $input, OutputInterface $output)
    {
        $queryType     = $this->getContainer()->get('ezpublish.query_type.registry')->getQueryType('AcmeBundle:LatestContent');
        $query         = $queryType->getQuery(['type' => 'article']);
        $searchResults = $this->getContainer()->get('ezpublish.api.service.search')->findContent($query);
        foreach ($searchResults->searchHits as $searchHit) {
            $output->writeln($searchHit->valueObject->contentInfo->name);
        }
    }
}
```

## ESI

Just like for regular Symfony controllers, you can take advantage of ESI and use different cache levels:

**Using ESI**

``` brush:
{{ render_esi(controller("ez_content:viewAction", {"contentId": 123, "viewType": "line"})) }}
```

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Only scalable variables can be sent via render\_esi (not object)

## Asynchronous rendering

Symfony also supports asynchronous content rendering with the help of <a href="http://mnot.github.com/hinclude/">hinclude.js</a> library.

**Asynchronous rendering**

``` brush:
{{ render_hinclude(controller("ez_content:viewAction", {"contentId": 123, "viewType": "line"})) }}
```

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Only scalable variables can be sent via render\_hinclude (not object)

### Display a default text

If you want to display a default text while a controller is loaded asynchronously, you have to pass a second parameter to your render\_hinclude twig function.

**Display a default text during asynchronous loading of a controller**

``` brush:
{{ render_hinclude(controller('EzCorporateDesignBundle:Header:userLinks'), {'default': "<div style='color:red'>loading</div>"}) }}
```

See also: [Custom controllers](#ContentRendering-Customcontrollers)

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<a href="http://mnot.github.com/hinclude/">hinclude.js</a> needs to be properly included in your layout to work.

Please <a href="http://symfony.com/doc/current/book/templating.html#asynchronous-content-with-hinclude-js">refer to Symfony documentation</a> for all available options.

# Reference

Symfony & Twig template functions/filters/tags

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
For template functionality provided by Symfony Framework, see <a href="http://symfony.com/doc/current/reference/twig_reference.html">Symfony Twig Extensions Reference page</a>. For those provided by the underlying Twig template engine, see <a href="http://twig.sensiolabs.org/documentation#reference">Twig Reference page</a>

## Twig functions reference

See [Twig Functions Reference](Twig-Functions-Reference_32114025.html) for detailed information on all available Twig functions.

# Extensibility

## Events

### Introduction

This section presents the events that are triggered by eZ Platform.

### eZ Publish Core

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Event name</th>
<th align="left">Triggered when...</th>
<th align="left">Usage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong><code>ezpublish.siteaccess</code></strong></td>
<td align="left">After the SiteAccess matching has occurred.</td>
<td align="left"><p>Gives further control on the matched SiteAccess.</p>
<p>The event listener method receives an <code>eZ\Publish\Core\MVC\Symfony\Event\PostSiteAccessMatchEvent</code> object.</p></td>
</tr>
<tr class="even">
<td align="left"><strong><code>ezpublish.pre_content_view</code></strong></td>
<td align="left">Right before a view is rendered for a Content item, via the content view controller.</td>
<td align="left"><p>This event is triggered by the view manager and allows you to inject additional parameters to the content view template.</p>
The event listener method receives an <code>eZ\Publish\Core\MVC\Symfony\Event\PreContentViewEvent </code>object.
<p> </p></td>
</tr>
<tr class="odd">
<td align="left"><code>                 ezpublish.api.contentException               </code></td>
<td align="left">The API throws an exception that could not be caught internally (missing field type, internal error...).</td>
<td align="left"><p>This event allows further programmatic handling (like rendering a custom view) for the exception thrown.</p>
<p>The event listener method receives an <code>eZ\Publish\Core\MVC\Symfony\Event\APIContentExceptionEvent</code> object.</p></td>
</tr>
</tbody>
</table>

#### In this topic:

-   [Introduction](#ContentRendering-Introduction)
    -   [The ViewController](#ContentRendering-TheViewController)
-   [Configuration](#ContentRendering-Configuration)
    -   [View provider configuration](#ContentRendering-Viewproviderconfiguration)
    -   [View Matchers](#ContentRendering-ViewMatchers)
    -   [Default view templates](#ContentRendering-Defaultviewtemplates)
-   [Usage](#ContentRendering-Usage)
    -   [Content view templates](#ContentRendering-Contentviewtemplates)
    -   [Content and Location view providers](#ContentRendering-ContentandLocationviewproviders)
    -   [Rendering Content items](#ContentRendering-RenderingContentitems)
    -   [Embedding images](#ContentRendering-Embeddingimages)
    -   [Adding Links](#ContentRendering-AddingLinks)
    -   [Embedding Content items](#ContentRendering-EmbeddingContentitems)
    -   [Rendering blocks](#ContentRendering-Renderingblocks)
    -   [Binary and Media download](#ContentRendering-BinaryandMediadownload)
    -   [Custom controllers](#ContentRendering-Customcontrollers)
    -   [Query controller](#ContentRendering-Querycontroller)
    -   [ESI](#ContentRendering-ESI)
    -   [Asynchronous rendering](#ContentRendering-Asynchronousrendering)
-   [Reference](#ContentRendering-Reference)
    -   [Twig functions reference](#ContentRendering-Twigfunctionsreference)
-   [Extensibility](#ContentRendering-Extensibility)
    -   [Events](#ContentRendering-Events)

#### Related topics:

[Injecting parameters in content views](Injecting-parameters-in-content-views_31430331.html)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Repository](Repository_31432023.html)</span>
5.  <span>[List of Limitations](List-of-Limitations_31430459.html)</span>

 Developer : ContentTypeLimitation 



A Limitation to specify if the User has access to Content with a specific Content Type.

|                 |                                                                          |
|-----------------|--------------------------------------------------------------------------|
| Identifier      | `Class`                                                                  |
| Value Class     | `eZ\Publish\API\Repository\Values\User\Limitation\ContentTypeLimitation` |
| Type Class      | `eZ\Publish\Core\Limitation\ContentTypeLimitationType`                   |
| Criterion used  | `eZ\Publish\API\Repository\Values\Content\Query\Criterion\ContentTypeId` |
| Role Limitation | no                                                                       |

###### Possible values

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">Value</td>
<td align="left">UI value</td>
<td align="left">Description</td>
</tr>
<tr class="even">
<td align="left"><code>&lt;ContentType_id&gt;</code></td>
<td align="left"><code>&lt;ContentType_name&gt;</code></td>
<td align="left"><p>All valid <code>ContentType</code> ids can be set as value(s)</p></td>
</tr>
</tbody>
</table>

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Community Resources](Community-Resources_31429530.html)</span>
4.  <span>[How to Contribute](How-to-Contribute_31429587.html)</span>

 Developer : Contribute to Documentation 



While we are doing our best to make sure our documentation fulfills all your needs, there is always place for improvement. If you'd like to contribute to our docs, you can do the following:

-   **Add comments.** Whenever you notice a mistake or possible improvement in any of the topics, leave a comment or suggestion at the bottom of the page.
-   **Create a JIRA issue.** You can also report any omissions or inaccuracies you find by creating a JIRA issue. See [Report and follow issues: The bugtracker](31429592.html) on how to do this. Remember to add the "Documentation" component to your issue to make sure we don't lose track of it.
-   **Visit Slack.** The \#documentation-contrib channel on <a href="http://ez-community-on-slack.herokuapp.com">eZ Community Slack team</a> is the place to drop your comments, suggestions, or proposals for things you'd like to see covered in documentation. (You can use the link to get an auto-invite to Slack).
-   **Contact the Doc Team.** If you'd like to add to any part of the documentation, you can also contact the Doc Team directly at <script type="text/javascript">
    <!--
    h='&#x65;&#122;&#46;&#110;&#x6f;&#46;';a='&#64;';n='&#100;&#x6f;&#x63;&#x2d;&#116;&#x65;&#x61;&#x6d;';e=n+a+h;
    document.write('<a h'+'ref'+'="ma'+'ilto'+':'+e+'" clas'+'s="em' + 'ail">'+e+'<\/'+'a'+'>');
    // -->
    </script><noscript>&#100;&#x6f;&#x63;&#x2d;&#116;&#x65;&#x61;&#x6d;&#32;&#x61;&#116;&#32;&#x65;&#122;&#32;&#100;&#x6f;&#116;&#32;&#110;&#x6f;&#32;&#100;&#x6f;&#116;&#32;</noscript>

 

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Community Resources](Community-Resources_31429530.html)</span>
4.  <span>[How to Contribute](How-to-Contribute_31429587.html)</span>

 Developer : Contributing translations 



If you'd like to see eZ Platform in your language, you can contribute to the translations. Contributing is made easy by using Crowdin, which allows you to translate elements of the interface in context.

# How to translate the interface using Crowdin

If you wish to contribute to an existing translation of PlatformUI or start a new one, <span class="inline-comment-marker" data-ref="b52fbf5d-a27a-42e7-b153-f1509bb55b71">the best way</span> is to start with in-context translation (but you can also [translate directly on the Crowdin website](#Contributingtranslations-Translatingoutsidein-context)).

## Preparing to use in-context

To start translating, you need an option to turn in-context translation on and off. To do this, set a browser cookie. There are several ways to do this, but we will highlight a couple here.

### Using bookmarks

You can easily create two bookmarks to toggle in-context on/off.

Right-click your browser's bookmark bar, and create a new bookmark, with the following label and link:

-   Enable in-context: `javascript:(function() {document.cookie='ez_in_context_translation=1;path=/;'; location.reload();})()`
-   Disable in-context: `javascript:(function()  {document.cookie='ez_in_context_translation=;expires=Mon, 05 Jul 2000  00:00:00 GMT;path=/;'; location.reload();})()`

Then click on the bookmarks from PlatformUI to enable/disable in-context.

### Using the debugging console

Another way is to open the development console and run these lines:

-   enable: `document.cookie='ez_in_context_translation=1;path=/;'; location.reload();`
-   disable: `document.cookie='ez_in_context_translation=;expires=Mon, 05 Jul 2000 00:00:00 GMT;path=/;'; location.reload();`

## Using in-context translation

The first time you enable in-context, if you're not logged into Crowdin, it will ask you to log in or register an account. Once done, it will ask you which language you want to translate to, from the list of languages configured in Crowdin.

Choose your language and you can start translating right away. Strings in the interface that can be translated will be outlined in red (untranslated), blue (translated) or green (approved). When moving over them, an edit button will show up on the top left corner of the outline. Click on it, and edit the string in the window that shows up.

### <span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img src="attachments/31429671/33554862.png" title=" In-context translation of Platform UI" alt=" In-context translation of Platform UI" class="confluence-embedded-image image-center" width="800" height="480" /></span>

#### Troubleshooting

Make sure you clear your browser's cache in addition to eZ Platform's. Some of the translation resources use aggressive HTTP cache.

## Translating outside in-context

If you prefer not to use in-context, simply visit <a href="https://crowdin.com/project/ezplatform">eZ Platform's Crowdin page</a>, choose a language and you will see a list of files containing strings. Here you can suggest your translations.

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
If the language you want to translate to is not available, you can ask for it to be added in the <a href="https://crowdin.com/project/ezplatform/discussions">Crowdin discussion forum for eZ Platform</a>.

# Install new translation package

To make use of the UI translations, you need to<span class="inline-comment-marker" data-ref="9504e97b-17fd-4ff0-bae5-958311e12228"> install the new translation package in your project.</span>

## Translation packages per language

To allow users to install only what they need, we have split every language into a dedicated package.

All translation packages are published on <a href="https://github.com/ezplatform-i18n">ezplatform-i18n organisation on github</a>

## Install a new language in your project

<span class="inline-comment-marker" data-ref="9370cf8d-c018-4086-aaa3-d6723bb71444">If you want to install a new language in your project, you just have to install the corresponding package.</span>

For example, if you want to translate your application into French, you just have to run:

    composer require ezplatform-i18n/ezplatform-i18n-fr_fr

and then clear the cache.

Now you can reload your eZ Platform administration page which will be translated in French (if your browser is configured to fr\_FR.)

# Full translation workflow

<span class="inline-comment-marker" data-ref="20756fb2-d2e8-4028-812b-0513d0ba73d9">You can read a full description of how new translations are prepared and dis</span>tributed in <a href="https://github.com/ezsystems/ezplatform/blob/1.8/doc/i18n/translation_workflow.md">the documentation of GitHub</a>.

#### In this topic:

-   [How to translate the interface using Crowdin](#Contributingtranslations-HowtotranslatetheinterfaceusingCrowdin)
    -   [Preparing to use in-context](#Contributingtranslations-Preparingtousein-context)
        -   [Using bookmarks](#Contributingtranslations-Usingbookmarks)
        -   [Using the debugging console](#Contributingtranslations-Usingthedebuggingconsole)
    -   [Using in-context translation](#Contributingtranslations-Usingin-contexttranslation)
        -   [](#Contributingtranslations-)
    -   [Translating outside in-context](#Contributingtranslations-Translatingoutsidein-context)
-   [Install new translation package](#Contributingtranslations-Installnewtranslationpackage)
    -   [Translation packages per language](#Contributingtranslations-Translationpackagesperlanguage)
    -   [Install a new language in your project](#Contributingtranslations-Installanewlanguageinyourproject)
-   [Full translation workflow](#Contributingtranslations-Fulltranslationworkflow)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Cookbook](Cookbook_31429528.html)</span>

 Developer : Converting request parameters into API objects 



# Description

In lots of cases, a request will provide a contentId or a locationId. Before using them, you will have to load API object within your controller.

# Solution

For example:

``` brush:
public function listBlogPostsAction( $locationId )
{
    $location = $repository->getLocationService()->loadLocation( $locationId );
```

Thanks to the param converter, you can directly have the API object at your disposal. All you have to do is:

-   For Locations:
    -   In your controller's signature, type int the variable to Location.
    -   Make sure a parameter named "locationId" is provided by the request.
-   For Content items:
    -   In your controller's signature, typeint the variable to Content
    -   Make sure a parameter named "contentId" is provided by the request

# Example

Example using Locations:

``` brush:
use eZ\Publish\API\Repository\Values\Content\Location;

public function listBlogPostsAction( Location $location )
{
    // use my $location object
```

## Further information

If you want to understand how it works, you can check <a href="http://symfony.com/doc/master/bundles/SensioFrameworkExtraBundle/annotations/converters.html">Symfony's param converter documentation</a> and the <a href="https://github.com/ezsystems/ezpublish-kernel/pull/1128">pull request implementing the Repository ParamConverters</a>.

## Migrating your current application

<a href="https://github.com/ezsystems/DemoBundle/pull/129/files">See example pull request on the DemoBundle</a> which provides a few concrete examples.

#### In this topic:

-   [Description](#ConvertingrequestparametersintoAPIobjects-Description)
-   [Solution](#ConvertingrequestparametersintoAPIobjects-Solution)
-   [Example](#ConvertingrequestparametersintoAPIobjects-Example)
    -   [Further information](#ConvertingrequestparametersintoAPIobjects-Furtherinformation)
    -   [Migrating your current application](#ConvertingrequestparametersintoAPIobjects-Migratingyourcurrentapplication)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>

 Developer : Cookbook 



This Cookbook contains recipes for doing specific tasks and solving challenges that you may encounter while working with eZ Platform.

 

Contributing recipes

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
Know a nice trick? Found an interesting solution? Let us know in the comments or take a look at how to [Contribute to Documentation](Contribute-to-Documentation_31429594.html).

 

#### Available recipes:

-   [Authenticating a user with multiple user providers](Authenticating-a-user-with-multiple-user-providers_31429790.html)
-   [Converting request parameters into API objects](Converting-request-parameters-into-API-objects_31429807.html)
-   [Creating custom notifications for Flex Workflow](Creating-custom-notifications-for-Flex-Workflow_33555728.html)
-   [Creating Landing Page blocks (Enterprise)](31430614.html)
-   [Creating Landing Page layouts (Enterprise)](31430259.html)
-   [Displaying children of a Content item](Displaying-children-of-a-Content-item_32868706.html)
-   [Displaying content with simple templates](Displaying-content-with-simple-templates_34079211.html)
-   [Executing long-running console commands](Executing-long-running-console-commands_31429811.html)
-   [Exposing SiteAccess-aware configuration for your bundle](Exposing-SiteAccess-aware-configuration-for-your-bundle_31429794.html)
-   [Importing settings from a bundle](Importing-settings-from-a-bundle_31429803.html)
-   [Injecting parameters in content views](Injecting-parameters-in-content-views_31430331.html)
-   [Listening to Core events](Listening-to-Core-events_31429796.html)
-   [Making cross-origin HTTP requests](Making-cross-origin-HTTP-requests_31430329.html)
-   [Paginating API search results](Paginating-API-search-results_31429798.html)
-   [Retrieving root location](Retrieving-root-location_31429800.html)
-   [Steps to set up Cluster](Steps-to-set-up-Cluster_31432321.html)
-   [Using RouteReference](Using-RouteReference_31430391.html)

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>
6.  <span>[Content items, Content Types and Fields](31430275.html)</span>
7.  <span>[Field Types reference](Field-Types-reference_31430495.html)</span>

 Developer : Country Field Type 



This Field Type represents one or multiple countries.

| Name      | Internal name | Expected input |
|-----------|---------------|----------------|
| `Country` | `ezcountry`   | `array`        |

## Description

This Field Type makes possible to store and retrieve data representing countries.

## PHP API Field Type 

### Input expectations

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>array</code></td>
<td align="left"><div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="brush: php; gutter: true; theme: Eclipse" style="font-size:12px;"><code>array(
    &quot;JP&quot; =&gt; array(
        &quot;Name&quot; =&gt; &quot;Japan&quot;,
        &quot;Alpha2&quot; =&gt; &quot;JP&quot;,
        &quot;Alpha3&quot; =&gt; &quot;JPN&quot;,
        &quot;IDC&quot; =&gt; 81
    )
);</code></pre>
</div>
</div></td>
</tr>
</tbody>
</table>

<span class="nx">Note: When you set an array directly on Content field you don't need to provide all this information, the Field Type will assume it is a hash and in this case will accept a simplified structure described below under [To / From Hash format](#CountryFieldType-ToFromHashFormat).</span>

### Validation

This Field Type validates if the multiple countries are allowed by the field definition, and if the Alpha2 is valid according to the countries configured in eZ Platform.

### Settings

The field definition of this Field Type can be configured with one option:

| Name         | Type      | Default value | Description                                                                             |
|--------------|-----------|---------------|-----------------------------------------------------------------------------------------|
| `isMultiple` | `boolean` | `false`       | This setting allows (if true) or denies (if false) the selection of multiple countries. |

**Country FieldType example settings**

``` brush:
$settings = array(
    "isMultiple" => true
);
```

### <span id="CountryFieldType-ToFromHashFormat" class="confluence-anchor-link"></span>To / From Hash format

The format used for serialization is simpler than the full format, this is also available when setting value on the content field, by setting the value to an array instead of the Value object. Example of that shown below:

**Value object content example**

``` brush:
$content->fields["countries"] = array( "JP", "NO" );
```

The format used by the toHash method is the Alpha2 value, however the input is capable of accepting either Name, Alpha2 or Alpha3 value as shown below in the Value object section.

### Value object

##### Properties

The Value class of this field type contains the following properties:

| Property     | Type      | Description                                                                                |
|--------------|-----------|--------------------------------------------------------------------------------------------|
| `$countries` | `array[]` | This property will be used for the country selection provided as input, as its attributes. |

**Value object content example**

``` brush:
$value->countries = array(
    "JP" => array(
        "Name" => "Japan",
        "Alpha2" => "JP",
        "Alpha3" => "JPN",
        "IDC" => 81
    )
)
```

##### Constructor

<span>The `Country`</span>`\Value`<span> constructor will initialize a new Value object with the value provided. It expects an array as input.</span>

**Constructor example**

``` brush:
// Instantiates a Country Value object
$countryValue = new Country\Value(
    array(
        "JP" => array(
            "Name" => "Japan",
            "Alpha2" => "JP",
            "Alpha3" => "JPN",
            "IDC" => 81
        )
    )
);
```

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>
4.  <span>[Creating a Tweet Field Type](Creating-a-Tweet-Field-Type_31429766.html)</span>
5.  <span>[Build the bundle](Build-the-bundle_31429768.html)</span>

 Developer : Create the bundle 



Custom Field Types follow the Symfony 2 extension mechanism: <a href="http://symfony.com/doc/current/cookbook/bundles/index.html">bundles</a>. We can get started with a bundle using the built-in Symfony 2 bundle generator.

### Generating the bundle

From the eZ Platform root, run the following:

``` brush:
php app/console generate:bundle
```

First, we are asked for the namespace. As the vendor, we will use EzSystems as the root namespace. This must of course be changed to whatever identifies you as a vendor (your name, company name, etc). We then choose a preferably unique name for the Field Type itself, and make the name end with Bundle. Here we’ve chosen TweetFieldTypeBundle.

 

``` brush:
Bundle namespace: EzSystems/TweetFieldTypeBundle<enter>
```

We must next input the bundle’s name. Nothing exotic here: we concatenate the vendor’s namespace and the bundle’s namespace, which is the default. Just hit Enter:

``` brush:
Bundle name [EzSystemsTweetFieldTypeBundle]:<enter>
```

We are then asked for the target directory. We will begin within the `src` folder, but we could (and should!) version it and have it moved to `vendor` at some point. Again, this is the default, and we just hit Enter.

``` brush:
Target directory [/home/bertrand/www/ezpublish5/src]:<enter>
```

We must then specify which format the configuration must be generated as. We will use yml, since it is what we use in eZ Platform itself. Of course, any other format could be used.

``` brush:
Configuration format (yml, xml, php, or annotation): yml<enter>
```

The generator will then offer to create the whole directory structure for us. Since our bundle isn’t really a standard Symfony full stack bundle, we decline.

``` brush:
Do you want to generate the whole directory structure [no]? no<enter>
```

 

We then get a summary of what will be generated:

``` brush:
You are going to generate a "EzSystems\TweetFieldTypeBundle\EzSystemsTweetFieldTypeBundle" bundle
in "/home/bertrand/www/ezpublish5/src/" using the "yml" format.
Do you confirm generation [yes]?<enter>
```

After generation, the wizard will offer to update the kernel with our bundle (answer "yes"), and to update the app’s routing with our bundle’s route file (answer "no").

``` brush:
Generating the bundle code: OK
Checking that the bundle is autoloaded: OK
Confirm automatic update of your Kernel [yes]? <enter>
Enabling the bundle inside the Kernel: OK
Confirm automatic update of the Routing [yes]? no <enter>
```

Our bundle should now be generated. Navigate to `src/EzSystems/EzSystemsTweetBundle` and you should see the following structure:

``` brush:
$ ls -l src/EzSystems/TweetFieldTypeBundle
Controller
DependencyInjection
EzSystemsTweetFieldTypeBundle.php
Resources
Tests
```

Feel free to delete the Controller folder, since we won’t use it in this tutorial. It could have been useful, had our Field Type required an interface of its own.

**Tutorial path**






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>
4.  <span>[Extending PlatformUI with new navigation](Extending-PlatformUI-with-new-navigation_31430235.html)</span>

 Developer : Create the extension Bundle 



To extend PlatformUI, the very first thing to do is to create a Symfony bundle. For that, you can use <a href="http://symfony.com/doc/current/bundles/SensioGeneratorBundle/commands/generate_bundle.html">the Symfony generate bundle command</a> in the following way:

``` brush:
$ app/console generate:bundle --namespace=EzSystems/ExtendingPlatformUIConferenceBundle --dir=src --format=yml --no-interaction
```

This will generate a new bundle skeleton in `src/EzSystems/ExtendingPlatformUIConferenceBundle`, add it to the application kernel and configure eZ Platform to use the generated `routing.yml` without asking any question. Of course, you are free to tweak the bundle's namespace and directory or to integrate the PlatformUI extension code in an existing bundle.

Results and next step:

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
If you run this exact command, you will pretty much get <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/tree/1_bundle">the code available under the 1_bundle tag on Github</a>.

The next step is then to [prepare the bundle to handle PlatformUI specific configuration](Set-up-the-configuration_31430239.html).

**Tutorial path**






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>

 Developer : Creating a Tweet Field Type 



## About this tutorial

 

This tutorial aims at covering the creation and development of a custom eZ Platform [Field Type](https://doc.ez.no/display/DEVELOPER/Field+Types+reference).
We will do this by implementing a *Tweet* Field Type. It will:

-   Accept as input the URL of a tweet (https://twitter.com/&lt;username&gt;/status/&lt;id&gt;)

-   Fetch the tweet using the Twitter oEmbed API (<a href="https://dev.twitter.com/docs/embedded-tweets" class="uri">https://dev.twitter.com/docs/embedded-tweets</a>)

-   Store the tweet’s embed contents and URL

-   Display the tweet's embedded version when displaying the field from a template

 

<span class="confluence-embedded-file-wrapper"><img src="attachments/31429766/31429765.png" class="confluence-embedded-image" /></span>

### About Field Types

Field Types are the most granular building blocks for content managed by eZ Platform. The system comes with about [30 native types](Field-Types-reference_31430495.html) that cover most common needs (Text line, Rich text, Email, Author list, Content relation, Map location, Float, etc.)

Field Types are responsible for:

-   Storing data, either using the native storage engine mechanisms, or specific means

-   Validating input data

-   Making the data searchable (if applicable)

-   Displaying an instance of the type

Custom Field Types are a very powerful type of extension, since they allow you to hook deep into the content model.

You can find the in-depth [documentation about Field Types and their best practices here](Field-Type-API-and-best-practices_31430767.html). It describes how each component of a Field Type interacts with the various layers of the system, and how to implement those.

 

## Getting the code

The code created throughout this tutorial is available on GitHub: <a href="https://github.com/ezsystems/TweetFieldTypeBundle" class="uri">https://github.com/ezsystems/TweetFieldTypeBundle</a>.

 

## Steps

### The bundle

Field Types, like any other eZ Platform plugin, must be provided as Symfony2 bundles. This chapter covers the creation and organization of this bundle.

Read more about [creating](Create-the-bundle_31429782.html) and [structuring the bundle](Structure-the-bundle_31429784.html).

### API

This part covers the implementation of the eZ Platform API elements required to implement a custom Field Type.

Read more about [implementing the Tweet\\Value class](31429770.html) and [the Tweet\\Type class](31429772.html).

### Converter

Storing data from any Field Type into the Legacy Storage Engine requires that your custom data is mapped to the data model.

Read more about [implementing the Legacy Storage Engine Converter](Implement-the-Legacy-Storage-Engine-Converter_31429776.html).

### Templating

Displaying a Field Type's data is done through a <a href="http://twig.sensiolabs.org/doc/intro.html">Twig template</a>.

Read more about [implementing the Field Type template](Introduce-a-template_31429779.html).

### PlatformUI integration

Viewing and editing values of the Field Type in PlatformUI requires that you extend PlatformUI, using mostly Javascript.

You should ideally read the general <a href="https://github.com/ezsystems/PlatformUIBundle/blob/master/docs/extensibility.md">extensibility documentation for PlatformUI</a>. The part about <a href="https://github.com/ezsystems/PlatformUIBundle/blob/master/docs/extensibility.md#templates-1">templating</a> covers view templates. Edit templates are not documented at the time of writing, but <a href="http://www.netgenlabs.com/">Netgen</a> <span> has published a tutorial that </span>covers the topic: <a href="http://www.netgenlabs.com/Blog/Adding-support-for-a-new-field-type-to-eZ-Publish-Platform-UI" class="uri">http://www.netgenlabs.com/Blog/Adding-support-for-a-new-field-type-to-eZ-Publish-Platform-UI</a>.

**Tutorial Path**

## Attachments:

<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [fieldtype tutorial, final result.PNG](attachments/31429766/31429765.png) (image/png)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Cookbook](Cookbook_31429528.html)</span>

 Developer : Creating custom notifications for Flex Workflow 



<span style="color: rgb(0,0,0);text-decoration: none;">To create a custom notification you have to provide two plugins in the `flex-workflow` bundle, one for the `notificationsPopupView` and second for the `notificationIndicatorView`.</span>

<span style="color: rgb(0,0,0);text-decoration: none;">We will start from creating a plugin for `notificationIndicatorView` which is responsible for displaying a text in the notification bar (this green stripe in the bottom when you get new notification)</span>

<span style="color: rgb(0,0,0);text-decoration: none;">We have to start from adding dependencies in yui.yml (placed in `./Resources/config/yui.yml`):</span><span style="color: rgb(0,0,0);text-decoration: none;"> </span>

``` brush:
mb-notificationmessagecreatorplugin:
    requires: ['plugin', 'ez-pluginregistry']
    dependencyOf: ['fw-notificationindicatorview']
    path: %mybundle.public_dir%/js/plugins/mb-notificationmessagecreatorplugin.js
```

<span style="color: rgb(0,0,0);text-decoration: none;">
</span><span style="color: rgb(0,0,0);text-decoration: none;">Now we can create our plugin (as we declared in the yui.yml, we need to create it in `./js/plugins`), it will be stored in a file named `mb-notificationmessagecreatorplugin.js`:</span><span style="color: rgb(0,0,0);text-decoration: none;"> </span>

``` brush:
YUI.add('mb-notificationmessagecreatorplugin', function (Y) {
    'use strict';

    var PLUGIN_NAME = 'mbNotificationMessageCreatorPlugin';

    /**
     * Add the notification message creator
     *
     * @module mb-notificationmessagecreatorplugin
     */
    Y.namespace('mb.Plugin');

    /**
     * @namespace mb.Plugin
     * @class mbNotificationMessageCreator
     * @constructor
     * @extends Plugin.Base
     */
    Y.mb.Plugin.NotificationMessageCreator = Y.Base.create(PLUGIN_NAME, Y.Plugin.Base, [], {
        initializer: function () {
            var notificationIndicatorView = this.get('host');

            /**
             * This will add a message creator to the `notificationIndicatorView`.
             * In the public method `addNotificationMessageCreator` we have to provide:
             * 1. The notification type.
             * 2. The callback to be invoked to create the message in the notification bar.
             */

 
           notificationIndicatorView.addNotificationMessageCreator('myNotificationType',
 this._createNotificationMessage.bind(this));
        },

        /**
         * Creates a notification message.
         *
         * @method _createNotificationMessage
         * @protected
         * @param notification {Object} the notification
         * @return {String}
         */
        _createNotificationMessage: function (notification) {
            /**
             * In this method we have to return a string which will be displayed in the notification bar.
             * To this method is passed the notification object provided from backend.
             * In this tutorial we assume that the message is in object `data`.
             */
            return notification.data.message;
        },

    }, {
        NS: PLUGIN_NAME
    });

    Y.eZ.PluginRegistry.registerPlugin(
         Y.mb.Plugin.NotificationMessageCreator, ['notificationIndicatorView']
    );
});
```

<span style="color: rgb(0,0,0);text-decoration: none;">Now we can create a plugin for the `notificationsPopupView`, it will be responsible for creating a proper notification struct, again we start from creating dependency in yui.yml:</span><span style="color: rgb(0,0,0);text-decoration: none;"> </span>

``` brush:
mb-notificationstructparserplugin:
    requires: ['plugin', 'ez-pluginregistry']
    dependencyOf: ['fw-notificationspopupview']
    path: %mybundle.public_dir%/js/plugins/mb-notificationstructparserplugin.js
```

<span style="color: rgb(0,0,0);text-decoration: none;">And we create a plugin named `mb-notificationstructparserplugin`:</span>

``` brush:
YUI.add('mb-notificationstructparserplugin', function (Y) {
    'use strict';

    var PLUGIN_NAME = 'mbNotificationStructParserPlugin',
        TIMESTAMP_MULTIPLIER = 1000;

    /**
     * Add the notification struct parser
     *
     * @module mb-notificationstructparserplugin
     */
    Y.namespace('mb.Plugin');

    /**
     * @namespace mb.Plugin
     * @class mbNotificationStructParser
     * @constructor
     * @extends Plugin.Base
     */
    Y.mb.Plugin.NotificationStructParser = Y.Base.create(PLUGIN_NAME, Y.Plugin.Base, [], {
        initializer: function () {
            var notificationsPopupView = this.get('host');

            /**
             * This will add notification parser to the `notificationsPopupView`.
             * In the public method `addNotificationStructParser` we have to provide:
             * 1. The notification type.
             * 2. The callback to be invoked to create the proper notification struct.
             */
            notificationsPopupView.addNotificationStructParser('myNotificationType', this._createNotificationStruct.bind(this));
        },

        /**
         * Creates a notification structure required to render notifications
         *
         * @method _createNotificationStruct
         * @protected
         * @param item {Object} notification data
         * @return {Object}
         */
        _createNotificationStruct: function (item) {
            var creationDate = new Date(item.created * TIMESTAMP_MULTIPLIER);

            /**
             * In this method we have to return an object with proper notification struct.
             * The proper struct looks like this:
             * {
             *     id: {Number} the notification id
             *     isPending: {Number} is notification pending (0 or 1)
             *     date: {String} the date of notification
             *     time: {String} the time of notification
             *     type: {String} the notification type
             *     messageType: {String} the type message
             *     link: {String} the url to redirect user on click (if omitted will only close popup)
             *     shortText: {String} the short description text
             *     text: {String} the long description text (if omitted only shortText will be displayed)
             * }
             */
            return {
                id: item.id,
                isPending: parseInt(item.isPending, 10),
                type: item.type,
                date: Y.Date.format(creationDate, {format: '%x'}),
                time: Y.Date.format(creationDate, {format: '%X'}),
                link: item.data.link,
                messageType: item.data.contentName,
                shortText: item.data.message,
                text: item.data.message
            };
        },
    }, {
        NS: PLUGIN_NAME
    });

    Y.eZ.PluginRegistry.registerPlugin(
         Y.mb.Plugin.NotificationStructParser, ['notificationsPopupView']
    );
});
```

<span style="color: rgb(0,0,0);text-decoration: none;">Now we can clear cache (`php app/console --env=prod cache:clear`) and our notification should be displayed properly. In the image below you can check what is what in the notification struct:</span><span style="color: rgb(0,0,0);text-decoration: none;"> </span><span style="color: rgb(0,0,0);text-decoration: none;"> </span>

<span style="color: rgb(0,0,0);text-decoration: none;"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img src="attachments/33555728/33555726.png" class="confluence-embedded-image" width="600" /></span>
</span>

 

## Attachments:

<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [notification.png](attachments/33555728/33555726.png) (image/png)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>
6.  <span>[Content items, Content Types and Fields](31430275.html)</span>
7.  <span>[Field Types reference](Field-Types-reference_31430495.html)</span>

 Developer : Date Field Type 



This Field Type represents a date without time information.

| Name   | Internal name | Expected input type |
|--------|---------------|---------------------|
| `Date` | `ezdate`      | `mixed`             |

## Description

This Field Type makes it possible to store and retrieve date information.

#### PHP API Field Type 

### Input expectations

If input value is of type **`string`** or **`integer`**, it will be passed directly to the <a href="http://www.php.net/manual/en/datetime.construct.php">PHP's built-in <strong><code>\DateTime</code></strong> class constructor</a>, therefore the same input format expectations apply.

It is also possible to directly pass an instance of **`\DateTime`**.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>string</code></td>
<td align="left"><code>&quot;2012-08-28 12:20 Europe/Berlin&quot;</code></td>
</tr>
<tr class="even">
<td align="left"><pre><code>integer</code></pre></td>
<td align="left"><pre><code>1346149200</code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre><code>\DateTime</code></pre></td>
<td align="left"><pre><code>new \DateTime()</code></pre></td>
</tr>
</tbody>
</table>

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Time information is **not stored**.

Before storing, the provided input value will be set to the the beginning of the day in the given or the environment timezone.

### Value object

##### Properties

The Value class of this field type contains the following properties:

| Property | Type        | Description                                      |
|----------|-------------|--------------------------------------------------|
| `$date`  | `\DateTime` | This property will be used for the text content. |

##### String representation

String representation of the date value will generate the date string in the format "l d F Y" as accepted by <a href="http://www.php.net/manual/en/function.date.php">PHP's built-in <strong><code>date()</code></strong> function</a>.

Example:

> `Wednesday 22 May 2013`

##### Constructor

The constructor for this value object will initialize a new Value object with the value provided. It accepts an instance of <a href="http://www.php.net/manual/en/datetime.construct.php">PHP's built-in <strong><code>\DateTime</code></strong> class</a>.

### Hash format

Hash value of this Field Type is an array with two keys:

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"><div class="tablesorter-header-inner">
Key
</div></th>
<th align="left"><div class="tablesorter-header-inner">
Type
</div></th>
<th align="left"><div class="tablesorter-header-inner">
Description
</div></th>
<th align="left"><div class="tablesorter-header-inner">
Example
</div></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><code>timestamp</code></p></td>
<td align="left"><code>integer</code></td>
<td align="left">Time information as a <a href="http://en.wikipedia.org/wiki/Unix_time">timestamp</a>.</td>
<td align="left"><p><code>1400856992</code></p></td>
</tr>
<tr class="even">
<td align="left"><p><code>rfc850</code></p></td>
<td align="left"><code>string</code></td>
<td align="left"><p>Time information as a string in <a href="http://tools.ietf.org/html/rfc850">RFC 850 date format</a>.</p>
<p>As input, this will have higher precedence over the <strong><code>timestamp</code></strong> value.</p></td>
<td align="left"><code>&quot;Friday, 23-May-14 14:56:14 GMT+0000&quot;</code></td>
</tr>
</tbody>
</table>

**Example of the hash value in PHP**

``` brush:
$hash = array(
    "timestamp" => 1400856992,
    "rfc850" => "Friday, 23-May-14 14:56:14 GMT+0000"
);
```

### Validation

This Field Type does not perform any special validation of the input value.

### Settings

The field definition of this Field Type can be configured with one option:

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Type</th>
<th align="left">Default value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><pre><code>defaultType</code></pre></td>
<td align="left"><pre><code>mixed</code></pre></td>
<td align="left"><pre><code>Type::DEFAULT_EMPTY</code></pre></td>
<td align="left"><p>One of the <strong><code>DEFAULT_*</code></strong> constants, used by the administration interface for setting the default field value.</p>
<p>See below for more details.</p></td>
</tr>
</tbody>
</table>

<span style="color: rgb(0,0,0);">Following **`defaultType`** default value options are available as constants in the </span>**`eZ\Publish\Core\FieldType\Date\Type`**<span style="color: rgb(0,0,0);">** **class:</span>

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Constant</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><pre><code>DEFAULT_EMPTY</code></pre></td>
<td align="left">Default value will be empty.</td>
</tr>
<tr class="even">
<td align="left"><pre><code>DEFAULT_CURRENT_DATE</code></pre></td>
<td align="left">Default value will use current date.</td>
</tr>
</tbody>
</table>

**Date FieldType example settings**

``` brush:
use eZ\Publish\Core\FieldType\Date\Type;

$settings = array(
    "defaultType" => Type::DEFAULT_EMPTY
);
```

## Template rendering

The template called by [the **ez\_render\_field()** Twig function](ez_render_field_32114041.html) while rendering a Date field has access to the following parameters:

| Parameter | Type     | Default | Description                                                                                                                       |
|-----------|----------|---------|-----------------------------------------------------------------------------------------------------------------------------------|
| `locale`  | `string` |         | Internal parameter set by the system based on current request locale or if not set calculated based on the language of the field. |

Example:

``` brush:
{{ ez_render_field(content, 'date') }}
```

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>
6.  <span>[Content items, Content Types and Fields](31430275.html)</span>
7.  <span>[Field Types reference](Field-Types-reference_31430495.html)</span>

 Developer : DateAndTime Field Type 



This Field Type represents a full date including time information.

| Name          | Internal name | Expected input type |
|---------------|---------------|---------------------|
| `DateAndTime` | `ezdatetime`  | `mixed`             |

## Description

This Field Type makes possible to store and retrieve a full date including time information.

## PHP API Field Type 

### Input expectations

If input value is of type **`string`** or **`integer`**, it will be passed directly to the <a href="http://www.php.net/manual/en/datetime.construct.php">PHP's built-in <strong><code>\DateTime</code></strong> class constructor</a>, therefore the same input format expectations apply.

It is also possible to directly pass an instance of **`\DateTime`**.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>string</code></td>
<td align="left"><code>&quot;2012-08-28 12:20 Europe/Berlin&quot;</code></td>
</tr>
<tr class="even">
<td align="left"><pre><code>integer</code></pre></td>
<td align="left"><pre><code>1346149200</code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre><code>\DateTime</code></pre></td>
<td align="left"><pre><code>new \DateTime()</code></pre></td>
</tr>
</tbody>
</table>

### Value object

##### Properties

The Value class of this field type contains the following properties:

| Property | Type        | Description                                                |
|----------|-------------|------------------------------------------------------------|
| `$value` | `\DateTime` | The date and time value as an instance of **`\DateTime`**. |

##### Constructor

The constructor for this value object will initialize a new Value object with the value provided. It accepts an instance of PHP's built-in **`\DateTime`** class.

##### String representation

String representation of the date value will generate the date string in the format "D Y-d-m H:i:s" as accepted by <a href="http://www.php.net/manual/en/function.date.php">PHP's built-in <strong><code>date()</code></strong> function</a>.

Example:

> `Wed 2013-22-05 12:19:18`
>
> ``

### Hash format

Hash value of this Field Type is an array with two keys:

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Key</th>
<th align="left">Type</th>
<th align="left">Description</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><code>timestamp</code></p></td>
<td align="left"><code>integer</code></td>
<td align="left">Time information as a <a href="http://en.wikipedia.org/wiki/Unix_time">timestamp</a>.</td>
<td align="left"><p><code>1400856992</code></p></td>
</tr>
<tr class="even">
<td align="left"><p><code>rfc850</code></p></td>
<td align="left"><code>string</code></td>
<td align="left"><p>Time information as a string in <a href="http://tools.ietf.org/html/rfc850">RFC 850 date format</a>.</p>
<p>As input, this will have higher precedence over the <strong><code>timestamp</code></strong> value.</p></td>
<td align="left"><code>&quot;Friday, 23-May-14 14:56:14 GMT+0000&quot;</code></td>
</tr>
</tbody>
</table>

``` brush:
$hash = array(
    "timestamp" => 1400856992,
    "rfc850" => "Friday, 23-May-14 14:56:14 GMT+0000"
);
```

### Validation

This Field Type does not perform any special validation of the input value.

### Settings

The field definition of this Field Type can be configured with several options:

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Type</th>
<th align="left">Default value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>useSeconds</code></td>
<td align="left"><code>boolean</code></td>
<td align="left"><code>false</code></td>
<td align="left">Used to control displaying of seconds in the output.</td>
</tr>
<tr class="even">
<td align="left"><pre><code>defaultType</code></pre></td>
<td align="left"><pre><code>mixed</code></pre></td>
<td align="left"><pre><code>Type::DEFAULT_EMPTY</code></pre></td>
<td align="left"><p>One of the <strong><code>DEFAULT_*</code></strong> constants, used by the administration interface for setting the default field value.</p>
<p>See below for more details.</p></td>
</tr>
<tr class="odd">
<td align="left"><pre><code>dateInterval</code></pre></td>
<td align="left"><pre><code>null|\DateInterval</code></pre></td>
<td align="left"><pre><code>null</code></pre></td>
<td align="left"><p>This setting complements <strong><code>defaultType</code></strong> setting and can be used only when latter is set to <strong><code>Type::DEFAULT_CURRENT_DATE_ADJUSTED</code></strong>.</p>
<p>In that case the default input value when using administration interface will be adjusted by the given <strong><code>\DateInterval</code></strong>.</p></td>
</tr>
</tbody>
</table>

<span style="color: rgb(0,0,0);">Following **`defaultType`** default value options are available as constants in the </span>**`eZ\Publish\Core\FieldType\DateAndTime\Type`**<span style="color: rgb(0,0,0);">** **class:</span>

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Constant</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><pre><code>DEFAULT_EMPTY</code></pre></td>
<td align="left">Default value will be empty.</td>
</tr>
<tr class="even">
<td align="left"><pre><code>DEFAULT_CURRENT_DATE</code></pre></td>
<td align="left">Default value will use current date.</td>
</tr>
<tr class="odd">
<td align="left"><pre><code>DEFAULT_CURRENT_DATE_ADJUSTED</code></pre></td>
<td align="left"><span><span>Default value will use current date, adjusted by the interval defined in </span></span><strong><code>dateInterval</code></strong><span style="line-height: 1.4285715;"> setting</span><span style="line-height: 1.4285715;">.</span></td>
</tr>
</tbody>
</table>

**DateAndTime FieldType example settings**

``` brush:
use eZ\Publish\Core\FieldType\DateAndTime\Type;

$settings = array(
    "useSeconds" => false,
    "defaultType" => Type::DEFAULT_EMPTY,
    "dateInterval" => null
);
```

## Template rendering

The template called by [the **ez\_render\_field()** Twig function](ez_render_field_32114041.html) while rendering a Date field has access to the following parameters:

| Parameter | Type     | Default | Description                                                                                                                       |
|-----------|----------|---------|-----------------------------------------------------------------------------------------------------------------------------------|
| `locale`  | `string` |         | Internal parameter set by the system based on current request locale or if not set calculated based on the language of the field. |

Example:

``` brush:
{{ ez_render_field(content, 'datetime') }}
```

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>
4.  <span>[Extending PlatformUI with new navigation](Extending-PlatformUI-with-new-navigation_31430235.html)</span>

 Developer : Define a View 



## Views in PlatformUI

Each route defines a View to render when the route is matched. As explained in the [PlatformUI technical introduction](Extending-eZ-Platform_31429689.html#ExtendingeZPlatform-Technicalarchitecture), this kind of view is called a **Main View**. Like any view, it can have an arbitrary number of sub-views.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
**Good practice:** keep the views small and do not hesitate to create sub-views. This eases the maintenance and allows you to reuse the small sub-views in different context.

A View is responsible for generating the User Interface and handling the user input (click, keyboard, drag and drop, etc.). In its lifecycle, a view first receives a set of parameters, then it is rendered and added to DOM.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
PlatformUI reuses the <a href="http://yuilibrary.com/yui/docs/view/#views-models-and-addtarget">YUI View system</a>. `Y.View` is designed to be a very simple component. PlatformUI extends this concept to have views with more features like templates or asynchronous behavior.

## Creating and using a custom Main View

### Creating a new View

As for the plugin in the previous step, the first thing to do is to declare a new module in the extension bundle `yui.yml` file:

**New module in yui.yml**

``` brush:
ezconf-listview:
    requires: ['ez-view']
    path: %extending_platformui.public_dir%/js/views/ezconf-listview.js
```

Our basic view will extend the PlatformUI basic view which is available in the `ez-view` module. As a result, `ez-view` has to be added in the module requirements.

Then we have to create the corresponding module file. In this file, we'll create a new View component by extending `Y.eZ.View` provided by `ez-view`.

**%extending\_platformui.public\_dir%/js/views/ezconf-listview.js**

``` brush:
YUI.add('ezconf-listview', function (Y) {
    Y.namespace('eZConf');

    Y.eZConf.ListView = Y.Base.create('ezconfListView', Y.eZ.View, [], {
        initializer: function () {
            console.log("Hey, I'm the list view");
        },

        render: function () {
            // this.get('container') is an auto generated <div>
            // here, it's not yet in the DOM of the page and it will be added
            // after the execution of render().
            this.get('container').setContent(
                "Hey, I'm the listView and I was rendered it seems"
            );
            this.get('container').setStyles({
                background: '#fff',
                fontSize: '200%',
            });
            return this;
        },
    });
});
```

This code creates the `Y.eZConf.ListView` by extending `Y.eZ.View`. The newly created view component has a custom `render` method. As its name suggests, this method is called when the view needs to be rendered. For now, we are directly manipulating the DOM. `this.get('container')` in a View allows you to retrieve the container DOM node, it's actually <a href="http://yuilibrary.com/yui/docs/node/">a Y.Node instance</a> that is automatically created and added to the page when the View is needed in the application.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
A View is responsible for handling only what happens in its own container. While it's technically possible, it is a very bad practice for a View to handle anything that is outside its own container.

At this point, if you open/refresh PlatformUI in your browser, nothing will have really changed, because the newly added View is not used anywhere yet.

### Using it as a Main View

Now that we have a View, it's time to change the route configuration added in the previous step so that our custom route uses it. To do that, we'll have to change the application plugin to register the new view as a main view in the application and then to define the custom route with that view. Since we want to use the new view in the plugin, the `ezconf-listview` module becomes a dependency of the plugin module. The plugin module declaration becomes:

``` brush:
ezconf-listapplugin:
    requires: ['ez-pluginregistry', 'plugin', 'base', 'ezconf-listview'] # we've added 'ezconf-listview'
    dependencyOf: ['ez-platformuiapp']
    path: %extending_platformui.public_dir%/js/apps/plugins/ezconf-listappplugin.js
```

Then in the plugin, `Y.eZConf.ListView` becomes available; we can register it as a potential main view and change the route to use it:

**ezconf-listappplugin.js**

``` brush:
YUI.add('ezconf-listapplugin', function (Y) {
    Y.namespace('eZConf.Plugin');

    Y.eZConf.Plugin.ListAppPlugin = Y.Base.create('ezconfListAppPlugin', Y.Plugin.Base, [], {
        initializer: function () {
            var app = this.get('host'); // the plugged object is called host

            console.log("Hey, I'm a plugin for PlatformUI App!");
            console.log("And I'm plugged in ", app);

            console.log('Registering the ezconfListView in the app');
            app.views.ezconfListView = {
                type: Y.eZConf.ListView,
            };

            console.log("Let's add a route");
            app.route({
                name: "eZConfList",
                path: "/ezconf/list",
                view: "ezconfListView", // because we registered the view in app.views.ezconfListView
                sideViews: {'navigationHub': true, 'discoveryBar': false},
                callbacks: ['open', 'checkUser', 'handleSideViews', 'handleMainView'],
            });
        },
    }, {
        NS: 'ezconfTypeApp' // don't forget that
    });

    Y.eZ.PluginRegistry.registerPlugin(
        Y.eZConf.Plugin.ListAppPlugin, ['platformuiApp']
    );
});
```

After doing that, `/ez#/ezconf/list` should no longer display the dashboard, but you should see the message generated by `Y.eZConf.ListView`.

### Using a template

Manipulating the DOM in a view render method is fine for small changes but not very handy as soon as you want to generate a more complex UI. It's also a great way to separate pure UI/markup code from the actual view logic.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
In PlatformUI, most views are using a template to generate their own markup, those templates are interpreted by <a href="http://yuilibrary.com/yui/docs/handlebars/">the Handlebars.js template engine embed into YUI</a>.

The templates are made available in the application by defining them as modules in `yui.yml`. The template modules are a bit special though. To be recognized as a template and correctly handled by the application, a template module has a `type` property that should be set to `template`. Also, to get everything ready *automatically*, the module name should follow a naming convention. The module name should consist of the lowercase View internal name (the first `Y.Base.create` parameter) where the template is supposed to be used followed by the suffix `-ez-template`. In our case, the internal name of `Y.eZConf.ListView` is `ezconfListView`, so if we want to use a template in this view, the module for this template should be `ezconflistview-ez-template`. The template module must also be added as a dependency of the view module using it (`ezconf-listview` in this case). As a result, the modules declaration for the template and the view will be:

``` brush:
ezconf-listview:
    requires: ['ez-templatebasedview', 'ezconflistview-ez-template']
    path: %extending_platformui.public_dir%/js/views/ezconf-listview.js
ezconflistview-ez-template: # internal view name + '-ez-template' suffix
    type: 'template' # mandatory so that the template is available in JavaScript
    path: %extending_platformui.public_dir%/templates/ezconflistview.hbt
```

In `yui.yml`, we also have to change the `ezconf-listview` module to now require <span class="blob-code-inner"> <span class="pl-s"> <span class="pl-s"> `ez-` <span class="x x-first x-last"> `templatebasedview` instead of `ez-view` so that `Y.eZConf.ListView` can inherit from `Y.eZ.TemplateBasedView` instead of `Y.eZ.View.` </span> </span> </span> </span> Once that is in place, the rendering logic can be changed to use the template:

``` brush:
YUI.add('ezconf-listview', function (Y) {
    Y.namespace('eZConf');

    Y.eZConf.ListView = Y.Base.create('ezconfListView', Y.eZ.TemplateBasedView, [], { // Y.eZ.TemplateBasedView now!
        initializer: function () {
            console.log("Hey, I'm the list view");
        },

        render: function () {
            // when extending Y.eZ.TemplateBasedView
            // this.template is the result of the template
            // compilation, it's a function. You can pass an object
            // in parameters and each property will be available in the template
            // as a variable named after the property.
            this.get('container').setHTML(
                this.template({
                    "name": "listView"
                })
            );
            this.get('container').setStyles({
                background: '#fff',
                fontSize: '200%',
            });
            return this;
        },
    });
});
```

And the last part of the chain is the Handlebars template file itself:

**ezconflistview.hbt**

``` brush:
<h1 class="ezconf-list-title">List view</h1>

Hey, I'm the {{ name }} and I'm rendered with the template!
```

At this point, `/ez#/ezconf/list` should display the <span class="blob-code-inner"> <span class="pl-s"> <span class="pl-s"> <span class="x x-first x-last"> `Y.eZConf.ListView` </span> </span> </span> </span> rendered with the template.

### Adding a CSS

We've just moved the markup logic from the view component to a template file. It is also time to do the same for the CSS styles that are still in the `render` method. For that, a CSS file can be created on the disk to replace the inline styles:

**list.css**

``` brush:
.ez-view-ezconflistview {
    background: #fff;
}

.ez-view-ezconflistview .ezconf-list-title {
    margin-top: 0;
}
```

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
By default, a view container element has an auto-generated class built from the internal view name.

**Good practice:** using that auto-generated class to write the CSS rule greatly limits the risk of side effects when styling a view.

 

Then this file has to be listed in the extension bundle `css.yml` configuration file:

**css.yml**

``` brush:
system:
    default:
        css:
            files:
                - %extending_platformui.css_dir%/views/list.css
```

After this is done, a custom view is now used when reaching `/ez#/ezconf/list` and the UI is now styled with a custom external stylesheet.

Results and next step:

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
The resulting code can be seen in <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/tree/4_view">the 4_view tag on GitHub</a>, this step result can also be viewed as <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/compare/3_routing...4_view">a diff between tags <code>3_routing</code> and <code>4_view</code></a>.

The next step is then [to configure the navigation](Configure-the-navigation_31430245.html) so that user can easily reach the new page.

**Tutorial path**






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : Design 



# Introduction

This page covers design in eZ Platform in a general aspect. If you want to learn about how to display content and build your content templates, you might want to check [Content Rendering](Content-Rendering_31429679.html).

To apply a template to any part of your webpage, you need three (optionally four) elements:

1.  An entry in the configuration that defines which template should be used in what situation
2.  The template file itself
3.  Assets used by the template (for example, CSS or JS files, images, etc.)
4.  (optional) A custom controller used when the template is read which allows you more detailed control over the page.

# Configuration

Each template must be mentioned in a configuration file together with a definition of the situation in which it is used. You can use the `ezplatform.yml` file located in the `app/config/` folder, or create your own separate configuration file in that folder that will list all your templates.

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
If you decide to create a new configuration file, you will need to import it by including an import statement in `ezplatform.yml`. Add the following code at the beginning of `ezplatform.yml`:

``` brush:
imports:
    - { resource: <your_file_name>.yml }
```

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
If you are using the recommended .yml files for configuration, here are the basic rules for this format:

The configuration is based on pairs of a key and its value, separated by a colon, presented in the following form: key: value. The value of the key may contain further keys, with their values containing further keys, and so on. This hierarchy is marked using indentation – each level lower in the hierarchy must be indented in comparison with its parent.

A short configuration file can look like this:

**Sample configuration file**

``` brush:
ezpublish:
    system:
        default:
            user:
                layout: pagelayout.html.twig
            content_view:
                full:
                    article:
                        template: full\article.html.twig
                        match:
                            Identifier\ContentType: [article]
                    blog_post:
                        controller: app.controller.blog:showBlogPostAction
                        template: full\blog_post.html.twig
                        match:
                            Identifier\ContentType: [blog_post]
                line:
                    article:
                        template: line\article.html.twig
                        match:
                            Identifier\ContentType: [article]
```

This is what individual keys in the configuration mean:

-   **`ezpublish`** and **`system`** are obligatory at the start of any configuration file which defines views.
-   **`default`** defines the siteaccess for which the configuration will be used. "default", as the name suggests, determines what views are used when no other configuration is chosen. You can also have separate keys defining views for other siteaccesses.
-   **`user`** and **`layout`** point to the main template file that is used in any situation where no other template is defined. All other templates extend this one. See [below](#Design-pagelayout)for more information.
-   **`content_view`** defines the view provider.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
In earlier versions of eZ CMS, `location_view` was used as the view provider. It is now deprecated.

-   **`full`** and **`line`** determine the kind of view to be used (see below).
-   **`article`** and **`blog_post`** are the keys that start the configuration for one individual case of using a template. You can name these keys any way you want, and you can have as many of them as you need.
-   **`template`** names the template to be used in this case, including the folder it is stored in (starting from `app/Resources/views`).
-   **`controller`** defines the controller to be used in this case. Optional, if this key is absent, the default controller is used.
-   **`match`** defines the situation in which the template will be used. There are different criteria which can be used to "match" a template to a situation, for example a Content Type, a specific Location ID, Section, etc. You can view the full list of matchers here: <span class="confluence-link"> [View provider configuration](Content-Rendering_31429679.html#ContentRendering-Viewproviderconfiguration) </span>. You can specify more than one matcher for any template; the matchers will be linked with an AND operator.

 

In the example above, three different templates are mentioned, two to be used in full view, and one in line view. Notice that two separate templates are defined for the "article" Content Type. They use the same matcher, but will be used in different situations – one when an Article is displayed in full view, and one in line view. Their templates are located in different folders. The line template will also make use of a custom controller, while the remaining cases will employ the default one.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
#### Full, line and other views

Each Content item can be rendered differently, using different templates, depending on the type of view it is displayed in. The default, built-in views are **full** (used when the Content item is displayed by itself, as a full page), **line** (used when it is displayed as an item in the list, for example a listing of contents of a folder), and **embed** (used when one Content item is embedded in another). Other, custom view types can be created, but only these three have built-in controllers in the system.

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
See <span class="confluence-link"> [View provider configuration](Content-Rendering_31429679.html#ContentRendering-Viewproviderconfiguration) </span> for more details.

## Template file

Templates in eZ Platform are written in the Twig templating language.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
#### Twig templates in short

At its core, a Twig template is an HTML frame of the page that will be displayed. Inside this frame you define places (and manners) in which different parts of your Content items will be displayed (rendered).

Most of a Twig template file can look like an ordinary HTML file. This is also where you can define places where Content items or their fields will be embedded.

 

The configuration described above lets you select one template to be used in a given situation, but this does not mean you are limited to only one file per case. It is possible to include other templates in the main template file. For example, you can have a single template for the footer of a page and include it in many other templates. Such templates do not need to be mentioned in the configuration .yml file.

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
See <a href="http://symfony.com/doc/current/book/templating.html#including-templates">Including Templates</a> in Symfony documentation for more information on including templates.

 

<span id="Design-pagelayout" class="confluence-anchor-link"></span>The main template for your webpage (defined per siteaccess) is placed in the `pagelayout.html.twig` file. This template will be used by default for those parts of the website where no other templates are defined.

A `pagelayout.html.twig` file exists already in Demo Bundles, but if you are using a clean installation, you need to create it from scratch. This file is typically located in a bundle, for example using the built-in AppBundle: `src/AppBundle/Resources/views`.<span> The name of the bundle must the added whenever the file is called, like in the example below.</span>

Any further templates will extend and modify this one, so they need to start with a line like this:

``` brush:
{% extends "AppBundle::pagelayout.html.twig" %}
```

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Although using AppBundle is recommended, you could also place the template files directly in `<installation_folder>/app                 /`Resources/views . Then the files could <span class="confluence-link">be referenced in code without any prefix. See [Best Practices](Best-Practices_31429687.html) for more information.
</span>

Template paths

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
In short, the `Resources/views` part of the path is automatically added whenever a template file is referenced. What you need to provide is the bundle name, name of any subfolder within `/views/`, and file name, all three separated by colons (:)

To find out more about the way of referencing template files placed in bundles, see <a href="http://symfony.com/doc/current/book/templating.html#referencing-templates-in-a-bundle">Referencing Templates in a Bundle</a> in Symfony documentation.

Templates can be extended using a Twig <a href="http://twig.sensiolabs.org/doc/functions/block.html"><code>block</code></a>tag. This tag lets you define a named section in the template that will be filled in by the child template. For example, you can define a "title" block in the main template. Any child template that extends it can also contain a "title" block. In this case the contents of the block from the child template will be placed inside this block in the parent template (and override what was inside this block):

**pagelayout.html.twig**

``` brush:
{# ... #}
    <body>
        {% block title %}
            <h1>Default title</h1>
        {% endblock %}
    </body>
{# ... #}
```

**child.html.twig**

``` brush:
{% extends "AppBundle::pagelayout.html.twig" %}
{% block title %}
    <h1>Specific title</h1>
{% endblock %}
```

In the simplified example above, when the `child.html.twig` template is used, the "title" block from it will be placed in and will override the "title" block from the main template – so "Specific title" will be displayed instead of "Default title."

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
Alternatively, you can place templates inside one another using the <a href="http://twig.sensiolabs.org/doc/functions/include.html"><code>include</code></a>function.

See <a href="http://twig.sensiolabs.org/doc/templates.html">http://twig.sensiolabs.org/doc/templates.html#</a> for detailed documentation on how to use Twig.

#### Embed content in templates

Now that you know how to create a general layout with Twig templates, let's take a look at the ways in which you can render content inside them.

There are several ways of placing Content items or their Fields inside a template. You can do it using one of the <span class="confluence-link"> <span class="confluence-link"> [Twig functions described in detail here](Content-Rendering_31429679.html#ContentRendering-Reference) </span> </span>.

As an example, let's look at one of those functions: **[ez\_render\_field](ez_render_field_32114041.html)** . It renders one selected Field of the Content item. In its simplest form this function can look like this:

``` brush:
{{ ez_render_field( content, 'description' ) }}
```

This renders the value of the Field with identifier "description" of the current Content item (signified by "content"). You can additionally choose a special template to be used for this particular Field:

``` brush:
{{ ez_render_field( 
       content, 
       'description',
       { 'template': 'AppBundle:fields:description.html.twig' }
   ) }}
```

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
As you can see in the case above, templates can be created not only for whole pages, but also for individual Fields.

Another way of embedding Content items is using the **render\_esi** function (which is not an eZ-specific function, but a Symfony standard). This function lets you easily select a different Content item and embed it in the current page. This can be used, for instance, if you want to list the children of a Content item in its parent.

``` brush:
{{ render_esi(controller('ez_content:viewAction', {locationId: 33, viewType: 'line'} )) }}
```

This example renders the Content item with Location ID 33 using the line view. To do this, the function applies the 'ez\_content:viewAction' controller. This is the default controller for rendering content, but can be substituted here with any custom controller of your choice.

### Assets

Asset files such as CSS stylesheets, JS scripts or image files can be defined in the templates and need to be included in the directory structure in the same way as with any other web project. Assets are placed in the `web/` folder in your installation.

Instead of linking to stylesheets or embedding images like usually, you can use the <a href="http://symfony.com/doc/current/book/templating.html#linking-to-assets"><code>asset</code></a>function.

### Controller

While it is absolutely possible to template a whole website using only Twig, a custom PHP controller gives many more options of customizing the behavior of the pages.

See [Custom controllers](Content-Rendering_31429679.html#ContentRendering-Customcontrollers) for more information.

# Usage

## Creating a new design using Bundle Inheritance

Due to the fact that eZ Platform is built using the Symfony 2 framework, it is possible to benefit from most of its stock features such as Bundle Inheritance. To learn more about this concept in general, check out the <a href="http://symfony.com/doc/current/cookbook/bundles/override.html">related Symfony documentation</a>.

Bundle Inheritance allows you to customize a template from a parent bundle. This is very convenient when creating a custom design for an already existing piece of code.

The following example shows how to create a customized version of a template from the DemoBundle.

### Creating a bundle

Create a new bundle to host your design using the dedicated command (from your app installation):

``` brush:
php app/console generate:bundle
```

### Configuring bundle to inherit from another

Following the related <a href="http://symfony.com/doc/current/cookbook/bundles/inheritance.html">Symfony documentation</a>, modify your bundle to make it inherit from the "eZDemoBundle". Then copy a template from the DemoBundle in the new bundle, following the same directory structure. Customize this template, clear application caches and reload the page. You custom design should be available.

### Known limitation

If you are experiencing problems with routes not working after adding your bundle, take a look at <a href="https://jira.ez.no/browse/EZP-23575">this issue</a>.

# Reference

## Twig Helper

eZ Platform comes with a Twig helper as a <a href="http://symfony.com/doc/master/cookbook/templating/global_variables.html">global variable</a> named **`ezpublish`** .

This helper is accessible from all Twig templates and allows you to easily retrieve useful information.

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Property</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>ezpublish.siteaccess</code></td>
<td align="left"><p>Returns the current siteaccess.</p></td>
</tr>
<tr class="even">
<td align="left"><code>                 ezpublish.rootLocation               </code></td>
<td align="left">Returns the root Location object</td>
</tr>
<tr class="odd">
<td align="left"><code>ezpublish.requestedUriString</code></td>
<td align="left">Returns the requested URI string (also known as semanticPathInfo).</td>
</tr>
<tr class="even">
<td align="left"><code>ezpublish.systemUriString</code></td>
<td align="left">Returns the &quot;system&quot; URI string. System URI is the URI for internal content controller. If current route is not an URLAlias, then the current Pathinfo is returned.</td>
</tr>
<tr class="odd">
<td align="left"><code>ezpublish.viewParameters</code></td>
<td align="left">Returns the view parameters as a hash.</td>
</tr>
<tr class="even">
<td align="left"><code>ezpublish.viewParametersString</code></td>
<td align="left">Returns the view parameters as a string.</td>
</tr>
<tr class="odd">
<td align="left"><code>ezpublish.legacy</code></td>
<td align="left">Returns legacy information.</td>
</tr>
<tr class="even">
<td align="left"><code>ezpublish.translationSiteAccess</code></td>
<td align="left">Returns the translation SiteAccess for a given language, or null if it cannot be found.</td>
</tr>
<tr class="odd">
<td align="left"><code>ezpublish.availableLanguages</code></td>
<td align="left">Returns the list of available languages.</td>
</tr>
<tr class="even">
<td align="left"><code> ezpublish.configResolver</code></td>
<td align="left">Returns the config resolver.</td>
</tr>
</tbody>
</table>

### Legacy

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
`ezpublish.legacy` is only available **when viewing content in legacy fallback** (e.g. no corresponding Twig templates)

The `ezpublish.legacy` property returns an object of type <a href="http://api.symfony.com/2.8/Symfony/Component/HttpFoundation/ParameterBag.html">ParameterBag</a>, which is a container for key/value pairs, and contains additional properties to retrieve/handle legacy information.

| Property                                                | Description                                                     |
|---------------------------------------------------------|-----------------------------------------------------------------|
| `                 ezpublish.legacy.all               `  | Returns all the parameters, with all the contained information. |
| `                 ezpublish.legacy.keys               ` | Returns the parameter keys only.                                |
| `                 ezpublish.legacy.get               `  | Returns a parameter by name.                                    |
| `                 ezpublish.legacy.has               `  | Returns true if the parameter is defined.                       |

## Listing the available parameters

You can list the available parameters in `ezpublish.legacy` by using the `ezpublish.legacy.keys` property, as shown in the following example:

**Example on retrieving the available parameters under ezpublish.legacy**

``` brush:
{{ dump(ezpublish.legacy.keys()) }}
```

which will give a result similar to:

    array
      0 => string 'view_parameters' (length=15)
      1 => string 'path' (length=4)
      2 => string 'title_path' (length=10)
      3 => string 'section_id' (length=10)
      4 => string 'node_id' (length=7)
      5 => string 'navigation_part' (length=15)
      6 => string 'content_info' (length=12)
      7 => string 'template_list' (length=13)
      8 => string 'cache_ttl' (length=9)
      9 => string 'is_default_navigation_part' (length=26)
      10 => string 'css_files' (length=9)
      11 => string 'js_files' (length=8)
      12 => string 'css_files_configured' (length=20)
      13 => string 'js_files_configured' (length=19)

## Retrieving legacy information

Legacy information is accessible by using the `ezpublish.legacy.get` property, which will allow you to access all data contained in <a href="http://doc.ez.no/eZ-Publish/Technical-manual/4.x/Templates/The-pagelayout/Variables-in-pagelayout#module_result">$module_result</a>, from the legacy kernel.

This allows you to import information directly into twig templates. For more details please check the available examples on using the `ezpublish.legacy.get` property for retrieving <a href="https://confluence.ez.no/display/EZP/Legacy+template+fallback#Legacytemplatefallback-Persistentvariable">persistent variables</a> and <a href="https://confluence.ez.no/display/EZP/Legacy+template+fallback#Legacytemplatefallback-Assets">assets</a>.

As a usage example, if you want to access the legacy information related to 'content\_info' you can do it, as shown in the following example:

**Example on accessing 'content\_info' under ezpublish.legacy**

``` brush:
{{ ezpublish.legacy.get('content_info') }}
```

The previous call will return the contents on the 'content\_info' as an `array`, and if we `dump` it the result will be similar to the following:

    array
      'object_id' => string '57' (length=2)
      'node_id' => string '2' (length=1)
      'parent_node_id' => string '1' (length=1)
      'class_id' => string '23' (length=2)
      'class_identifier' => string 'landing_page' (length=12)
      'remote_id' => string '8a9c9c761004866fb458d89910f52bee' (length=32)
      'node_remote_id' => string 'f3e90596361e31d496d4026eb624c983' (length=32)
      'offset' => boolean false
      'viewmode' => string 'full' (length=4)
      'navigation_part_identifier' => string 'ezcontentnavigationpart' (length=23)
      'node_depth' => string '1' (length=1)
      'url_alias' => string '' (length=0)
      'current_language' => string 'eng-GB' (length=6)
      'language_mask' => string '3' (length=1)
      'main_node_id' => string '2' (length=1)
      'main_node_url_alias' => boolean false
      'persistent_variable' => 
        array
          'css_files' => 
            array
              0 => string 'video.css' (length=9)
          'js_files' => 
            array
              0 => string 'video.js' (length=8)
      'class_group' => boolean false
      'state' => 
        array
          2 => string '1' (length=1)
      'state_identifier' => 
        array
          0 => string 'ez_lock/not_locked' (length=18)
      'parent_class_id' => string '1' (length=1)
      'parent_class_identifier' => string 'folder' (length=6)
      'parent_node_remote_id' => string '629709ba256fe317c3ddcee35453a96a' (length=32)
      'parent_object_remote_id' => string 'e5c9db64baadb82ab8db54f0e2192ec3' (length=32)

Additionally, for retrieving information contained in 'content\_info' such as the current language of the content in the page you can do it like in the following example:

**Example on retrieving 'current\_language'**

``` brush:
{{ ezpublish.legacy.get('content_info')['current_language'] }}
```

#### In this topic:

-   [Introduction](#Design-Introduction)
-   [Configuration](#Design-Configuration)
    -   [Template file](#Design-Templatefile)
        -   [Assets](#Design-Assets)
        -   [Controller](#Design-Controller)
-   [Usage](#Design-Usage)
    -   [Creating a new design using Bundle Inheritance](#Design-CreatinganewdesignusingBundleInheritance)
        -   [Creating a bundle](#Design-Creatingabundle)
        -   [Configuring bundle to inherit from another](#Design-Configuringbundletoinheritfromanother)
        -   [Known limitation](#Design-Knownlimitation)
-   [Reference](#Design-Reference)
    -   [Twig Helper](#Design-TwigHelper)
        -   [Legacy](#Design-Legacy)
    -   [Listing the available parameters](#Design-Listingtheavailableparameters)
    -   [Retrieving legacy information](#Design-Retrievinglegacyinformation)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Community Resources](Community-Resources_31429530.html)</span>
4.  <span>[How to Contribute](How-to-Contribute_31429587.html)</span>

 Developer : Development guidelines 



These are the development/coding guidelines for eZ Platform kernel, they are the same if you intend to write Bundles, hack on eZ Platform itself or create new functionality for or on top of eZ Platform.

Like most <span>development</span> guidelines these aims to improve security, maintainability, performance and readability of our software. They follow industry standards but sometimes extend them to cater specifically to our needs for eZ Platform ecosystem. The next sections will cover all relevant technologies from a high level point of view.

 

## HTTP

eZ Platform is a web software that is reached via HTTP in most cases, out of the box in eZ Platform kernel this is specifically: web (usually HTML) or REST.

We aim to follow the <a href="http://trac.tools.ietf.org/wg/httpbis/trac/wiki#HTTP1.1Deliverables">latest</a> stable HTTP specification, and industry best practice:

-   **Expose our data in a RESTful way**
    -   GET, HEAD, OPTIONS & TRACE methods are <a href="http://tools.ietf.org/html/draft-ietf-httpbis-p2-semantics-21#section-5.2.1">safe</a> (otherwise known as <a href="http://en.wiktionary.org/wiki/nullipotent">nullipotent</a>), as in: should never cause changes to resources (note: things like writing a line in a log file are not considered resource changes)
    -   PUT & DELETE methods are <a href="http://tools.ietf.org/html/draft-ietf-httpbis-p2-semantics-21#section-5.2.2">idempotent</a>, as in multiple identical requests should all have the same result as a single request
    -   GET & HEAD methods should be <a href="http://tools.ietf.org/html/draft-ietf-httpbis-p2-semantics-21#section-5.2.3">cacheable</a> both on client side, server-side and proxies between, as further defined in the HTTP <a href="http://tools.ietf.org/html/draft-ietf-httpbis-p6-cache-21">specification</a>
    -   As PUT is for replacing a resource, we should use <a href="http://tools.ietf.org/html/rfc5789">PATCH</a> in cases where only partial replacement is intended
-   **Authenticated traffic**
    -   Should use HTTPS
-   **Session based traffic**
    -   Should follow recommendations for *Authenticated traffic*
    -   Should use a per user session <a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">CSRF</a> token on all requests using un-safe HTTP methods (POST, PUT, DELETE, PATCH, ...)
    -   Should expire session id, session data and CSRF token on login, logout and session time out, except:
        -   On login session data from previous session id is moved to new session id, keeping for instance shopping basket on login
    -   Should avoid timing attacks by using a random amount of time for login operation
    -   Should never use Session id in URI's. And this feature ("SID") must always be disabled on production servers
-   **Sessions**
    -   Should not be used to store large amounts of data; store data in database and id's in session if needed
    -   Should not store critical data: if user deletes his cookies or closes his browser session data is lost
    -   Should use an ID generated with enough randomness to prevent prediction or brute-force attacks
-   **Cookies (especially session cookies)**
    -   Should never store sensitive data in cookies (only exception is session id in session cookie)
    -   Should always set *Full domain* to avoid <a href="http://en.wikipedia.org/wiki/Session_fixation#Attacks_using_cross-subdomain_cooking">cross-subdomain cooking</a> when on shared domain.
    -   Should set *HttpOnly* flag to reduce risk of attacks such as <a href="http://en.wikipedia.org/wiki/Session_fixation#Attacks_using_cross-site_cooking">cross-site cooking</a> and <a href="http://en.wikipedia.org/wiki/Cross-site_scripting" title="Cross-site scripting">cross-site scripting</a>
    -   Should set *Secure flag* if HTTPS is used (as recommended above)
    -   Must never exceed 4kb
-   **Headers**
    -   Should never include input data from user input or data from database without sanitizing it
-   **Redirects**
    -   Should never take url from user input (example: POST parameter), instead allow identifiers instead that are understood by the backend
-   **User input**
    -   Should always be validated, sanitized, casted and filtered to avoid <a href="http://en.wikipedia.org/wiki/Cross-site_scripting">XSS</a> & <a href="http://en.wikipedia.org/wiki/Clickjacking">c<span style="color: rgb(0,0,0);">lickjacking</span></a><span style="color: rgb(0,0,0);"> </span> attacks
        -   NB: this includes variables in the php supervariable `$_SERVER` as well (e.g. hostname should not be trusted)
-   **User file uploads**
    -   Should follow recommendations for "User input" to validate file name
    -   Should place uploaded files in a non public folder to avoid access to execute uploaded file or in case of assets white list the type
    -   Should be appropriately limited in size to avoid DOS attacks on disk space, cpu usage by antivirus tool etc...
-   **File downloads**
    -   Should not rely on user provided file path for non public files, instead use a synthetic id
-   **Admin operations**
    -   May be placed on a different (sub)domain then the front end website to avoid session stealing across front and backend.
-   **Fully support being placed behind a reverse proxy like <a href="https://www.varnish-cache.org/">Varnish</a>**

## REST

For now see the living <a href="https://github.com/ezsystems/ezp-next/blob/master/doc/specifications/rest/REST-API-V2.rst">REST v2 specification</a> in our git repository for further details.

## UI

eZ Platform is often used as a web content management software, so we always strive to use the HTML/CSS/EcmaScript specifications correctly, and keep new releases up to date on new revisions of those. We furthermore always try to make sure our software gracefully degrades making sure it is useful even on older or less capable web clients (browsers), the industry terms for this approach are:

-   <a href="http://en.wikipedia.org/wiki/Progressive_enhancement" title="Progressive enhancement">Progressive enhancement</a>
-   <a href="http://en.wikipedia.org/wiki/Unobtrusive_JavaScript">Unobtrusive JavaScript</a>
-   <a href="http://en.wikipedia.org/wiki/Responsive_Web_Design" title="Responsive Web Design">Responsive Design</a>

All these terms in general recommends aiming for the minimum standard first, and enhance with additional features/styling if the client is capable of doing so. In essence this allows eZ Platform to be "Mobile first" if the design allows for it, which is recommended. But eZ Platform should always also be fully capable of having different sets of web presentations for different devices using one or several sets of SiteAccess matching rules for the domain, port or URI, so any kind of device detection can be used together with eZ Platform, making it fully possible to write for instance <a href="http://en.wikipedia.org/wiki/Wireless_Application_Protocol">WAP</a> based websites and interfaces on top of eZ Platform.

### WEB Forms/Ajax

As stated in the HTTP section, all unsafe requests to the web server should have a CSRF token to protect against attacks; this includes web forms and ajax requests that don't use the GET http method. As also stated in the HTTP section and further defined in the PHP section, User input should always be validated to avoid XSS issues.

### HTML/Templates

All data that comes from backend and in return comes from user input should always be escaped, in case of Twig templates this done by default, but in case of PHP templates, Ajax and other not Twig based output this must be handled manually.

Output escaping must be properly executed according to the desired format, eg. javascript vs. html, but also taking into account the correct character set (see eg. output escaping fallacy when not specifying charset encoding in <a href="http://www.php.net/htmlspecialchars">htmlspecialchars</a>)

### Admin

Admin operations that can have a severe impact on the web applications should require providing password and require it again after some time has gone, normally 10 - 20 minutes, on all session based interfaces.

&lt;TODO: Add more coding guidelines for HTML (XHTML5), Javascript, CSS and templates&gt;

## PHP

For now see our comprehensive coding standard & guidelines <a href="https://github.com/ezsystems/ezpublish-kernel/wiki/codingstandards">wiki page</a> on github.

eZ Coding Standards Tools

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
See also <a href="http://eZ%20Coding%20Standard%20tools">eZ Coding Standards Tools</a> repository to get the configuration files for your favorite tools.

### Public API

The PHP Public API provided in eZ Platform is in most cases in charge of checking permissions to data for you, but some API's are not documented to throw UnauthorizedException, which means that it is the consumer of the API's who is responsible for checking permissions.

The following example shows how this is done in the case of loading users:

**loadUser()**

``` brush:
// Get a user
$userId = (int)$params['id'];
$userService = $repository->getUserService();
$user = $userService->loadUser( $userId );

// Now check that current user has access to read this user
if ( !$repository->canUser( 'content', 'read', $user ) )
{
    // Generates message: User does not have access to 'content' 'read' with id '10'
    throw new \eZ\Publish\Core\Base\Exceptions\UnauthorizedException( 'content', 'read', array( 'id' => $userId ) );
}
```

### Command line

Output must always be escaped when displaying data from the database.

*&lt;TODO: Expand on how best practice is to handle user input in eZ Platform to avoid XSS issues&gt;*

## Data & Databases

-   Values coming from variables should always be appropriately quoted or binded in SQL statements
-   The SQL statements used should never be created by hand with one version per supported database, as this increases both the maintenance load and the chances for security-related problems
-   Usage of temporary tables is discouraged, as their behaviour is very different on different databases. Subselects should be prefererred (esp. since recent mysql versions have much better support for them)
-   Full table locking is discouraged

*&lt;TODO: guidelines for how data should be stored for maximum portability (hint: XML & abstraction)&gt;*

### Sessions

-   Business logic should not depend on database connections being either persistent or not persistent
-   The connection to the database should always be opened as late as possible during page execution. Ideally, to improve scalability, a web page executing no queries should not connect to the db at all (note that closing the db connection as soon as possible is a tricky problem, as we expect to support persistent db connections as well for absolute best performances)
-   The same principle applies to configurations where a master/slave db setup is in use: the chance for a failure due to a database malfunction should not increase with the number of db servers at play, but actually decrease
-   It is recommended to avoid as much as possible statements which alter the current session, as they slow down the application, are brittle and hard to debug.
    Point in case; if a db session locks a table then is abruptly terminated, the table might stay locked for a long time

### Transactions

-   Transactions should always be used to wrap sql statements which affect data in multiple tables: either all data changes go through or none of them
-   Transactions are prone to locking issues, so the code executed within a transaction should be limited to the minimum necessary amount (ex. clearing caches should be done after the transaction is committed)
-   When using transactions, always consider side effects on external system, such as on-disk storage. F.e. is a transaction relative to creating an image variation is rolled back, the corresponding file should not be left on disk
-   Nested transactions are supported in the following way:
    -   a transaction within another one will not commit when requested, only the outhermost transaction will commit
    -   a transaction within another one will roll back all the way to the start of the outhermost transaction when requested
    -   as a result a transaction shall never be rolled back just as a means of cancelling its work - the side effect might be of cancelling other work which had just been done previously

### Limitations in the SQL dialect supported

Striving to support Mysql 5, PostgreSQL xx and Oracle 10, the following limitations apply:

-   Tables, columns and other db objects should not use names longer than 30 chars
-   Varchar columns with a definition of *default "" not null* are discouraged
-   For SELECTs, offset and limit have to be handled by the php layer, not hardcoded in the sql
-   Never treat a NULL varchar value as semantically different from an empty string value
-   The select list of a query cannot contain the same field multiple times
-   For GROUP BY statements, all fields in the group by clause should be in the select list as well
-   For SELECTs, usage of the AS token is allowed in the select list, but not in the list of tables
-   Do not put quotes around numeric values (use proper casting/escaping to avoid SQL injection)
-   *&lt;TODO: finish sql guidelines&gt;*

 

#### In this topic:

-   [HTTP](#Developmentguidelines-HTTP)
-   [REST](#Developmentguidelines-REST)
-   [UI](#Developmentguidelines-UI)
    -   [WEB Forms/Ajax](#Developmentguidelines-WEBForms/Ajax)
    -   [HTML/Templates](#Developmentguidelines-HTML/Templates)
    -   [Admin](#Developmentguidelines-Admin)
-   [PHP](#Developmentguidelines-PHP)
    -   [Public API](#Developmentguidelines-PublicAPI)
    -   [Command line](#Developmentguidelines-Commandline)
-   [Data & Databases](#Developmentguidelines-Data&Databases)
    -   [Sessions](#Developmentguidelines-Sessions)
    -   [Transactions](#Developmentguidelines-Transactions)
    -   [Limitations in the SQL dialect supported](#Developmentguidelines-LimitationsintheSQLdialectsupported)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : Devops 



# Introduction

## Cache Clearing

This page describes commands involved in clearing cache from the command line.

### Clearing file cache using the Symfony cache:clear command

Out of the box Symfony provides a command to perform cache clearing. It will delete all file-based caches, which mainly consist of Twig template, Symfony container, and Symfony route cache, but also everything else stored in cache folder. Out of the box on a single-server setup this includes "Content cache". For further information on use, see the help text of the command:

``` brush:
php app/console --env=prod cache:clear -h
```

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
If you do not specify an environment, by default `cache:clear` will clear the cache for the `dev` environment. If you want to clear it for `prod` you need to to use the --env=prod option.

On each web server

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
In [Clustering](Clustering_31430387.html) setup *(several web servers),* the command to clear file cache needs to be executed on each and every web server!

### Clearing "Content Cache" on a Cluster setup

For [Cluster](Clustering_31430387.html) setup, the content cache ([<span class="confluence-link">HTTP Cache</span>](HTTP-Cache_31430152.html) <span class="confluence-link"> </span> and [Persistent Cache](Repository_31432023.html#Repository-PersistenceCache)) must be set up to be shared among the servers. And while all relevant cache is cleared for you on repository changes when using the APIs, there might be times where you'll need to clear cache manually: 

-   Varnish: [Cache purge](https://doc.ez.no/display/DEVELOPER/HTTP+Cache#HTTPCache-CachePurge)
-   Persistence Cache: [Using Cache service](Repository_31432023.html#Repository-UsingCacheService)

## Web Debug Toolbar

When running eZ Platform in the `dev` environment you have access to the standard Symfony Web Debug Toolbar. It is extended with some eZ Platform-specific information:

<span class="confluence-embedded-file-wrapper"><img src="attachments/31432029/32868731.png" title="eZ Platform info in Web Debug Toolbar" alt="eZ Platform info in Web Debug Toolbar" class="confluence-embedded-image" /></span>

#### SPI (persistence)

This section provides the number of non-cached [SPI](Repository_31432023.html#Repository-SPI)calls and handlers. You can see details of these calls in the <a href="http://symfony.com/doc/current/profiler.html">Symfony Profiler</a> page.

#### Site Access

Here you can see the name of the current Siteaccess and how it was matched. For reference see the [list of possible siteaccess matchers](SiteAccess_31429665.html#SiteAccess-Availablematchers).

# Configuration

## Logging and Debug Configuration

### Introduction

Logging in eZ Platform consists of two parts, several debug systems that integrates with symfony developer toolbar to give you detailed information about what is going on. And standard <a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-3-logger-interface.md">PSR-3</a> logger, as provided by Symfony using <a href="https://github.com/Seldaek/monolog">Monolog</a>.

### Debugging in dev environment

When using the Symfony dev [<span class="confluence-link">environment</span>](Environments_31429669.html), the system out of the box tracks additional metrics for you to be able to debug issues, this includes <a href="http://stash.tedivm.com/">Stash</a> cache use *(done by <a href="https://github.com/tedivm/TedivmStashBundle">StashBundle</a>)*, and a [persistence cache](Repository_31432023.html#Repository-Persistencecacheconfiguration) use.

#### Reducing memory use

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
For long running scripts, instead head over to [Executing long-running console commands](Executing-long-running-console-commands_31429811.html) for some much more relevant info.

If you are running out of memory and don't need to keep track of cache hits and misses. Then StashBundle tracking, represented by the `stash.tracking` setting, and persistence cache logging, represented by the setting `parameters.ezpublish.spi.persistence.cache.persistenceLogger.enableCallLogging`, can optionally be disabled.

 

**config\_dev.yml**

``` brush:
stash:
    tracking: false                  # Default is true in dev
    tracking_values: false           # Default is false in dev, to only track cache keys not values
    caches:
        default:
            inMemory: false          # Default is true
            registerDoctrineAdapter: false

parameters:
    ezpublish.spi.persistence.cache.persistenceLogger.enableCallLogging: false
```

### Error logging and rotation

eZ Platform uses the Monolog component to log errors, and it has a `RotatingFileHandler` that allows for file rotation.

According to their documentation, it "logs records to a file and creates one logfile per day. It will also delete files older than `$maxFiles`".

But then, their own recommendation is to use "`logrotate`" instead of doing the rotation in the handler as you would have better performance.

 

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
More details here:

-   <a href="https://github.com/Seldaek/monolog" class="uri">https://github.com/Seldaek/monolog</a>
-   <a href="http://linuxcommand.org/man_pages/logrotate8.html" class="uri">http://linuxcommand.org/man_pages/logrotate8.html</a>

 

If you decided to use Monolog's handler, it can be configured in `app/config/config.yml`

``` brush:
monolog:
    handlers:
        main:
            type: rotating_file
            max_files: 10
            path: "%kernel.logs_dir%/%kernel.environment%.log"
            level: debug
```

#### In this topic:

-   [Introduction](#Devops-Introduction)
    -   [Cache Clearing](#Devops-CacheClearing)
        -   [Clearing file cache using the Symfony cache:clear command](#Devops-ClearingfilecacheusingtheSymfonycache:clearcommand)
        -   [Clearing "Content Cache" on a Cluster setup](#Devops-Clearing%22ContentCache%22onaClustersetup)
    -   [Web Debug Toolbar](#Devops-WebDebugToolbar)
-   [Configuration](#Devops-Configuration)
    -   [Logging and Debug Configuration](#Devops-LoggingandDebugConfiguration)
        -   [Introduction](#Devops-Introduction.1)
        -   [Debugging in dev environment](#Devops-Debuggingindevenvironment)
        -   [Error logging and rotation](#Devops-Errorloggingandrotation)

## Attachments:

<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [webdebugtoolbar.png](attachments/31432029/32868731.png) (image/png)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>
4.  <span>[Building a Bicycle Route Tracker in eZ Platform](Building-a-Bicycle-Route-Tracker-in-eZ-Platform_31431606.html)</span>
5.  <span>[Part 1: Setting up eZ Platform](31431610.html)</span>
6.  <span>[Step 2 - Create your content model](Step-2---Create-your-content-model_31431844.html)</span>

 Developer : Diagram for step2 



<span id="diagramly-reader-32868750-2559151311003325400" class="drawio-viewer" style="position : relative; display : inline-block; max-width : 100%;"> <span id="diagramly-reader-content-32868750-2559151311003325400" class="diagramly-content" style="position : relative; display : inline-block"></span> </span>

## Attachments:

<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [Ride\_Point\_of\_interest\_relation](attachments/32868756/32868752) (application/drawio)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [Ride\_Point\_of\_interest\_relation.png](attachments/32868756/32868753.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [Ride\_Point\_of\_interest\_relation](attachments/32868756/32868754) (application/drawio)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [Ride\_Point\_of\_interest\_relation.png](attachments/32868756/32868755.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [Ride\_Point\_of\_interest\_relation](attachments/32868756/32868750) (application/drawio)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [Ride\_Point\_of\_interest\_relation.png](attachments/32868756/32868751.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [Copy of Ride\_Point\_of\_interest\_relation](attachments/32868756/32868759) (application/drawio)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [Copy of Ride\_Point\_of\_interest\_relation.png](attachments/32868756/32868760.png) (image/png)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Cookbook](Cookbook_31429528.html)</span>

 Developer : Displaying children of a Content item 



# Description

One of the basic design tasks you may need to complete when creating your website is configuring one page to display all of its children. Examples are having a blog display blog posts, of a folder that shows <span class="inline-comment-marker" data-ref="77916aad-aa82-477b-b486-5ee37dce91c4">all articles it contains</span>.

# Solution

There are two ways to make a Content item display it<span class="inline-comment-marker" data-ref="fdef209c-770f-4509-8e54-32c81610e3c0">s childre</span>n:

1.  [Using a Custom Controller](#DisplayingchildrenofaContentitem-UsingaCustomController)
2.  [Using the Query Controller](#DisplayingchildrenofaContentitem-UsingtheQueryController)

This recipe will show how to use both those methods to display all children of a Content item with the Content Type Folder.

## Using a Custom Controller

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
There are three different ways of using a Custom Controller that you can learn about in the [Custom Controller page](https://doc.ez.no/display/DEVELOPER/Content+Rendering#ContentRendering-Customcontrollers). In this case we will be applying the first of these, that is using the Custom Controller alongside the built-in ViewController.

Configuring for the use of a C<span class="inline-comment-marker" data-ref="ea02127a-ca1a-499b-9218-ffff81810087">ustom Controller starts w</span>ith pointing to it in your standard view <span class="inline-comment-marker" data-ref="38edeeb0-0932-49ef-99b3-a33f0f662169">configuration</span> (which you can keep in `ezplatform.yml` or a separate file, for example `views.yml`):

``` brush:
folder:
    controller: app.controller.folder:showAction
    template: "full/folder.html.twig"
    match:
        Identifier\ContentType: "folder"
```

Besides the standard view config, under the `controller` key you need to provide here the path to the Controller and the action. They are defined in the following file:

**AppBundle/Controller/FolderController.php**

``` brush:
<?php

namespace AppBundle\Controller;

use eZ\Publish\API\Repository\ContentService;
use eZ\Publish\API\Repository\LocationService;
use eZ\Publish\API\Repository\SearchService;
use eZ\Publish\API\Repository\Values\Content\Query;
use eZ\Publish\API\Repository\Values\Content\Query\SortClause;
use eZ\Publish\Core\MVC\ConfigResolverInterface;
use eZ\Publish\Core\MVC\Symfony\View\ContentView;
use AppBundle\Criteria\Children;

class FolderController {

    /** @var \eZ\Publish\API\Repository\SearchService */
    protected $searchService;

    /** @var \eZ\Publish\Core\MVC\ConfigResolverInterface */
    protected $configResolver;

    /** @var \AppBundle\Criteria\Children */
    protected $childrenCriteria;

    /**
     * @param \eZ\Publish\API\Repository\SearchService $searchService
     * @param \eZ\Publish\Core\MVC\ConfigResolverInterface $configResolver
     * @param \AppBundle\Criteria\Children $childrenCriteria
     */
    public function __construct(
        SearchService $searchService,
        ConfigResolverInterface $configResolver,
        Children $childrenCriteria
    ) {
        $this->searchService = $searchService;
        $this->configResolver = $configResolver;
        $this->childrenCriteria = $childrenCriteria;
    }

    /**
     * Displays blog posts and gallery images on home page.
     *
     * @param \eZ\Publish\Core\MVC\Symfony\View\ContentView $view
     *
     * @return \eZ\Publish\Core\MVC\Symfony\View\ContentView
     */
    public function showAction(ContentView $view)
    {
        $view->addParameters([
            //'content' => $this->contentService->loadContentByContentInfo($view->getLocation()->getContentInfo()),
            'items' => $this->fetchItems($view->getLocation(), 25),
        ]);
        return $view;
    }

    private function fetchItems($location, $limit)
    {
        $languages = $this->configResolver->getParameter('languages');
        $query = new Query();
        //$location = $this->locationService->loadLocation($locationId);

    $query->query = $this->childrenCriteria->generateChildCriterion($location, $languages);
        $query->performCount = false;
        $query->limit = $limit;
        $query->sortClauses = [
            new SortClause\DatePublished(Query::SORT_DESC),
        ];
        $results = $this->searchService->findContent($query);
        $items = [];
        foreach ($results->searchHits as $item) {
            $items[] = $item->valueObject;
        }
        return $items;
    }

}
```

As you can see, this Controller makes use of the `generateChildCriterion`, which means you need to provide a file containing this function:

**AppBundle/Criteria/Children.php**

``` brush:
<?php

namespace AppBundle\Criteria;

use eZ\Publish\API\Repository\Values\Content\Location;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion;

class Children
{
    /**
     * Generate criterion list to be used to fetch sub-items.
     *
     * @param \eZ\Publish\API\Repository\Values\Content\Location $location location of the root
     * @param string[] $languages array of languages
     *
     * @return \eZ\Publish\API\Repository\Values\Content\Query\Criterion
     */
    public function generateChildCriterion(Location $location, array $languages = [])
    {
        return new Criterion\LogicalAnd([
            new Criterion\Visibility(Criterion\Visibility::VISIBLE),
            new Criterion\ParentLocationId($location->id),
            new Criterion\Subtree($location->pathString),
            new Criterion\LanguageCode($languages),
        ]);
    }
}
```

Next, you must register these two services:

**AppBundle/Resources/config/services.yml**

``` brush:
services:

    app.criteria.children:
        class: AppBundle\Criteria\Children

    app.controller.folder:
        class: AppBundle\Controller\FolderController
        arguments:
            - '@ezpublish.api.service.search'
            - '@ezpublish.config.resolver'
            - '@app.criteria.children'
```

Finally, let's use the Controller in a template:

**app/Resources/views/full/folder.html.twig**

``` brush:
<h1>{{ ez_content_name(content) }}</h1>

{% for item in items %}
  <h2>{{ ez_content_name(item) }}</h2>
{% endfor %}
```

This template makes use of the `items` specified in the Controller file to list every child of the folder.

## Using the Query Controller

The Query Controller is a predefined custom content view Controller that runs a Repository Query.

If you need to create a simple query it's easier to use the Query Controller than to build a completely custom one, as you will not have to write custom PHP code. Like with a Custom Controller, however, you will be able to use properties of the viewed Content or Location as parameters.

The main file in this case is a `LocationChildrenQueryType.php` file which generates a Query that retrieves the children of the current Location.

**AppBundle/QueryType/LocationChildrenQueryType.php**

``` brush:
<?php
namespace AppBundle\QueryType;

use eZ\Publish\API\Repository\Values\Content\LocationQuery;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion\ParentLocationId;
use eZ\Publish\Core\QueryType\QueryType;

class LocationChildrenQueryType implements QueryType
{
    public function getQuery(array $parameters = [])
    {
        return new LocationQuery([
            'filter' => new ParentLocationId($parameters['parentLocationId']),
        ]);
    }

    public function getSupportedParameters()
    {
        return ['parentLocationId'];
    }
//
    public static function getName()
    //
        return 'LocationChildren';
    }
}
```

Next, in your standard view configuration file include a block that indicates when this Controller will be used. It is similar to regular view config, but contains additional information:

``` brush:
folder:
    controller: "ez_query:locationQueryAction"
    template: "full/folder.html.twig"
    match:
        Identifier\ContentType: "folder"
    params:
        query:
            query_type: 'LocationChildren'
            parameters:
                parentLocationId: "@=location.id"
            assign_results_to: 'items'
```

In this case the `controller` key points to the Query Controller's `locationQuery` action. `assign_results_to` identifies the parameter containing all the retrieved children that will later be used in the templates:

**app/Resources/views/full/folder.html.twig**

``` brush:
<h1>{{ ez_content_name(content) }}</h1>

{% for item in items.searchHits %}
  <h2>{{ ez_content_name(item.valueObject.contentInfo) }}</h2>
{% endfor %}
```

This template makes use of the `items` specified in `assign_results_to` to list every child of the folder.

#### In this topic:

-   [Description](#DisplayingchildrenofaContentitem-Description)
-   [Solution](#DisplayingchildrenofaContentitem-Solution)
    -   [Using a Custom Controller](#DisplayingchildrenofaContentitem-UsingaCustomController)
    -   [Using the Query Controller](#DisplayingchildrenofaContentitem-UsingtheQueryController)

#### Related topics:

[Custom Controller](https://doc.ez.no/display/DEVELOPER/Content+Rendering#ContentRendering-Customcontrollers)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Cookbook](Cookbook_31429528.html)</span>

 Developer : Displaying content with simple templates 



This page describes basic steps needed to render content on a page.

# Rendering a full page

By default (without any configuration), a Content item will be rendered without any template. In your config you can tell the app to render it using different templates depending on the situation. Templates are written in the Twig templating language.

Let's create a very simple template that you will use to render an article:

**article.html.twig**

``` brush:
<div>
    {# 'ez_render_field' is one of the available Twig functions.
    It will render the 'body' Field of the current 'content' #}
    {{ ez_render_field(content, 'body') }}
</div>
```

Place this file in the `app/Resources/views` folder.

Now you need a config that will decide when this template is used.

You can place the config in the `app/config` folder in either of two places: a separate file or the preexisting `ezplatform.yml`. In this case you'll use the latter.

In `ezplatform.yml` under the `ezpublish` and `system` keys add the following config (pay attention to indentation. `default` should be indented relative to `system`):

``` brush:
# 'default' is the siteaccess.
default:
    # 'content_view' indicates that we will be defining view configuration.
    content_view:
        # 'full' is the type of view to use. We'll talk about defining other view types below.
        full:
            # Here starts the entry for our view. You can give it any name you want, as long as it is unique.
            article:
                # This is the path to the template file, relative to the 'app/Resources/views' folder.
                template: full\article.html.twig
                # This identifies the situations when the template will be used.
                match:
                    # The template will be used when the Content Type of the content is 'article'.
                    Identifier\ContentType: [article]
```

In the `match` section you can use different ways to identify the situation where the template will be used, not only the Content Type, see [<span class="confluence-link">Matchers</span>](Content-Rendering_31429679.html#ContentRendering-Matchers).

At this point all Articles should render using the new template. If you do not see changes, clear the cache (`php app/console cache:clear`).

# Rendering page elements

In the example above you used the `ez_render_field` Twig function to render the 'body' Field of the content item. Of course each Content item can have multiple fields and you can render them in different ways in the template. Other Twig functions let you access other properties of your content. To see an example, let's extend the template a bit:

**article.html.twig**

``` brush:
{# This renders the Content name of the article #}
<h1>{{ ez_content_name(content) }}</h1>
<div>
    {# Here you add a rendering of a different Field, 'intro' #}
    <b>{{ ez_render_field(content, 'intro') }}</b>
</div>    
<div>
    {{ ez_render_field(content, 'body') }}
</div>
```

You can also make use of different other [Twig functions](Twig-Functions-Reference_32114025.html), for example [ez\_field\_value](ez_field_value_32114035.html), which renders the value of the Field without a template.

# Different views

Besides the `full` view type you can create many other view types. They can be used for example when rendering children of a folder of when embedding one Content item in another. See <span class="confluence-link"><span class="confluence-link"><span class="confluence-link"><span class="confluence-link">[Content Rendering](Content-Rendering_31429679.html#ContentRendering-Renderembeddedcontentitems)</span></span></span></span>.

# Listing children

To see how to list children of a Content item, for example all content contained in a folder, see [Displaying children of a Content item](Displaying-children-of-a-Content-item_32868706.html)

# Adding links

To add links to your templates you use the `ez_urlalias` path. To see how it works, let's add one more line to the template:

**article.html.twig**

``` brush:
<h1>{{ ez_content_name(content) }}</h1>
{# The link points to the content in Location ID 2, which is the Home Content item #}
<a href="{{ path('ez_urlalias', {locationId: 2}) }}">Back</a>
<div>
{# ... #}
```

Instead of pointing to a specific content by its Location ID you can of course also use here a variable, see <a href="https://github.com/ezsystems/ezplatform-demo/blob/e15b93ade4b8c1f9084c5adac51239d239f9f7d8/app/Resources/views/full/blog.html.twig#L25">this example in the Demo Bundle</a>.

#### In this topic:

-   [Rendering a full page](#Displayingcontentwithsimpletemplates-Renderingafullpage)
-   [Rendering page elements](#Displayingcontentwithsimpletemplates-Renderingpageelements)
-   [Different views](#Displayingcontentwithsimpletemplates-Differentviews)
-   [Listing children](#Displayingcontentwithsimpletemplates-Listingchildren)
-   [Adding links](#Displayingcontentwithsimpletemplates-Addinglinks)

#### Related topics:

[Content Rendering](Content-Rendering_31429679.html)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : Docker Tools 



Beta

<span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
Instructions and Tools *(docker images, Dockerfile, .env file, docker-compose files, scripts, etc.)* described on this page are currently in Beta for community testing & contribution, and might change without notice.

 

> Docker allows you to package an application with all of its dependencies into a standardized unit for software development. – Docker.com

Using Docker images, we can package up all the executables, dependencies, and files required to run eZ Platform. We're in the process of preparing images for public use, and you can follow along on related epic tracking this  <span class="jira-issue resolved"> <a href="https://jira.ez.no/browse/EZP-25665?src=confmacro" class="jira-issue-key"><img src="https://jira.ez.no/images/icons/issuetypes/epic.png" class="icon" />EZP-25665</a> - <span class="summary">Docker-Tools / deployment M1 - beta</span> <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-success jira-macro-single-issue-export-pdf">Closed</span> </span>

*What is described on this page has gone through several iterations to try to become as simple as possible. It uses plain Docker and Docker Compose to avoid having to learn anything specific with these tools, and it uses official docker images to take advantage of continued innovation by Docker Inc. and the ecosystem. We will expand on these tools as both images, and Docker itself, matures. *

If you would like to join our efforts *(development, documentation, feedback, and/or testing)*, <a href="http://ez-community-on-slack.herokuapp.com/">sign up</a> for our <a href="http://ezcommunity.slack.com">Community Slack</a> and join the conversation in the **\#docker-tools** channel.

### Demo usage

Project use

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
For usage with your own project based on eZ Platform or eZ Enterprise starting with v1.4.0 you'll find documentation for project use in `doc/docker-compose/README.md`.

What follows below is instructions for setting up a simple single-server instance of eZ Platform demo using Docker. This is here shown on your own machine, however using <a href="https://docs.docker.com/machine/">Docker Machine</a> you may point this to a variety of servers and services.

Note: For running Docker in production you'll need to handle a few more things we are not covering here yet, some of which are:

-   Handling persistence, both database and web/var files
-   Ideally also scale out to offer redundancy, and for that use memcached/redis and Varnish in front
-   Handle health of containers and configure setup if something goes down
-   ...

<span><span style="color: rgb(255,0,0);">INTERNAL</span> Work in progress, need to move entrypoint so it can be loaded.</span>

<span>
</span>

<span>First place the two files below in a empty folder:</span>

**.env**

``` brush:
SYMFONY_ENV=prod
SYMFONY_DEBUG=0
DATABASE_USER=ezp
DATABASE_PASSWORD=SetYourOwnPassword
DATABASE_NAME=ezp
```

**docker-compose.yml**

``` brush:
version: '2'

services:
  app:
    image: ezsystems/ezplatform-demo:latest
    depends_on:
     - db
    environment:
     - SYMFONY_ENV
     - SYMFONY_DEBUG
     - DATABASE_USER
     - DATABASE_PASSWORD
     - DATABASE_NAME
     - DATABASE_HOST=db

  web:
    image: nginx:stable
    volumes_from:
     - app:ro
    ports:
     - "8080:80"
    environment:
     - SYMFONY_ENV
     - MAX_BODY_SIZE=20
     - FASTCGI_PASS=app:9000
     - TIMEOUT=190
     - DOCKER0NET
    command: /bin/bash -c "cd /var/www && cp -a doc/nginx/ez_params.d /etc/nginx && bin/vhost.sh --template-file=doc/nginx/vhost.template > /etc/nginx/conf.d/default.conf && nginx -g 'daemon off;'"

  db:
    image: mariadb:10.0
    #volumes:
    # - ./entrypoint/mysql:/docker-entrypoint-initdb.d/:ro
    environment:
     - MYSQL_RANDOM_ROOT_PASSWORD=1
     - MYSQL_USER=$DATABASE_USER
     - MYSQL_PASSWORD=$DATABASE_PASSWORD
     - MYSQL_DATABASE=$DATABASE_NAME
     - TERM=dumb
 
```

 

Then execute:

``` brush:
# If you have used same terminal for testing docker already, then first: unset COMPOSE_FILE SYMFONY_ENV SYMFONY_DEBUG
 
docker-compose up -d --force-recreate

docker-compose exec --user www-data app /bin/sh -c "php /scripts/wait_for_db.php; php app/console ezplatform:install demo"
```

App should now be up on localhost:8080

 
 

### Known issues

Incomplete list of known bugs:

|                                                                |                                                                                                                                   |
|----------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------|
| <span class="jim-table-header-content">Key</span>              | <span class="jim-table-header-content">Summary</span>                                                                             |
| [EZP-25869](https://jira.ez.no/browse/EZP-25869?src=confmacro) | [Docker containers has extremely slow IO on Mac/Windows under development use](https://jira.ez.no/browse/EZP-25869?src=confmacro) |
| [EZP-26286](https://jira.ez.no/browse/EZP-26286?src=confmacro) | [\[Insight\] YAML files should not contain syntax error](https://jira.ez.no/browse/EZP-26286?src=confmacro)                       |

<span id="total-issues-count-1246250676"> [2 issues](https://jira.ez.no/secure/IssueNavigator.jspa?reset=true&jqlQuery=component%3D%22Deployment+%3E+Docker+Containers%22+AND+issuetype%3DBug+AND+Resolution+is+Empty+ORDER+BY+priority+++&src=confmacro "View all matching issues in JIRA.") </span>

 

#### Related:

-   Documentation:
    -   ~~[Installation Using Docker](Installation-Using-Docker_32113397.html)~~
-   Docker images:
    -   <a href="https://hub.docker.com/r/ezsystems/php/">ezsystems/php</a>
    -   ezsystems/ezplatform-demo

 

<span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img src="attachments/32113421/32113469.png" class="confluence-embedded-image confluence-thumbnail image-center" height="150" /></span>






1.  <span>[Developer](index.html)</span>

# <img src="images/icons/contenttypes/home_page_16.png" alt="Home Page" width="16" height="16" /> <span id="title-text"> Developer : Documentation </span>



## Welcome to the eZ Platform Developer documentation!

 

This is the center for eZ Platform documentation for developers and system administrators. Here you'll find information about installing, administrating, managing, customizing and extending eZ Platform. The latest version is <a href="https://ezplatform.com/">v1.8.0</a> ([Release Notes](eZ-Platform-v1.8.0_33555269.html)), available on the eZ Developer Hub: <a href="https://ezplatform.com/" class="uri">https://ezplatform.com/</a>

 

**<span class="confluence-embedded-file-wrapper image-left-wrapper"><img src="attachments/31429504/31431962.png" class="confluence-embedded-image image-left" /></span>New to eZ Platform?**

**See [Get Started with eZ Platform
](Get-Started-with-eZ-Platform_31429520.html)**

**<span class="confluence-embedded-file-wrapper image-left-wrapper"><img src="attachments/31429504/31431964.png" class="confluence-embedded-image image-left" /></span>Looking for reference?**

**Read about the [API](API_31429524.html)**

**<span class="confluence-embedded-file-wrapper image-left-wrapper"><img src="attachments/31429504/31431965.png" class="confluence-embedded-image image-left" /></span>Need a specific recipe?**

**Browse the [Cookbook](Cookbook_31429528.html)**

**<span class="confluence-embedded-file-wrapper image-left-wrapper"><img src="attachments/31429504/31431967.png" class="confluence-embedded-image image-left" /></span>Curious about switching to eZ Platform?**

**Check out [Migrating to eZ Platform - Follow the Ibex!](31429532.html)**

**Ready to learn?<span class="confluence-embedded-file-wrapper image-right-wrapper"><img src="attachments/31429504/31431968.png" class="confluence-embedded-image image-right" /></span>
**

**Take a look at the [Tutorials](Tutorials_31429522.html)**

**Want an overview of the system?<span class="confluence-embedded-file-wrapper image-right-wrapper"><img src="attachments/31429504/31431969.png" class="confluence-embedded-image image-right" /></span>**

**Read [The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)**

**Want to get involved?<span class="confluence-embedded-file-wrapper image-right-wrapper"><img src="attachments/31429504/31431970.png" class="confluence-embedded-image image-right" /></span>**

**Check out the** **[Community Resources](Community-Resources_31429530.html)**

**Need Release Notes & older versions?<span class="confluence-embedded-file-wrapper image-right-wrapper"><img src="attachments/31429504/31431971.png" class="confluence-embedded-image image-right" /></span>**

**See** **[Releases](Releases_31429534.html)**

 

 

 

 

 

<span class="aui-icon aui-icon-small aui-iconfont-search">Search</span>

 

Not a developer?

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Take a look at our [user documentation for editors and content managers](https://doc.ez.no/display/USER/Documentation).

 

 

## Attachments:

<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [get started.png](attachments/31429504/31431962.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [api.png](attachments/31429504/31431964.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [cookbook.png](attachments/31429504/31431966.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [cookbook.png](attachments/31429504/31431965.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [migrating.png](attachments/31429504/31431967.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [tutorials.png](attachments/31429504/31431968.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [hitchhiker.png](attachments/31429504/31431969.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [community.png](attachments/31429504/31431970.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [previous versions.png](attachments/31429504/31431971.png) (image/png)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Search](Search_31429673.html)</span>
5.  <span>[Search Engines](Search-Engines_32112955.html)</span>

 Developer : ElasticSearch Bundle 



<span class="status-macro aui-lozenge aui-lozenge-error">EXPERIMENTAL</span>

<span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
ElasticSearch exists only as a technology preview, we welcome people to try it and help make it better. The latest version is only available in "dev-master" version of eZ Platform, and not in any version of eZ Publish Platform 5.x.

Given it is experimental, it is currently not professionally supported

 

## How to use ElasticSearch Search engine

### Step 1: Enabling Bundle

First, activate the Elasticsearch Search Engine Bundle (eZ\\Bundle\\EzPublishElasticsearchSearchEngineBundle\\EzPublishElasticsearchSearchEngineBundle) in your `app/AppKernel.php` class file.

### Step 2: Configuring Bundle

Then configure your search engine in config.yml

Example:

 

**config.yml**

``` brush:
ez_search_engine_elasticsearch:
    default_connection: es_connection_name
    connections:
        es_connection_name:
            server: http://localhost:9200
            index_name: ezpublish
            document_type_name:
                content: content
                location: location
```

 

For further information on the ElasticSearch integration in eZ Platform, find the default <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Publish/Core/Search/Elasticsearch/Content/Resources/elasticsearch.yml">configuration</a> and <a href="https://github.com/ezsystems/ezpublish-kernel/tree/master/eZ/Publish/Core/Search/Elasticsearch/Content/Resources/mappings">mappings</a> for Content and Location type documents *(Note: Content/Location modeling will most likely be simplified in the future, like in the Solr search engine bundle)*.

 

### Step 3: Configuring repository

<span style="line-height: 1.4285715;">The following is an example of configuring the ElasticSearch Search Engine, where the `connection` name is same as in example above, and engine is set to be </span> `elasticsearch`:

 

 

**ezplatform.yml**

``` brush:
ezpublish:
    repositories:
        main:
            storage:
                engine: legacy
                connection: default
            search:
                engine: elasticsearch
                connection: es_connection_name
```

 

### Step 4: Run CLI indexing command

Last step is to execute initial indexation of data:

``` brush:
php app/console ezplatform:elasticsearch_create_index
```

 

 

#### In this topic:

-   [How to use ElasticSearch Search engine](#ElasticSearchBundle-HowtouseElasticSearchSearchengine)
    -   [Step 1: Enabling Bundle](#ElasticSearchBundle-Step1:EnablingBundle)
    -   [Step 2: Configuring Bundle](#ElasticSearchBundle-Step2:ConfiguringBundle)
    -   [Step 3: Configuring repository](#ElasticSearchBundle-Step3:Configuringrepository)
    -   [Step 4: Run CLI indexing command](#ElasticSearchBundle-Step4:RunCLIindexingcommand)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>
6.  <span>[Content items, Content Types and Fields](31430275.html)</span>
7.  <span>[Field Types reference](Field-Types-reference_31430495.html)</span>

 Developer : EmailAddress Field Type 



This Field Type represents an email address, in the form of a string.

| Name           | Internal name | Expected input type |
|----------------|---------------|---------------------|
| `EmailAddress` | `ezemail`     | `string`            |

## Description

The EmailAddress Field Type stores an email address, which is provided as a string.

## PHP API Field Type 

### Value object

##### Properties

The **`Value`** class of this field type contains the following properties:

| Property | Type     | Description                                                                |
|----------|----------|----------------------------------------------------------------------------|
| `$email` | `string` | This property will be used for the input string provided as email address. |

**Value object content example**

``` brush:
use eZ\Publish\Core\FieldType\EmailAddress\Type;

// Instantiates an EmailAddress Value object with default value (empty string)
$emailaddressValue = new Type\Value();

// Email definition
$emailaddressValue->email = "someuser@example.com";
```

##### Constructor

<span>The **`EmailAddress`**</span>**`\Value`**<span> constructor will initialize a new Value object with the value provided. It accepts a string as input.</span>

**Constructor example**

``` brush:
use eZ\Publish\Core\FieldType\EmailAddress\Type;
 
// Instantiates an EmailAddress Value object
$emailaddressValue = new Type\Value( "someuser@example.com" );
```

##### String representation

String representation of the Field Type's Value object is the email address contained in it.

Example:

> `someuser@example.com`

### Hash format

Hash value for this Field Type's Value is simply the email address as a string.

Example:

> `someuser@example.com`

### Validation

This Field Type uses the **`EmailAddressValidator`** validator as a resource which will test the string supplied as input against a pattern, to make sure that a valid email address has been provided.
If the validations fail a **`ValidationError`**<span class="p">  </span>is thrown, specifying the error message.

### Settings

This Field Type does not support settings.

 

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : Environments 



Environment configuration as provided by Symfony is enhanced in eZ Platform to allow specifying this in the virtual host configuration.
You can configure several environments, from production, development or staging, even if for each one of them you need to use different configuration sets.

 

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<span>See also </span><a href="http://symfony.com/doc/current/cookbook/configuration/environments.html">the Symfony Recipe about &quot; How to Master and Create new Environments &quot;</a>

# Web server configuration

For example, using Apache, in the `VirtualHost` example in <a href="https://github.com/ezsystems/ezplatform/tree/master/doc/apache2">doc/apache2/</a> in your install, the required `VirtualHost` configurations have been already included. You can switch to the desired environment by setting the `ENVIRONMENT` environment variable to "`prod`", "`dev`" or other custom value, as you can see in the following example:

``` brush:
# Environment.
# Possible values: "prod" and "dev" out-of-the-box, other values possible with proper configuration
# Defaults to "prod" if omitted (uses SetEnvIf so value can be used in rewrite rules)
SetEnvIf Request_URI ".*" SYMFONY_ENV="prod"
```

# Configuration

If you want to use a custom environment (something else then "`prod`" and "`dev`") the next step is to create the dedicated configuration files for your environment:

-   `app/config/config_ <env_name> .yml`
-   `app/config/ezplatform_ <env_name> .yml`

The name used as `            <env_name>          ` will be the one that can be used as value of the `ENVIRONMENT` environment variable.

Those files must import the main configuration file, just like the default <a href="https://github.com/ezsystems/ezpublish-community/blob/master/ezpublish/config/config_dev.yml"><code>config_dev.yml</code></a> already does. Here's an example:

``` brush:
imports:
    - { resource: config.yml }
```

 

This allows you to override settings defined in the main configuration file, depending on your environment (like the DB settings or any other setting you may want to override).

#### In this topic:

-   [Web server configuration](#Environments-Webserverconfiguration)
-   [Configuration](#Environments-Configuration)

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[API](API_31429524.html)</span>
4.  <span>[REST API Guide](REST-API-Guide_31430286.html)</span>

 Developer : Error handling 



Error handling in the REST API is fully based on HTTP error codes. As a web developer, you are probably familiar with the most common ones: 401 Unauthorized, 404 Not Found or 500 Internal Server Error. The REST API uses those, along with a few more, to allow proper error handling.

The complete list of error codes used and the conditions in which they apply are specified in the <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/doc/specifications/rest/REST-API-V2.rst">reference documentation</a>.

## General error codes

A few error codes apply to most resources (if they *are* applicable)

### 500 Internal Server Error

<span>The server encountered an unexpected condition, usually an exception, which prevented it from fulfilling the request: database down, permissions or configuration error.</span>

### 501 Not Implemented

<span>Returned when the requested method has not yet been implemented. As of eZ Publish 5.0, most of User, User group, Content, Location and Content Type have been implemented. Some of their methods, as well as other features, may return a 501.</span>

### <span>404 Not Found</span>

<span>Returned when the request failed because the request object was not found. You should be familiar with this one.</span>

### <span>405 Method Not Allowed</span>

<span>Returned when the requested REST API resource doesn't support the HTTP verb that was used.</span>

### <span>406 Not Acceptable</span>

<span>Returned when an accept header sent with the requested isn't supported.</span>

## <span>Error handling in your REST implementation</span>

<span>It is up to you, in your client implementation, to handle those codes by checking if an error code (4xx or 5xx) was returned instead of the expected 2xx or 3xx.</span>

#### In this topic:

-   [General error codes](#Errorhandling-Generalerrorcodes)
    -   [500 Internal Server Error](#Errorhandling-500InternalServerError)
    -   [501 Not Implemented](#Errorhandling-501NotImplemented)
    -   [404 Not Found](#Errorhandling-404NotFound)
    -   [405 Method Not Allowed](#Errorhandling-405MethodNotAllowed)
    -   [406 Not Acceptable](#Errorhandling-406NotAcceptable)
-   [Error handling in your REST implementation](#Errorhandling-ErrorhandlinginyourRESTimplementation)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Cookbook](Cookbook_31429528.html)</span>

 Developer : Executing long-running console commands 



# Description

This page describes how to execute long-running console commands, to make sure they don't run out of memory. An example is a custom import command or the indexing command provided by the [Solr Bundle](Solr-Bundle_31430592.html).

# Solution

## Reducing memory usage

To avoid quickly running out of memory while executing such commands you should make sure to:

1.  <span class="inline-comment-marker" data-ref="5c1c379e-da6a-435d-ba3e-f3fe7df39d94">Always</span> run in prod environment using: `--env=prod`
    1.  See [Environments](Environments_31429669.html) for further information on Symfony environments.
    2.  *See [Logging and debug configuration](https://doc.ez.no/display/DEVELOPER/Devops#Devops-LoggingandDebugConfiguration) for some of different features enabled in development *environments, which by design uses memory.**

2.  Avoid Stash *(<span class="confluence-link">[Persistence cache](Repository_31432023.html#Repository-Persistencecacheconfiguration)</span>)* using to much memory in prod:

    1.  If your system is running, or you need to use cache, then disable Stash InMemory cache as it does not limit the amount of items in cache and grows exponentially:

        **config\_prod.yml (snippet, not a full example for stash config)**

        ``` brush:
        stash:
            caches:
                default:
                    inMemory: false 
        ```

        Also if you use FileSystem driver, make sure `memKeyLimit` is set to a low number, default should be 200 and can be lowered like this:

        **config\_prod.yml**

        ``` brush:
        stash:
            caches:
                default:
                    FileSystem:
                        memKeyLimit: 100
        ```

    2.  If your setup is offline and cache is cold, there is no risk of stale cache and you can actually completely disable Stash cache. This will improve performance of import scripts:

        **config\_prod.yml (full example)**

        ``` brush:
        stash:
            caches:
                default:
                    drivers: [ BlackHole ]
                    inMemory: false
        ```

3.  For logging using monolog, if you use either the default `               fingers_crossed             `, or `buffer` handler, make sure to specify `               buffer_size             ` <span class="inline-comment-marker" data-ref="b6f4845b-de84-415d-bd48-2744c8886ef8"> to limit how large the buffer grows before it gets flushed</span>:

    **config\_prod.yml (snippet, not a full example for monolog config)**

    ``` brush:
    monolog:
        handlers:
            main:
                type: fingers_crossed
                buffer_size: 200
    ```

4.  Run PHP without memory limits using: `php ` `-d memory_limit=-1 app/console <command>` <span>
    </span>
5.  Disable `xdebug` *(PHP extension to debug/profile php use)* when running the command, this will cause php to use much more memory.

 

Note: Memory will still grow

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Even when everything is configured like described above, memory will grow for each iteration of indexing/inserting a content item with at least *1kb* per iteration after the initial first 100 rounds. This is expected behavior; to be able to handle more iterations you will have to do one or several of the following:

-   <span>Change the import/index script in question to [use process forking](#Executinglong-runningconsolecommands-process-forking) to avoid the issue.</span>
-   Upgrade PHP: *newer versions of PHP are typically more memory-efficient.*
-   Run the console command on a machine with more memory (RAM)*.
    *

## Process forking with Symfony<span id="Executinglong-runningconsolecommands-process-forking" class="confluence-anchor-link"></span>

The recommended way to completely avoid "memory leaks" in PHP in the first place is to use processes, and for console scripts this is typically done using process forking which is quite easy to do with Symfony.

The things you will need to do:

1.  Change your command so it supports taking slice parameters, like for instance a batch size and a child-offset parameter.
    1.  *If defined, child-offset parameter denotes if a process is child, this could have been accomplished with two commands as well.*
    2.  *If not defined, it is master process which will execute the processes until nothing is left to process.*

2.  Change the command so that the master process takes care of forking child processes in slices.
    1.  For execution in-order, <a href="https://github.com/ezsystems/ezpublish-kernel/blob/6.2/eZ/Bundle/PlatformInstallerBundle/src/Command/InstallPlatformCommand.php#L230">you may look to our platform installer code</a>used to fork out solr indexing after installation to avoid cache issues.
    2.  For parallel execution of the slices, <a href="http://symfony.com/doc/current/components/process.html#process-signals">see Symfony doc for further instruction</a>.

 

#### In this topic:

-   [Description](#Executinglong-runningconsolecommands-Description)
-   [Solution](#Executinglong-runningconsolecommands-Solution)
    -   [Reducing memory usage](#Executinglong-runningconsolecommands-Reducingmemoryusage)
    -   [Process forking with Symfony](#Executinglong-runningconsolecommands-ProcessforkingwithSymfonyprocess-forking)

#### Related topics:

<span class="confluence-link">[Environments](Environments_31429669.html)</span>

<a href="http://symfony.com/doc/current/components/process.html">Symfony Process Component [symfony.com]</a>

[How to Contribute](How-to-Contribute_31429587.html)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Get Started with eZ Platform](Get-Started-with-eZ-Platform_31429520.html)</span>
4.  <span>[Step 2: Going Deeper](31429542.html)</span>
5.  <span>[Get Started with eZ Enterprise](Get-Started-with-eZ-Enterprise_31429569.html)</span>

 Developer : Explore eZ Enterprise Tutorials 








1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Cookbook](Cookbook_31429528.html)</span>

 Developer : Exposing SiteAccess-aware configuration for your bundle 



# Description

Symfony Config component makes it possible to define *semantic configuration*, exposed to the end developer. This configuration is validated by rules you define, e.g. validating type (string, array, integer, boolean, etc.). Usually, once validated and processed, this semantic configuration is then mapped to internal *key/value* parameters stored in the `ServiceContainer`.

eZ Platform uses this for its core configuration, but adds another configuration level, the **siteaccess**. For each defined siteaccess, we need to be able to use the same configuration tree in order to define siteaccess-specific config. These settings then need to be mapped to siteaccess-aware internal parameters that you can retrieve via the `ConfigResolver`. For this, internal keys need to follow the format `<namespace>.<scope>.<parameter_name>`, `namespace` being specific to your app/bundle, `scope` being the siteaccess, siteaccess group, `default` or `global`, `parameter_name` being the actual setting *identifier*.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<span style="color: rgb(0,0,0);">For more information on ConfigResolver, namespaces and scopes, see </span><span class="confluence-link">[eZ Platform configuration basics](https://doc.ez.no/display/DEVELOPER/SiteAccess#SiteAccess-Configuration)</span><span style="color: rgb(119,119,119);">.</span>

<span>The goal of this feature is to make it easy to implement a </span>*siteaccess-aware*<span> semantic configuration and its mapping to internal config for any eZ bundle developer.</span>

# Solution

## Semantic configuration parsing

<span><span>An abstract </span>`Configuration`<span> class has been added, simplifying the way to add a siteaccess settings tree like the following:</span></span>

 

**ezplatform.yml or config.yml**

``` brush:
acme_demo:
    system:
        my_siteaccess:
            hello: "world"
            foo_setting:
                an_integer: 456
                enabled: true

        my_siteaccess_group:
            hello: "universe"
            foo_setting:
                foo: "bar"
                some: "thing"
                an_integer: 123
                enabled: false
```

 

<span>Class FQN is </span>`eZ\Bundle\EzPublishCoreBundle\DependencyInjection\Configuration\SiteAccessAware\Configuration`<span>.
</span><span style="line-height: 1.4285715;">All you have to do is to extend it and use </span>`$this->generateScopeBaseNode()`<span style="line-height: 1.4285715;">:</span>

``` brush:
namespace Acme\DemoBundle\DependencyInjection;

use eZ\Bundle\EzPublishCoreBundle\DependencyInjection\Configuration\SiteAccessAware\Configuration as SiteAccessConfiguration;
use Symfony\Component\Config\Definition\Builder\NodeBuilder;
use Symfony\Component\Config\Definition\Builder\TreeBuilder;

class Configuration extends SiteAccessConfiguration
{
    public function getConfigTreeBuilder()
    {
        $treeBuilder = new TreeBuilder();
        $rootNode = $treeBuilder->root( 'acme_demo' );

        // $systemNode will then be the root of siteaccess aware settings.
        $systemNode = $this->generateScopeBaseNode( $rootNode );
        $systemNode
            ->scalarNode( 'hello' )->isRequired()->end()
            ->arrayNode( 'foo_setting' )
                ->children()
                    ->scalarNode( "foo" )->end()
                    ->scalarNode( "some" )->end()
                    ->integerNode( "an_integer" )->end()
                    ->booleanNode( "enabled" )->end()
                ->end()
            ->end();

        return $treeBuilder;
    }
}
```

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<span style="color: rgb(0,0,0);">Default name for the *siteaccess root node* is `system`, but you can customize it. For this, just pass the name you want to use as a second argument of `$this->generateScopeBaseNode()`.</span>

## Mapping to internal settings

Semantic configuration must always be *mapped* to internal *key/value* settings within the `ServiceContainer`. This is usually done in the DIC extension.

For siteaccess-aware settings, new `ConfigurationProcessor` and `Contextualizer` classes have been introduced to ease the process.

``` brush:
namespace Acme\DemoBundle\DependencyInjection;

use eZ\Bundle\EzPublishCoreBundle\DependencyInjection\Configuration\SiteAccessAware\ConfigurationProcessor;
use eZ\Bundle\EzPublishCoreBundle\DependencyInjection\Configuration\SiteAccessAware\ContextualizerInterface;
use Symfony\Component\DependencyInjection\ContainerBuilder;
use Symfony\Component\Config\FileLocator;
use Symfony\Component\HttpKernel\DependencyInjection\Extension;
use Symfony\Component\DependencyInjection\Loader;

/**
 * This is the class that loads and manages your bundle configuration
 *
 * To learn more see {@link http://symfony.com/doc/current/cookbook/bundles/extension.html}
 */
class AcmeDemoExtension extends Extension
{
    public function load( array $configs, ContainerBuilder $container )
    {
        $configuration = $this->getConfiguration( $configs, $container );
        $config = $this->processConfiguration( $configuration, $configs );

        $loader = new Loader\YamlFileLoader( $container, new FileLocator( __DIR__.'/../Resources/config' ) );
        $loader->load( 'default_settings.yml' );

        // "acme_demo" will be the namespace as used in ConfigResolver format.
        $processor = new ConfigurationProcessor( $container, 'acme_demo' );
        $processor->mapConfig(
            $config,
            // Any kind of callable can be used here.
            // It will be called for each declared scope/SiteAccess.
            function ( $scopeSettings, $currentScope, ContextualizerInterface $contextualizer )
            {
                // Will map "hello" setting to "acme_demo.<$currentScope>.hello" container parameter
                // It will then be possible to retrieve this parameter through ConfigResolver in the application code:
                // $helloSetting = $configResolver->getParameter( 'hello', 'acme_demo' );
                $contextualizer->setContextualParameter( 'hello', $currentScope, $scopeSettings['hello'] );
            }
        );

        // Now map "foo_setting" and ensure keys defined for "my_siteaccess" overrides the one for "my_siteaccess_group"
        // It is done outside the closure as it is needed only once.
        $processor->mapConfigArray( 'foo_setting', $config );
    }
}
```

Tip

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
You can map simple settings by calling `$processor->mapSetting()`, without having to call `$processor->mapConfig()` with a callable.

``` brush:
$processor = new ConfigurationProcessor( $container, 'acme_demo' );
$processor->mapSetting( 'hello', $config );
```

Important

<span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
Always ensure you have defined and loaded default settings.

**@AcmeDemoBundle/Resources/config/default\_settings.yml**

``` brush:
parameters:
    acme_demo.default.hello: world
    acme_demo.default.foo_setting:
        foo: ~
        some: ~
        planets: [Earth]
        an_integer: 0
        enabled: false
        j_adore: les_sushis
```

### Merging hash values between scopes

When you define a hash as semantic config, you sometimes don't want the siteaccess settings to replace the default or group values, but *enrich* them by appending new entries. This is made possible by using `$processor->mapConfigArray()`, which needs to be called outside the closure (before or after), in order to be called only once.

<span>Consider the following default config:</span>

**default\_settings.yml**

``` brush:
parameters:
    acme_demo.default.foo_setting:
        foo: ~
        some: ~
        planets: [Earth]
        an_integer: 0
        enabled: false
        j_adore: les_sushis
```

<span><span>
</span></span>

<span><span>And then this semantic config:</span></span>

 

**ezplatform.yml or config.yml**

``` brush:
acme_demo:
    system:
        sa_group:
            foo_setting:
                foo: bar
                some: thing
                an_integer: 123

        # Assuming "sa1" is part of "sa_group"
        sa1:
            foo_setting:
                an_integer: 456
                enabled: true
                j_adore: le_saucisson
```

<span>
</span>

<span>What we want here is that keys defined for </span>`foo_setting`<span> are merged between default/group/siteaccess:</span>

**Expected result**

``` brush:
parameters:
    acme_demo.sa1.foo_setting:
        foo: bar
        some: thing
        planets: [Earth]
        an_integer: 456
        enabled: true
        j_adore: le_saucisson
```

#### Merge from *second level*

In the example above, entries were merged in respect to the scope order of precedence. However, if we define the `planets` key for`sa1`, it will completely override the default value since the merge process is done at only 1 level.

You can add another level by passing `ContextualizerInterface::MERGE_FROM_SECOND_LEVEL` as an option (3rd argument) to`$contextualizer->mapConfigArray()`.

**default\_settings.yml**

``` brush:
parameters:
    acme_demo.default.foo_setting:
        foo: ~
        some: ~
        planets: [Earth]
        an_integer: 0
        enabled: false
        j_adore: [les_sushis]
```

**Semantic config (ezplatform.yml / config.yml)**

``` brush:
acme_demo:
    system:
        sa_group:
            foo_setting:
                foo: bar
                some: thing
                planets: [Mars, Venus]
                an_integer: 123

        # Assuming "sa1" is part of "sa_group"
        sa1:
            foo_setting:
                an_integer: 456
                enabled: true
                j_adore: [le_saucisson, la_truite_a_la_vapeur]
```

Result of using `ContextualizerInterface::MERGE_FROM_SECOND_LEVEL` option:

``` brush:
parameters:
    acme_demo.sa1.foo_setting:
        foo: bar
        some: thing
        planets: [Earth, Mars, Venus]
        an_integer: 456
        enabled: true
        j_adore: [les_suhis, le_saucisson, la_truite_a_la_vapeur]
```

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
There is also another option, `ContextualizerInterface::UNIQUE`, to be used when you want to ensure your array setting has unique values. It will only work on normal arrays though, not hashes.

#### Limitations

A few limitation exist with this scope hash merge:

-   Semantic setting name and internal name will be the same (like `foo_setting` in the examples above).
-   Applicable to first level semantic parameter only (i.e. settings right under the siteaccess name).
-   Merge is not recursive. Only second level merge is possible by using `ContextualizerInterface::MERGE_FROM_SECOND_LEVEL` option.

## Dedicated mapper object

<span>Instead of passing a callable to `$processor->mapConfig()`, an instance of `eZ\Bundle\EzPublishCoreBundle\DependencyInjection\Configuration\SiteAccessAware\ConfigurationMapperInterface` can be passed.</span>

<span>This can be useful if you have a lot of configuration to map and don't want to pollute your DIC extension class (better for maintenance).</span>

### Merging hash values between scopes

<span><span>As specified above, </span>`$contextualizer->mapConfigArray()`<span> is not to be used within the </span>*scope loop*<span>, like for simple values. When using a closure/callable, you usually call it before or after </span>`$processor->mapConfig()`<span>. For mapper objects, a dedicated interface can be used: </span>`HookableConfigurationMapperInterface`<span>, which defines 2 methods: </span>`preMap()`<span> and </span>`postMap()`<span>.</span></span>

<span>
</span>

 

#### In this topic:

-   [Description](#ExposingSiteAccess-awareconfigurationforyourbundle-Description)
-   [Solution](#ExposingSiteAccess-awareconfigurationforyourbundle-Solution)
    -   [Semantic configuration parsing](#ExposingSiteAccess-awareconfigurationforyourbundle-Semanticconfigurationparsing)
    -   [Mapping to internal settings](#ExposingSiteAccess-awareconfigurationforyourbundle-Mappingtointernalsettings)
        -   [Merging hash values between scopes](#ExposingSiteAccess-awareconfigurationforyourbundle-Merginghashvaluesbetweenscopes)
    -   [Dedicated mapper object](#ExposingSiteAccess-awareconfigurationforyourbundle-Dedicatedmapperobject)
        -   [Merging hash values between scopes](#ExposingSiteAccess-awareconfigurationforyourbundle-Merginghashvaluesbetweenscopes.1)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>

 Developer : Extending PlatformUI with new navigation 



## Introduction

This tutorial aims at providing a step-by-step guide on how to extend the JavaScript application provided by <a href="https://github.com/ezsystems/PlatformUIBundle">the PlatformUI bundle</a>. 

In this tutorial, we will create a new part of the application allowing to browse your content by Content Type instead of using the tree structure. To fully benefit from this document, you need to:

-   be comfortable with eZ Platform's content model (Content, Location, Content Type, etc.)
-   have basic to intermediate level in HTML5/CSS/JavaScript
-   have a basic knowledge of Symfony's concepts (Bundle, Controller and routing)
-   have read the [PlatformUI technical introduction](Extending-eZ-Platform_31429689.html)

This tutorial is divided into 9 steps. The complete code base is available on Github in <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle">the ExtendingPlatformUIConferenceBundle repository</a> which also provides a tag for each step. The expected end result can be seen in this screencast:

 

 

 

#### Relevant Community resources

<a href="http://www.netgenlabs.com/Blog/Adding-support-for-a-new-field-type-to-eZ-Publish-Platform-UI">Adding support for a new field type to eZ Platform UI</a>

 

 

**Tutorial path**






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : Extending eZ Platform 



# Backoffice interface

The backend interface is produced by <a href="https://github.com/ezsystems/PlatformUIBundle">the PlatformUI Bundle</a> which provides a JavaScript Single Page Application based on <a href="http://yuilibrary.com/yui/docs/app/">the YUI App Framework</a>. This application is accessible in your browser at **http://\[uri\_of\_platform\]/ez**.

## Technical architecture

The PlatformUI application code is divided into different types of components:

-   **Application:** this is the top level component, the PlatformUI application is an instance of it. It is responsible for authenticating the user and for handling the routing.
-   **Models:** models are the main objects handled by the application, they represent our main domain objects (Content, Location, Content Type, etc.)
-   **View services:** view services act between the Application and the Views. They are configured on the routes and the main responsibility of a view service is to provide the model (or other data) to the views and to perform the operations requested by the user (removing a Content item, copying, etc.)
-   **Views:** views generate the user interface and handle the user interaction (clicking, form submitting, etc.). A view can have several sub-views which can have further sub-views themselves.
-   **Plugins:** plugins can enhance the application, the view services or the views for instance to provide additional features or to tweak the behavior of the plugged component.

The following chart depicts the interaction between those components:

<span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img src="attachments/31429689/31430352.png" alt="Overview of PlatformUI component structure" class="confluence-embedded-image confluence-content-image-border" height="400" /></span>

### Views: main view, sub-view, side view

The views represent a large part of the application and each of them can be used in three different contexts:

1.  As the main view
2.  As a sub-view of another (sub-)view
3.  As a side view

#### Main view

A view used as a main view is configured at the route level to be displayed when the user navigates to that route.

For instance, when reaching `/ez`, the user is redirected to the `loginForm` route (`/ez#/login`) and this route is configured in the following way in the application component:

``` brush:
{
     name: "loginForm",
     path: "/login",
     service: Y.eZ.LoginFormViewService,
     sideViews: {'navigationHub': false, 'discoveryBar': false},
     view: 'loginFormView',
     callbacks: ['open', 'handleSideViews', 'handleMainView']
}
```

Among others things, this means the view `loginFormView` will be used as the main view when this route is matched. `loginFormView` is actually <a href="http://yuilibrary.com/yui/docs/app/#declaring-views">the identifier of the view metadata registered in the <code>view</code> property of the Application</a>.

#### Sub-view

To avoid having huge main views doing too many things in the application, the views are divided into smaller parts called sub-views.

<span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img src="attachments/31429689/31430349.png" class="confluence-embedded-image confluence-content-image-border" width="700" /></span>

For instance, the view used to display a Location is divided into several views at several levels, it contains:

-   An action bar view for the right toolbar, which contains:
    -   a view for the Minimize button
    -   a view for the Create button which contains:
        -   a view to list and select a Content Type
    -   a view for the Edit button
    -   ...
-   A Location View tab view which contains:
    -   the Raw Content View to display the fields which contains:
        -   A view for each fields
        -   ...
-   A Location Details tab view
-   ...
-   A sub-item list view

#### Side view

A view can also be used as a side view. As its name suggests a side view can represent anything that is not part of the main view.

For instance, when displaying a Location, the top menu (the Navigation hub) or the left toolbar (the Discovery Bar) are side views.

<span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img src="attachments/31429689/31430350.png" class="confluence-embedded-image confluence-content-image-border" width="700" /></span>

The side views are also used for various widgets providing a service used several times in the application, such as the Universal Discovery Widget.

### View services

The view services act between the Application and the Views for both the main views and the side views. They are responsible for providing the required data needed by a main view or a side view to be rendered. A view service will also receive the events triggered by the view to react or provide the additional data. For that, the view services receive an instance of the JavaScript REST Client.

## How are pages generated?

Depending on the part of the PlatformUI Application you are using, the page may be generated in two different ways. From an end-user perspective, this is almost transparent but as a developer it is important to understand how the page is generated to be able to extend it.

### Browser side rendering

The pages in the content part (as opposed to admin related pages) are fully rendered in the browser. For instance, when displaying a Location in PlatformUI, the corresponding view service loads the Location model and the *related* models (Content, Content Type, etc.) with the eZ Platform REST API (through the JavaScript REST Client) and gives them the LocationView to be displayed directly by this view and/or by its sub-views. If you open the browser developer tools in the network panel, you can see the REST requests needed to build the page and they only contain a JSON structure.

<span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img src="attachments/31429689/31430345.png" class="confluence-embedded-image confluence-content-image-border" width="700" /></span>

### Server side rendering

The pages in the admin are build in a more traditional way as they are partly rendered server side. For those pages, the view service fetches one (or several) HTML fragment(s) from the server. This HTML fragment follows a very simple structure and can be generated by any means on the server and of course, in PlatformUI this is done in a quite standard Symfony controller. By opening the browser developer tools in the network panel you can see the requests needed to build the section list page.

<span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img src="attachments/31429689/31430351.png" class="confluence-embedded-image confluence-content-image-border" width="700" /></span>

## UI Components

### Navigation hub

The Navigation Hub is a side view displaying the top menu.

<span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img src="attachments/31429689/31430348.png" class="confluence-embedded-image confluence-content-image-border" width="700" /></span>

It displays 4 **Navigation zones**:

-   *Content*
-   *Page*
-   *Performance*
-   *Admin Panel*

A zone can contain an arbitrary number of **Navigation zone items**. By default, the *Content* zone has 2 navigation items: *Content structure* and *Media library*.

### Bar views: Discovery Bar View, Action Bar View, Edit Action Bar View

Bar views provide a set of potential actions for the user.

<span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img src="attachments/31429689/31430347.png" class="confluence-embedded-image" width="700" /></span>

When navigating in the Content zone, the **Discovery Bar View** allows you to discover content while the **Action Bar View** on the right allows you to act on the Content item being viewed (edit, move, copy, etc.).

When editing a Content item, the **Edit Action Bar View** on the right allows you to act on the Content item being edited.

### Universal Discovery Widget

<span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img src="attachments/31429689/31430346.png" class="confluence-embedded-image" width="700" /></span>

The Universal Discovery Widget is a side view triggered when the user needs to pick a Content item (or a Location). It can provide several **Discovery Methods**. By default, *Browse* and *Search* are available.

# Extending the Dashboard

<span class="status-macro aui-lozenge aui-lozenge-current">V1.4</span>

eZ Platform contains a Dashboard which shows the user the most relevant Content items divided into blocks for a quick overview.

Aside from the built-in blocks you can extend the Dashboard with new ones and remove existing ones.

It can be done in four steps:

1.  Create a block view
2.  Create a template
3.  Create a plugin for the view

4.  Add modules to configuration

### Create a block view

The first step is creating a view that will be added to the Dashboard. You can do it based on the Dashboard Block Asynchronous View. Thanks to this you only need to provide the data to display in the table.

Using the Dashboard Block Asynchronous View you need to set an `identifier` of the block. The asynchronous view fires the `_fireLoadDataEvent` method to get the data. The data must find itself in an array with the `items` attribute.

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
If you want to create a completely different view, without a table, you can use the Dashboard Block Base View.

In the example below an `images` block is defined which looks up all content under the `/images/` folder in the tree:

``` brush:
YUI.add('ezs-dashboardblockimagesview', function (Y) {
    'use strict';
    /**
     * Provides the Dashboard Images Block View class
     *
     * @module ez-dashboardblockimagesview
     */
    Y.namespace('eZS');
    var BLOCK_IDENTIFIER = 'images';
    /**
     * The dashboard images block view
     *
     * @namespace eZS
     * @class DashboardBlockImagesView
     * @constructor
     * @extends eZ.DashboardBlockAsynchronousView
     */
    Y.eZS.DashboardBlockImagesView = Y.Base.create('dashboardBlockImagesView', Y.eZ.DashboardBlockAsynchronousView, [], {
        initializer: function () {
            this._set('identifier', BLOCK_IDENTIFIER);
        },
        _fireLoadDataEvent: function () {
            this.fire('locationSearch', {
                viewName: 'images-dashboard',
                resultAttribute: 'items',
                loadContentType: true,
                loadContent: true,
                search: {
                    criteria: {SubtreeCriterion: '/1/43/51/'},
                    limit: 10
                }
            });
        },
        _getTemplateItem: function (item) {
            return {
                content: item.content.toJSON(),
                contentType: item.contentType.toJSON(),
                location: item.location.toJSON(),
                contentInfo: item.location.get('contentInfo').toJSON(),
            };
        },
    });
});
```

 

In the `_getTemplateItem` method you can specify the structure of the item which will be provided to the template. In the example above each item will be an object with four properties.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
If you don't intend to change the structure of the item, there's no need to override this method.

### Create a template

Now you have to create a template for the view, for example:

``` brush:
<h2 class="ez-block-title">Images</h2>
<div class="ez-block-wrapper ez-asynchronousview">
    {{#if loadingError}}
    <p class="ez-asynchronousview-error ez-font-icon">
        An error occurred while loading the images list.
        <button class="ez-asynchronousview-retry ez-button ez-font-icon pure-button">Retry</button>
    </p>
    {{else}}
    <table class="ez-block-items-table">
        <thead class="ez-block-header">
            <tr>
                <th class="ez-block-head-title">Title</th>
                <th class="ez-block-head-content-type">Content Type</th>
                <th class="ez-block-head-version">Version</th>
                <th class="ez-block-head-modified">Last saved</th>
            </tr>
        </thead>
        <tbody class="ez-block-content">
        {{#each items}}
            <tr class="ez-block-row">
                <td class="ez-block-cell">{{ contentInfo.name }}</td>
                <td class="ez-block-cell">{{ lookup contentType.names contentInfo.mainLanguageCode }}</td>
                <td class="ez-block-cell">{{ contentInfo.currentVersionNo }}</td>
                <td class="ez-block-cell ez-block-cell-options">
                    {{ contentInfo.lastModificationDate }}
                    <div class="ez-block-row-options">
                        <a class="ez-block-option-edit ez-font-icon" href="{{ path "editContent" id=contentInfo.id languageCode=contentInfo.mainLanguageCode }}"></a>
                        <a class="ez-block-option-view ez-font-icon" href="{{ path "viewLocation" id=location.id languageCode=contentInfo.mainLanguageCode }}"></a>
                    </div>
                </td>
            </tr>
        {{/each}}
        </tbody>
    </table>
    {{/if}}
</div>
```

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
You may notice that the template is prepared to handle the `loadingError`, because the asynchronous view provides it if there are problems with loading data. If no error occurs, a table with basic info about your images will be displayed.

### Create a plugin for the view

The next step is adding the view and the template to the Dashboard. To do this, you need to create a plugin for the Dashboard view.

In the initializer you can use the public `addBlock` method from the Dashboard view. In this method you only have to provide the instance of your view. Here you also set some properties for your new view: `bubbleTargets` to make sure that the events will bubble up to the other views, and `priority` where you can set the order of blocks in the Dashboard (higher number goes first).

``` brush:
YUI.add('ezs-dashboardblocksplugin', function (Y) {
    'use strict';
    /**
     * The plugin is responsible for adding a new block to the dashboard.
     *
     * @module ezs-dashboardblocksplugin
     */
    Y.namespace('eZS.Plugin');
    Y.eZS.Plugin.DashboardBlocks = Y.Base.create('studioDashboardBlocks', Y.Plugin.Base, [], {
        initializer: function () {
            this.get('host').addBlock(this.get('imagesBlockView'));
        }
    }, {
        NS: 'studioDashboardBlocks',
        ATTRS: {
            imagesBlockView: {
                valueFn : function () {
                    return new Y.eZS.DashboardBlockImagesView({
                        bubbleTargets: this.get('host'),
                        priority: 500
                    });
                }
            }
        }
    });
    Y.eZ.PluginRegistry.registerPlugin(
        Y.eZS.Plugin.DashboardBlocks, ['dashboardBlocksView']
    );
});
```

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
If for whatever reason you want to remove a block, use another public method, `removeBlock`, and provide it with just the block identifier.

### Add modules to configuration

The last thing you have to do is add new modules to the yml configuration:

``` brush:
ezs-dashboardblocksplugin:
    requires:
        - 'plugin'
        - 'base'
        - 'ez-pluginregistry'
        - 'ezs-dashboardblockimagesview'
    dependencyOf: ['ez-dashboardblocksview']
    path: %ezstudioui.public_dir%/js/views/services/plugins/ezs-dashboardblocksplugin.js
ezs-dashboardblockimagesview:
    requires:
        - 'ez-dashboardblockasynchronousview'
        - 'dashboardblockimagesview-ez-template'
    path: %ezstudioui.public_dir%/js/views/ezs-dashboardblockimagesview.js
dashboardblockimagesview-ez-template:
    type: 'template'
    path: %ezstudioui.public_dir%/templates/dashboardblock-images.hbt
```

 

In this example the plugin is added as a dependency of the Dashboard block view, requiring the new images block view. The Dashboard images view in turn requires the asynchronous view.

After this configuration is complete the Dashboard should display the new block.

# Extending the Landing Page (Enterprise)

## Block templates

<span class="status-macro aui-lozenge aui-lozenge-current">V.1.8</span>

<span class="status-macro aui-lozenge aui-lozenge-current">EZ ENTERPRISE</span>

All Landing Page blocks, both those that come out of the box and [custom ones](31430614.html), can have multiple templates. This allows you to create different styles for each block and let the editor choose them when adding the block from the UI. The templates are defined in your configuration files like in the following example, with `simplelist` and `special` being the template names:

**app/config/block\_templates.yml**

``` brush:
blocks:
    contentlist:
        views:
            simplelist:
                template: blocks/contentlist_simple.html.twig
                name: Simple Content List
            special:
                template: blocks/contentlist_special.html.twig
                name: Special Content List 
```

## Extending the Form Builder

<span class="status-macro aui-lozenge aui-lozenge-current">V1.7</span>

<span class="status-macro aui-lozenge aui-lozenge-current">EZ ENTERPRISE</span>

Form Builder Bundle currently comes with three basic types of fields: Single Line Text, Paragraph Text and Email.

It was designed to be easy to extend by adding new types of fields.

### Field definitions

Default field definitions are available in `Resources\config\default_fields.yml`.

#### Field definition structure

Field definitions are contained under the `fields` key. Each definition has its own key, e.g. `single_line_text`. Each definition must contain two sections:

-   `identifier` - name of the definition used on the front end
-   `displayName` - name displayed in the Page mode editor in the `fields` tab

The definition can also contain the following optional sections:

-   `validators` - defines validators that the field will use. This must contain the validator's identifier and the values that will be checked during validation, for example:

``` brush:
        validators:
            - { identifier: required, value: 1 }
```

-   `attributes` - contains the field's attributes. You can place here custom attributes for new fields, like in <a href="https://github.com/ezsystems/ezstudio-form-builder/blob/master/bundle/Resources/config/default_fields.yml#L33" class="uri">https://github.com/ezsystems/ezstudio-form-builder/blob/master/bundle/Resources/config/default_fields.yml#L33</a>. There are also <a href="https://github.com/ezsystems/ezstudio-form-builder/blob/master/lib/Core/Definition/FieldDefinition.php#L16-L19">four default attributes</a> that are used for every field: `LABEL_NAME`, `LABEL_HELP_TEXT`, `LABEL_ADMIN_LABEL` and `LABEL_PLACEHOLDER_TEXT`. If you wish, you can override them in your configuration.

<!-- -->

-   `views` - provides a list of views that will be used to display the field. At least one view must be defined, with the keys `name`, `thumbnail` and `template`, for example:

``` brush:
        views:
            basic:
                name: Form Test Line Text Basic
                thumbnail: /bundles/ezsystemsformbuilder/images/thumbnails/single_line_text/basic.svg
                template: EzSystemsFormBuilderBundle:fields:single_line_text/basic.html.twig
```

#### Adding a new field definition

This procedure assumes you are creating a separate Bundle to house your new type of form field.

##### 1. Create a YAML file with field definition

Create a YAML configuration file, e.g. `Resources\config\extended_fields.yml`, with the following code:

``` brush:
fields:
    test_text:
        identifier: testLineText
        displayName: 'Test Line Text'
        validators:
            - { identifier: required, value: 1 }
        attributes:
            name: 'test line attribute'
        views:
            basic:
                name: Form Test Line Text Basic
                thumbnail: /bundles/ezsystemsformbuilder/images/thumbnails/single_line_text/basic.svg
                template: EzSystemsFormBuilderBundle:fields:single_line_text/basic.html.twig
```

You can also provide additional options using the `options:` key. For example, you can make sure that the data entered in a field will not to be stored in the database, like for example in the <a href="https://github.com/ezsystems/ezstudio-form-builder/blob/5fd44dc5419a2e969f2a17acbda794f321e5c946/bundle/Resources/config/default_fields.yml#L134">built-in Captcha field</a>.

When creating a new template for the field definition, remember to add mandatory `ezform-field` class and `field.id` as shown below: 

``` brush:
{% extends 'EzSystemsFormBuilderBundle:fields:field.html.twig' %}
{% block input %}
    <input type="text" class="ezform-field ..." id="{{ field.id }}" placeholder="{{ field.placeholderText }}">
{% endblock %}
```

##### 2. Modify the `DependencyInjection\TestExtension.php` class

The class must implement the` PrependExtensionInterface` interface:

``` brush:
class TestExtension implements PrependExtensionInterface
```

In the `prepend` method in `TestExtension.php` add the following lines at the end:

``` brush:
public function prepend(ContainerBuilder $container)
    {
    ...
        $configFile = __DIR__ . '/../Resources/config/extended_fields.yml';
        $config = Yaml::parse(file_get_contents($configFile));
        $container->loadFromExtension('ez_systems_form_builder', $config);
        $container->addResource(new FileResource($configFile));    
    }
```

### Validators

#### Creating your own validators

You can create your own validators by reproducing the following configuration:

##### Validator configuration

A validator implements the `EzSystems\FormBuilder\SPI\ValidatorInterface.php` interface and extends the abstract class `EzSystems\FormBuilder\Core\Validator\Validator.php`.

The interface requires the implementation of the following methods:

-   `validate`
-   `getLabel`
-   `getErrorMessage`
-   `setLimitation`
-   `getValueType`

The `validate` method is the one that contains the logic for the validation. It returns `true` when validation is successful, or `false` when the data does not validate:

``` brush:
    /**
     * @return bool
     */
    public function validate($value);
```

The `getLabel` method returns a string with the name of the validator that will be used in the editor:

``` brush:
    /**
     * @return string
     */
    public function getLabel();
```

The `getErrorMessage` method returns error message(s) to appear when the `validate` method returns `false`:

``` brush:
    /**
     * @return array
     */
    public function getErrorMessage();
```

The `setLimitation` method allows the configuration of limitations. Its default implementation is contained in the `Validator` abstract class:

``` brush:
    /**
     * @param mixed $limitation
     */
    public function setLimitation($limitation);
```

The `getValueType` method returns the name of the checked value type:

``` brush:
    /**
     * @return string
     */
    public function getValueType();
```

Currently the abstract class `Validator` has three value types (defined in `Core\Validator\Validator.php`):

``` brush:
    const TYPE_INTEGER = 'integer';
    const TYPE_STRING = 'string';
    const TYPE_BOOL = 'bool';
```

The validator must be tagged as `form_builder.field_validator`. Due to this the `Resources\config\validator_services.yml` file contains two entries, one in the `parameters` section:

``` brush:
form_builder.validator.example.class: EzSystems\FormBuilder\Core\Validator\ExampleValidator
```

and one in the `services` section:

``` brush:
form_builder.validator.example:
        class: '%form_builder.validator.example.class%'
        tags:
            - { name: form_builder.field_validator, alias: example }
```

 

### Signal slots

Whenever a form is submitted and stored in a database, `lib\Core\SignalSlot\Signal\FormSubmit` emits signal in a `submitForm` service. You can create your own listeners, called Signal slots, to capture the FormSubmit signal.

Below you can find an example of a custom Signal slot. It saves submission to a text file. 

``` brush:
<?php
namespace AppBundle\SignalSlot;
use Symfony\Component\Filesystem\Filesystem;
use eZ\Publish\Core\SignalSlot\Slot;
use eZ\Publish\Core\SignalSlot\Signal;
class HandleSubmission extends Slot
{
    /**
     * Receive the given $signal and react on it.
     *
     * @param EzSystems\FormBuilder\Core\SignalSlot\Signal\FormSubmit $signal
     */
    public function receive(Signal $signal)
    {
        $fs = new Filesystem();
        $formId = $signal->formId;
        $submission = $signal->submission;
        $created = $submission->created->format("Y-m-d.H:i:s");
        $dataRows = [];
        foreach ($submission->fields as $field) {
            $dataRows[] = "{$field->label}: {$field->value}";
        }
        $fs->mkdir("forms/{$formId}");
        $fs->dumpFile("forms/{$formId}/{$created}.txt", implode("\n", $dataRows));
    }
}
```

 

It has to be registered as a tagged Symfony service, like this:

``` brush:
    app_bundle.handle_submission:
        class: "AppBundle\SignalSlot\HandleSubmission"
        tags:
            - { name: ezpublish.api.slot, signal: '\EzSystems\FormBuilder\Core\SignalSlot\Signal\FormSubmit' }
 
```

 

### Other Form Builder fields

<span class="status-macro aui-lozenge aui-lozenge-current">V1.8</span>

Form Builder fields introduced in v1.8 require additional configuration.

#### Date field

To make use of the Date field you need to add the necessary assets. The assets should be added in page head with the following code:

``` brush:
{% javascripts
    ...
    'bundles/ezsystemsformbuilder/js/vendors/*/*.js'
%}
    <script type="text/javascript" src="{{ asset_url }}"></script>
{% endjavascripts %}
```

``` brush:
{% stylesheets filter='cssrewrite'
    ...
    'bundles/ezsystemsformbuilder/css/vendors/*/*.css'
%}
    <link rel="stylesheet" type="text/css" href="{{ asset_url }}">
{% endstylesheets %}
```

##### Adding new date format

If you wish to add a new date format, the `alias` in the date field config must follow this pattern:

`d` or `D` - day of the month (1-2 digits)
`dd` or `DD` - day of the month (2 digits)
`m` or `M` - month of the year (1-2 digits)
`mm` or `MM` - month (2 digits)
`yy` or `YY` - year (2 digits)
`yyyy` or `YYYY` - year (4 digits)

for example:

`d-m-yyyy` - `16-1-2017`
`mm/dd/yy` - `01/16/17`

# Further extensibility

## Content Type icons

<span class="status-macro aui-lozenge aui-lozenge-current">V1.4</span>

A Content item can be treated as an instance of a Content Type. The type of a Content item is very important information to provide to the user. The Content Type to which a Content item belongs is represented graphically using an icon near the Content item name. Essentially, the Content Types are project-specific so the icons can be easily configured and extended by integrators.

#### Font icons + CSS

Icons in the PlatformUI interface are provided by an icon font. For Content Types, the idea is to expand that concept so that while generating the interface, we end up with a code similar to:

``` brush:
 <h1 class="ez-contenttype-icon ez-contenttype-icon-folder">Folder Name</h1>
```

 

With such classes, the `h1` is specified to display a Content Type icon. The class `ez-contenttype-icon` makes sure the element is styled for that and gets the default Content Type icon. The second class is specific to the Content Type based on its identifier and if it's defined in one of the CSS files, the element will get the custom Content Type icon defined there.

### Adding new Content Type icons

The extensibility of Content Type icons is tackled differently depending on the use case, but it relies on the ability to embed a custom CSS file in PlatformUI with `css.yml`.

To prevent the need to configure/extend the system, we provide several pre-configured icons for very common Content Types such as:

-   `product`
-   `author`
-   `category`
-   `gallery` / `portfolio`
-   `blog_post` / `blogpost` / `post`
-   `blog` / `weblog`
-   `news`
-   `pdf`
-   `document`
-   `photo`
-   `comment`
-   `wiki`
-   `wiki_page` / `wikipage`

There are three ways of choosing Content Type icons:

#### Pick an icon for a custom Content Type from existing icons

In such a case you need to pick the icon code. For that, <a href="https://icomoon.io/app/">the icomoon application</a> can be used until the UI guidelines are up-to-date and reference the available icons. To ease that process and the readability of the code, we'll use ligatures in the font icon so that the CSS code for a custom Content Type could look like:

``` brush:
 /* in a custom CSS file included with `css.yml` */
.ez-contenttype-icon-mycontenttypeidentifier:before {
    content: "product"; /* because this icon matches the usage of such content
    items */
}
```

 

#### Add custom icons

If the icons we provide do not fit a custom Content Type, then a new custom icon font has to be added. To generate the icon, the Icomoon App can be used (or any other tool). Then, using a custom CSS stylesheet, this font can be included and the `ez-contenttype-icon-<content type identifier>` can be configured to use that font.

Example:

``` brush:
/* in a custom CSS file included with `css.yml` */
@font-face {
    font-family: 'my-icon-font';
    src:url('../../fonts/my-icon-font.eot');
    src:url('../../fonts/my-icon-font.eot?#iefix') format('embedded-opentype'),
        url('../../fonts/my-icon-font.woff') format('woff'),
        url('../../fonts/my-icon-font.ttf') format('truetype'),
        url('../../fonts/my-icon-font.svg#my-icon-font') format('svg');
    font-weight: normal;
    font-style: normal;
}
.ez-contenttype-icon-myidentifier:before {
    font-family: 'my-icon-font';
    content: "myiconcode";
}
/* repeated as many times as needed for each custom Content Type */
```

 

#### Completely override the icon set

The solution for this use case is very close to the previous one. A custom icon font will have to be produced, loaded with a custom CSS file, and then the `ez-contenttype-icon` style has to be changed to use that new font.

Example:

``` brush:
/* in a custom CSS file included with `css.yml` */
@font-face {
    font-family: 'my-icon-font';
    src:url('../../fonts/my-icon-font.eot');
    src:url('../../fonts/my-icon-font.eot?#iefix') format('embedded-opentype'),
        url('../../fonts/my-icon-font.woff') format('woff'),
        url('../../fonts/my-icon-font.ttf') format('truetype'),
        url('../../fonts/my-icon-font.svg#my-icon-font') format('svg');
    font-weight: normal;
    font-style: normal;
}
.ez-contenttype-icon:before {
    font-family: 'my-icon-font'; /* replaces ez-platformui-icomoon */
    /* no further change needed if the custom icon font uses the same
     * codes/ligatures
     */
}
```

 

## Custom Javascript

Custom Javascript can be added to PlatformUI using the following configuration block:

``` brush:
ez_platformui:
    system:
        default:
            javascript:
                files:
                   - '<path to js file>'
```

#### In this topic:

-   [Backoffice interface](#ExtendingeZPlatform-Backofficeinterface)
    -   [Technical architecture](#ExtendingeZPlatform-Technicalarchitecture)
        -   [Views: main view, sub-view, side view](#ExtendingeZPlatform-Views:mainview,sub-view,sideview)
        -   [View services](#ExtendingeZPlatform-Viewservices)
    -   [How are pages generated?](#ExtendingeZPlatform-Howarepagesgenerated?)
        -   [Browser side rendering](#ExtendingeZPlatform-Browsersiderendering)
        -   [Server side rendering](#ExtendingeZPlatform-Serversiderendering)
    -   [UI Components](#ExtendingeZPlatform-UIComponents)
        -   [Navigation hub](#ExtendingeZPlatform-Navigationhub)
        -   [Bar views: Discovery Bar View, Action Bar View, Edit Action Bar View](#ExtendingeZPlatform-Barviews:DiscoveryBarView,ActionBarView,EditActionBarView)
        -   [Universal Discovery Widget](#ExtendingeZPlatform-UniversalDiscoveryWidget)
-   [Extending the Dashboard](#ExtendingeZPlatform-ExtendingtheDashboard)
    -   [Create a block view](#ExtendingeZPlatform-Createablockview)
    -   [Create a template](#ExtendingeZPlatform-Createatemplate)
    -   [Create a plugin for the view](#ExtendingeZPlatform-Createapluginfortheview)
    -   [Add modules to configuration](#ExtendingeZPlatform-Addmodulestoconfiguration)
-   [Extending the Landing Page (Enterprise)](#ExtendingeZPlatform-ExtendingtheLandingPage(Enterprise))
    -   [Block templates](#ExtendingeZPlatform-Blocktemplates)
    -   [Extending the Form Builder](#ExtendingeZPlatform-ExtendingtheFormBuilder)
        -   [Field definitions](#ExtendingeZPlatform-Fielddefinitions)
        -   [Validators](#ExtendingeZPlatform-Validators)
        -   [Signal slots](#ExtendingeZPlatform-Signalslots)
        -   [Other Form Builder fields](#ExtendingeZPlatform-OtherFormBuilderfields)
-   [Further extensibility](#ExtendingeZPlatform-Furtherextensibility)
    -   [Content Type icons](#ExtendingeZPlatform-ContentTypeicons)
        -   [Adding new Content Type icons](#ExtendingeZPlatform-AddingnewContentTypeicons)
    -   [Custom Javascript](#ExtendingeZPlatform-CustomJavascript)

## Attachments:

<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [network\_panel2.png](attachments/31429689/31430345.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [udw.png](attachments/31429689/31430346.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [locationview2.png](attachments/31429689/31430347.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [nav\_hub.png](attachments/31429689/31430348.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [sub-views.png](attachments/31429689/31430349.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [locationview.png](attachments/31429689/31430350.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [network\_panel.png](attachments/31429689/31430351.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [architecture\_platformui.png](attachments/31429689/31430352.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [architecture\_platformui.svg](attachments/31429689/31430353.svg) (image/svg+xml)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[API](API_31429524.html)</span>
4.  <span>[REST API Guide](REST-API-Guide_31430286.html)</span>

 Developer : Extending the REST API 



The eZ Platform REST API comes with a framework that makes it quite easy to extend the API for your own needs.

## Requirements

REST routes are required to use the eZ Platform REST API prefix, `/api/ezp/v2`. You can create new resources below this prefix.

To do so, you will/may need to create

-   a Controller that will handle your route actions
-   a Route, in your bundle's routing file
-   a Controller action
-   Optionally, a `ValueObjectVisitor` (if your Controller returns an object that doesn't already have a converter)
-   Optionally, an `InputParser`

### Controller

To create a REST controller, you need to extend the `ezpublish_rest.controller.base` service, as well as the `eZ\Publish\Core\REST\Server\Controller` class.

Let's create a very simple controller, that has a `sayHello()` method, that takes a name as an argument.

**My/Bundle/RestBundle/Rest/Controller/DefaultController.php**

``` brush:
namespace My\Bundle\RestBundle\Rest\Controller;
 
use eZ\Publish\Core\REST\Server\Controller as BaseController;
 
class DefaultController extends BaseController
{
    public function sayHello( $name )
    {
        // @todo Implement me
    }
}
```

### Route

As said earlier, your REST routes are required to use the REST URI prefix. To do so, the easiest way is to import your routing file using this prefix.

**app/config/routing.yml**

``` brush:
myRestBundle_rest_routes:
    resource: "@MyRestBundle/Resources/config/routing_rest.yml"
    prefix:   %ezpublish_rest.path_prefix%
```

Using a distinct file for REST routes allows you to use the prefix for all this file's routes without affecting other routes from your bundle.

Next, you need to create the REST route. We need to define the route's <a href="http://symfony.com/doc/current/cookbook/controller/service.html">controller as a service</a> since our controller was defined as such.

**My/Bundle/RestBundle/Resources/config/routing\_rest.yml**

``` brush:
myRestBundle_hello_world:
    pattern: /my_rest_bundle/hello/{name}
    defaults:
        _controller: myRestBundle.controller.default:sayHello
    methods: [GET]
```

<span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
Due to <span class="jira-issue resolved"> <a href="https://jira.ez.no/browse/EZP-23016?src=confmacro" class="jira-issue-key"><img src="https://jira.ez.no/images/icons/issuetypes/bug.png" class="icon" />EZP-23016</a> - <span class="summary">Custom REST API routes (v2) are not accessible from the legacy backend</span> <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-success jira-macro-single-issue-export-pdf">Closed</span> </span> , custom REST routes must be prefixed with `ezpublish_rest_`, or they won't be detected correctly.

## Controller action

Unlike standard Symfony 2 controllers, the REST ones don't return an `HttpFoundation\Response` object, but a `ValueObject`. This object will during the kernel run be converted, using a ValueObjectVisitor, to a proper Symfony 2 response. One benefit is that when multiple controllers return the same object, such as a Content item or a Location, the visitor will be re-used.

Let's say that our Controller will return a `My\Bundle\RestBundle\Rest\Values\Hello`

**My/Bundle/RestBundle/Rest/Values/Hello.php**

``` brush:
namespace My\Bundle\RestBundle\Rest\Values;
 
class Hello
{
    public $name;
 
    public function __construct( $name )
    {
        $this->name = $name;
    }
}
```

We will return an instance of this class from our `sayHello()` controller method.

**My/Bundle/RestBundle/Rest/Controller/DefaultController.php**

``` brush:
namespace My\Bundle\RestBundle\Controller;

use eZ\Publish\Core\REST\Server\Controller as BaseController;
use My\Bundle\RestBundle\Rest\Values\Hello as HelloValue;

class DefaultController extends BaseController
{
    public function sayHello( $name )
    {
        return new HelloValue( $name );
    }
}
```

And that's it. Outputting this object in the Response requires that we create a ValueObjectVisitor.

## ValueObjectVisitor

A ValueObjectVisitor will take a Value returned by a REST controller, whatever the class, and will transform it into data that can be converted, either to json or XML. Those visitors are registered as services, and tagged with `ezpublish_rest.output.value_object_visitor`. The tag attribute says which class this Visitor applies to.

Let's create the service for our ValueObjectVisitor first.

**My/Bundle/RestBundle/Resources/config/services.yml**

``` brush:
services:
    myRestBundle.value_object_visitor.hello:
        parent: ezpublish_rest.output.value_object_visitor.base
        class: My\Bundle\RestBundle\Rest\ValueObjectVisitor\Hello
        tags:
            - { name: ezpublish_rest.output.value_object_visitor, type: My\Bundle\RestBundle\Rest\Values\Hello }
```

Let's create our visitor next. It must extend the  `eZ\Publish\Core\REST\Common\Output\ValueObjectVisitor` abstract class, and implement the `visit()` method.
It will receive as arguments:

-   `$visitor`: The output visitor. Can be used to set custom response headers ( `setHeader( $name, $value )`), HTTP status code ( `setStatus( $statusCode )` )...
-   `$generator`: The actual Response generator. It provides you with a DOM like API.
-   `$data`: the visited data, the exact object you returned from the controller 

**My/Bundle/RestBundle/Rest/Controller/Default.php**

``` brush:
namespace My\Bundle\RestBundle\Rest\ValueObjectVisitor;

use eZ\Publish\Core\REST\Common\Output\ValueObjectVisitor;
use eZ\Publish\Core\REST\Common\Output\Generator;
use eZ\Publish\Core\REST\Common\Output\Visitor;

class Hello extends ValueObjectVisitor
{
    public function visit( Visitor $visitor, Generator $generator, $data )
    {
        $generator->startValueElement( 'Hello', $data->name );
        $generator->endValueElement( 'Hello' );
    }
}
```

Do not hesitate to look into the built-in ValueObjectVisitors, in `           eZ/Publish/Core/REST/Server/Output/ValueObjectVisitor         `, for more examples.

### Cache handling

The easiest way to handle cache is to re-use the `           CachedValue         ` Value Object. It acts as a proxy, and adds the cache headers, depending on the configuration, for a given object and set of options.

When you want the response to be cached, return an instance of CachedValue, with your Value Object as the argument. You can also pass a location id using the second argument, so that the Response is tagged with it:

``` brush:
return new CachedValue($helloValue, ['locationId', 42]);
```

## Input parser

What we have seen above covers requests that don't require an input payload, such as GET or DELETE. If you need to provide your controller with parameters, either in JSON or XML, the parameter struct requires an Input Parser so that the payload can be converted to an actual ValueObject.

Each payload is dispatched to its Input Parser based on the request's Content-Type header. For example, a request with a Content-Type of `application/vnd.ez.api.ContentCreate` will be parsed by `eZ\Publish\Core\REST\Server\Input\Parser\ContentCreate`. This parser will build and return a `ContentCreateStruct` that can then be used to create content with the Public API.

Those input parsers are provided with a pre-parsed version of the input payload, as an associative array, and don't have to care about the actual format (XML or JSON).

Let's see what it would look like with a Content-Type of application/vnd.my.Greetings, that would send this as XML:

**application/vnd.my.Greetings+xml**

``` brush:
<?xml version="1.0" encoding="utf-8"?>
<Greetings>
    <name>John doe</name>
</Greetings>
```

First, we need to create a service with the appropriate tag in services.yml.

**My/Bundle/RestBundle/Resources/config/services.yml**

``` brush:
services:
    myRestBundle.input_parser.Greetings:
        parent: ezpublish_rest.input.parser
        class: My\Bundle\RestBundle\Rest\InputParser\Greetings
        tags:
            - { name: ezpublish_rest.input.parser, mediaType: application/vnd.my.Greetings }
```

The mediaType attribute of the ezpublish\_rest.input.parser tag maps our Content Type to the input parser.

Let's implement our parser. It must extend eZ\\Publish\\Core\\REST\\Server\\Input\\Parser, and implement the `parse()` method. It accepts as an argument the input payload, `$data`, as an array, and an instance of `ParsingDispatcher` that can be used to forward parsing of embedded content.

For convenience, we will consider that our input parser returns an instance of our `Value\Hello` class.

**My/Bundle/RestBundle/Rest/InputParser/Greetings.php**

``` brush:
namespace My\Bundle\RestBundle\Rest\InputParser;
 
use eZ\Publish\Core\REST\Common\Input\BaseParser;
use eZ\Publish\Core\REST\Common\Input\ParsingDispatcher;
use My\Bundle\RestBundle\Rest\Value\Hello;
use eZ\Publish\Core\REST\Common\Exceptions;


class Greetings extends BaseParser
{
    /**
     * @return My\Bundle\RestBundle\Rest\Value\Hello
     */
    public function parse( array $data, ParsingDispatcher $parsingDispatcher )
    {
        // re-using the REST exceptions will make sure that those already have a ValueObjectVisitor
        if ( !isset( $data['name'] ) )
            throw new Exceptions\Parser( "Missing or invalid 'name' element for Greetings." );


        return new Hello( $data['name'] );
    }
}
```

**My/Bundle/RestBundle/Resources/config/services.yml**

``` brush:
services:
    myRestBundle.controller.default:
        class: My\Bundle\RestBundle\Rest\Controller\Default
        parent: ezpublish_rest.controller.base
```

Do not hesitate to look into the built-in InputParsers, in `eZ/Publish/Core/REST/Server/Input/Parser`, for more examples.

 

## Registering resources in the REST root

You can register newly added resources so that they show up in the REST root resource for automatic discovery.

New resources can be registered with code like this:

``` brush:
ez_publish_rest:
    system:
        default:
            rest_root_resources:
                someresource:
                    mediaType: 'Content'
                    href: 'router.generate("ezpublish_rest_loadContent", {"contentId": 2})'
```

with `someresource` being a unique key.

 

The `router.generate` call dynamically renders a URI based on the name of the route and the optional parameters that are passed as the other arguments (in the code above this is the `contentId`).

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
This syntax is based on <a href="http://symfony.com/doc/current/components/expression_language/index.html">Symfony's expression language</a>, an extensible component that allows limited / readable scripting to be used outside code context.

 

The above configuration will add the following entry to the root resource:

`<someresource media-type="application/vnd.ez.api.Content+xml" href="/api/ezp/v2/content/objects/2"/>`

#### In this topic:

-   [Requirements](#ExtendingtheRESTAPI-Requirements)
    -   [Controller](#ExtendingtheRESTAPI-Controller)
    -   [Route](#ExtendingtheRESTAPI-Route)
-   [Controller action](#ExtendingtheRESTAPI-Controlleraction)
-   [ValueObjectVisitor](#ExtendingtheRESTAPI-ValueObjectVisitor)
    -   [Cache handling](#ExtendingtheRESTAPI-Cachehandling)
-   [Input parser](#ExtendingtheRESTAPI-Inputparser)
-   [Registering resources in the REST root](#ExtendingtheRESTAPI-RegisteringresourcesintheRESTroot)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[API](API_31429524.html)</span>

 Developer : Field Type API and best practices 



# Field Type API & best practices

eZ Platform can support arbitrary data to be stored in the fields of a content item. In order to support custom data, besides the standard data types, a developer needs to create a custom **Field Type**.

The implementation of a custom Field Type is done based on the Field Type SPI and its interfaces. These can be found under `eZ\Publish\SPI\FieldType`.

In order to provide custom functionality for a Field Type, the SPI interacts with multiple layers of the eZ Platform architecture, as shown in the following diagram:

 <span class="confluence-embedded-file-wrapper"><img src="attachments/31430767/31430766.png" class="confluence-embedded-image" /></span>

On the top layer, the Field Type needs to provide conversion from and to a simple PHP hash value to support the REST API. The generated hash value may only consist of scalar values and hashes. It must not contain objects or arrays with numerical indexes that aren't sequential and/or don't start with zero.

Below that, the Field Type must support the Public API implementation (aka Business Layer), regarding:

-   Settings definition for FieldDefinitions
-   Value creation and validation
-   Communication with the Persistence SPI

On the bottom level, a Field Type can additionally hook into the Persistence SPI, in order to store data from a FieldValue in an external service. Note that all non-standard eZ Publish database tables (e.g. `ezurl`) are also considered "external storage" from now on.

The following sequence diagram visualizes the process of creating a new `Content` across all layers, especially focused on the interaction with a `FieldType`.

<span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img src="attachments/31430767/31430764.png" class="confluence-embedded-image" width="900" /></span>
 

In the next lines/pages, this document explains how to implement a custom Field Type based on the SPI and what is expected from it. As a code example, please refer to the Url FieldType, which has been implemented as a reference.

## Public API interaction

The interaction with the Public API is done through the interface `eZ\Publish\SPI\FieldType\FieldType`. A custom Field Type must provide an implementation of this interface. In addition, it is considered best practice to provide a value object class for storing the custom field value provided by the Field Type.

### FieldDefinition handling

In order to make use of a custom Field Type, the user must apply it in a `eZ\Publish\API\Repository\Values\ContentType\FieldDefinition` of a custom Content Type. The user may in addition provide settings for the Field Type and a validator configuration.  Since the Public API cannot know anything about these, their handling is delegated to the Field Type itself through the following methods:

`getFieldTypeIdentifier()`

Returns a unique identifier for the custom Field Type, which is used to assign the type to a Field Definition. By convention for the returned type identifier string should be prefixed by a unique shortcut for the vendor (e.g. `ez` for eZ Systems).

`getSettingsSchema()`

Using this method, the Public API retrieves a schema for the field type settings. A typical setting would e.g. be a default value. The settings structure defined by this schema is stored in the `FieldDefinition`. Since it is not possible to define a generic format for such a schema, the Field Type is free to return any serializable data structure from this method.

`getValidatorConfigurationSchema()`

In addition to normal settings, the Field Type should provide a schema settings for it's validation process. The schema describes, what kind of validation can be performed by the Field Type and which settings the user can specify to these validation methods. For example, the `ezstring` type can validate minimum and maximum length of the string. It therefore provides a schema to indicate to the user that he might specify the corresponding restrictions, when creating a `FieldDefinition` with this type. Again, the schema does not underlie any regulations, except for that it must be serializable.

`validateFieldSettings()`

Before the Public API stores settings for the `FieldType` in a `FieldDefinition`, the type is asked to validate the settings (which were provided by the user). As a result, the `FieldType` must return if the given settings comply to the schema defined by `getSettingsSchema()`. `validateValidatorConfiguration()` Analog to `validateFieldSettings()`, this method verifies that the given validator configuration complies to the schema provided by `getValidatorConfigurationSchema()`.

It is important to note that while the schema definitions of the `FieldType` maybe both be of arbitrary, serializable format, it is highly recommended to use a simple hash structure. It is highly recommended to follow the [Best practices](#FieldTypeAPIandbestpractices-Bestpractices) in order to create future proof schemas.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
**Note:** Since it is not possible to enforce a schema format, the code using a specific `FieldType` must basically know all `FieldType`s it deals with.

This will also apply to all user interfaces and the REST API, which therefore must provide extension points to register handling code for custom `FieldType`. These extensions are not defined, yet.

#### Name of the Field Type

If you implement Nameable as an extra service, and register this Service using the tag `nameable`, the method `{FieldType}Nameable->getFieldName()` will be used to retrieve the name.

Otherwise the regular `{FieldType}->getName()` method is used.

**Example from fieldtype\_services.yml**

``` brush:
# Nameable services (for fieldtypes that need advance name handling)
    ezpublish.fieldType.ezobjectrelation.nameable_field:
        class: %ezpublish.fieldType.ezobjectrelation.nameable_field.class%
        arguments:
          - @ezpublish.spi.persistence.cache.contentHandler
        tags:
            - {name: ezpublish.fieldType.nameable, alias: ezobjectrelation}
```

 

### Value handling

A field type needs to deal with the custom value format provided by it. In order for the public API to work properly, it delegates working with such custom field values to the corresponding Field Type. The `SPI\FieldType\FieldType` interface therefore provides the following methods:

`acceptValue()`

This method is responsible for accepting and converting user input for the field. It checks the input structure it accepts and might build and return a different structure holding the data. An example would be, that the user just provides an HTTP link as a string, which is converted to the value object of the Url FieldType. Unlike the `FieldType\Value` constructor, it is perfectly acceptable to make this method aware of multiple input types (object or primitive, for instance).

Note: The method must assert structural consistency of the value, but must not validate plausibility of the value.

`getEmptyValue()`

Through settings, the `FieldType` can specify, that the user may define a default value for the `Field` of the type. If no such default is provided by the user, the `FieldType` itself is asked for an "empty value" as the final fallback. The value chain for a specific field is therefore like this, when a `Field` of the `FieldType` is filled out:

1.  1.  Is a value provided by the filling user?
    2.  Is a default provided by the `FieldDefinition`?
    3.  Take the empty value provided by the `FieldType`

`validate()`

In contrast to `acceptValue()` this method validates the plausibility of the given value, based on the `FieldType` settings and validator configuration, stored in the corresponding `FieldDefinition`.

### <span style="font-size: 1.4em;">Storage conversion</span>

As said above, the value format of a `FieldType` is free form. However, in order to make eZ Publish store the value in it's database, it must comply to certain rules at storage time. To not restrict the value itself, a `FieldValue` must be converted to the storage specific format used by the Persistence SPI: `eZ\Publish\SPI\Persistence\Content\FieldValue`. After restoring a Field of `FieldType`, the conversion must be undone. The following methods of the `FieldType` are responsible for that:

`toPersistenceValue()`

This method receives the value of a `Field` of `FieldType` and must return an SPI `FieldValue`, which can be stored.

`fromPersistenceValue()`

As the counterpart, this method receives an SPI `FieldValue` and must reconstruct the original value of the `Field` from it.

The SPI FieldValue struct has several properties, which might be used by the FieldType as follows:

`$data`

The data to be stored in the eZ Publish database. This may either be a scalar value, a hash map or a simple, serializable object.

`$externalData`

The arbitrary data stored in this field will not be touched by any of the eZ Publish components directly, but will be hold available for [Storing external data](#FieldTypeAPIandbestpractices-Storingexternaldata).

`$sortKey`

An value which can be used to sort `Content` by the field.

*Note: TBD: Where will you register the Indexable implementations?*

## Searching

Fields, or a custom field type, might contain or maintain data which is relevant for user searches. To make the search engine aware of the data in your field type you need to implement an additional interface and register the implementation.

If your field type does not maintain any data, which should be available to search engines, feel free to just ignore this section.

The` eZ\Publish\SPI\FieldType\Indexable` defines two methods, which are required to be implemented, if the field type provides data relevant to search engines. The interface defines two methods for this:

`getIndexData( Field $field )`

This method is supposed to return the actual index data for the provided `eZ\Publish\SPI\Persistence\Content\Field`. The index data consists of an array of `eZ\Publish\SPI\Persistence\Content\Search\Field` instances. They are described below in further detail.

`getIndexDefinition()`

To be able to query data properly an indexable field type also is required to return search specification. You must return a hash map of `eZ\Publish\SPI\Persistence\Content\Search\FieldType` instances from this method, which could look like:

``` brush:
array(
    'url'  => new Search\FieldType\StringField(),
    'text' => new Search\FieldType\StringField(),
)
```

 This example from the `Url` field type shows that the field type will always return two indexable values, both strings. They have the names `url` and `text` respectively.

### Search Field Values

The search field values, returned by the `getIndexData` method are simple value objects consisting of the following properties:

`$name`

The name of the field

`$value`

The value of the field

`$type`

An `eZ\Publish\SPI\Persistence\Content\Search\FieldType` instance, describing the type information of the field.

### Search Field Types

There are bunch of available search field types, which are automagically handled by our Search backend configuration. When using those there is no requirement to adapt , for example, the Solr configuration in any way. You can always use custom field types, though, but these might require re-configuration of the search backend. For Solr this would mean adapting the schema.xml.

The default available search field types are:

`StringField.php`

Standard string values. Will also be queries by full text searches.

`TextField.php`

Standard text values. Will be queried by full text searches. Configured text normalizations in the search backend apply.

`BooleanField.php`

Boolean values.

`DateField.php`

Date field. Can be used for date range queries.

`FloatField.php`

Field for floating point numbers.

`IntegerField.php`

Field for integer numbers.

`PriceField.php`

Field for price values. Currency conversion might be applied by the search backends. Might require careful configuration.

`IdentifierField.php`

Field used for IDs. Basically acts like the string field, but will not be queried by fulltext searches

`CustomField.php`

Custom field, for custom search data types. Will probably require additional configuration in the search backend.

### Configuring Solr

As mentioned before, if you are using the standard type definitions **there is no need to configure the search backend in any way**. Everything will work fine. The field definitions are handled using `dynamicField` definitions in Solr, for example.

If you want to configure the handling of your field, you can always add a special field definition the Solr `schema.xml`. The field type names, which are used by the Solr search backend look like this for fields: `<content_type_identifier>/<field_identifier>/<search_field_name>_<type>`. You can, of course define custom `dynamicField` definitions to match, for example, on your custom `_<type>` definition.

You could also define a custom field definition dedicatedly for certain fields, like for the name field in an article:

``` brush:
<field name="article/name/value_s" type="string" indexed="true" stored="true" required="false"/>
```

If you want to learn more about the Solr implementation and detailed information about configuring it, check out the [Solr Search Service Implementation Notes](https://doc.ez.no/display/TMPA/Solr+Search+Service+Implementation+Notes).

## Storing external data

A `FieldType` may store arbitrary data in external data sources and is in fact encouraged to do so. External storages can be e.g. a web service, a file in the file system, another database or even the eZ Publish database itself (in form of a non-standard table). In order to perform this task, the `FieldType` will interact with the Persistence SPI, which can be found in `eZ\Publish\SPI\Persistence`, through the `eZ\Publish\SPI\FieldType\FieldStorage` interface.

Whenever the internal storage of a Content item that includes a Field of the `FieldType` is accessed, one of the following methods is called to also access the external data:

`hasFieldData()`

Returns if the `FieldType` stores extrnal data at all.

`storeFieldData()`

Called right before a `Field` of `FieldType` is stored. The method should perform the storing of `$externalData`. The method must return `true`, if the call manipulated **internal data** of the given `Field`, so that it is updated in the internal database.

`getFieldData()`

Is called after a `Field` has been restored from the database in order to restore `$externalData`.

`deleteFieldData()`

Must delete external data for the given `Field`, if exists.

`getIndexData()`

See search service

Each of the above methods receive a $context array, which contains information on the underlying storage and the environment. This context can be used to store data in the eZ Publish data storage, but outside of the normal structures (e.g. a custom table in an SQL database). Note that the Field Type must take care on it's own for being compliant to different data sources and that 3rd parties can extend the data source support easily. For more information about this, take a look at the [Best practices](#FieldTypeAPIandbestpractices-Bestpractices)<a href="" class="reference internal"></a> section.

## Legacy Storage conversion

The `FieldType` system is designed for future storage back ends of eZ Publish. However, the old database schema (*Legacy Storage*) must still be supported. Since this database cannot store arbitrary value information as provided by a `FieldType`, another conversion step must take place if the Legacy Storage is used.

The conversion takes place through the interface `eZ\Publish\Core\Persistence\Legacy\Content\FieldValue\Converter`, which you must provide an implementation of with your `FieldType`. The following methods are contained in the interface:

`toStorageValue()`

Converts a Persistence `Value` into a legacy storage specific value.

`fromStorageValue()`

Converts the other way around.

`toStorageFieldDefinition()`

Converts a Persistence `FieldDefinition` to a storage specific one.

`fromStorageFieldDefinition`

Converts the other way around.

`getIndexColumn()`

Returns the storage column which is used for indexing.

### Registering a converter

The registration of a `Converter` currently works through the `$config` parameter of `eZ\Publish\Core\Persistence\Legacy\Handler`. See the class documentation for further details.

 

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
For global service container integration, see [Register Field Type](Register-Field-Type_31430769.html).

## REST API interaction

When REST API is used, conversion needs to be done for `FieldType` values, settings and validator configurations. These are converted to and from a simple hash format that can be encoded in REST payload (typically XML or JSON). As conversion needs to be done both when transmitting and receiving data through REST, `FieldType` implements following pairs of methods:

`toHash()`

Converts FieldType Value into a plain hash format.

`fromHash()`

Converts the other way around.

`fieldSettingsToHash()`

Converts FieldType settings to a simple hash format.

`fieldSettingsFromHash()`

Converts the other way around.

`validatorConfigurationToHash()`

Converts FieldType validator configuration to a simple hash format.

`validatorConfigurationFromHash()`

Converts the other way around.

### Extension points

Some `FieldTypes` will require additional processing, for example a `FieldType` storing a binary file, or one having more complex settings or validator configuration. For this purpose specific implementations of an abstract class `eZ\Publish\Core\REST\Common\FieldTypeProcessor` are used. This class provides following methods:

`preProcessValueHash()`

Performs manipulations on a received value hash, so that it conforms to the format expected by the `fromHash()` method described above.

`postProcessValueHash()`

Performs manipulations on a outgoing value hash, previously generated by the `toHash()` method described above.

`preProcessFieldSettingsHash()`

Performs manipulations on a received settings hash, so that it conforms to the format expected by the `fieldSettingsFromHash()` method described above.

`postProcessFieldSettingsHash()`

Performs manipulations on a outgoing settings hash, previously generated by the `fieldSettingsToHash()` method described above.

`preProcessValidatorConfigurationHash()`

Performs manipulations on a received validator configuration hash, so that it conforms to the format expected by the `validatorConfigurationFromHash()` method described above.

`postProcessValidatorConfigurationHash()`

Performs manipulations on a outgoing validator configuration hash, previously generated by the `validatorConfigurationToHash()` method described above.

Base implementations of these methods simply return the given hash, so you can implement only the methods your `FieldType` requires. Some `FieldTypes` coming with the eZ Publish installation already implement processors and you are encouraged to take a look at them.

For details on registering a `FieldType` processor, see [Register Field Type](Register-Field-Type_31430769.html).

## Best practices

In this chapter, best practices for implementing a custom FieldType are collected. We highly encourage following these practices to be future proof.

### Gateway based Storage

In order to allow the usage of a `FieldType` that uses external data with different data storages, it is recommended to implement a gateway infrastructure and a registry for the gateways. In order to ease this action, the Core implementation of `FieldType` s provides corresponding interfaces and base classes. These can also be used for custom field types.

The interface `eZ\Publish\Core\FieldType\StorageGateway` is implemented by gateways, in order to be handled correctly by the registry. It has only a single method:

`setConnection()`

The registry mechanism uses this method to set the SPI storage connection (e.g. the database connection to the Legacy Storage database) into the gateway, which might be used to store external data. The connection is retrieved from the `$context` array  automatically by the registry.

Note that the Gateway implementation itself must take care about validating that it received a usable connection. If it did not, it should throw a `RuntimeException`.

The registry mechanism is realized as a base class for `FieldStorage` implementations: `eZ\Publish\Core\FieldType\GatewayBasedStorage`. For managing `StorageGateway` s, the following methods are already implemented in the base class:

`addGateway()`

Allows the registration of additional `StorageGateway`s from the outside. Furthermore, a hash map of `StorageGateway`s can be given to the constructor for basic initialization. This array should orginate from the Dependency Injection mechanism.

`getGateway()`

This protected method is used by the implementation to retrieve the correct `StorageGateway` for the current context.

As a reference for the usage of these infrastructure, the Keyword, Url and User types can be examined.

### Settings schema

It is recommended to use a simple hash map format for the settings schema retured by <span class="pre">eZ\\Publish\\SPI\\FieldType\\FieldType::getSettingsSchema()</span>, which follows these rules:

-   The key of the hash map identifies a setting (e.g. `default`)
-   Its value is a hash map (2nd level) describing the setting using
    -   `type` to identify the setting type (e.g. `int` or `string`)
    -   `default` containing the default setting value

An example schema could look like this:

``` brush:
array(
    'backupData' => array(
        'type' => 'bool',
        'default' => false
    ),
    'defaultValue' => array(
        'type' => 'string',
        'default' => 'Sindelfingen'
    )
);
```

 

### Validator schema

The schema for validator configuration should have a similar format than the settings schema has, except it has an additional level, to group settings for a certain validation mechanism:

-   The key on the 1st level is a string, identifying a validator
-   Assigned to that is a hash map (2nd level) of settings
-   This hash map has a string key for each setting of the validator
-   It is assigned to a 3rd level hashmap, the setting description
-   This hash map should have the same format as for normal settings

For example, for the `ezstring` type, the validator schema could be:

``` brush:
array(
    'stringLength' => array(
        'minStringLength' => array(
            'type'    => 'int',
            'default' => 0,
        ),
        'maxStringLength' => array(
            'type'    => 'int'
            'default' => null,
        )
    ),
);
```

## Registering a Field Type

To register a Field Type, see [Register Field Type](Register-Field-Type_31430769.html).

To be integrated in unit and integration tests, Field Types need to be registered through the `service.ini` in `eZ/Publish/Core/settings`.

## Templating

A FieldType always need a piece of template to be correctly displayed. See [Field Type template](Field-Type-template_31430773.html).

## Testing

`FieldType` s should be integration tested on 1 different levels:

1.  Their integration with the Persistence SPI
2.  Their integration with the Public API

For both test environments, infrastructure is already in place, so that you can easily implement the required tests for your custom `FieldType`

### Persistence SPI

This type of integration test ensures, that a Field Type stores its data properly on basis of different Persistence SPI implementations.

 

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
**Note:** By now, only the Legacy Storage implementation exists.

 

The integration tests with the Persistence SPI can be found in `eZ\Publish\SPI\Tests\FieldType`. In order to implement a test for your custom `FieldType`, you need to extend the common base class `eZ\Publish\SPI\Tests\FieldType\BaseIntegrationTest` and implement it's abstract methods. As a reference the `KeywordIntegrationTest`, `UrlIntegrationTest` and `UserIntegrationTest` can deal.

Running the test is fairly simple: Just specify the global `phpunit.xml` for PHPUnit configuration and make it execute a single test or a directory of tests, for example:

``` brush:
$ phpunit -c phpunit.xml eZ/Publish/SPI/Tests/FieldType
```

in order to run all `FieldType` tests.

### Public API

On a second level, the interaction between an implementation of the Public API (aka the Business Layer) and the Field Type is tested. Again, there is a common base class as the infrastructural basis for such tests, which resides in `eZ\Publish\API\Repository\Tests\FieldType\BaseIntegrationTest`.

 

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Note that the In-Memory stubs for the Public API integration test suite, do not perform actual Field Type calls, but mainly emulate the behavior of a Field Type for simplicity reasons.

If your Field Type needs to convert data between `storeFieldData()` and `getFieldData()`, you need to implement a `eZ\Publish\API\Repository\Tests\Stubs\PseudoExternalStorage` in addition, which performs this task. Running the tests against the Business Layer implementation of the Public API is not affected by this.

 

<!-- -->

 

#### In this topic:

-   [Field Type API & best practices](#FieldTypeAPIandbestpractices-FieldTypeAPI&bestpractices)
    -   [Public API interaction](#FieldTypeAPIandbestpractices-PublicAPIinteraction)
        -   [FieldDefinition handling](#FieldTypeAPIandbestpractices-FieldDefinitionhandling)
        -   [Value handling](#FieldTypeAPIandbestpractices-Valuehandling)
        -   [Storage conversion](#FieldTypeAPIandbestpractices-Storageconversion)
    -   [Searching](#FieldTypeAPIandbestpractices-Searching)
        -   [Search Field Values](#FieldTypeAPIandbestpractices-SearchFieldValues)
        -   [Search Field Types](#FieldTypeAPIandbestpractices-SearchFieldTypes)
        -   [Configuring Solr](#FieldTypeAPIandbestpractices-ConfiguringSolr)
    -   [Storing external data](#FieldTypeAPIandbestpractices-Storingexternaldata)
    -   [Legacy Storage conversion](#FieldTypeAPIandbestpractices-LegacyStorageconversion)
        -   [Registering a converter](#FieldTypeAPIandbestpractices-Registeringaconverter)
    -   [REST API interaction](#FieldTypeAPIandbestpractices-RESTAPIinteraction)
        -   [Extension points](#FieldTypeAPIandbestpractices-Extensionpoints)
    -   [Best practices](#FieldTypeAPIandbestpractices-Bestpractices)
        -   [Gateway based Storage](#FieldTypeAPIandbestpractices-GatewaybasedStorage)
        -   [Settings schema](#FieldTypeAPIandbestpractices-Settingsschema)
        -   [Validator schema](#FieldTypeAPIandbestpractices-Validatorschema)
    -   [Registering a Field Type](#FieldTypeAPIandbestpractices-RegisteringaFieldType)
    -   [Templating](#FieldTypeAPIandbestpractices-Templating)
    -   [Testing](#FieldTypeAPIandbestpractices-Testing)
        -   [Persistence SPI](#FieldTypeAPIandbestpractices-PersistenceSPI)
        -   [Public API](#FieldTypeAPIandbestpractices-PublicAPI)

## Attachments:

<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [create\_content\_sequence.png](attachments/31430767/31430764.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [create\_content\_sequence.svg](attachments/31430767/31430765.svg) (image/svg+xml)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [field\_type\_overview.png](attachments/31430767/31430766.png) (image/png)

## Comments:

<table>
<colgroup>
<col width="100%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><a href=""></a>
<p>If you want to add a fieldtype that is unsearchable, then you can specify the indexable class to be the default one as here:</p>
<pre><code>ezpublish.fieldtype.indexable.myfieldtypeidentifier:
 class: %ezpublish.fieldType.indexable.unindexed.class%
    tags:
 - {name: ezpublish.fieldType.indexable, alias: myfieldtypeidentifier}</code></pre>
<p>Not doing so will lead to errors like this when running the Solr Create Index script:</p>
<p><span class="s1">[OutOfBoundsException]<br />
</span>No type registered for myfieldtypeidentifier.  </p>
<div>
<span class="s1"><br />
</span>
</div>
<div class="smallfont" align="left" style="color: #666666; width: 98%; margin-bottom: 10px;">
<img src="images/icons/contenttypes/comment_16.png" width="16" height="16" /> Posted by jani.tarvainen@ez.no at May 24, 2016 12:55
</div></td>
</tr>
</tbody>
</table>






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[API](API_31429524.html)</span>
4.  <span>[Field Type API and best practices](Field-Type-API-and-best-practices_31430767.html)</span>

 Developer : Field Type template 



# Defining your Field Type template

In order to be used by [`ez_render_field()` Twig helper](https://doc.ez.no/display/TECHDOC/ez_render_field), you need to define a **template containing a block** dedicated to the Field display.

This block consists on a piece of template receiving specific variables you can use to make the display vary.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
You will find examples with built-in Field Types in <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Bundle/EzPublishCoreBundle/Resources/views/content_fields.html.twig">EzPublishCoreBundle/Resources/views/content_fields.html.twig</a>

**Template for a FieldType with "myfieldtype" identifier**

``` brush:
{% block myfieldtype_field %}
{# Your code here #}
{% endblock %}
```

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
By convention, your block **must** be named `<fieldTypeIdentifier>_field`.

## Exposed variables

| Name            | Type                                                   | Description                                                                     |
|-----------------|--------------------------------------------------------|---------------------------------------------------------------------------------|
| `field`         | `eZ\Publish\API\Repository\Values\Content\Field`       | The field to display                                                            |
| `contentInfo`   | `eZ\Publish\API\Repository\Values\Content\ContentInfo` | The ContentInfo to which the field belongs to                                   |
| `versionInfo`   | `eZ\Publish\API\Repository\Values\Content\VersionInfo` | The VersionInfo to which the field belongs to                                   |
| `fieldSettings` | `mixed`                                                | Settings of the field (depends on the FieldType)                                |
| `parameters`    | `hash`                                                 | Options passed to `ez_render_field()` under the `parameters` key                |
| `attr`          | `hash`                                                 | The attributes to add the generate the HTML markup.                             
                                                                            Contains at least a **`class`** entry, containing `<fieldtypeidentifier>-field`  |

## Reusing blocks

To ease Field Type template development, you can take advantage of all defined blocks by using the <a href="http://twig.sensiolabs.org/doc/functions/block.html">block() function</a>.

You can for example take advantage of `simple_block_field`, `simple_inline_field` or `field_attributes` blocks provided in <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Bundle/EzPublishCoreBundle/Resources/views/content_fields.html.twig#L413">content_fields.html.twig</a>.

Warning

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
To be able to reuse built-in blocks, **your template must inherit from `EzPublishCoreBundle::content_fields.html.twig`**.

## Registering your template

 

To make your template available, you must register it to the system.

**app/config/ezplatform.yml**

``` brush:
ezpublish:
    system:
        my_siteaccess:
            field_templates:
                - 
                    template: "AcmeTestBundle:fields:my_field_template.html.twig"
                    # Priority is optional (default is 0). The higher it is, the higher your template gets in the list.
                    priority: 10
```

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
You can define these rules in a dedicated file instead of `app/config/ezplatform.yml`.<span style="color: rgb(51,51,51);"> </span>Read the [cookbook recipe to learn more about it](Importing-settings-from-a-bundle_31429803.html)<span style="color: rgb(51,51,51);">.</span>

#### In this topic:

-   [Defining your Field Type template](#FieldTypetemplate-DefiningyourFieldTypetemplate)
    -   [Exposed variables](#FieldTypetemplate-Exposedvariables)
    -   [Reusing blocks](#FieldTypetemplate-Reusingblocks)
    -   [Registering your template](#FieldTypetemplate-Registeringyourtemplate)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>
6.  <span>[Content items, Content Types and Fields](31430275.html)</span>

 Developer : Field Types reference 



This page contains a reference of Field Types used in eZ Platform.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
For the general Field Type documentation see [Field Type API and best practices](Field-Type-API-and-best-practices_31430767.html).

If you are looking for the documentation on how to implement a custom Field Type, see the [Creating a Tweet Field Type](Creating-a-Tweet-Field-Type_31429766.html) tutorial.

<span>A Field Type is the smallest possible entity of storage. It determines how a specific type of information should be validated, stored, retrieved, formatted and so on. eZ Platform comes with a collection of fundamental types that can be used to build powerful and complex content structures. In addition, it is possible to extend the system by creating custom Field Types for special needs. Custom Field Types have to be programmed in PHP. However, the built-in Field Types are usually sufficient enough for typical scenarios. The following table gives an overview of the supported Field Types that come with eZ Platform.</span>

### <span>Built in Field Types</span>

| FieldType                                                                                                                 | Description                                                                         | Searchable in Legacy Storage engine               |
|---------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------|---------------------------------------------------|
| [Author](Author-Field-Type_31430499.html)                                                                                 | Stores a list of authors, each consisting of author name and author email.          | No                                                |
| [BinaryFile](BinaryField-Field-Type_31430501.html)                                                                        | Stores a file.                                                                      | Yes                                               |
| [Checkbox](Checkbox-Field-Type_31430497.html)                                                                             | Stores a boolean value.                                                             | Yes                                               |
| [Country](Country-Field-Type_31430503.html)                                                                               | Stores country names as a string.                                                   | Yes                                               |
| <span class="confluence-link"> [DateAndTime](DateAndTime-Field-Type_31430505.html) </span>                                | Stores a full date including time information.                                      | <span>Yes</span>                                  |
| <span class="confluence-link"> [Date](Date-Field-Type_31430507.html) </span>                                              | Stores date information.                                                            | <span>Yes</span>                                  |
| <span class="confluence-link"> [EmailAddress](EmailAddress-Field-Type_31430509.html) </span>                              | Validates and stores an email address.                                              | Yes                                               |
| <span class="confluence-link"> [Float](Float-Field-Type_31430511.html) </span>                                            | Validates and stores a decimal value.                                               | No                                                |
| <span class="confluence-link"> [Image](Image-Field-Type_31430513.html) </span>                                            | Validates and stores an image.                                                      | No                                                |
| <span class="confluence-link"> [Integer](Integer-Field-Type_31430515.html) </span>                                        | Validates and stores an integer value.                                              | Yes                                               |
| <span class="confluence-link"> [ISBN](ISBN-Field-Type_31430517.html) </span>                                              | Handles International Standard Book Number (ISBN) in 10-digit or 13-digit format.   | Yes                                               |
| <span class="confluence-link"> [Keyword](Keyword-Field-Type_31430519.html) </span>                                        | Stores keywords.                                                                    | No                                                |
| [Landing Page](31430521.html)                                                                                             | Stores a page with a layout consisting of multiple zones.                           | No                                                |
| <span class="confluence-link"> [MapLocation](MapLocation-Field-Type_31430523.html) </span>                                | Stores map coordinates.                                                             | Yes, with MapLocationDistance criterion           |
| <span class="confluence-link"> [Media](Media-Field-Type_31430525.html) </span>                                            | Validates and stores a media file.                                                  | No                                                |
| <span class="confluence-link"> [Null](Null-Field-Type_31430527.html) </span>                                              | Used as fallback for missing Field Types and for testing purposes.                  | No                                                |
| <span class="confluence-link"> [Rating](Rating-Field-Type_31430531.html) </span>                                          | Stores a rating.                                                                    | No                                                |
| <span class="confluence-link"> [Relation](Relation-Field-Type_31430533.html) </span>                                      | Validates and stores a relation to a Content item.                                  | Yes, with both Field and FieldRelation criterions |
| <span class="confluence-link"> [RelationList](RelationList-Field-Type_31430535.html) </span>                              | Validates and stores a list of relations to Content items.                          | Yes, with FieldRelation criterion                 |
| [RichText](RichText-Field-Type_31430537.html)                                                                             | Validates and stores structured rich text, and exposes it in several formats.       | Yes                                               |
| <span class="confluence-link"> [Selection](Selection-Field-Type_31430539.html) </span>                                    | Validates and stores a single selection or multiple choices from a list of options. | Yes                                               |
| <span class="confluence-link"> [TextBlock](TextBlock-Field-Type_31430541.html) </span>                                    | Validates and stores a larger block of text.                                        | No                                                |
| <span class="confluence-link"> [TextLine](TextLine-Field-Type_31430545.html) </span>                                      | Validates and stores a single line of text.                                         | Yes                                               |
| <span class="confluence-link"> [Time](Time-Field-Type_31430543.html) </span>                                              | Stores time information.                                                            | Yes                                               |
| <span class="confluence-link"> [Url](Url-Field-Type_31430547.html) </span>                                                | Stores a URL / address.                                                             | No                                                |
| <span class="confluence-link"> [User](User-Field-Type_31430549.html) </span>                                              | Validates and stores information about a user.                                      | No                                                |
| <span class="confluence-link"> <span class="confluence-link"> [XmlText](XmlText-Field-Type_31430551.html) </span> </span> | Validates and stores multiple lines of formatted text.                              | Yes                                               |

### Field Types provided by Community

| FieldType                                                                                         | Description                                    | Searchable | Editing support in UI                                                                                                                                                                            | Planned to be incl in the future |
|---------------------------------------------------------------------------------------------------|------------------------------------------------|------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|
| <a href="https://github.com/netgen/TagsBundle">Tags</a>                     | Tags field and full fledge taxonomy management | Yes        | <span style="color: rgb(153,51,0);">No</span> *(See <a href="http://www.netgenlabs.com/Blog/Crowdfunding-Tags-Bundle-support-for-eZ-Platform-UI">crowdfunding</a>* *page)* | Yes                              |
| <a href="https://github.com/ezcommunity/EzPriceBundle">Price</a>            | Price field for product catalog use            | Yes        | <span style="color: rgb(153,51,0);">No</span>                                                                                                                                                    | Yes                              |
| <a href="https://github.com/ezcommunity/EzMatrixFieldTypeBundle">Matrix</a> | Matrix field for matrix data                   | Yes        | <span style="color: rgb(153,51,0);">No</span>                                                                                                                                                    | Yes                              |

### Known missing Field Types

The following Field Types are configured using [Null Field Type](Null-Field-Type_31430527.html) to avoid exceptions if they exists in your database, but their functionality is currently not known to be implemented out of the box or by the community:

<span class="jira-issue"> <a href="https://jira.ez.no/browse/EZP-20112?src=confmacro" class="jira-issue-key"><img src="https://jira.ez.no/images/icons/issuetypes/story.png" class="icon" />EZP-20112</a> - <span class="summary">Some Shop FieldTypes are not supported by Public API</span> <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-complete jira-macro-single-issue-export-pdf">Backlog</span> </span>

<span class="jira-issue"> <a href="https://jira.ez.no/browse/EZP-20115?src=confmacro" class="jira-issue-key"><img src="https://jira.ez.no/images/icons/issuetypes/story.png" class="icon" />EZP-20115</a> - <span class="summary">eZ Identifier FieldType not supported by Public API</span> <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-complete jira-macro-single-issue-export-pdf">Backlog</span> </span>

<span class="jira-issue"> <a href="https://jira.ez.no/browse/EZP-20118?src=confmacro" class="jira-issue-key"><img src="https://jira.ez.no/images/icons/issuetypes/story.png" class="icon" />EZP-20118</a> - <span class="summary">eZ Password Expiry FieldType not supported by Public API</span> <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-complete jira-macro-single-issue-export-pdf">Backlog</span> </span>

*Missing something? For field types provided by community, like for instance `ezselection2`, unless otherwise mentioned it can be considered missing for the time being. If something should be listed here, add a comment.* 

### Generate new Field Type

Besides links in the top of this topic in regards to creating own field type, from partner Smile there is now a <a href="https://github.com/Smile-SA/EzFieldTypeGeneratorBundle">Field Type Generator Bundle</a> helping you get started creating skeleton for eZ Platform field type, including templates for editorial interface. 

 

#### Related topics:

-   [Content items, Content Types and Fields](31430275.html)

#### In this topic:

-   [Built in Field Types](#FieldTypesreference-BuiltinFieldTypes)
-   [Field Types provided by Community](#FieldTypesreference-FieldTypesprovidedbyCommunity)
-   [Known missing Field Types](#FieldTypesreference-KnownmissingFieldTypes)
-   [Generate new Field Type](#FieldTypesreference-GeneratenewFieldType)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>
4.  <span>[Extending PlatformUI with new navigation](Extending-PlatformUI-with-new-navigation_31430235.html)</span>

 Developer : Filter by Content Type 



This step is very similar to the previous one [on adding pagination](Paginate-results_31430251.html). We are going to add a new `type` parameter in the whole component *stack*; the main difference with the `offset` case is that the user will pick a Content Type in a drop-down list instead of just using the Next/Previous links in the page.

## Symfony Controller and routing configuration to accept a `type` parameter

In addition to the `offset` parameter, the Symfony action has to accept a `type` parameter. Like in the previous step, this involves changing the `routing.yml` configuration file and changing the logic in the Controller to do a search request based on this parameter if it is provided. This is done in the <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/commit/f5c7c7fafb18db91b3f6698fb5aa765c59a8b7cf">related commit</a>.

## JavaScript application routing to accept a `type` parameter

Like in the `offset` case, we have to add a new route to support the `type` parameter. Again, this is done in the application plugin with the following code:

**ezconf-listappplugin.js**

``` brush:
app.route({
    name: "eZConfListOffsetTypeIdentifier",
    path: "/ezconf/list/:offset/:typeIdentifier",
    view: "ezconfListView",
    service: Y.eZConf.ListViewService,
    sideViews: {'navigationHub': true, 'discoveryBar': false},
    callbacks: ['open', 'checkUser', 'handleSideViews', 'handleMainView'],
});
```

## Request the server with the given type

Again, this is very similar to the `offset` case, now that we have a Content Type identifier in the matched route parameters, we can request the server to get a filtered list by changing the `_load` implementation in our view service:

**\_load method in ezconf-listviewservice.js**

``` brush:
_load: function (callback) {
    // the request allows to retrieve the matched parameters
    var offset = this.get('request').params.offset,
        typeIdentifier = this.get('request').params.typeIdentifier,
        uri;

    if ( !offset ) {
        offset = 0;
    }
    uri = this.get('app').get('apiRoot') + 'list/' + offset;
    if ( typeIdentifier ) {
        uri += '/' + typeIdentifier;
    }

    Y.io(uri, {
        method: 'GET',
        on: {
            success: function (tId, response) {
                this._parseResponse(response);
                callback(this);
            },
            failure: this._handleLoadFailure,
        },
        context: this,
    });
},
```

After doing hat, you can manually tweak the URI to get a filtered list. For instance, if you go to `/ez#/ezconf/list/10/folder` you should only see Locations of Folders in the repository.

## Content Type drop down list in the server response

Of course, the end user is not supposed to tweak the URI to filter by Content Type. To provide a usable interface, we will add a drop-down list where they can choose a Content Type to only get the corresponding list. Again, this is done server side by modifying the Controller to fetch the list of Content Types and Content Type Groups with the Content Type Service. Once this is done, the types and the groups can be passed to the Twig template to build a drop-down list in the following way:

**Drop down list building**

``` brush:
{% block content %}
<div class="ezconf-list-toolbar">
    <label for="types-list">Filter by content type</label>
    <select id="types-list" class="ezconf-list-types">
        <option value="">None</option>
    {% for group in groups %}
        <optgroup label="{{ group.identifier }}">
        {% for type in typesByGroup[group.identifier] %}
            <option value="{{ type.identifier }}"{% if type.identifier == typeIdentifier %}selected{% endif %}>{{ type.names['eng-GB'] }}</option>
        {% endfor %}
        </optgroup>
    {% endfor %}
    </select>
</div>

<!-- ... the rest of the content goes here -->

{% endblock %}
```

The complete change for that can be seen in the <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/commit/7fd4ae253f4fd8400365a6d519c99ef1bfd5dae9">corresponding commit</a>.

## Filter by Content Type by using the drop down list

The only remaining feature is now to take into account the user interaction on the added drop-down list. The view is responsible for that and it will basically subscribe to the `change` DOM event on the list and will fire the <span class="blob-code-inner"> <span class="pl-s"> `navigateTo` <span class="pl-pds"> event like we did in the `offset` case:</span> </span> </span>

**Drop down list change handling**

``` brush:
YUI.add('ezconf-listview', function (Y) {
    Y.namespace('eZConf');

    Y.eZConf.ListView = Y.Base.create('ezconfListView', Y.eZ.ServerSideView, [], {
        events: {
            '.ezconf-list-location': {
                // tap is 'fast click' (touch friendly)
                'tap': '_navigateToLocation'
            },
            '.ezconf-list-page-link': {
                'tap': '_navigateToOffset'
            },
            '.ezconf-list-types': {
                'change': '_filterByType'
            }
        },

        _filterByType: function (e) {
            var select = e.target;

            this.fire('navigateTo', {
                routeName: 'eZConfListOffsetTypeIdentifier',
                routeParams: {
                    offset: "0", // offset: 0 does not work, because of a bug in PlatformUI
                    typeIdentifier: select.get('value'),
                }
            });
        },

        // ... the rest of the view code should still be there
    });
});
```

Basically, when the user selects a value in the drop-down list, the view fires the `navigateTo` event to navigate to the `eZConfListOffsetTypeIdentifier` route with the corresponding Content Type identifier and the offset set to 0. The view service is still handling this event and takes the user to the corresponding page in the application.

Results

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
And that's it! We now have a working interface to navigate through Content with a flat list that can be filtered by Content Type. The resulting code can be seen in <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/releases/tag/8_filter">the <code>8_filter</code> tag on GitHub</a>, this step result can also be viewed as <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/compare/7_pagination...8_filter">a diff between tags <code>7_pagination</code> and <code>8_filter</code></a>. [The conclusion page](Conclusion_31430255.html) lists the potential improvement and some bugs in our current implementation. It also gives a list of documentation pages to read to go into more detail.

 

 

**Tutorial path**






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>
6.  <span>[Content items, Content Types and Fields](31430275.html)</span>
7.  <span>[Field Types reference](Field-Types-reference_31430495.html)</span>

 Developer : Float Field Type 



This Field Type represents a float value.

| Name    | Internal name | Expected input |
|---------|---------------|----------------|
| `Float` | `ezfloat`     | `float`        |

## <span class="nx">Description</span>

This Field Type stores numeric values which will be provided as floats.

## PHP API Field Type 

### Input expectations

<span style="color: rgb(0,0,0);">The Field Type expects a number as input. Both decimal and integer numbers are accepted.</span>

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>float</code></td>
<td align="left"><p><code>194079.572</code></p></td>
</tr>
<tr class="even">
<td align="left"><code>int</code></td>
<td align="left"><code>144</code></td>
</tr>
</tbody>
</table>

### Value object

##### Properties

The Value class of this field type contains the following properties:

| Property | Type    | Description                                                        |
|----------|---------|--------------------------------------------------------------------|
| `$value` | `float` | This property will be used to store the value provided as a float. |

**Value object content example**

``` brush:
use eZ\Publish\Core\FieldType\Float\Type;

// Instantiates a Float Value object
$floatValue = new Type\Value();

$float->value = 284.773
```

##### Constructor

The `Float``\Value` constructor will initialize a new Value object with the value provided. It expects a numeric value with or without decimals.

**Constructor example**

``` brush:
use eZ\Publish\Core\FieldType\Float\Type;

// Instantiates a Float Value object
$floatValue = new Type\Value( 284.773 );
```

### Validation

This Field Type supports `FloatValueValidator`, defining maximal and minimal float value:

| Name            | Type    | Default value | Description                                                                |
|-----------------|---------|---------------|----------------------------------------------------------------------------|
| `minFloatValue` | `float` | `null`        | This setting defines the minimum value this FieldType will allow as input. |
| `maxFloatValue` | `float` | `null`        | This setting defines the maximum value this FieldType will allow as input. |

**Validator configuration example in PHP**

``` brush:
use eZ\Publish\Core\FieldType\Float\Type;
  
$contentTypeService = $repository->getContentTypeService();
$floatFieldCreateStruct = $contentTypeService->newFieldDefinitionCreateStruct( "float", "ezfloat" );
 
// Accept only numbers between 0.1 and 203.99
$floatFieldCreateStruct->validatorConfiguration = array(
    "FileSizeValidator" => array(  
        "minFloatValue" => 0.1,
        "maxFloatValue" => 203.99
    )
);
```

### Settings

This Field Type does not support settings.

 

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[API](API_31429524.html)</span>
4.  <span>[REST API Guide](REST-API-Guide_31430286.html)</span>

 Developer : General REST usage 



As explained in the [<span class="confluence-link">introduction</span>](REST-API-Guide_31430286.html), the REST API is based on a very limited list of general principles:

-   each resource (uri) interacts with a part of the system (Content, URL aliases, User Groups, etc.),
-   for each resource, one or more verbs are available, each having a different effect (delete a Content item, get a URL Alias, list user groups, etc.),
-   media-type request headers indicate what type of data (Content / ContentInfo), and data format (JSON or XML), are expected as a response, and what can be requested.

## Anatomy of a REST call

### What we can learn from a GET request

This verb is used to query the API for information. It is one of the two operations web browsers implement, and the one most commonly used.

#### Request

The only requirement for this verb is usually the resource URI, and the accept header. On top of that, cache request headers can be added, like `If-None-Match`, but those aren't fully implemented yet in eZ Publish 5.0.

**Load ContentInfo request**

``` brush:
GET /content/objects/23 HTTP/1.1
Accept: application/vnd.ez.api.ContentInfo+xml
```

#### Response headers

The API will reply with:

-   an **HTTP response code**,
-   a few **headers**,
-   the XML representation of the ContentInfo for content with ID 23 in XML format, as specified in the Accept header.

**Load ContentInfo response**

``` brush:
HTTP/1.1 200 OK
Accept-Patch: application/vnd.ez.api.ContentUpdate+xml;charset=utf8
Content-Type: application/vnd.ez.api.ContentInfo+xml
Content-Length: xxx
```

The length of our content, provided by the Content-Length header, isn't *that* useful.

##### HTTP Code

The API responded here with a standard 200 OK HTTP response code, which is the expected response code for a "normal" GET request. Some GET requests, like <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/doc/specifications/rest/REST-API-V2.rst#13241%C2%A0%C2%A0%C2%A0get-current-version">getting a Content item's current version</a>, may reply with a 301 Moved permanently, or 307 Temporary redirect code.

Errors will be indicated with HTTP error codes, like 404 for Not Found, or 500 for Internal server error. The <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/doc/specifications/rest/REST-API-V2.rst">REST specifications</a> provide the list of every HTTP response code you can expect from implemented resources.

##### Content-Type header

As long as a response contains an actual HTTP body, the Content-Type header will be used to specify which Content-Type is contained in the response. In that case, a ContentInfo (`Content-Type: application/vnd.ez.api.ContentInfo`) in XML (`Content-Type: application/vnd.ez.api.ContentInfo+xml`)

##### Accept-Patch header

This is a very interesting one.

It tells us we can modify the received content by patching (`Accept-Patch: application/vnd.ez.api.ContentUpdate+xml;charset=utf8`) it with a <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Publish/API/Repository/Values/Content/ContentUpdateStruct.php">ContentUpdateStruct</a> (`Accept-Patch: application/vnd.ez.api.ContentUpdate+xml;charset=utf8`) in XML (`Accept-Patch: application/vnd.ez.api.ContentUpdate+xml;charset=utf8`) format. Of course, JSON would also work, with the proper format.

This last part means that if we send a PATCH /content/objects/23 request with a <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Publish/API/Repository/Values/Content/ContentUpdateStruct.php">ContentUpdateStruct</a> XML payload, we will update this Content. 

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
REST will use the `Accept-Patch` header to indicate how to **modify** the returned **data**.

##### Other headers: Location

Depending on the resource, request & response headers will vary. For instance, <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/doc/specifications/rest/REST-API-V2.rst#13231%C2%A0%C2%A0%C2%A0creating-content">creating content</a>, or <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/doc/specifications/rest/REST-API-V2.rst#13241%C2%A0%C2%A0%C2%A0get-current-version">getting a Content item's current version</a> will both send a `Location` header to provide you with the requested resource's ID.

Those particular headers generally match a specific list of HTTP response codes. Location is sent by `201 Created`, `301 Moved permanently,` `307 Temporary redirect responses`. This list isn't finished, but you can expect those HTTP responses to provide you with a Location header.

##### Other headers: Destination

This request header is the request counterpart of the Location response header. It is used in a COPY / MOVE operation, like <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/doc/specifications/rest/REST-API-V2.rst#13236%C2%A0%C2%A0%C2%A0copy-content">copying a Content item</a>, on a resource to indicate where the resource should be moved to, using the ID of the destination.

#### Response body

**Load ContentInfo response body** <span class="collapse-source expand-control"><span class="expand-control-icon icon"> </span><span class="expand-control-text">Expand source</span></span>

``` brush:
<?xml version="1.0" encoding="UTF-8"?>
<Content href="/content/objects/23" id="23"
  media-type="application/vnd.ez.api.Content+xml" remoteId="qwert123">
  <ContentType href="/content/types/10" media-type="application/vnd.ez.api.ContentType+xml" />
  <Name>This is a title</Name>
  <Versions href="/content/objects/23/versions" media-type="application/vnd.ez.api.VersionList+xml" />
  <CurrentVersion href="/content/objects/23/currentversion"
    media-type="application/vnd.ez.api.Version+xml"/>
  <Section href="/content/sections/4" media-type="application/vnd.ez.api.Section+xml" />
  <MainLocation href="/content/locations/1/4/65" media-type="application/vnd.ez.api.Location+xml" />
  <Locations href="/content/objects/23/locations" media-type="application/vnd.ez.api.LocationList+xml" />
  <Owner href="/user/users/14" media-type="application/vnd.ez.api.User+xml" />
  <lastModificationDate>2012-02-12T12:30:00</lastModificationDate>
  <publishedDate>2012-02-12T15:30:00</publishedDate>
  <mainLanguageCode>eng-US</mainLanguageCode>
  <alwaysAvailable>true</alwaysAvailable>
</Content>
```

The XML body is a serialized version of a <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Publish/API/Repository/Values/Content/ContentInfo.php">ContentInfo</a> struct. Most REST API calls will actually involve exchanging XML / JSON representations of the public API. This consistency, which we took very seriously, was a hard requirement for us, as it makes documentation much better by requiring *less* of it.

As explained above, the API has told us that we could modify content object 23 by sending a `vendor/application/vnd.ez.ContentUpdate+xml`. This media type again matches a Value in the API, <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Publish/API/Repository/Values/Content/ContentUpdateStruct.php">ContentUpdateStruct</a>.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
The REST API data structs mostly match a PHP Public API value object

#### Value objects representation

Value objects like <a href="https://github.com/ezsystems/ezp-next/blob/master/eZ/Publish/API/Repository/Values/Content/ContentInfo.php">ContentInfo</a> basically feature two types of fields: basic, local fields (modified, name...) and foreign field(s) references (sectionId, mainLocationId).

Local fields will be represented in XML / JSON with a primitive type (integer, string), while foreign key references will be represented as a link to another resource. This resource will be identified with its URI (`/content/objects/23/locations`), and the media-type that should be requested when calling that resource (`media-type="application/vnd.ez.api.LocationList+xml"`). Depending on how much data you need, you may choose to crawl those relations, or to ignore them.

XSD files

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
For each XML structure known to the REST API, you can find XSD files in the XSD folder of the specifications. Those will allow you to validate your XML, and learn about every option those XML structures feature.

<a href="https://github.com/ezsystems/ezpublish-kernel/tree/master/doc/specifications/rest/xsd" class="uri">https://github.com/ezsystems/ezpublish-kernel/tree/master/doc/specifications/rest/xsd</a> 

## Request parameters

So far, we have seen that responses will depend on:

-   The URI,
-   Request headers, like the Accept one

URI parameters are of course also used. They usually serve as filters / options for the requested resource. For instance, they can be used to customize a list's offset/limit, to filter a list, specify which fields you want from a content... For almost all resources, those parameters must be provided as GET ones. This request would return the 5 first relations for Version 2 of Content 59:

**GET request with limit parameter**

``` brush:
GET /content/objects/59/versions/2/relations&limit=5 HTTP/1.1
Accept: application/vnd.ez.api.RelationList+xml
```

Working with value objects IDs

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Resources that accept a reference to another resource expect this reference to be given as a REST ID, not a Public API ID. As such, the URI to request users that are assigned the role with ID 1 would be `GET /api/ezp/v2/user/users?roleId=/api/ezp/v2/user/roles/1`.

## Custom HTTP verbs

In addition to the usual GET, POST, PUT and DELETE HTTP verbs, the API supports a few custom ones: COPY, MOVE (<a href="http://tools.ietf.org/html/rfc2518" class="uri">http://tools.ietf.org/html/rfc2518</a>), PATCH (<a href="http://tools.ietf.org/html/rfc5789" class="uri">http://tools.ietf.org/html/rfc5789</a>) and PUBLISH. While it should generally not be a problem, some HTTP servers may fail to recognize those. If you face this situation, you can customize a standard verb (POST, PUT) with the <span>`X-HTTP-Method-Override` header.</span>

**PATCH HTTP request**

``` brush:
POST /content/objects/59 HTTP/1.1
X-HTTP-Method-Override: PATCH
```

<span>Both methods are always mentioned, when applicable, in the specifications.</span>

## Specifying a siteaccess

One of the principles of REST is that the same resource (Content, Location, ContentType, etc.) should be unique. The purpose is mostly to make it simple to cache your REST API using a reverse proxy like Varnish. If the same resource is available at multiple locations, cache purging becomes much more complex.

Due to this, we decided not to enable siteaccess matching with REST. In order to specify a siteaccess when talking to the REST API, a custom header, `X-Siteaccess`, needs to be provided. If it isn't, the default one will be used:

 

**X-Siteaccess header example**

``` brush:
GET / HTTP/1.1
Host: api.example.com
Accept: application/vnd.ez.api.Root+json
X-Siteaccess: ezdemo_site_admin
```

 

<span>
</span>

#### In this topic:

-   [Anatomy of a REST call](#GeneralRESTusage-AnatomyofaRESTcall)
    -   [What we can learn from a GET request](#GeneralRESTusage-WhatwecanlearnfromaGETrequest)
-   [Request parameters](#GeneralRESTusage-Requestparameters)
-   [Custom HTTP verbs](#GeneralRESTusage-CustomHTTPverbs)
-   [Specifying a siteaccess](#GeneralRESTusage-Specifyingasiteaccess)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Get Started with eZ Platform](Get-Started-with-eZ-Platform_31429520.html)</span>
4.  <span>[Step 2: Going Deeper](31429542.html)</span>

 Developer : Get Started with eZ Enterprise 



If you are looking for even more than eZ Platform can offer you, eZ Enterprise is the thing for you. A commercial offering, it rests atop eZ Platform and taps into all that it offers. With its intuitive in-page editing to landing page management, it delivers fully integrated tools that help you create and manage content on eZ Platform-powered sites and apps.

 

From the developer's point of view, working with eZ Enterprise is not much different than operating on eZ Platform, because the core of the system remains the same.

 

 

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>

 Developer : Get Started with eZ Platform 



# Quickstart with eZ Platform

**Before you begin: [Requirements & Configuration](https://doc.ez.no/pages/viewpage.action?pageId=31429536)**

**Getting things set up: [Installation](https://doc.ez.no/display/DEVELOPER/Step+1%3A+Installation)**

**Learning eZ Platform: [What's Next](https://doc.ez.no/display/DEVELOPER/Step+2%3A+Going+Deeper)**

**
**

#### Transitioning to eZ Platform

If you've worked with **eZ Publish** (our legacy product) in the past, see [Migration from eZ Publish](Migration-from-eZ-Publish_31430320.html), and a [Feature Comparison](https://doc.ez.no/display/MAIN/Transitioning+from+eZ+Publish+to+eZ+Platform+and+eZ+Studio%3A+Feature+Comparison) between eZ Publish (legacy) and eZ Platform (current).

If you've worked with **other CMS's** before, see [Migrating to eZ Platform](https://doc.ez.no/pages/viewpage.action?pageId=31429532).

 

 

<span class="confluence-embedded-file-wrapper image-center-wrapper"><img src="attachments/31429520/32866977.png" class="confluence-embedded-image image-center" /></span>

 

## Attachments:

<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [ibex-mountain-small.png](attachments/31429520/32866977.png) (image/png)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[API](API_31429524.html)</span>
4.  <span>[eZ Platform Public PHP API](eZ-Platform-Public-PHP-API_31429583.html)</span>
5.  <span>[Public API Guide](Public-API-Guide_31430303.html)</span>

 Developer : Getting started with the Public API 



In this chapter, we will see two ways of customizing eZ Platform: command line scripts (for import scripts, for instance), and custom controllers.

## Symfony bundle

In order to test and use Public API code, you will need to build a custom bundle. Bundles are Symfony's extensions, and are therefore also used to extend eZ Platform. Symfony 2 provides code generation tools that will let you create your own bundle and get started in a few minutes.

In this chapter, we will show how to create a custom bundle, and implement both a command line script and a custom route with its own controller action and view. All shell commands assume that you use some Linux shell, but those commands would of course also work on Windows systems.

### Generating a new bundle

First, change the directory to your eZ Platform root.

``` brush:
$ cd /path/to/ezplatform
```

Then use the app/console application with the `generate:bundle` command to start the bundle generation wizard.

Let's follow the instructions provided by the wizard. Our objective is to create a bundle named `     EzSystems/Bundles/CookBookBundle   `, located in the `src` directory.

``` brush:
$ php app/console generate:bundle
```

The wizard will first ask about our bundle's namespace. Each bundle's namespace should feature a vendor name (in our own case: `EzSystems`), optionally followed by a sub-namespace (we could have chosen to use `Bundle`), and end with the actual bundle's name, suffixed with Bundle: `CookbookBundle`.

**Bundle namespace**

``` brush:
Your application code must be written in bundles. This command helps you generate them easily.

Each bundle is hosted under a namespace (like Acme/Bundle/BlogBundle).

The namespace should begin with a "vendor" name like your company name, your project name, or your client name, followed by one or more optional category sub-namespaces, and it should end with the bundle name itself (which must have Bundle as a suffix).

See http://symfony.com/doc/current/cookbook/bundles/best_practices.html#index-1 for more details on bundle naming conventions. 

Use / instead of \ for the namespace delimiter to avoid any problem.

Bundle namespace: EzSystems/CookbookBundle
```

You will then be asked about the Bundle's name, used to reference your bundle in your code. We can go with the default, `EzSystemsCookbookBundle`. Just hit Enter to accept the default.

**Bundle name**

``` brush:
In your code, a bundle is often referenced by its name. It can be the concatenation of all namespace parts but it's really up to you to come up with a unique name (a good practice is to start with the vendor name).

Based on the namespace, we suggest EzSystemsCookbookBundle.

Bundle name [EzSystemsCookbookBundle]:
```

The next question is your bundle's location. By default, the script offers to place it in the `src` folder. This is perfectly acceptable unless you have a good reason to place it somewhere else. Just hit Enter to accept the default.

**Bundle directory**

``` brush:
The bundle can be generated anywhere. The suggested default directory uses the standard conventions.


Target directory [/path/to/ezpublish5/src]:
```

Next, you need to choose the generated configuration's format, out of YAML, XML, PHP or annotations. We mostly use yaml in eZ Platform, and we will use it in this cookbook. Enter 'yml', and hit Enter.

**Configuration format**

``` brush:
Determine the format to use for the generated configuration.                                                                                                                        

Configuration format (yml, xml, php, or annotation) [annotation]: yml
```

The last choice is to generate code snippets demonstrating the Symfony directory structure. If you're learning Symfony, it is a good idea to accept, as it will create a controller, yaml files, etc.

**Generate snippets & directory structure**

``` brush:
To help you get started faster, the command can generate some code snippets for you.

Do you want to generate the whole directory structure [no]? yes
```

The generator will then summarize the previous choices, and ask for confirmation. Hit Enter to confirm.

**Summary and confirmation**

``` brush:
You are going to generate a "EzSystems\Bundle\CookbookBundle\EzSystemsCookbookBundle" bundle in "/path/to/ezpublish5/src/" using the "yml" format.

Do you confirm generation [yes]? yes
```

The wizard will generate the bundle, check autoloading, and ask about the activation of your bundle. Hit Enter in the answer to both questions to have your bundle automatically added to your Kernel (`app/AppKernel.php`) and routes from your bundle added to the existing routes (`app/config/routing.yml`).

**Activation and generation**

``` brush:
  Bundle generation

Generating the bundle code: OK
Checking that the bundle is autoloaded: OK
Confirm automatic update of your Kernel [yes]?
Enabling the bundle inside the Kernel: OK
Confirm automatic update of the Routing [yes]?
Importing the bundle routing resource: OK

  You can now start using the generated code!
 
```

Your bundle should be generated and activated. Let's now see how you can interact with the Public API by creating a command line script, and a custom controller route and action.

### Creating a command line script in your bundle

Writing a command line script with Symfony 2 is *very* easy. The framework and its bundles ship with a few scripts. They are all started using `php app/console <command>`. You can get the complete list of existing command line scripts by executing `php app/console list` from the eZ Platform root.

In this chapter, we will create a new command, identified as `ezpublish:cookbook:hello`, that takes an optional name argument, and greets that name. To do so, we need one thing: a class with a name ending with "Command" that extends `Symfony\Component\Console\Command\Command`. Note that in our case, we use `ContainerAwareCommand` instead of `Command`, since we need the dependency injection container to interact with the Public API. In your bundle's directory (`src/EzSystems/CookbookBundle`), create a new directory named `Command`, and in this directory, a new file named `HelloCommand.php`.

Add this code to the file:

**HelloCommand.php**

``` brush:
<?php
namespace EzSystems\CookBookBundle\Command;

use Symfony\Component\Console\Input\InputInterface;
use Symfony\Component\Console\Output\OutputInterface;
use Symfony\Component\Console\Input\InputArgument;

class HelloCommand extends \Symfony\Bundle\FrameworkBundle\Command\ContainerAwareCommand
{
    /**
     * Configures the command
     */
    protected function configure()
    {
    }

    /**
     * Executes the command
     * @param InputInterface $input
     * @param OutputInterface $output
     */
    protected function execute( InputInterface $input, OutputInterface $output )
    {
    }
}
```

This is the skeleton for a command line script.

One class with a name ending with "Command" (`HelloCommand`), extends `Symfony\Bundle\FrameworkBundle\Command\Command`, and is part of our bundle's Command namespace. It has two methods: `configure()`, and `execute()`. We also import several classes & interfaces with the use keyword. The first two, `InputInterface` and `OutputInterface` are used to 'typehint' the objects that will allow us to provide input & output management in our script.

`Configure` will be used to set your command's name, as well as its options and arguments. `Execute` will contain the actual implementation of your command. Let's start by creating the `configure()` method.

**TestCommand::configure()**

``` brush:
protected function configure()
{
    $this->setName( 'ezpublish:cookbook:hello' );
    $this->setDefinition(
        array(
            new InputArgument( 'name', InputArgument::OPTIONAL, 'An argument' )
        )
    );
}
```

First, we use `setName()` to set our command's name to "`ezpublish:cookbook:hello`". We then use `setDefinition()` to add an argument, named `name`, to our command.

You can read more about argument definitions and further options in the <a href="http://symfony.com/doc/2.0/components/console/introduction.html">Symfony 2 Console documentation</a>. Once this is done, if you run `php app/console list`, you should see `ezpublish:cookbook:hello` listed in the available commands. If you run it, it will however still do nothing.

Let's just add something very simple to our `execute()` method so that our command actually does something.

**TestCommand::execute()**

``` brush:
protected function execute( InputInterface $input, OutputInterface $output )
{
    // fetch the input argument
    if ( !$name = $input->getArgument( 'name' ) )
    {
        $name = "World";
    }
    $output->writeln( "Hello $name" );
}
```

You can now run the command from the eZ Platform root.

**Hello world**

``` brush:
$ php app/console ezpublish:cookbook:hello world
Hello world
```

### Creating a custom route with a controller action

In this short chapter, we will see how to create a new route that will catch a custom URL and execute a controller action. We want to create a new route, `/cookbook/test`, that displays a simple 'Hello world' message. This tutorial is a simplified version of the official one that can be found on <a href="http://symfony.com/doc/current/book/controller.html" class="uri">http://symfony.com/doc/current/book/controller.html</a>.

During our bundle's generation, we have chosen to generate the bundle with default code snippets. Fortunately, almost everything we need is part of those snippets. We just need to do some editing, in particular in two locations: `src/EzSystems/Resources/CookbookBundle/config/routing.yml` and `src/EzSystems/CookbookBundle/Controllers/DefaultController.php`. The first one will be used to configure our route (`/cookbook/test`) as well as the controller action the route should execute, while the latter will contain the actual action's code.

#### routing.yml

This is the file where we define our action's URL matching. The generated file contains this YAML block:

**Generated routing.yml**

``` brush:
ez_systems_cookbook_homepage:
    path:     /hello/{name}
    defaults: { _controller: EzSystemsCookbookBundle:Default:index }
```

We can safely remove this default code, and replace it with this:

**Edited routing.yml**

``` brush:
ezsystems_cookbook_hello:
    path:     /cookbook/hello/{name}
    defaults: { _controller: EzSystemsCookbookBundle:Default:hello }
```

We define a route that matches the URI /cookbook/\* and executes the action `hello` in the Default controller of our bundle. The next step is to create this method in the controller.

#### DefaultController.php

This controller was generated by the bundle generator. It contains one method, `helloAction()`, that matched the YAML configuration we have changed in the previous part. Let's just rename the `indexAction()` method so that we end up with this code.

**DefaultController::helloAction()**

``` brush:
public function helloAction( $name )
{
    $response = new \Symfony\Component\HttpFoundation\Response;
    $response->setContent( "Hello $name" );
    return $response;
}
```

We won't go into details about controllers in this cookbook, but let's walk through the code a bit. This method receives the parameter defined in `routing.yml`. It is called "name" in the route definition, and must be called $name in the matching action. Since the action is named "hello" in `routing.yml`, the expected method name is `helloAction`.

Controller actions **must** return a Response object that will contain the response's content, the headers, and various optional properties that affect the action's behavior. In our case, we simply set the content, using `setContent()`, to "Hello $name". Go to http://ezplatform/cookbook/hello/YourName, and you should get "Hello YourName".

The custom EzPublishCoreBundle Controller

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
For convenience, a custom controller is available at <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Bundle/EzPublishCoreBundle/Controller.html">eZ\Bundle\EzPublishCoreBundle\Controller</a>. It gives you with a few commodity methods:

-   `getRepository()`
    Returns the Public API repository that gives you access to the various services through `getContentService()`, `getLocationService()` and so on; 
-   `getLegacyKernel()`
    Returns an instance of the <a href="http://apidoc.ez.no/doxygen/trunk/NS/html/classeZ_1_1Publish_1_1Core_1_1MVC_1_1Legacy_1_1Kernel.html">eZ\Publish\Core\MVC\Legacy\Kernel</a> that you can use to interact with the Legacy eZ Platform kernel
-   `getConfigResolver()`
    Returns the <a href="http://apidoc.ez.no/doxygen/trunk/NS/html/classeZ_1_1Bundle_1_1EzPublishCoreBundle_1_1DependencyInjection_1_1Configuration_1_1ConfigResolver.html">ConfigResolver</a> that gives you access to configuration data.

You are encouraged to use it for your custom controllers that interact with eZ Platform.

 

With both command line scripts and HTTP routes, you have the basics you need to start writing Public API code.

#### In this topic:

-   [Symfony bundle](#GettingstartedwiththePublicAPI-Symfonybundle)
    -   [Generating a new bundle](#GettingstartedwiththePublicAPI-Generatinganewbundle)
    -   [Creating a command line script in your bundle](#GettingstartedwiththePublicAPI-Creatingacommandlinescriptinyourbundle)
    -   [Creating a custom route with a controller action](#GettingstartedwiththePublicAPI-Creatingacustomroutewithacontrolleraction)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[API](API_31429524.html)</span>
4.  <span>[REST API Guide](REST-API-Guide_31430286.html)</span>

 Developer : Getting started with the REST API 



## Installation

No special preparations are necessary to use the REST API. As long as your eZ Platform is correctly configured, the REST API is available on your site using the URI `/api/ezp/v2/`. If you have installed eZ Platform in a subfolder, prepend the path with this subfolder: <span class="nolink">http://example.com/**su**</span>**b/folder/ezpublish**/api/ezp/v2/.

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Please note that the `/api/ezp/v2` prefix will be used in all REST hrefs, but not in URIs.

## Configuration

### Authentication

As explained in more detail in the [authentication page](REST-API-Authentication_31430293.html), two authentication methods are currently supported: session and basic. By default, session authentication is the active mode, it uses a session cookie. The alternative, basic auth authentication requires a login / password to be sent using basic HTTP authentication.

To enable basic auth based authentication, you need to edit `app/config/security.yml` and uncomment the configuration block about REST

**security.yml**

``` brush:
security:
    # ...
    firewalls:
        # ...
        ezpublish_rest:
            pattern: ^/api/ezp/v2
            ezpublish_http_basic:
                realm: eZ Platform REST API
```

## Testing the API

A standard web browser is not sufficient to fully test the API. You can, however, try opening the root resource with it, using the session authentication: <span class="nolink">http://example.com/api/ezp/v2/.</span> Depending on how your browser understands XML, it will either download the XML file, or open it in the browser.

To test further, you can use browser extensions, like <a href="https://chrome.google.com/webstore/detail/advanced-rest-client/hgmloofddffdnphfgcellkdfbfbjeloo">Advanced REST client for Chrome</a> or <a href="https://addons.mozilla.org/firefox/addon/restclient/">RESTClient for Firefox</a>, or dedicated tools. For command line users, <a href="https://github.com/jkbr/httpie">HTTPie</a> is a good tool.

### JavaScript example

One of the main reasons for this API is to help implement JavaScript / AJAX interaction. You can see here an example of an AJAX call that retrieves ContentInfo (e.g. metadata) for a Content item:

**REST API with JavaScript**

``` brush:
<pre id="rest-output"></pre>
<script>
var resource = '/api/ezp/v2/content/objects/59',
    log = document.getElementById('rest-output'),
    request = new XMLHttpRequest();

log.innerHTML = "Loading the content info from " + resource + "...";

request.open('GET', resource, true);
request.onreadystatechange = function () {
    if ( request.readyState === 4 ) {
        log.innerHTML = "HTTP response from " + resource + "\n\n" + request.getAllResponseHeaders() + "\n" + request.responseText;
    }
};
request.setRequestHeader('Accept', 'application/vnd.ez.api.ContentInfo+json');
request.send();
</script>
```

In order to test it, just save this code to some test.html file in the web folder of your eZ Platform installation. If you use the rewrite rules, don't forget to allow this file to be served directly.

If necessary, substitute` 59` with the Content item ID of an item from your database. You will get the ContentInfo for item 59 in JSON encoding.

Note that by default, session authentication is used. This means that the session cookie will be transparently sent together with the request, and every AJAX call will have the same permissions as the currently logged in user.

JavaScript REST Client

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
To ease the use of the eZ Platform REST API, we provide a JavaScript REST Client. Its basic usage is explained in [Using the JavaScript REST API Client](Using-the-JavaScript-REST-API-Client_31430299.html).

#### In this topic:

-   [Installation](#GettingstartedwiththeRESTAPI-Installation)
-   [Configuration](#GettingstartedwiththeRESTAPI-Configuration)
    -   [Authentication](#GettingstartedwiththeRESTAPI-Authentication)
-   [Testing the API](#GettingstartedwiththeRESTAPI-TestingtheAPI)
    -   [JavaScript example](#GettingstartedwiththeRESTAPI-JavaScriptexample)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Community Resources](Community-Resources_31429530.html)</span>
4.  <span>[How to Contribute](How-to-Contribute_31429587.html)</span>

 Developer : GitHub 101 



Contributing to the doc

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
This part of the documentation is still a <span class="status-macro aui-lozenge aui-lozenge-current">WORK-IN-PROGRESS</span>. Would you like to contribute to it?

If you have any thoughts or tips to share, let us know in the comments below, visit our <a href="http://ez-community-on-slack.herokuapp.com/">Slack channel</a> or take a look at other ways to [Contribute to Documentation](https://doc.ez.no/display/DEVELOPER/Contribute+to+Documentation).

Related JIRA issue: <a href="https://jira.ez.no/browse/EZP-25590">EZP-25590</a>

The eZ Platform Github repository is stored here: <a href="https://github.com/ezsystems/ezplatform" class="uri">https://github.com/ezsystems/ezplatform</a>

 

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : HTTP Cache 



# Introduction

## Smart HTTP cache clearing

**Smart HTTP cache clearing** refers to the ability to clear cache for Locations/content that is in relation with the content being currently cleared.

When published, any Content item usually has at least one Location, identified by its URL. Therefore, HTTP cache being bound to URLs, if a Content item is updated (a new version is published), we want HTTP cache for all its Locations to be cleared, so the content itself can be updated everywhere it is supposed to be displayed. Sometimes, clearing cache for the content's Locations is not sufficient. You can, for instance, have an excerpt of it displayed in a list from the parent Location, or from within a relation. In this case, cache for the parent Location and/or the relation need to be cleared as well (at least if an ESI is not used).

### The mechanism

**Smart HTTP cache clearing** is an event-based mechanism. Whenever a content item needs its cache cleared, the cache purger service sends an `ezpublish.cache_clear.content` event (also identified by `eZ\Publish\Core\MVC\Symfony\MVCEvents::CACHE_CLEAR_CONTENT` constant) and passes an `eZ\Publish\Core\MVC\Symfony\Event\ContentCacheClearEvent` event object. This object contains the ContentInfo object we need to clear the cache for. Every listener for this event can add Location objects to the *cache clear list*.

Once the event is dispatched, the purger passes collected Location objects to the purge client, which will effectively send the cache `BAN` request.

Note

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
The event is dispatched with a dedicated event dispatcher, `ezpublish.http_cache.event_dispatcher`.

### Default behavior

By default, following Locations will be added to the cache clear list:

-   All Locations assigned to content (`AssignedLocationsListener`)
-   Parent Location of all Content item's Locations (`ParentLocationsListener`)
-   Locations for content's relations, including reverse relations (`RelatedLocationsListener`)

### Implementing a custom listener

By design, smart HTTP cache clearing is extensible. One can easily implement an event listener/subscriber to the `ezpublish.cache_clear.content` event and add Locations to the cache clear list.

#### Example

Here's a very simple custom listener example, adding an arbitrary Location to the list.

Important

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Cache clear listener services **must** be tagged as `ezpublish.http_cache.event_subscriber` or `ezpublish.http_cache.event_listener`.

``` brush:
namespace Acme\AcmeTestBundle\EventListener;

use eZ\Publish\API\Repository\LocationService;
use eZ\Publish\Core\MVC\Symfony\Event\ContentCacheClearEvent;
use eZ\Publish\Core\MVC\Symfony\MVCEvents;
use Symfony\Component\EventDispatcher\EventSubscriberInterface;

class ArbitraryLocationsListener implements EventSubscriberInterface
{
    /**
     * @var LocationService
     */
    private $locationService;

    public function __construct( LocationService $locationService )
    {
        $this->locationService = $locationService;
    }

    public static function getSubscribedEvents()
    {
        return [MVCEvents::CACHE_CLEAR_CONTENT => ['onContentCacheClear', 100]];
    }

    public function onContentCacheClear( ContentCacheClearEvent $event )
    {
        // $contentInfo is the ContentInfo object for the content being cleared.
        // You can extract information from it (e.g. ContentType from its contentTypeId), using appropriate Repository services.
        $contentInfo = $event->getContentInfo();

        // Adding arbitrary locations to the cache clear list.
        $event->addLocationToClear( $this->locationService->loadLocation( 123 ) );
        $event->addLocationToClear( $this->locationService->loadLocation( 456 ) );
    }
}
```

``` brush:
parameters:
    acme.cache_clear.arbitrary_locations_listener.class: Acme\AcmeTestBundle\EventListener\ArbitraryLocationsListener

services:
    acme.cache_clear.arbitrary_locations_listener:
        class: %acme.cache_clear.arbitrary_locations_listener.class%
        arguments: [@ezpublish.api.service.location]
        tags:
            - { name: ezpublish.http_cache.event_subscriber }
```

## Content Cache

 

eZ Platform uses <a href="http://symfony.com/doc/current/book/http_cache.html">Symfony HttpCache</a> to manage content "view" cache with an <a href="http://symfony.com/doc/current/book/http_cache.html#http-expiration-and-validation">expiration model</a>. In addition it is extended *(using FOSHttpCache)* to add several advanced features. For content coming from the CMS the following is taken advantage of out of the box:

-   To be able to always keep cache up to date, cache is made "content-aware" to allow updates to content to trigger *cache invalidation.*
    -   Uses a custom `X-Location-Id` header, which both Symfony and Varnish Proxy are able to invalidate cache on *<span style="line-height: 1.42857;">(for details see </span><span class="confluence-link">[Cache purge](https://doc.ez.no/display/DEVELOPER/HTTP+Cache#HTTPCache-CachePurge).)</span>*
-   To be able to also cache requests by logged-in users, cache is made "[<span class="confluence-link"><span class="confluence-link"><span class="confluence-link">context-aware</span></span></span>](#HTTPCache-Context-awareHTTPCache)<span class="confluence-link"> </span>."
    -   Uses a custom vary header `X-User-Hash` to allow pages to var by user rights *(so not per unique user, that is better served by browser cache.)*

### Cache and Expiration Configuration

**ezplatform.yml**

``` brush:
ezpublish:
    system:
        my_siteaccess:
            content:
                view_cache: true      # Activates HttpCache for content
                ttl_cache: true       # Activates expiration based HttpCache for content (very fast)
                default_ttl: 60       # Number of seconds an Http response is valid in cache (if ttl_cache is true)
```

### Making your controller response content-aware

Sometimes you need your controller's cache to be invalidated at the same time as specific content changes (i.e. <a href="http://symfony.com/doc/current/book/http_cache.html#using-esi-in-symfony2">ESI sub-requests with <code>render</code> twig helper</a>, for a menu for instance). To be able to do that, you just need to add `X-Location-Id` header to the response object:

``` brush:
use Symfony\Component\HttpFoundation\Response;
 
// Inside a controller action
// "Connects" the response to location #123 and sets a max age (TTL) of 1 hour.
$response = new Response();
$response->headers->set('X-Location-Id', 123);
$response->setSharedMaxAge(3600);
```

### Making your controller response context-aware

If the content you're rendering depends on a user's permissions, then you should make the response <span class="confluence-link"><span class="confluence-link">context-aware</span></span>:

``` brush:
use Symfony\Component\HttpFoundation\Response;
 
// Inside a controller action
// Tells proxy configured to support this header to take the rights of a user (user hash) into account for the cache
$response = new Response();
$response->setVary('X-User-Hash');
```

# Configuration

## Cache Purge

This page explains the content cache purge *(aka invalidate)* mechanism used when publishing content from the UI or from a container-aware script, resulting in cache being invalidated either in the built-in Symfony Reverse Proxy, or on the much faster Varnish reverse proxy.

### Overview

eZ Platform returns content-related responses with an `X-Location-Id` header that are stored together by the configured HTTP cache. This allows you to clear *(invalidate)* HTTP cache representing specifically a given Content item. On publishing the content, a cache purger is triggered with the Content ID in question, which in turn figures out affected content Locations based on [Smart HTTP cache clearing](https://doc.ez.no/display/DEVELOPER/HTTP+Cache#HTTPCache-SmartHTTPcacheclearing) logic. The returned Location IDs are sent for purge using the purge type explained further below.

### Purge types

#### Symfony Proxy: Local purge type

By default, invalidation requests will be emulated and sent to the Symfony Proxy cache Store. Cache purge will thus be synchronous, meaning no HTTP purge requests will be sent around when publishing.

**ezplatform.yml**

``` brush:
ezpublish:
    http_cache:
        purge_type: local
```

### Varnish: HTTP purge type

With Varnish you can configure one or several servers that should be purged over HTTP. This purge type is asynchronous, and flushed by the end of Symfony kernel-request/console cycle *(during terminate event)*. Settings for purge servers can be configured per site group or site access:

**ezplatform.yml**

``` brush:
ezpublish:
    http_cache:
        purge_type: http

    system:
        my_siteacess:
            http_cache:
                purge_servers: ["http://varnish.server1", "http://varnish.server2", "http://varnish.server3"]
```

For further information on setting up Varnish, see [Using Varnish](https://doc.ez.no/display/DEVELOPER/HTTP+Cache#HTTPCache-UsingVarnish).

### Purging

While purging on content, updates are handled for you; on actions against the eZ Platform APIs, there are times you might have to purge manually.

#### Manual by code

Manual purging from code which takes [Smart HTTP cache clearing](https://doc.ez.no/display/DEVELOPER/HTTP+Cache#HTTPCache-SmartHTTPcacheclearing) logic into account, this is using the service also used internally for cache clearing on content updates:

``` brush:
// Purging cache based on content id, this will trigger cache clear of all locations found by Smart HttpCache clear
// typically self, parent, related, ..
$container->get('ezpublish.http_cache.purger')->purgeForContent(55);
```

#### <span style="color: rgb(0,98,147);">Manually by command with Symfony Proxy</span>

Symfony Proxy stores its cache in the Symfony cache directory, so a regular `cache:clear` commands will clear it:

``` brush:
php app/console --env=prod cache:clear
```

#### Manual by HTTP BAN request on Varnish

When using Varnish and in need to purge content directly, then the following examples show how this is done internally by our <span>FOSPurgeClient, and in turn </span>FOSHttpCache Varnish proxy client:

For purging all:

``` brush:
BAN / HTTP 1.1 
Host: localhost 
X-Location-Id: .* 
```

Or with given location ids *(here 123 and 234)*:<span style="color: rgb(0,128,0);"> </span>

``` brush:
BAN / HTTP 1.1 
Host: localhost 
X-Location-Id: ^(123|234)$
```

     

## Using Varnish

eZ Platform being built on top of Symfony, it uses standard HTTP cache headers. By default the Symfony reverse proxy, written in PHP, is used to handle cache, but it can be easily replaced with any other reverse proxy like Varnish.

*Use of Varnish is a requirement for use in Clustering setup, for overview of clustering feature see [Clustering](Clustering_31430387.html). *

 

### Prerequisites

-   A working Varnish 3 or Varnish 4 setup.

### Recommended VCL base files

For Varnish to work properly with eZ, you'll need to use one of the provided files as a basis:

-   <a href="https://github.com/ezsystems/ezplatform/blob/master/doc/varnish/vcl/varnish3.vcl">Varnish 3 VCL example</a>
-   <a href="https://github.com/ezsystems/ezplatform/blob/master/doc/varnish/vcl/varnish4.vcl">Varnish 4 VCL example</a>

> **Note:** Http cache management is done with the help of <a href="http://foshttpcachebundle.readthedocs.org/">FOSHttpCacheBundle</a>. You may need to tweak your VCL further on according to <a href="http://foshttpcache.readthedocs.org/en/latest/varnish-configuration.html">FOSHttpCache documentation</a> in order to use features supported by it.

### Configure eZ Publish

#### Update your Virtual Host

Somehow we need to tell php process that we are behind a Varnish proxy and not the built in Symfony Http Proxy. If you use fastcgi/fpm you can pass these directly to php process, but you can in all cases also specify them in your web server config.

#### On apache:

**my\_virtualhost.conf**

``` brush:
<VirthualHost *:80>
    # Configure your VirtualHost with rewrite rules and stuff
 
    # Force front controller NOT to use built-in reverse proxy.
    SetEnv SYMFONY_HTTP_CACHE 0
 
    # Configure IP of your Varnish server to be trusted proxy
    # Replace fake IP address below by your Varnish IP address
    SetEnv SYMFONY_TRUSTED_PROXIES "193.22.44.22"
</VirtualHost>
```

#### On nginx:

**mysite.com**

``` brush:
fastcgi_param SYMFONY_HTTP_CACHE 0;
# Configure IP of your Varnish server to be trusted proxy
# Replace fake IP address below by your Varnish IP address
fastcgi_param SYMFONY_TRUSTED_PROXIES "193.22.44.22";
```

### Update YML configuration

Secondly we need to tell eZ Platform to change to use http based purge client *(specifically FosHttpCache Varnish purge client is used)*, and specify url Varnish can be reached on:

**ezplatform.yml**

``` brush:
ezpublish:
    http_cache:
        purge_type: http
 
    system:
        # Assuming that my_siteaccess_group your frontend AND backend siteaccesses
        my_siteaccess_group:
            http_cache:
                # Fill in your Varnish server(s) address(es).
                purge_servers: [http://my.varnish.server:8081]
```

 

# Usage

## <span id="HTTPCache-Content-awareHTTPCache" class="confluence-anchor-link"></span>Context-aware HTTP cache

### Use case

As it is based on Symfony 2, eZ Platform uses HTTP cache <span class="confluence-link">extended with features like content awareness</span>. However, this cache management is only available for anonymous users due to HTTP restrictions.

It is of course possible to make HTTP cache vary thanks to the `Vary` response header, but this header can only be based on one of the request headers (e.g. `Accept-Encoding`). Thus, to make the cache vary on a specific context *(for example a hash based on a user roles and limitations)*, this context must be present in the original request.

### Feature

As the response can vary on a request header, the base solution is to make the kernel do a sub-request in order to retrieve the user context hash (aka **user hash**). Once the *user hash* has been retrieved, it's injected in the original request in the `X-User-Hash` custom header, making it possible to *vary* the HTTP response on this header:

``` brush:
<?php
use Symfony\Component\HttpFoundation\Response;

// ...

// Inside a controller action
$response = new Response();
$response->setVary('X-User-Hash');
```

This solution is implemented in Symfony reverse proxy (aka *HttpCache*) and is also accessible to dedicated reverse proxies like Varnish.

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Note that sharing ESIs across SiteAccesses is not possible by design (see <span class="jira-issue resolved"> <a href="https://jira.ez.no/browse/EZP-22535?src=confmacro" class="jira-issue-key"><img src="https://jira.ez.no/images/icons/issuetypes/bug.png" class="icon" />EZP-22535</a> - <span class="summary">Cached ESI can not be shared across pages/siteaccesses due to "pathinfo" property</span> <span class="aui-lozenge aui-lozenge-subtle aui-lozenge-success jira-macro-single-issue-export-pdf">Closed</span> </span> for technical details)

Vary by User

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
In cases where you need to deliver content uniquely to a given user, and tricks like using JavaScript and cookie values, hinclude, or disabling cache is not an option. Then remaining option is to vary response by cookie:

``` brush:
$response->setVary('Cookie');
```

Unfortunately this is not optimal as it will by default vary by all cookies, including those set by add trackers, analytics tools, recommendation services, etc. However, as long as *your* application backend does not need these cookies, you can solve this by stripping everything but the session cookie. Example for Varnish can be found in the default VCL examples in part dealing with User Hash, for single-server setup this can easily be accomplished in Apache / Nginx as well.

 

### HTTP cache clear

As eZ Platform uses <a href="http://foshttpcachebundle.readthedocs.org/">FOSHttpCacheBundle</a>, this impacts the following features:

-   HTTP cache purge
-   User context hash

Varnish proxy client from FOSHttpCache lib is used for clearing eZ HTTP cache, even when using Symfony HttpCache. A single `BAN` request is sent to registered purge servers, containing a `X-Location-Id` header. This header contains all Location IDs for which objects in cache need to be cleared.

### Symfony reverse proxy

Symfony reverse proxy (aka HttpCache) is supported out of the box, all you have to do is to activate it.

### Varnish

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Please refer to [Using Varnish](https://doc.ez.no/display/DEVELOPER/HTTP+Cache#HTTPCache-UsingVarnish)

### User context hash

<a href="http://foshttpcachebundle.readthedocs.org/en/latest/features/user-context.html">FOSHttpCacheBundle <em>User Context feature</em></a> is activated by default.

As the response can vary on a request header, the base solution is to make the kernel do a sub-request in order to retrieve the context (aka **user context hash**). Once the *user hash* has been retrieved, it's injected in the original request in the `X-User-Hash` header, making it possible to *vary* the HTTP response on this header:

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Name of the <a href="http://foshttpcachebundle.readthedocs.org/en/latest/reference/configuration/user-context.html">user hash header is configurable in FOSHttpCacheBundle</a>. By default eZ Platform sets it to `**X-User-Hash**`.

``` brush:
<?php 
use Symfony\Component\HttpFoundation\Response;
 
// ...
 
// Inside a controller action
$response = new Response();
$response->setVary('X-User-Hash');
```

 

This solution is <a href="http://foshttpcachebundle.readthedocs.org/en/latest/features/symfony-http-cache.html">implemented in Symfony reverse proxy (aka <em>HttpCache</em>)</a> and is also accessible to <a href="http://foshttpcache.readthedocs.org/en/latest/varnish-configuration.html">dedicated reverse proxies like Varnish</a>.

### Workflow

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
Please refer to <a href="http://foshttpcachebundle.readthedocs.org/en/latest/features/user-context.html#how-it-works">FOSHttpCacheBundle documentation on how user context feature works</a>.

### User hash generation

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
Please refer to <a href="http://foshttpcachebundle.readthedocs.org/en/latest/features/user-context.html#generating-hashes">FOSHttpCacheBundle documentation on how user hashes are being generated</a>.

eZ Platform already interferes with the hash generation process by adding current user permissions and limitations. You can also interfere in this process by <a href="http://foshttpcachebundle.readthedocs.org/en/latest/reference/configuration/user-context.html#custom-context-providers">implementing custom context provider(s)</a>.

#### User hash generation with Varnish 3

The behavior described here comes out of the box with Symfony reverse proxy, but it's of course possible to use Varnish to achieve the same.

``` brush:
# Varnish 3 style for eZ Platform
# Our Backend - We assume that eZ Platform Web server listen on port 80 on the same machine.
backend ezplatform {
    .host = "127.0.0.1";
    .port = "80";
}

# Called at the beginning of a request, after the complete request has been received
sub vcl_recv {

    # Set the backend
    set req.backend = ezplatform;

    # ...

    # Retrieve client user hash and add it to the forwarded request.
    call ez_user_hash;

    # If it passes all these tests, do a lookup anyway;
    return (lookup);
}

# Sub-routine to get client user hash, for context-aware HTTP cache.
# Don't forget to correctly set the backend host for the Curl sub-request.
sub ez_user_hash {

    # Prevent tampering attacks on the hash mechanism
    if (req.restarts == 0
        && (req.http.accept ~ "application/vnd.fos.user-context-hash"
            || req.http.x-user-context-hash
        )
    ) {
        error 400;
    }

    if (req.restarts == 0 && (req.request == "GET" || req.request == "HEAD")) {
        # Get User (Context) hash, for varying cache by what user has access to.
        # https://doc.ez.no/display/EZP/Context+aware+HTTP+cach

        # Anonymous user w/o session => Use hardcoded anonymous hash to avoid backend lookup for hash
        if (req.http.Cookie !~ "eZSESSID" && !req.http.authorization) {
            # You may update this hash with the actual one for anonymous user
            # to get a better cache hit ratio across anonymous users.
            # Note: Then needs update every time anonymous user role assignments change.
            set req.http.X-User-Hash = "38015b703d82206ebc01d17a39c727e5";
        }
        # Pre-authenticate request to get shared cache, even when authenticated
        else {
            set req.http.x-fos-original-url    = req.url;
            set req.http.x-fos-original-accept = req.http.accept;
            set req.http.x-fos-original-cookie = req.http.cookie;
            # Clean up cookie for the hash request to only keep session cookie, as hash cache will vary on cookie.
            set req.http.cookie = ";" + req.http.cookie;
            set req.http.cookie = regsuball(req.http.cookie, "; +", ";");
            set req.http.cookie = regsuball(req.http.cookie, ";(eZSESSID[^=]*)=", "; \1=");
            set req.http.cookie = regsuball(req.http.cookie, ";[^ ][^;]*", "");
            set req.http.cookie = regsuball(req.http.cookie, "^[; ]+|[; ]+$", "");

            set req.http.accept = "application/vnd.fos.user-context-hash";
            set req.url = "/_fos_user_context_hash";

            # Force the lookup, the backend must tell not to cache or vary on all
            # headers that are used to build the hash.

            return (lookup);
        }
    }

    # Rebuild the original request which now has the hash.
    if (req.restarts > 0
        && req.http.accept == "application/vnd.fos.user-context-hash"
    ) {
        set req.url         = req.http.x-fos-original-url;
        set req.http.accept = req.http.x-fos-original-accept;
        set req.http.cookie = req.http.x-fos-original-cookie;

        unset req.http.x-fos-original-url;
        unset req.http.x-fos-original-accept;
        unset req.http.x-fos-original-cookie;

        # Force the lookup, the backend must tell not to cache or vary on the
        # user hash to properly separate cached data.

        return (lookup);
    }
}

sub vcl_fetch {

    # ...

    if (req.restarts == 0
        && req.http.accept ~ "application/vnd.fos.user-context-hash"
        && beresp.status >= 500
    ) {
        error 503 "Hash error";
    }
}

sub vcl_deliver {
    # On receiving the hash response, copy the hash header to the original
    # request and restart.
    if (req.restarts == 0
        && resp.http.content-type ~ "application/vnd.fos.user-context-hash"
        && resp.status == 200
    ) {
        set req.http.x-user-hash = resp.http.x-user-hash;

        return (restart);
    }

    # If we get here, this is a real response that gets sent to the client.

    # Remove the vary on context user hash, this is nothing public. Keep all
    # other vary headers.
    set resp.http.Vary = regsub(resp.http.Vary, "(?i),? *x-user-hash *", "");
    set resp.http.Vary = regsub(resp.http.Vary, "^, *", "");
    if (resp.http.Vary == "") {
        remove resp.http.Vary;
    }

    # Sanity check to prevent ever exposing the hash to a client.
    remove resp.http.x-user-hash;
}
```

#### User hash generation with Varnish 4

``` brush:
// Varnish 4 style for eZ Platform
// Complete VCL example

vcl 4.0;

// Our Backend - Assuming that web server is listening on port 80
// Replace the host to fit your setup
backend ezplatform {
    .host = "127.0.0.1";
    .port = "80";
}

// Called at the beginning of a request, after the complete request has been received
sub vcl_recv {

    // Set the backend
    set req.backend_hint = ezplatform;

    // ...

    // Retrieve client user hash and add it to the forwarded request.
    call ez_user_hash;

    // If it passes all these tests, do a lookup anyway.
    return (hash);
}
 
// Called when the requested object has been retrieved from the backend
sub vcl_backend_response {
    if (bereq.http.accept ~ "application/vnd.fos.user-context-hash"
        && beresp.status >= 500
    ) {
        return (abandon);
    }
    
    // ...
}

// Sub-routine to get client user hash, for context-aware HTTP cache.
sub ez_user_hash {

    // Prevent tampering attacks on the hash mechanism
    if (req.restarts == 0
        && (req.http.accept ~ "application/vnd.fos.user-context-hash"
            || req.http.x-user-hash
        )
    ) {
        return (synth(400));
    }

    if (req.restarts == 0 && (req.method == "GET" || req.method == "HEAD")) {
        // Get User (Context) hash, for varying cache by what user has access to.
        // https://doc.ez.no/display/EZP/Context+aware+HTTP+cache

        // Anonymous user w/o session => Use hardcoded anonymous hash to avoid backend lookup for hash
        if (req.http.Cookie !~ "eZSESSID" && !req.http.authorization) {
            // You may update this hash with the actual one for anonymous user
            // to get a better cache hit ratio across anonymous users.
            // Note: You should then update it every time anonymous user rights change.
            set req.http.X-User-Hash = "38015b703d82206ebc01d17a39c727e5";
        }
        // Pre-authenticate request to get shared cache, even when authenticated
        else {
            set req.http.x-fos-original-url    = req.url;
            set req.http.x-fos-original-accept = req.http.accept;
            set req.http.x-fos-original-cookie = req.http.cookie;
            // Clean up cookie for the hash request to only keep session cookie, as hash cache will vary on cookie.
            set req.http.cookie = ";" + req.http.cookie;
            set req.http.cookie = regsuball(req.http.cookie, "; +", ";");
            set req.http.cookie = regsuball(req.http.cookie, ";(eZSESSID[^=]*)=", "; \1=");
            set req.http.cookie = regsuball(req.http.cookie, ";[^ ][^;]*", "");
            set req.http.cookie = regsuball(req.http.cookie, "^[; ]+|[; ]+$", "");
            set req.http.accept = "application/vnd.fos.user-context-hash";
            set req.url = "/_fos_user_context_hash";

            // Force the lookup, the backend must tell how to cache/vary response containing the user hash
            return (hash);
        }
    }

    // Rebuild the original request which now has the hash.
    if (req.restarts > 0
        && req.http.accept == "application/vnd.fos.user-context-hash"
    ) {
        set req.url         = req.http.x-fos-original-url;
        set req.http.accept = req.http.x-fos-original-accept;
        set req.http.cookie = req.http.x-fos-original-cookie;
        unset req.http.x-fos-original-url;
        unset req.http.x-fos-original-accept;
        unset req.http.x-fos-original-cookie;

        // Force the lookup, the backend must tell not to cache or vary on the
        // user hash to properly separate cached data.

        return (hash);
    }
}

sub vcl_deliver {
    // On receiving the hash response, copy the hash header to the original
    // request and restart.
    if (req.restarts == 0
        && resp.http.content-type ~ "application/vnd.fos.user-context-hash"
    ) {
        set req.http.x-user-hash = resp.http.x-user-hash;
        return (restart);
    }

    // If we get here, this is a real response that gets sent to the client.
    // Remove the vary on context user hash, this is nothing public. Keep all
    // other vary headers.
    set resp.http.Vary = regsub(resp.http.Vary, "(?i),? *x-user-hash *", "");
    set resp.http.Vary = regsub(resp.http.Vary, "^, *", "");
    if (resp.http.Vary == "") {
        unset resp.http.Vary;
    }

    // Sanity check to prevent ever exposing the hash to a client.
    unset resp.http.x-user-hash;
    if (client.ip ~ debuggers) {
        if (obj.hits > 0) {
            set resp.http.X-Cache = "HIT";
            set resp.http.X-Cache-Hits = obj.hits;
        } else {
            set resp.http.X-Cache = "MISS";
        }
    }
}
```

#### New anonymous X-User-Hash

The anonymous X-User-Hash is generated based on the *anonymous user*, *group* and *role*. The `38015b703d82206ebc01d17a39c727e5` hash that is provided in the code above will work only when these three variables are left unchanged. Once you change the default permissions and settings, the X-User-Hash will change and Varnish won't be able to effectively handle cache anymore.

In that case you need to find out the new anonymous X-User-Hash and change the VCL accordingly, else Varnish will return a no-cache header.

The easiest way to find the new hash is:

**1.** Connect to your server (*shh* should be enough)

**2.** Add `<your-domain.com>` to your `/etc/hosts` file

**3.** Execute the following command:

`curl -I -H "Accept: application/vnd.fos.user-context-hash" http://<your-domain.com>/_fos_user_context_hash`

You should get a result like this:

``` brush:
HTTP/1.1 200 OK
Date: Mon, 03 Oct 2016 15:34:08 GMT
Server: Apache/2.4.18 (Ubuntu)
X-Powered-By: PHP/7.0.8-0ubuntu0.16.04.2
X-User-Hash: b1731d46b0e7a375a5b024e950fdb8d49dd25af85a5c7dd5116ad2a18cda82cb
Cache-Control: max-age=600, public
Vary: Cookie,Authorization
Content-Type: application/vnd.fos.user-context-hash
```

**4.** Now, replace the existing X-User-Hash value with the new one:

``` brush:
# Note: This needs update every time anonymous user role assignments change.
set req.http.X-User-Hash = "b1731d46b0e7a375a5b024e950fdb8d49dd25af85a5c7dd5116ad2a18cda82cb";
```

**5.** Restart the Varnish server and everything should work fine.

#### Default options for FOSHttpCacheBundle defined in eZ

The following configuration is defined in eZ by default for FOSHttpCacheBundle. You may override these settings.

``` brush:
fos_http_cache: 
    proxy_client: 
        # "varnish" is used, even when using Symfony HttpCache.
        default: varnish
        varnish: 
            # Means http_cache.purge_servers defined for current SiteAccess.
            servers: [$http_cache.purge_servers$]

    user_context: 
        enabled: true
        # User context hash is cached during 10min
        hash_cache_ttl: 600
        user_hash_header: X-User-Hash
```

<span> </span>

### Credits

This feature is based on <a href="http://asm89.github.io/2012/09/26/context-aware-http-caching.html">Context aware HTTP caching post</a> by <a href="https://github.com/asm89">asm89</a>.

#### In this topic:

-   [Introduction](#HTTPCache-Introduction)
    -   [Smart HTTP cache clearing](#HTTPCache-SmartHTTPcacheclearing)
        -   [The mechanism](#HTTPCache-Themechanism)
        -   [Default behavior](#HTTPCache-Defaultbehavior)
        -   [Implementing a custom listener](#HTTPCache-Implementingacustomlistener)
    -   [Content Cache](#HTTPCache-ContentCache)
        -   [Cache and Expiration Configuration](#HTTPCache-CacheandExpirationConfiguration)
        -   [Making your controller response content-aware](#HTTPCache-Makingyourcontrollerresponsecontent-aware)
        -   [Making your controller response context-aware](#HTTPCache-Makingyourcontrollerresponsecontext-aware)
-   [Configuration](#HTTPCache-Configuration)
    -   [Cache Purge](#HTTPCache-CachePurge)
        -   [Overview](#HTTPCache-Overview)
        -   [Purge types](#HTTPCache-Purgetypes)
        -   [Varnish: HTTP purge type](#HTTPCache-Varnish:HTTPpurgetype)
        -   [Purging](#HTTPCache-Purging)
    -   [Using Varnish](#HTTPCache-UsingVarnish)
        -   [Prerequisites](#HTTPCache-Prerequisites)
        -   [Recommended VCL base files](#HTTPCache-RecommendedVCLbasefiles)
        -   [Configure eZ Publish](#HTTPCache-ConfigureeZPublish)
        -   [Update YML configuration](#HTTPCache-UpdateYMLconfiguration)
-   [Usage](#HTTPCache-Usage)
    -   [Context-aware HTTP cache](#HTTPCache-Content-awareHTTPCacheContext-awareHTTPcache)
        -   [Use case](#HTTPCache-Usecase)
        -   [Feature](#HTTPCache-Feature)
        -   [HTTP cache clear](#HTTPCache-HTTPcacheclear)
        -   [Symfony reverse proxy](#HTTPCache-Symfonyreverseproxy)
        -   [Varnish](#HTTPCache-Varnish)
        -   [User context hash](#HTTPCache-Usercontexthash)
        -   [Workflow](#HTTPCache-Workflow)
        -   [User hash generation](#HTTPCache-Userhashgeneration)
        -   [Credits](#HTTPCache-Credits)

#### Related:

-   [Overview of steps to set up Cluster](Steps-to-set-up-Cluster_31432321.html)[:](#HTTPCache-Persistencecacheconfiguration)
    -   [Set up DFS IO Handler](Clustering_31430387.html)
    -   [Configure Persistence Cache](Repository_31432023.html#Repository-Persistencecacheconfiguration)
    -   <span class="confluence-link">[Configure sessions](Sessions_31429667.html)</span>

## Comments:

<table>
<colgroup>
<col width="100%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><a href=""></a>
<p>Note that you'll need to define &quot;SYMFONY_HTTP_CACHE&quot; instead of &quot;USE_HTTP_CACHE&quot; and &quot;SYMFONY_TRUSTED_PROXIES&quot; instead of &quot;TRUSTED_PROXIES&quot;</p>
<p>ps. At least in eZPlatform 1.3</p>
<div class="smallfont" align="left" style="color: #666666; width: 98%; margin-bottom: 10px;">
<img src="images/icons/contenttypes/comment_16.png" width="16" height="16" /> Posted by diaborn at Jun 03, 2016 12:42
</div></td>
</tr>
<tr class="even">
<td align="left"><a href=""></a>
<p>Thanks <a href="https://doc.ez.no/display/~diaborn" class="confluence-userlink user-mention">Ivan Ternovtsiy</a>, fixed <img src="images/icons/emoticons/smile.png" alt="(smile)" class="emoticon emoticon-smile" /> </p>
<div class="smallfont" align="left" style="color: #666666; width: 98%; margin-bottom: 10px;">
<img src="images/icons/contenttypes/comment_16.png" width="16" height="16" /> Posted by andre.romcke@ez.no at Oct 29, 2016 14:44
</div></td>
</tr>
</tbody>
</table>






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Community Resources](Community-Resources_31429530.html)</span>

 Developer : How to Contribute 



Are you ready to become a part of the eZ Community? There are several ways in which you can contribute, from spotting and reporting bugs to commenting on the documentation to discussing innovative uses on Slack to coding new bundles.

 

If you're looking to contribute code, whether in form of corrections or separate bundles with features, the open-source nature of eZ Platform lets you do this without any fuss using GitHub. Take a look at [GitHub 101](GitHub-101_31429590.html) and our [Development guidelines](Development-guidelines_31430575.html) to get started.

If you've noticed any improvement needed in the documentation, see how to [Contribute to Documentation](Contribute-to-Documentation_31429594.html).

If you'd just like to let us know of a bug you've encountered, see how to report it in [Report and follow issues: The bugtracker](31429592.html).

If you'd like to contribute to a translation of eZ Platform interface, see [Contributing translations](Contributing-translations_34079215.html).

If what you're looking for is simply discussing the way you use eZ Platform, drop by to the <a href="http://share.ez.no">community website</a> or the <a href="https://ezcommunity.slack.com/">eZ Community Slack team</a>.

 

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>
6.  <span>[Content items, Content Types and Fields](31430275.html)</span>
7.  <span>[Field Types reference](Field-Types-reference_31430495.html)</span>

 Developer : ISBN Field Type 



This Field Type represents an ISBN string.

| Name   | Internal name | Expected input type |
|--------|---------------|---------------------|
| `ISBN` | `ezisbn`      | `string`            |

## <span>Description</span>

This Field Type makes it possible to store and retrieve an ISBN string in either an ISBN-10 or ISBN-13 format.

## PHP API Field Type 

### Value object

##### Properties

The Value class of this Field Type contains the following properties:

| Property | Type     | Description                                     |
|----------|----------|-------------------------------------------------|
| `$isbn`  | `string` | This property will be used for the ISBN string. |

##### String representation

An ISBN's string representation is the the $isbn property's value, as a string.

##### Constructor

The constructor for this value object will initialize a new Value object with the value provided. It accepts a string as argument and will set it to the `isbn` attribute.

### Validation

The input passed into this Field Type is subject of ISBN validation depending on the Field settings in its FieldDefinition stored in the Content Type. An example of this Field setting is shown below and will control if input is validated as ISBN-13 or ISBN-10:

``` brush:
Array
(
    [isISBN13] => true
)
```

 

For more details on the Value object for this Field Type please refer to the <a href="http://apidoc.ez.no/doxygen/trunk/NS/html/classeZ_1_1Publish_1_1Core_1_1FieldType_1_1ISBN_1_1Value.html">auto-generated documentation</a> *(todo: update link when available, see <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Publish/Core/FieldType/ISBN/Value.php">here</a>* *for the value object and its doc in the mean time)*.

 

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>
6.  <span>[Content items, Content Types and Fields](31430275.html)</span>
7.  <span>[Field Types reference](Field-Types-reference_31430495.html)</span>

 Developer : Image Field Type 



<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Field Type identifier: `ezimage`
Validators: File size
Value object: `\eZ\Publish\Core\FieldType\Image\Value`<span>
Associated Services: `ezpublish.fieldType.ezimage.variation_service`</span>

The Image Field Type allows you to store an image file.

A **variation service** handles conversion of the original image into different formats and sizes through a set of preconfigured named variations: large, small, medium, black & white thumbnail, etc.

## PHP API Field Type

### Value object

The `value` property of an Image Field will return an `\eZ\Publish\Core\FieldType\Image\Value` object with the following properties:

##### Properties

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Property</th>
<th align="left">Type</th>
<th align="left">Example</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>id</code></td>
<td align="left">string</td>
<td align="left"><code>0/8/4/1/1480-1-eng-GB/image.png  </code></td>
<td align="left"><p>The image's unique identifier. Usually the path, or a part of the path. To get the full path, use <code>URI</code> property.</p></td>
</tr>
<tr class="even">
<td align="left"><code>alternativeText</code></td>
<td align="left">string</td>
<td align="left"><code>This is a piece of text</code></td>
<td align="left">The alternative text, as entered in the Field's properties</td>
</tr>
<tr class="odd">
<td align="left"><code>fileName</code></td>
<td align="left">string</td>
<td align="left"><code>image.png</code></td>
<td align="left">The original image's filename, without the path</td>
</tr>
<tr class="even">
<td align="left"><code>fileSize</code></td>
<td align="left">int</td>
<td align="left"><code>37931</code></td>
<td align="left">The original image's size, in bytes</td>
</tr>
<tr class="odd">
<td align="left"><code>uri</code></td>
<td align="left">string</td>
<td align="left"><code>var/ezdemo_site/storage/images/0/8/4/1/1480-1-eng-GB/image.png</code></td>
<td align="left">The original image's URI</td>
</tr>
<tr class="even">
<td align="left"><code>imageId</code></td>
<td align="left">string</td>
<td align="left"><code>240-1480</code></td>
<td align="left">A special image ID, used by REST</td>
</tr>
</tbody>
</table>

### Image Variations

Using the variation Service, variations of the original image can be obtained. Those are `\eZ\Publish\SPI\Variation\Values\ImageVariation`<span style="line-height: 1.4285715;"> objects with the following properties:</span>

| Property       | Type     | Example  | Description                          |
|----------------|----------|----------|--------------------------------------|
| `width`        | int      | `640`    | The variation's width in pixels      |
| `height`       | int      | `480`    | The variation's height in pixels     |
| `name`         | string   | `medium` | The variation's identifier           |
| `info`         | mixed    |          | Extra info, such as EXIF data        |
| `fileSize`     | int      |          |                                      |
| `mimeType`     | string   |          |                                      |
| `fileName`     | string   |          |                                      |
| `dirPath`      | string   |          |                                      |
| `uri`          | string   |          | The variation's uri                  |
| `lastModified` | DateTime |          | When the variation was last modified |

### Field Defintion options

The Image Field Type supports one FieldDefinition option: the maximum size for the file.

## Using an Image Field

### Template Rendering

When displayed using `ez_render_field`, an Image Field will output this type of HTML:

``` brush:
<img src="var/ezdemo_site/storage/images/0/8/4/1/1480-1-eng-GB/image_medium.png" width="844" height="430" alt="Alternative text" />
```

The template called by [the **ez\_render\_field()** Twig function](ez_render_field_32114041.html) while rendering a Image field accepts the following the parameters:

| Parameter | Type             | Default        | Description                                                                                                                                       |
|-----------|------------------|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------|
| `alias`   | `string`         | `"original``"` | The image variation name, must be defined in your site access `image_variations` settings. Defaults to "original", the originally uploaded image. |
| `width`   | `int`            |                | Optionally to specify a different width set on the image html tag then then one from image alias.                                                 |
| `height`  | <span>int</span> |                | <span>Optionally to specify a different height set on the image html tag then then one from image alias.</span>                                   |
| `class`   | `string`         |                | <span>Optionally to specify a specific html class for use in custom javascript and/or css.</span>                                                 |

 

Example: 

``` brush:
{{ ez_render_field( content, 'image', { 'parameters':{ 'alias': 'imagelarge', 'width': 400, 'height': 400 } } ) }}
```

The raw Field can also be used if needed. Image variations for the Field's content can be obtained using the `ez_image_alias` Twig helper:

``` brush:
{% set imageAlias = ez_image_alias( field, versionInfo, 'medium' ) %}
```

<span style="line-height: 1.4285715;">The variation's properties can be used to generate the required output:</span>

``` brush:
<img src="{{ asset( imageAlias.uri ) }}" width="{{ imageAlias.width }}" height="{{ imageAlias.height }}" alt="{{ field.value.alternativeText }}" />
```

 

### With the REST API

Image Fields within REST are exposed by the `application/vnd.ez.api.Content` media-type. An Image Field will look like this:

inputUri

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
From 5.2 version, new images must be input using the `inputUri` property from `Image\Value`.

**The keys `id` and `path` still work, but a deprecation warning will be thrown.**

**Version &gt;= 5.2**

``` brush:
<field>
    <id>1480</id>
    <fieldDefinitionIdentifier>image</fieldDefinitionIdentifier>
    <languageCode>eng-GB</languageCode>
    <fieldValue>
        <value key="inputUri">/var/ezdemo_site/storage/images/0/8/4/1/1480-1-eng-GB/kidding.png</value>
        <value key="alternativeText"></value>
        <value key="fileName">kidding.png</value>
        <value key="fileSize">37931</value>
        <value key="imageId">240-1480</value>
        <value key="uri">/var/ezdemo_site/storage/images/0/8/4/1/1480-1-eng-GB/kidding.png</value>
        <value key="variations">
            <value key="articleimage">
                <value key="href">/api/ezp/v2/content/binary/images/240-1480/variations/articleimage</value>
            </value>
            <value key="articlethumbnail">
                <value key="href">/api/ezp/v2/content/binary/images/240-1480/variations/articlethumbnail</value>
            </value>
        </value>
    </fieldValue>
</field>
```

**Before 5.2** <span class="collapse-source expand-control"><span class="expand-control-icon icon"> </span><span class="expand-control-text">Expand source</span></span>

``` brush:
<field>
    <id>1480</id>
    <fieldDefinitionIdentifier>image</fieldDefinitionIdentifier>
    <languageCode>eng-GB</languageCode>
    <fieldValue>
        <value key="id">var/ezdemo_site/storage/images/0/8/4/1/1480-1-eng-GB/kidding.png</value>
        <value key="path">/var/ezdemo_site/storage/images/0/8/4/1/1480-1-eng-GB/kidding.png</value>
        <value key="alternativeText"></value>
        <value key="fileName">kidding.png</value>
        <value key="fileSize">37931</value>
        <value key="imageId">240-1480</value>
        <value key="uri">/var/ezdemo_site/storage/images/0/8/4/1/1480-1-eng-GB/kidding.png</value>
        <value key="variations">
            <value key="articleimage">
                <value key="href">/api/ezp/v2/content/binary/images/240-1480/variations/articleimage</value>
            </value>
            <value key="articlethumbnail">
                <value key="href">/api/ezp/v2/content/binary/images/240-1480/variations/articlethumbnail</value>
            </value>
        </value>
    </fieldValue>
</field>
```

 

Children of the fieldValue node will list the general properties of the Field's original image (fileSize, fileName, inputUri, etc.), as well as variations. For each variation, a uri is provided. Requested through REST, this resource will generate the variation if it doesn't exist yet, and list the variation details:

``` brush:
<ContentImageVariation media-type="application/vnd.ez.api.ContentImageVariation+xml" href="/api/ezp/v2/content/binary/images/240-1480/variations/tiny">
  <uri>/var/ezdemo_site/storage/images/0/8/4/1/1480-1-eng-GB/kidding_tiny.png</uri>
  <contentType>image/png</contentType>
  <width>30</width>
  <height>30</height>
  <fileSize>1361</fileSize>
</ContentImageVariation>
```

### From PHP code

#### Getting an image variation

The variation service, `ezpublish.fieldType.ezimage.variation_service`, can be used to generate/get variations for a Field. It expects a VersionInfo, the Image Field and the variation name, as a string (`large`, `medium`, etc.)

``` brush:
$variation = $imageVariationHandler->getVariation(
    $imageField, $versionInfo, 'large'
);

echo $variation->uri;
```

## Manipulating image content

### From PHP

As for any Field Type, there are several ways to input content to a Field. For an Image, the quickest is to call `setField()` on the ContentStruct:

``` brush:
$createStruct = $contentService->newContentCreateStruct(
    $contentTypeService->loadContentType( 'image' ),
    'eng-GB'
);

$createStruct->setField( 'image', '/tmp/image.png' );
```

In order to customize the Image's alternative texts, you must first get an Image\\Value object, and set this property. For that, you can use the `Image\Value::fromString()` method that accepts the path to a local file:

``` brush:
$createStruct = $contentService->newContentCreateStruct(
    $contentTypeService->loadContentType( 'image' ),
    'eng-GB'
);

$imageField = \eZ\Publish\Core\FieldType\Image\Value::fromString( '/tmp/image.png' );
$imageField->alternativeText = 'My alternative text';
$createStruct->setField( 'image', $imageField );
```

You can also provide a hash of `Image\Value` properties, either to `setField()`, or to the constructor:

``` brush:
$imageValue = new \eZ\Publish\Core\FieldType\Image\Value(
    array(
        'id' => '/tmp/image.png',
        'fileSize' => 37931,
        'fileName' => 'image.png',
        'alternativeText' => 'My alternative text'
    )
);

$createStruct->setField( 'image', $imageValue );
```

### From REST

The REST API expects Field values to be provided in a hash-like structure. Those keys are identical to those expected by the `Image\Value` constructor: `fileName`, `alternativeText`. In addition, image data can be provided using the `data` property, with the image's content encoded as base64.

#### Creating an image Field

``` brush:
<?xml version="1.0" encoding="UTF-8"?>
<ContentCreate>
    <!-- [...metadata...] -->

    <fields>
        <field>
            <id>247</id>
            <fieldDefinitionIdentifier>image</fieldDefinitionIdentifier>
            <languageCode>eng-GB</languageCode>
            <fieldValue>
                <value key="fileName">rest-rocks.jpg</value>
                <value key="alternativeText">HTTP</value>
                <value key="data"><![CDATA[/9j/4AAQSkZJRgABAQEAZABkAAD/2wBDAAIBAQIBAQICAgICAgICAwUDAwMDAwYEBAMFBwYHBwcG
BwcICQsJCAgKCAcHCg0KCgsMDAwMBwkODw0MDgsMDAz/2[...]</value>
            </fieldValue>
        </field>
    </fields>
</ContentCreate>
```

#### Updating an image Field

Updating an Image Field requires that you re-send existing data. This can be done by re-using the Field obtained via REST, **removing the variations key**, and updating `alternativeText`, `fileName` or `data`. If you do not want to change the image itself, do not provide the `data` key.

``` brush:
<?xml version="1.0" encoding="UTF-8"?>
<VersionUpdate>
    <fields>
        <field>
            <id>247</id>
            <fieldDefinitionIdentifier>image</fieldDefinitionIdentifier>
            <languageCode>eng-GB</languageCode>
            <fieldValue>
                <value key="id">media/images/507-1-eng-GB/Existing-image.png</value>
                <value key="alternativeText">Updated alternative text</value>
                <value key="fileName">Updated-filename.png</value>
            </fieldValue>
        </field>
    </fields>
</VersionUpdate>
```

## Naming

Each storage engine determines how image files are named.

### Legacy Storage Engine naming

Images are stored within the following directory structure:

`<varDir>/<StorageDir>/<ImagesStorageDir>/<FieIdId[-1]>/<FieIdId[-2]>/<FieIdId[-3]>/<FieIdId[-4]>/<FieldId>-<VersionNumber>-<LanguageCode>/`

With the following values:

-   `VarDir` = var (default)
-   `StorageDir` = `storage` (default)
-   <span>`ImagesStorageDir` = `images` (default)</span>
-   <span>`FieldId` = `1480`</span>
-   <span>`VersionNumber` = `1`</span>
-   <span>`LanguageCode` = `eng-GB`</span>

<span>Images will be stored to `web/var/ezdemo_site/storage/images/0/8/4/1/1480-1-eng-GB`.</span>

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Using the field ID digits <span>in reverse order </span>as the folder structure maximizes sharding of files through multiple folders on the filesystem.

Within this folder, images will be named like the uploaded file, suffixed with an underscore and the variation name:

-   MyImage.png
-   MyImage\_large.png
-   MyImage\_rss.png

 

 

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : Images 



# Introduction

Image variations (image aliases) allow you to define and use different versions of the same image. You generate variations based on filters which modify aspects such as size and proportions, quality or decorations.

Image variations are generated with <a href="https://github.com/liip/LiipImagineBundle">LiipImagineBundle</a>, using the underlying <a href="http://imagine.readthedocs.org/en/latest/">Imagine library from avalanche123</a>. This bundle supports GD, Imagick or Gmagick PHP extensions, and allows you to define flexible filters in PHP. Image files are stored using the `IOService,` and are completely independent from the `ezimage` Field Type. They are generated only once and cleared on demand (e.g. on content removal).

# Configuration

Custom image variations are defined in `ezplatform.yml` or any imported semantic configuration file. The definition is [<span class="confluence-link">dynamic</span>](https://doc.ez.no/display/DEVELOPER/SiteAccess#SiteAccess-Configuration), so it can be configured per siteaccess and all the other scopes.

**Example image variation definition**

``` brush:
ezpublish:
    system:
        my_siteaccess:
            image_variations:
                small:
                    reference: null
                    filters:
                        - { name: geometry/scaledownonly, params: [100, 160] }
                medium:
                    reference: null
                    filters:
                        - { name: geometry/scaledownonly, params: [200, 290] }
                listitem:
                    reference: null
                    filters:
                        - { name: geometry/scaledownonly, params: [130, 190] }
                articleimage:
                    reference: null
                    filters:
                        - { name: geometry/scalewidth, params: [770] }
```

Important

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
Each variation name **must be unique**. It may contain `_` or `-` or numbers, but no spaces.

The following parameters are set for each variation:

-   `reference`: Name of a reference variation to base the variation on. If set to `null` (or `~`, which means `null` in YAML), the variation will take the original image for reference. It can be any available variation configured in the `ezpublish` namespace, or a `filter_set` defined in the `liip_imagine` namespace.

-   `filters`: Array of filter definitions (hashes containing `name` and `params` keys). See possible values [below](#Images-Reference).

## Default image variations

A few basic image variations are included by default in eZ Platform in the `default_settings.yml` config file:

``` brush:
ezsettings.default.image_variations:
    reference:
        reference: ~
        filters:
            geometry/scaledownonly: [600, 600]
    small:
        reference: reference
        filters:
            geometry/scaledownonly: [100, 100]
    tiny:
        reference: reference
        filters:
            geometry/scaledownonly: [30, 30]
    medium:
        reference: reference
        filters:
            geometry/scaledownonly: [200, 200]
    large:
        reference: reference
        filters:
            geometry/scaledownonly: [300, 300]
```

# Usage

## Filter usage examples

##### Scaling with an eZ Platform filter

This configuration defines a `medium` image variation that is scaled to a width of 700 px.

``` brush:
ezpublish:
    system:
        my_siteaccess:
            image_variations:
                medium:
                    reference: null
                    filters:
                        - geometry/scalewidth:
                            params: [770]
```

##### Image quality with a liip filter

This configuration adds a limit to the image quality using a liip filter.

You can use both an eZ Platform and a liip filter for the same image variation, in this case `medium`.

``` brush:
ezpublish:
    system:
        my_siteaccess:
            image_variations:
                # List of variations

liip_imagine:
    driver: imagick
    filter_sets:
        medium:
            jpeg_quality: 50
```

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Notice that the `liip_imagine` key is not placed under `image_variations`, but at the same level as `ezpublish`.

## Post-Processors

LiipImagineBundle supports <a href="http://symfony.com/doc/master/bundles/LiipImagineBundle/post-processors.html">post-processors on image aliases</a><span>. It is possible to specify them in image variation configuration:</span>

``` brush:
ezpublish:
    system:
        my_siteaccess:
            image_variations:
                articleimage:
                    reference: null
                    filters:
                        - { name: geometry/scalewidth, params: [770] }
                    post_processors:
                        jpegoptim: {}
```

<span>Please refer to <a href="http://symfony.com/doc/master/bundles/LiipImagineBundle/post-processors.html">post-processors documentation in LiipImagineBundle</a> <span> for details.</span> </span>

## Drivers

LiipImagineBundle supports GD (default), Imagick and GMagick PHP extensions and only works on image blobs (no command line tool is needed). See the <a href="http://symfony.com/doc/master/bundles/LiipImagineBundle/configuration.html">bundle's documentation to learn more on that topic</a>.

## Upgrade

#### Instantiate `LiipImagineBundle` in your kernel class

If you were using ImageMagick, install <a href="http://php.net/imagick">Imagick</a> or <a href="http://php.net/gmagick">Gmagick</a> PHP extensions and activate the driver in `liip_imagine `(<a href="http://symfony.com/doc/master/bundles/LiipImagineBundle/configuration.html">see LiipImagineBundle configuration documentation for more information</a>):

``` brush:
# ezplatform.yml or config.yml
liip_imagine:
    # Driver can be either "imagick", "gmagick" or "gd", depending on the PHP extension you're using.
    driver: imagick
```

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
GD will be used by default if no driver is specified.

## Purging aliases

It is possible to use the Liip Imagine console tool to clear generated aliases.

``` brush:
$ php app/console liip:imagine:cache:remove --filters=large
$ php app/console liip:imagine:cache:remove -v
```

The first example will clear the image files for the `large` alias. The second will clear all the generated aliases (be careful), and list the removed files (`-v).`

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
The naming scheme change introduced by this feature wasn't enabled by default on 5.4.x. As part of migration you'll need to adapt to the new schema to get the benefit of this more efficient purge method. More technical information can be found on the <a href="https://github.com/ezsystems/ezpublish-kernel/pull/1276">pull request</a>.

Code injection in image EXIF

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
EXIF metadata of an image <span class="blob-code-inner"><span class="pl-s1"><span class="pl-c">may contain e.g. HTML, JavaScript, or PHP code. eZ Platform is itself does not parse EXIF metadata, but third-party bundles need to be secured against this eventuality. Images should be treated like any</span></span></span> <span class="blob-code-inner"><span class="pl-s1"><span class="pl-c">other user-submitted data - make sure the metadata is properly escaped before use.</span></span></span>

# Reference

## Available filters

In addition to <a href="http://symfony.com/doc/master/bundles/LiipImagineBundle/configuration.html">filters exposed by LiipImagineBundle</a>, the following are available:

| Filter name                  | Parameters                                  | Description                                                                                        |
|------------------------------|---------------------------------------------|----------------------------------------------------------------------------------------------------|
| geometry/scaledownonly       | \[width, height\]                           | Generates a thumbnail that will not exceed width/height.                                           |
| geometry/scalewidthdownonly  | \[width\]                                   | Generates a thumbnail that will not exceed width.                                                  |
| geometry/scaleheightdownonly | \[height\]                                  | Generates a thumbnail that will not exceed height.                                                 |
| geometry/scalewidth          | \[width\]                                   | Alters image width. Proportion will be kept.                                                       |
| geometry/scaleheight         | \[height\]                                  | Alters image height. Proportion will be kept.                                                      |
| geometry/scale               | \[width, height\]                           | Alters image size, not exceeding provided width and height. Proportion will be kept.               |
| geometry/scaleexact          | \[width, height\]                           | Alters image size to fit exactly provided width and height. Proportion will not be kept.           |
| geometry/scalepercent        | \[widthPercent, heightPercent\]             | Scales width and height with provided percent values. Proportion will not be kept.                 |
| geometry/crop                | \[width, height, startX, startY\]           | Crops the image. Result will have provided width/height, starting at provided startX/startY        |
| border                       | \[thickBorderX, thickBorderY, color=\#000\] | Adds a border around the image. Thickness is defined in px. Color is "\#000" by default.           |
| filter/noise                 | \[radius=0\]                                | Smooths the contours of an image (`imagick`/`gmagick` only). `radius` is in pixel.                 |
| filter/swirl                 | \[degrees=60\]                              | Swirls the pixels of the center of an image (`imagick`/`gmagick` only). `degrees` defaults to 60°. |
| resize                       | {size: \[width, height\]}                   | Simple resize filter (provided by LiipImagineBundle).                                              |
| colorspace/gray              | N/A                                         | Converts an image to grayscale.                                                                    |

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
LiipImagineBundle supports additional settings, it is possible to combine filters from the list above to <a href="http://symfony.com/doc/master/bundles/LiipImagineBundle/filters.html">the ones provided in LiipImagineBundle</a> or custom ones.

## Discarded filters

The following filters exist in the Imagine library but are not used in eZ Platform due to incompatibility:

-   `flatten`. Obsolete, images are automatically flattened.
-   `bordercolor`
-   `border/width`
-   `colorspace/transparent`
-   `colorspace`

## Custom filters

Please refer to <a href="http://symfony.com/doc/master/bundles/LiipImagineBundle/filters.html#custom-filters">LiipImagineBundle documentation on custom filters</a>. <a href="http://imagine.readthedocs.org/en/latest/">Imagine library documentation</a> may also be useful.

#### In this topic:

-   [Introduction](#Images-Introduction)
-   [Configuration](#Images-Configuration)
    -   [Default image variations](#Images-Defaultimagevariations)
-   [Usage](#Images-Usage)
    -   [Filter usage examples](#Images-Filterusageexamples)
    -   [Post-Processors](#Images-Post-Processors)
    -   [Drivers](#Images-Drivers)
    -   [Upgrade](#Images-Upgrade)
    -   [Purging aliases](#Images-Purgingaliases)
-   [Reference](#Images-Reference)
    -   [Available filters](#Images-Availablefilters)
    -   [Discarded filters](#Images-Discardedfilters)
    -   [Custom filters](#Images-Customfilters)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>
4.  <span>[Creating a Tweet Field Type](Creating-a-Tweet-Field-Type_31429766.html)</span>

 Developer : Implement the Legacy Storage Engine Converter 



So far, our Field Type’s value is represented by the `Tweet\Value` class. It holds a semantic representation of the type’s data: a url, author url and the tweet's content.

The next step is to tell the system how to actually *store* this.

### About converters

Unlike eZ Publish Legacy, eZ Platform supports (by design) multiple storage engines. The main, and almost only one right now is the Legacy Storage Engine, based on the legacy database, with a new implementation. Since each storage engine may have its own way of storing data, we need to map each Field Type value to something legacy can understand. To do this, we will implement a Field Type Converter, each storage engine defining its own interface for those.

### Legacy Field Type converters

The legacy storage engine uses the `     ezcontentobject_attribute   ` table to store Field values, and `     ezcontentclass_attribute   ` to store Field definition values (settings, etc.). They're both based on the same principle. Each row represents a Field or a FieldDefinition, and offers several free fields, of different types, where the type can store its data:

-   `       ezcontentobject_attribute     ` offers three fields for this purpose: `       data_int     ` , `       data_text     ` and `       data_float     `
-   `       ezcontentclass_attribute     ` offers a few more: four `data_int` (`data_int1` to `data_int4`) fields, four `       data_float     `  (`data_float1` to `data_float5`) ones, and five `data_text` (`data_text1` to `data_text5`) .

Each type is free to use those fields in any way it requires. Converters will map a field’s semantic values to the fields described above, for both settings (validation + configuration) as well as value.

### Implementing Tweet\\LegacyConverter

The Converter will be placed along with the Type and Value definitions (the Kernel stores them inside the Legacy Storage Engine structure): `     eZ/Publish/FieldType/Tweet/LegacyConverter.php   ` . A Legacy Converter must implement the eZ\\Publish\\Core\\Persistence\\Legacy\\Content\\FieldValue\\Converter interface:

 

``` brush:
namespace EzSystems\TweetFieldTypeBundle\eZ\Publish\FieldType\Tweet;

use eZ\Publish\Core\Persistence\Legacy\Content\FieldValue\Converter;

class LegacyConverter implements Converter
{
}
```

The Converter interface expects us to implement five methods:

-   `         toStorageValue()` and `toFieldValue()`
    used to convert an API field value to a legacy storage value, and a legacy storage value to an API field value.  

-   `toStorageFieldDefinition()` and `toFieldDefinition()`
    used to convert a field definition to a legacy one, and a stored legacy field definition to an API field definition.

-   `getIndexColumn()`
    Tell the API which legacy DB field should be used to sort & filter content, either `sort_key_string` or `sort_key_int`

#### Implementing Field Value converters: toFieldValue() and toStorageValue()

As said above, those two methods are used to convert from a Field to a value that Legacy can store, and the other way around.

We have defined that we wanted to store the tweet’s URL in `data_text`, and that sorting would be done on the `username-status-tweetid` string we extract in `     getName()` and `     getSortInfo()`. 

`toStorageValue()` will fill the provided `eZ\Publish\Core\Persistence\Legacy\Content\StorageFieldValue` from a `     Tweet\Value`, while `     toFieldValue()` will do the exact opposite:

 

``` brush:
use eZ\Publish\Core\Persistence\Legacy\Content\StorageFieldValue;
use eZ\Publish\SPI\Persistence\Content\FieldValue;

// [...]

public function toStorageValue( FieldValue $value, StorageFieldValue $storageFieldValue )
{
   $storageFieldValue->dataText = $value->url;
   $storageFieldValue->sortKeyString = $value->sortKey;
}
public function toFieldValue( StorageFieldValue $value, FieldValue $fieldValue )
{
   $fieldValue->url = $value->dataText;
   $fieldValue->sortKey = $value->sortKeyString;
}
```

With these two methods, the legacy storage engine is able to convert a `Tweet\Value` into legacy data, and legacy data back into a `Tweet\Value` object.

#### Implementing Field Definition converters: `toStorageFieldDefinition()` and `toFieldDefinition()`

The first two methods we have implemented apply to a Field’s value . But we also need to convert our Field’s definition. For example, a TextLine’s max length, or any FieldDefinition option.

This is done using `toStorageDefinition()` that converts a `FieldDefinition` into a `StorageFieldDefinition`. `toFieldDefinition()` does the opposite. In our case, we actually don’t need to implement those methods since our Tweet Type doesn’t have settings:

 

``` brush:
use eZ\Publish\Core\Persistence\Legacy\Content\StorageFieldDefinition;
use eZ\Publish\SPI\Persistence\Content\Type\FieldDefinition;

// [...]

public function toStorageFieldDefinition( FieldDefinition $fieldDef, StorageFieldDefinition $storageDef )
{
}
 
public function toFieldDefinition( StorageFieldDefinition $storageDef, FieldDefinition $fieldDef )
{
}
```

#### Implementing `getIndexColumn()`

In `     toFieldValue()` and `     toStorageValue()` we have used the `     sortKeyString   ` property from `     StorageFieldValue`. `     getIndexColumn()` will tell provide the legacy storage engine the type of index / sort column it should use: string (`sort_key_string`) or int (`sort_key_int`). Depending on which one is returned, the system will either use the `     sortKeyString` or the `     sortKeyInt` properties from the `     StorageFieldValue`.

 

``` brush:
public function getIndexColumn()
{
   return 'sort_key_string';
}
```

### Registering the converter

Just like a Type, a Legacy Converter needs to be registered and tagged in the service container.

The tag is `ezpublish.storageEngine.legacy.converter`, and it requires an `alias` attribute to be set to the Field Type identifier (`eztweet`). Let's add this block to  `Resources/config/services.yml`:

 

**Resources/config/services.yml**

``` brush:
services:
    ezsystems.tweetbundle.fieldType.eztweet.converter:
        class: EzSystems\TweetFieldTypeBundle\eZ\Publish\FieldType\Tweet\LegacyConverter
        tags:
            - {name: ezpublish.storageEngine.legacy.converter, alias: eztweet}
```

 

 

 

**Tutorial path**






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Cookbook](Cookbook_31429528.html)</span>

 Developer : Importing settings from a bundle 



<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
The following recipe is valid for any type of settings supported by Symfony framework.

# Description

Usually, you develop your website using one or several custom bundles as this is a best practice. However, dealing with core bundle semantic configuration can be a bit tedious if you maintain it in the main `app/config/ezplatform.yml` configuration file.

# Solution

This recipe will show you how to import configuration from a bundle the manual way and the implicit way.

## The manual way

This is the simplest way of doing and it has the advantage of being explicit. The idea is to use the `imports` statement in your main `ezplatform.yml`:

**app/config/ezplatform.yml**

``` brush:
imports:
    # Let's import our template selection rules that reside in our custom bundle.
    # MyCustomBundle is the actual bundle name
    - {resource: "@AcmeTestBundle/Resources/config/templates_rules.yml"}
 
ezpublish:
    # ...
```

**templates\_rules.yml, placed under Resources/config folder in AcmeTestBundle**

``` brush:
# Here I need to reproduce the right configuration tree.
# It will be merged with the main one
ezpublish:
    system:
        my_siteaccess:
            ezpage:
                layouts:
                    2ZonesLayout1:
                        name: "2 zones (layout 1)"
                        template: "AcmeTestBundle:zone:2zoneslayout1.html.twig"
    
            content_view:
                full:
                    article_test:
                        template: "AcmeTestBundle:full:article_test.html.twig"
                        match:
                            Id\Location: [144,149]
                    another_test:
                        template: "::another_test.html.twig"
                        match:
                            Id\Content: 142
    
            block_view:
                campaign:
                    template: "AcmeTestBundle:block:campaign.html.twig"
                    match:
                        Type: "Campaign"
```

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
During the merge process, if the imported configuration files contain entries that are already defined in the main configuration file, **they will override them**.

Tip

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
If you want to import configuration for development use only, you can do so in your `ezpublish_dev.yml` 

## The implicit way

The following example will show you **how to implicitly load settings to configure eZ Platform kernel**. Note that this is also valid for any bundle!

We assume here that you're aware of <a href="http://symfony.com/doc/current/book/service_container.html#importing-configuration-via-container-extensions">service container extensions</a>.

**Acme/TestBundle/DependencyInjection/AcmeTestExtension**

``` brush:
<?php
 
namespace Acme\TestBundle\DependencyInjection;
 
use Symfony\Component\DependencyInjection\ContainerBuilder;
use Symfony\Component\Config\Resource\FileResource;
use Symfony\Component\Config\FileLocator;
use Symfony\Component\DependencyInjection\Extension\PrependExtensionInterface;
use Symfony\Component\HttpKernel\DependencyInjection\Extension;
use Symfony\Component\DependencyInjection\Loader;
use Symfony\Component\Yaml\Yaml;
 
/**
 * This is the class that loads and manages your bundle configuration
 *
 * To learn more see {@link http://symfony.com/doc/current/cookbook/bundles/extension.html}
 */
class AcmeTestExtension extends Extension implements PrependExtensionInterface
{
    // ...
 
    /**
     * Allow an extension to prepend the extension configurations.
     * Here we will load our template selection rules.

     *
     * @param ContainerBuilder $container
     */
    public function prepend( ContainerBuilder $container )
    {
        // Loading our YAML file containing our template rules
        $configFile = __DIR__ . '/../Resources/config/template_rules.yml';
        $config = Yaml::parse( file_get_contents( $configFile ) );
        // We explicitly prepend loaded configuration for "ezpublish" namespace.
        // So it will be placed under the "ezpublish" configuration key, like in ezpublish.yml.
        $container->prependExtensionConfig( 'ezpublish', $config );
        $container->addResource( new FileResource( $configFile ) );
    }
}
```

**AcmeTestBundle/Resources/config/template\_rules.yml**

``` brush:
# We explicitly prepend config for "ezpublish" namespace in service container extension, 
# so no need to repeat it here
system:
    ezdemo_frontend_group:
        ezpage:
            layouts:
                2ZonesLayout1:
                    name: "2 zones (layout 1)"
                    template: "AcmeTestBundle:zone:2zoneslayout1.html.twig"
 
        content_view:
            full:
                article_test:
                    template: "AcmeTestBundle:full:article_test.html.twig"
                    match:
                        Id\Location: 144
                another_test:
                    template: "::another_test.html.twig"
                    match:
                        Id\Content: 142
 
        block_view:
            campaign:
                template: "AcmeTestBundle:block:campaign.html.twig"
                match:
                    Type: "Campaign"
```

Regarding performance

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Service container extensions are called only when the container is being compiled, so there is nothing to worry about regarding performance.

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
Configuration loaded this way will be overridden by the main `ezplatform.yml` file.

 

 

#### In this topic:

-   [Description](#Importingsettingsfromabundle-Description)
-   [Solution](#Importingsettingsfromabundle-Solution)
    -   [The manual way](#Importingsettingsfromabundle-Themanualway)
    -   [The implicit way](#Importingsettingsfromabundle-Theimplicitway)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Cookbook](Cookbook_31429528.html)</span>

 Developer : Injecting parameters in content views 



# Description

It is possible to dynamically inject variables in content view templates by listening to the `     ezpublish.pre_content_view   ` event.

The event listener method receives an` eZ\Publish\Core\MVC\Symfony\Event\PreContentViewEvent `object

# Example

The following example will inject `foo` and `osTypes` variables in all content view templates.

``` brush:
<?php

namespace Acme\DemoBundle\EventListener;
use eZ\Publish\Core\MVC\Symfony\Event\PreContentViewEvent;

class PreContentViewListener
{
    public function onPreContentView( PreContentViewEvent $event )
    {
        // Get content view object and inject whatever no need.
        // You may add some custom business logic here.
        $contentView = $event->getContentView();
        $contentView->addParameters(
            array(
                 'foo'          => 'bar',
                 'osTypes'      => array( 'osx', 'linux', 'win' )
            )
        );
    }
}
```

**Service configuration**

``` brush:
parameters:
    ezdemo.pre_content_view_listener.class: Acme\DemoBundle\EventListener\PreContentViewListener

services:
    ezdemo.pre_content_view_listener:
        class: %ezdemo.pre_content_view_listener.class%
        tags:
            - {name: kernel.event_listener, event: ezpublish.pre_content_view, method: onPreContentView}
```

 

 

#### In this topic:

-   [Description](#Injectingparametersincontentviews-Description)
-   [Example](#Injectingparametersincontentviews-Example)

#### Related topics:

[Content Rendering](Content-Rendering_31429679.html)

<span class="confluence-link">[Default view templates](Content-Rendering_31429679.html#ContentRendering-Defaultviewtemplates)</span>






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Get Started with eZ Platform](Get-Started-with-eZ-Platform_31429520.html)</span>
4.  <span>[Step 1: Installation](31429538.html)</span>
5.  <span>[Manual Installation Guides](Manual-Installation-Guides_31431727.html)</span>

 Developer : Installation Guide for OS X 



## Preparation:

### 
1. Install MySQL 

Download from the <a href="https://www.mysql.com/">official MySQL webpage</a> is strongly recommended.

### 2. Set up PHP

This step requires the modification of two files: Apache2 configuration file and `php.ini`.
These files can be edited using a terminal editor like vi or nano, or a simple text editor such as TextEdit or Atom.

a. Edit Apache2 configuration file:

``` brush:
sudo vi /private/etc/apache2/httpd.conf
```

b. Uncomment the following line:

``` brush:
LoadModule php5_module libexec/apache2/libphp5.so
```

c. If you can't locate the `php.ini` file on your machine, it's probably under `php.ini.default`. Create a new `php.ini` file based on defaults:

``` brush:
sudo cp /private/etc/php.ini.default /private/etc/php.ini
```

d. Open the file in a text editor (in this example, in vi):

``` brush:
sudo vi /private/etc/php.ini
```

e. Locate `date.timezone` and `pdo_mysql.default_socket` and provide them with values as in the example below:

``` brush:
date.timezone = "Europe/Warsaw"
pdo_mysql.default_socket = /tmp/mysql.sock
```

f. Increase `memory_limit` value for eZ Platform:

``` brush:
memory_limit = 4G
```

### 3. Set up virtual host and start Apache2

a. Edit Apache2 configuration file:

``` brush:
sudo vi /private/etc/apache2/httpd.conf
```

b. Uncomment and modify the following lines:

``` brush:
LoadModule vhost_alias_module libexec/apache2/mod_vhost_alias.so
LoadModule rewrite_module libexec/apache2/mod_rewrite.so
```

c. Comment the following line:

``` brush:
Include /private/etc/apache2/extra/httpd-vhosts.conf
```

d. Add the following line to the file:

``` brush:
Include /private/etc/apache2/users/*.conf
```

e. Change permissions for virtual hosts storage directory (775):

``` brush:
sudo chmod -R 775 /private/etc/apache2/users
sudo chmod 775 /private/etc/apache2
```

### 4. Start Apache2 daemon using terminal

``` brush:
sudo apachectl start
```

### 5. Install Composer globally

Composer is a dependency manager that allows you to install packages directly in the project. It is also checking all packages' versions on a regular basis to make sure they are up-to-date and to avoid inconsistencies.

``` brush:
curl -sS https://getcomposer.org/installer | php
mkdir -p /usr/local/bin
php -d memory_limit=-1 composer.phar
```

### 6. Create a new database for eZ Platform

Create new database (you can substitute `ez1` with the database name you want to use):

``` brush:
/usr/local/mysql/bin/mysql -u root -e 'create database ez1;'
```

### 7. Install Brew package manager

Brew is a package manager for OS X, if you haven't used it already you are going to love what it does!

``` brush:
ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
```

### 8. Install additional requirements for eZ Platform

a. Install PEAR/PECL extension:

``` brush:
cd /usr/lib/php
curl -O https://pear.php.net/go-pear.phar
php -d detect_unicode=0 go-pear.phar
sudo php install-pear-nozlib.phar
sudo pear channel-update pear.php.net
sudo pecl channel-update pecl.php.net
sudo pear upgrade-all
sudo pear config-set auto_discover 1
```

b. Install autoconf:

``` brush:
brew install autoconf
```

c. Install intl:

``` brush:
brew install icu4c
sudo pecl install intl
```

d. The path to the ICU libraries and headers is: `/usr/local/opt/icu4c/`.

Edit `/private/etc/php.ini` and add following line:

``` brush:
extension=intl.so
```

e. Enable opcache extension for PHP (suggested, but not required) by adding:

``` brush:
zend_extension=opcache.so
```

## Installation:

### 
9. Install eZ Platform

a. Go to the folder with your installation and set up directory permissions:

``` brush:
chmod 775 ../ez1.lh
chmod 775 ../../workspace
chmod 775 ../../../Documents
```

 

b. Download archive from <a href="http://share.ez.no/downloads/downloads">share.ez.no/downloads</a>. Extract the eZ Platform archive to a directory, then execute post install scripts.

``` brush:
cd /<directory>/
php -d memory_limit=-1 composer.phar run-script post-install-cmd
```

 

c. Copy the virtual host template:

``` brush:
sudo cp doc/apache2/vhost.template /private/etc/apache2/users/ez1.lh.conf
```

d. Edit the new virtual host:

``` brush:
sudo vi /private/etc/apache2/users/ez1.lh.conf
```

e. Modify virtual host file **vhost.template. **

Replace the `---USER_ID---` variable (used in lines 10 and 17) with your current user ID. Use `whoami` command to get effective user ID of the currently logged user. If you want to use the default virtual host template (delivered with eZ Platform package) all you have to do is set up lines 7, 8, 9, 10, 17, 25 and 33:

f. Restart Apache 2 server:

``` brush:
sudo apachectl restart
```

g. Install required dependencies using Composer:

``` brush:
composer install
```

When Composer asks you for the token you must log in to your GitHub account and edit your profile. Go to the Personal access tokens link and Generate new token with default settings. Be aware that the token will be shown only once, so do not refresh the page until you paste the token into Composer prompt. This operation is performed only once when you install eZ Platform for the first time.

h. Change directory permissions:

``` brush:
rm -rf app/cache/* app/logs/*
sudo chmod +a "_www allow delete,write,append,file_inherit,directory_inherit" app/{cache,logs,config} web
sudo chmod +a "`whoami` allow delete,write,append,file_inherit,directory_inherit" app/{cache,logs,config} web
```

i. Install eZ Platform:

``` brush:
php app/console ezplatform:install clean
```

You will be able to see your page under <a href="http://ez1.lh" class="uri">http://ez1.lh</a> (or the address you chose in preparation). Please note that a clean install of eZ Platform doesn’t include DemoBundle anymore.

### 10. Optional

a. Install PHP 5.6 with opcache extension:

``` brush:
brew install -v homebrew/php/php56
chmod -R ug+w $(brew --prefix php56)/lib/php
brew install -v php56-opcache
```

b. Add proper `date.timezone` settings:

``` brush:
sudo vi /usr/local/etc/php/5.6/php.ini
```

c. Uncomment and modify:

``` brush:
date.timezone = "Europe/Warsaw"
(…)
Increase memory_limit value for eZ Platform:
memory_limit = 4G
(…)
```

d. Disable errors showing:

``` brush:
display_errors = Off
```

e. Change default PHP parser used by Apache:

``` brush:
sudo vi /private/etc/apache2/httpd.conf
```

f. Find and comment the following line:

``` brush:
# LoadModule php5_module libexec/apache2/libphp5.so
```

g. Add below:

``` brush:
LoadModule php5_module /usr/local/opt/php56/libexec/apache2/libphp5.so
```

e. Install intl extension for PHP 5.6:

``` brush:
brew install php56-intl
```

f. Restart Apache:

``` brush:
sudo apachectl restart
```

#### In this topic:

-   [Preparation:](#InstallationGuideforOSX-Preparation:)
    -   [1. Install MySQL ](#InstallationGuideforOSX-1.InstallMySQL)
    -   [2. Set up PHP](#InstallationGuideforOSX-2.SetupPHP)
    -   [3. Set up virtual host and start Apache2](#InstallationGuideforOSX-3.SetupvirtualhostandstartApache2)
    -   [4. Start Apache2 daemon using terminal](#InstallationGuideforOSX-4.StartApache2daemonusingterminal)
    -   [5. Install Composer globally](#InstallationGuideforOSX-5.InstallComposerglobally)
    -   [6. Create a new database for eZ Platform](#InstallationGuideforOSX-6.CreateanewdatabaseforeZPlatform)
    -   [7. Install Brew package manager](#InstallationGuideforOSX-7.InstallBrewpackagemanager)
    -   [8. Install additional requirements for eZ Platform](#InstallationGuideforOSX-8.InstalladditionalrequirementsforeZPlatform)
-   [Installation:](#InstallationGuideforOSX-Installation:)
    -   [9. Install eZ Platform](#InstallationGuideforOSX-9.InstalleZPlatform)
    -   [10. Optional](#InstallationGuideforOSX-10.Optional)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Get Started with eZ Platform](Get-Started-with-eZ-Platform_31429520.html)</span>
4.  <span>[Step 1: Installation](31429538.html)</span>
5.  <span>[Manual Installation Guides](Manual-Installation-Guides_31431727.html)</span>

 Developer : Installation Guide for Unix-Based Systems 



## 1. Install a LAMP Stack (\*NIX, Apache, MySQL, PHP5+)

Depending on your selected \*NIX distribution, you may need to install part or all of the LAMP stack required to run eZ Platform or eZ Enterprise. Before getting started, make sure you review our [requirements](https://doc.ez.no/pages/viewpage.action?pageId=31429536) page to see the systems we support and use for testing. You can try using an unsupported configuration, but your results may vary.

Please not that, while OS X *is* a \*NIX-based system, it has its own unique requirements listed in our [Installation Guide for OS X](Installation-Guide-for-OS-X_31431738.html). Developer-maintained installation notes are kept in our GitHub repository at this location as well: <a href="https://github.com/ezsystems/ezplatform/blob/master/INSTALL.md" class="uri">https://github.com/ezsystems/ezplatform/blob/master/INSTALL.md</a>

You may use your system's package manager (yum, apt-get, etc.) to obtain a copy of Apache, MySQL, and PHP, or download the latest versions from the official websites and install manually:

-   <a href="https://httpd.apache.org/download.cgi">Apache2</a>
-   <a href="http://dev.mysql.com/downloads/mysql/">MySQL</a>
-   <a href="http://php.net">PHP 5.6+</a>

For Debian 8.5, for example, we'd recommend using `apt-get` to install `apache2`, `mysql-server`, `mysql-client`, and `php5-*` (all the packages listed in the [requirements](https://doc.ez.no/pages/viewpage.action?pageId=31429536)), as well as `git` for version control. If the system on which you're doing the install has only 1 or 2 GB of RAM, be sure to [set up swap](https://doc.ez.no/display/DEVELOPER/Set+up+Swap+on+Debian+8.x) so you don't run out of RAM when running the composer scripts later on.

## 2. Get Composer

You'll need Composer, the PHP command line dependency manager.

a. Install Composer by running the following command on the terminal of the machine upon which you're installing eZ Platform:

``` brush:
php -r "readfile('https://getcomposer.org/installer');" | php
```

b. Move the downloaded composer.phar file to a globally-available path:

``` brush:
mv composer.phar /usr/local/bin/composer
```

## 3. Download the desired version of eZ Platform or eZ Enterprise

-   If you are installing eZ Platform, download the latest archive from <a href="http://share.ez.no/latest" class="uri">http://share.ez.no/latest</a>
-   For licensed eZ Enterprise customers, download your file here: <a href="https://support.ez.no/Downloads" class="uri">https://support.ez.no/Downloads</a>

Expand the archive into `/var/www/ezplatform` or the folder name or your choosing.

For developers interested in working with the latest version of eZ Platform, you may also clone the latest from our GitHub repository:

``` brush:
cd /var/www
git clone https://github.com/ezsystems/ezplatform.git /var/www/ezplatform
```

You can rename the destination folder to whatever you like. This is where eZ Platform will live, and you'll point your virtual host to this folder to use as its root. You may choose to download an archive file from <a href="http://share.ez.no/downloads/downloads">share.ez.no/downloads</a> instead of cloning from GitHub, and extract the eZ Platform archive to a similar directory. The subsequent steps are identical, regardless of the method you choose to obtain eZ Platform.

## 4. Create a new database for eZ Platform

Create new database (you can substitute `ezplatform` with the database name you want to use, but keep it in mind as you run the installation script):

``` brush:
/usr/bin/mysql -u root -e 'create database ezplatform;'
```

## 5. Run the Installation Scripts

Composer will look inside the composer.json file and install all of the required packages to run eZ Platform. There's a script in the app folder called console that will install eZ Platform for your desired environment as well (dev/prod).

This is the step where you want to make sure you have [swap configured for your machine](https://doc.ez.no/display/DEVELOPER/Set+up+Swap+on+Debian+8.x) if it does not have an abundance of RAM.

### a. Run composer install:

``` brush:
cd /var/www/ezplatform
php -d memory_limit=-1 /usr/local/bin/composer install
```

Once the installer gets to the point that it creates `app/config/parameters.yml`, you will be presented with a few decisions. The first asks you to choose a <a href="http://symfony.com/doc/current/reference/configuration/framework.html#secret">secret</a>; choose any random string you like, made up of characters, numbers, and symbols, up to around 32 characters. This is used by Symfony when generating <a href="http://symfony.com/doc/current/book/forms.html#forms-csrf">CSRF tokens</a>, <a href="http://symfony.com/doc/current/cookbook/security/remember_me.html">encrypting cookies</a>, and for creating signed URIs when using <a href="http://symfony.com/doc/current/book/http_cache.html#edge-side-includes">ESI (Edge Side Includes)</a>.

Next, you'll be asked to specify a database driver. You may press return to accept the default for this option, as well as the next several (`database_host, database_port, database_name, database_user`) unless you have customized those values and need to enter them as configured on your installation. If you set a password for your database user, enter it when prompted for `database_password`. The installer should continue once you've completed this manual portion of the installation process.

### b. Run eZ Platform's installer:

``` brush:
php -d memory_limit=-1 /var/www/ezplatform/app/console ezplatform:install --env prod clean
```

Don't forget to substitute any custom folder name you may have chosen in place of `ezplatform/` after `/var/www/` in the examples above. As you can see, this example shows a clean production installation. We're telling PHP to run Symfony's console to execute the ezplatform install script. You can get an informative output to learn more about the console script's capabilities by swapping in these parameters: `           config:dump-reference ezpublish         `

If Composer asks you for your token, you must log in to your GitHub account and edit your profile. Go to the Personal access tokens link and Generate new token with default settings. Be aware that the token will be shown only once, so do not refresh the page until you paste the token into the Composer prompt. This operation is performed only once when you install eZ Platform for the first time.

Please note that a clean install of eZ Platform doesn’t include the DemoBundle anymore.

## 6. Setup the folder rights (\*NIX users)

Like most things, <a href="http://symfony.com/doc/current/book/installation.html#checking-symfony-application-configuration-and-setup">Symfony documentation</a> applies here, meaning `app/cache` and `app/logs` need to be writable by cli and web server user.

Furthermore, future files and directories created by these two users will need to inherit those access rights. *For security reasons, there is no need for web server to have access to write to other directories.*

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
Then, go to the [Setup folder rights](Setup-folder-rights_32866325.html) page for the next steps of this settings.

## 7. Set up a Virtual Host

For our example, we'll demonstrate using Apache2 as part of the traditional LAMP stack.

### Option A: Scripted Configuration

Instead of manually editing the vhost.template file, you may instead [use the included shell script](https://doc.ez.no/display/DEVELOPER/Web+Server): /var/www/ezplatform/bin/vhost.sh to generate a configured .conf file. Check out the source of `vhost.sh` to see the options provided. Additional information is included in our [Web Server](Web-Server_31429554.html) documentation here as well.

### Option B: Manual Edits

a. Copy the vhost template file from its home in the doc folder:

``` brush:
cp /var/www/ezplatform/doc/apache2/vhost.template /etc/apache2/sites-available/ezplatform.conf
```

b. Edit the file, substituting the %placeholders% with the appropriate values for your desired config:

``` brush:
vi /etc/apache2/sites-available/ezplatform.conf
```

For a DEV environment, you can change

-   -   `<VirtualHost %IP_ADDRESS%:%PORT%>           `to
        `<VirtualHost *:80>`
    -   `ServerName %HOST_NAME%toServerName localhost`
    -   `ServerAlias %HOST_ALIAS%...that can simply be deleted.`
    -   `DocumentRoot %BASEDIR%/webtoDocumentRoot /var/www/ezplatform/web`
    -   `LimitRequestBody %BODY_SIZE_LIMIT%toLimitRequestBody 0`
    -   `TimeOut %TIMEOUT%toTimeOut 42to avoid waiting longer than 42 seconds for all the things.`

Be sure to specify `/var/www/ezplatform/web` as the `DocumentRoot` and `Directory`. Uncomment the line that starts with \#if\[SYMFONY\_ENV\] and set the value, something like this:

``` brush:
# Environment.
# Possible values: "prod" and "dev" out-of-the-box, other values possible with proper configuration
# Defaults to "prod" if omitted (uses SetEnvIf so value can be used in rewrite rules)
SetEnvIf Request_URI ".*" SYMFONY_ENV=dev
```

## 8. Server Configuration (Apache as example)

Make sure you've got the `libapache2-mod-php5` module installed for Apache2 to use PHP5.x, and have the rewrite module enabled:

``` brush:
apt-get -y install libapache2-mod-php5
a2enmod rewrite
```

a. You'll need the web user set as the owner/group on all your files to avoid a 500 error:

``` brush:
chown -R www-data:www-data /var/www/ezplatform
```

b. With your vhost file properly prepared and located in /etc/apache2/sites-available/ezplatform.conf, enable the VirtualHost and disable the default:

``` brush:
a2ensite ezplatform
a2dissite 000-default.conf
```

## 9. Restart server (Apache)

``` brush:
service apache2 restart
```

#### In this topic:

-   [1. Install a LAMP Stack (\*NIX, Apache, MySQL, PHP5+)](#InstallationGuideforUnix-BasedSystems-1.InstallaLAMPStack(*NIX,Apache,MySQL,PHP5+))
-   [2. Get Composer](#InstallationGuideforUnix-BasedSystems-2.GetComposer)
-   [3. Download the desired version of eZ Platform or eZ Enterprise](#InstallationGuideforUnix-BasedSystems-3.DownloadthedesiredversionofeZPlatformoreZEnterprise)
-   [4. Create a new database for eZ Platform](#InstallationGuideforUnix-BasedSystems-4.CreateanewdatabaseforeZPlatform)
-   [5. Run the Installation Scripts](#InstallationGuideforUnix-BasedSystems-5.RuntheInstallationScripts)
    -   [a. Run composer install:](#InstallationGuideforUnix-BasedSystems-a.Runcomposerinstall:)
    -   [b. Run eZ Platform's installer:](#InstallationGuideforUnix-BasedSystems-b.RuneZPlatform'sinstaller:)
-   [6. Setup the folder rights (\*NIX users)](#InstallationGuideforUnix-BasedSystems-6.Setupthefolderrights(*NIXusers))
-   [7. Set up a Virtual Host](#InstallationGuideforUnix-BasedSystems-7.SetupaVirtualHost)
    -   [Option A: Scripted Configuration](#InstallationGuideforUnix-BasedSystems-OptionA:ScriptedConfiguration)
    -   [Option B: Manual Edits](#InstallationGuideforUnix-BasedSystems-OptionB:ManualEdits)
-   [8. Server Configuration (Apache as example)](#InstallationGuideforUnix-BasedSystems-8.ServerConfiguration(Apacheasexample))
-   [9. Restart server (Apache)](#InstallationGuideforUnix-BasedSystems-9.Restartserver(Apache))

 

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Get Started with eZ Platform](Get-Started-with-eZ-Platform_31429520.html)</span>
4.  <span>[Step 1: Installation](31429538.html)</span>

 Developer : Installation Using Composer 



## Get Composer

If you don't have it already, install Composer, the command-line package manager for PHP. You'll have to have a copy of Git installed on your machine. The following command uses PHP to download and run the Composer installer, and should be entered on your terminal and executed by pressing Return or Enter:

``` brush:
php -r "readfile('https://getcomposer.org/installer');" | php
```

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
For further information about Composer usage see [Using Composer](Using-Composer_31431588.html)<span class="confluence-link"> </span>.

## eZ Platform Installation

The commands below assume you have <span>Composer installed globally</span>, a copy of git on your system, and your **MySQL/MariaDB server *already set up* with a database**. Once you've got all the required PHP extensions installed, you can get eZ Platform up and running with the following commands:

``` brush:
composer create-project --no-dev --keep-vcs ezsystems/ezplatform ezplatform
cd ezplatform
 
php app/console ezplatform:install clean
```

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
For more information about the availables options with Composer commands, see<a href="https://getcomposer.org/doc/03-cli.md">the Composer documentation</a>.

 

### Installing another distribution

eZ Platform exists in several distributions, listed in [Step 1: Installation](31429538.html), some with their own installer as shown in the example below. To install the Enterprise Edition you need an eZ Enterprise subscription and have to [set up Composer for that](Using-Composer_31431588.html).

**eZ Platform Enterprise Edition**

``` brush:
composer create-project --no-dev --keep-vcs ezsystems/ezplatform-ee
cd ezplatform-ee

# Options are listed on php app/console ezplatform:install -h
php app/console ezplatform:install studio-clean
```

### Installing another version

The instructions above show how to install the latest stable version, however with Composer you can specify the version and stability as well if you want to install something else. Using <span style="color: rgb(128,128,128);">`composer create-project -h`</span> you can see how you can specify another version:

> <span class="s1">create-project \[options\] \[--\] \[&lt;package&gt;\] \[&lt;directory&gt;\] \[&lt;version&gt;\]</span>
>
>  
>
> <span class="s1">Arguments:</span>
>
> <span class="s1">  &lt;</span><span class="s2">package&gt;</span><span class="s1">                            Package name to be installed</span>
>
> <span class="s1">  &lt;</span><span class="s2">directory&gt;</span><span class="s1">                            Directory where the files should be created</span>
>
> <span class="s1">  &lt;</span><span class="s2">version&gt;</span><span class="s1">                              Version, will default to latest</span>

Versions <a href="https://getcomposer.org/doc/articles/versions.md">can be expressed in many ways in Composer,</a> but the ones we recommend are:

-   Exact git tag: `v1.3.1`
-   Tilde for locking down the minor version: `~1.3.0`
    -   Equals: 1.3.\* 
-   Caret for allowing all versions within a major: `^1.3.0`
    -   Equals: 1.\* &lt;= 1.3.0

What was described above concerns stable releases, however <a href="https://getcomposer.org/doc/articles/versions.md#stability">Composer lets you specify stability in many ways</a>, mainly:

-   Exact git tag: `v1.4.0-beta1`
-   Stability flag on a given version: <span>`1.4.0@beta`</span>
    -   <span>Equals: versions of 1.4.0 in stability order of: beta, rc, stable</span>
    -   This can also be combined with tilde and caret to match ranges of unstable releases
-   Stability flag while omitting version: <span style="color: rgb(255,255,255);">'</span>`@alpha` equals latest available alpha release

Example:

``` brush:
composer create-project --no-dev --keep-vcs ezsystems/ezplatform-demo ezplatform @beta
cd ezplatform
 
php app/console ezplatform:install demo
```

#### Related:

-   [Installation Guide for OS X](Installation-Guide-for-OS-X_31431738.html)
-   [Installation Guide for Unix-Based Systems](Installation-Guide-for-Unix-Based-Systems_31431755.html)

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Get Started with eZ Platform](Get-Started-with-eZ-Platform_31429520.html)</span>
4.  <span>[Step 1: Installation](31429538.html)</span>

 Developer : Installation Using Docker 



When our Docker stuff is ready, we'll have the documentation here. Meanwhile, follow along with our progress:

<table style="width:100%;">
<colgroup>
<col width="9%" />
<col width="9%" />
<col width="9%" />
<col width="9%" />
<col width="9%" />
<col width="9%" />
<col width="9%" />
<col width="9%" />
<col width="9%" />
<col width="9%" />
<col width="9%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><span class="jim-table-header-content">T</span></td>
<td align="left"><span class="jim-table-header-content">Key</span></td>
<td align="left"><span class="jim-table-header-content">Summary</span></td>
<td align="left"><span class="jim-table-header-content">Assignee</span></td>
<td align="left"><span class="jim-table-header-content">Reporter</span></td>
<td align="left"><span class="jim-table-header-content">P</span></td>
<td align="left"><span class="jim-table-header-content">Status</span></td>
<td align="left"><span class="jim-table-header-content">Resolution</span></td>
<td align="left"><span class="jim-table-header-content">Created</span></td>
<td align="left"><span class="jim-table-header-content">Updated</span></td>
<td align="left"><span class="jim-table-header-content">Due</span></td>
</tr>
<tr class="even">
<td align="left"><a href="https://jira.ez.no/browse/EZP-25871?src=confmacro"><img src="https://jira.ez.no/images/icons/issuetypes/story.png" alt="Story" class="icon" /></a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-25871?src=confmacro">EZP-25871</a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-25871?src=confmacro">As a Developer I want to run my eZ Platform installation on Docker in a cluster server setup</a></td>
<td align="left">Unassigned</td>
<td align="left">André Rømcke</td>
<td align="left"><img src="https://jira.ez.no/images/icons/priorities/major.png" alt="High" class="icon" /></td>
<td align="left"><span class="aui-lozenge aui-lozenge-subtle aui-lozenge-complete"> Open </span></td>
<td align="left">Unresolved</td>
<td align="left">Jun 09, 2016</td>
<td align="left">Jun 09, 2016</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><a href="https://jira.ez.no/browse/EZP-25870?src=confmacro"><img src="https://jira.ez.no/images/icons/issuetypes/story.png" alt="Story" class="icon" /></a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-25870?src=confmacro">EZP-25870</a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-25870?src=confmacro">As a Developer I want to run pre built docker image of my eZ Platform demo installation, and run it in single server setup</a></td>
<td align="left">Unassigned</td>
<td align="left">André Rømcke</td>
<td align="left"><img src="https://jira.ez.no/images/icons/priorities/major.png" alt="High" class="icon" /></td>
<td align="left"><span class="aui-lozenge aui-lozenge-subtle aui-lozenge-complete"> Open </span></td>
<td align="left">Unresolved</td>
<td align="left">Jun 09, 2016</td>
<td align="left">Jun 09, 2016</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><a href="https://jira.ez.no/browse/EZP-26310?src=confmacro"><img src="https://jira.ez.no/images/icons/issuetypes/epic.png" alt="Epic" class="icon" /></a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-26310?src=confmacro">EZP-26310</a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-26310?src=confmacro">Docker-Tools / deployment M2 - Stabilizing</a></td>
<td align="left">André Rømcke</td>
<td align="left">André Rømcke</td>
<td align="left"><img src="https://jira.ez.no/images/icons/priorities/major.png" alt="High" class="icon" /></td>
<td align="left"><span class="aui-lozenge aui-lozenge-subtle aui-lozenge-complete"> Open </span></td>
<td align="left">Unresolved</td>
<td align="left">Sep 14, 2016</td>
<td align="left">Feb 20, 2017</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><a href="https://jira.ez.no/browse/EZP-25865?src=confmacro"><img src="https://jira.ez.no/images/icons/issuetypes/epic.png" alt="Epic" class="icon" /></a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-25865?src=confmacro">EZP-25865</a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-25865?src=confmacro">Testing infrastructure update (CI)</a></td>
<td align="left">Unassigned</td>
<td align="left">André Rømcke</td>
<td align="left"><img src="https://jira.ez.no/images/icons/priorities/critical.png" alt="Critical" class="icon" /></td>
<td align="left"><span class="aui-lozenge aui-lozenge-subtle aui-lozenge-complete"> Open </span></td>
<td align="left">Unresolved</td>
<td align="left">Jun 08, 2016</td>
<td align="left">Jan 17, 2017</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><a href="https://jira.ez.no/browse/EZP-26286?src=confmacro"><img src="https://jira.ez.no/images/icons/issuetypes/bug.png" alt="Bug" class="icon" /></a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-26286?src=confmacro">EZP-26286</a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-26286?src=confmacro">[Insight] YAML files should not contain syntax error</a></td>
<td align="left">Unassigned</td>
<td align="left">Sylvain Guittard</td>
<td align="left"><img src="https://jira.ez.no/images/icons/priorities/major.png" alt="High" class="icon" /></td>
<td align="left"><span class="aui-lozenge aui-lozenge-subtle aui-lozenge-complete"> Open </span></td>
<td align="left">Unresolved</td>
<td align="left">Sep 12, 2016</td>
<td align="left">Oct 26, 2016</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><a href="https://jira.ez.no/browse/EZP-24032?src=confmacro"><img src="https://jira.ez.no/images/icons/issuetypes/epic.png" alt="Epic" class="icon" /></a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-24032?src=confmacro">EZP-24032</a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-24032?src=confmacro">Sales Demo system</a></td>
<td align="left">Unassigned</td>
<td align="left">André Rømcke</td>
<td align="left"><img src="https://jira.ez.no/images/icons/priorities/major.png" alt="High" class="icon" /></td>
<td align="left"><span class="aui-lozenge aui-lozenge-subtle aui-lozenge-success"> Closed </span></td>
<td align="left">Done</td>
<td align="left">Feb 18, 2015</td>
<td align="left">Jan 19, 2016</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><a href="https://jira.ez.no/browse/EZP-23944?src=confmacro"><img src="https://jira.ez.no/images/icons/issuetypes/epic.png" alt="Epic" class="icon" /></a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-23944?src=confmacro">EZP-23944</a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-23944?src=confmacro">Docker for testing needs</a></td>
<td align="left">Unassigned</td>
<td align="left">Vidar Langseid</td>
<td align="left"><img src="https://jira.ez.no/images/icons/priorities/major.png" alt="High" class="icon" /></td>
<td align="left"><span class="aui-lozenge aui-lozenge-subtle aui-lozenge-success"> Closed </span></td>
<td align="left">Fixed</td>
<td align="left">Jan 28, 2015</td>
<td align="left">Sep 14, 2016</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><a href="https://jira.ez.no/browse/EZP-23945?src=confmacro"><img src="https://jira.ez.no/images/icons/issuetypes/task.png" alt="Task" class="icon" /></a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-23945?src=confmacro">EZP-23945</a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-23945?src=confmacro">Prepare containers for new install script( replacement of kickstart.ini )</a></td>
<td align="left">Unassigned</td>
<td align="left">Vidar Langseid</td>
<td align="left"><img src="https://jira.ez.no/images/icons/priorities/major.png" alt="High" class="icon" /></td>
<td align="left"><span class="aui-lozenge aui-lozenge-subtle aui-lozenge-success"> Closed </span></td>
<td align="left">Fixed</td>
<td align="left">Jan 28, 2015</td>
<td align="left">Feb 24, 2015</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><a href="https://jira.ez.no/browse/EZP-25868?src=confmacro"><img src="https://jira.ez.no/images/icons/issuetypes/story.png" alt="Story" class="icon" /></a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-25868?src=confmacro">EZP-25868</a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-25868?src=confmacro">As a Developer I want tool to build Docker image of my eZ Platform installation, and run it in single server setup</a></td>
<td align="left">Unassigned</td>
<td align="left">André Rømcke</td>
<td align="left"><img src="https://jira.ez.no/images/icons/priorities/major.png" alt="High" class="icon" /></td>
<td align="left"><span class="aui-lozenge aui-lozenge-subtle aui-lozenge-success"> Closed </span></td>
<td align="left">Fixed</td>
<td align="left">Jun 09, 2016</td>
<td align="left">Aug 24, 2016</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><a href="https://jira.ez.no/browse/EZP-25876?src=confmacro"><img src="https://jira.ez.no/images/icons/issuetypes/story.png" alt="Story" class="icon" /></a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-25876?src=confmacro">EZP-25876</a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-25876?src=confmacro">As Maintainer I want Behat tests running on docker containers so I can run the same setup locally</a></td>
<td align="left">Unassigned</td>
<td align="left">André Rømcke</td>
<td align="left"><img src="https://jira.ez.no/images/icons/priorities/major.png" alt="High" class="icon" /></td>
<td align="left"><span class="aui-lozenge aui-lozenge-subtle aui-lozenge-success"> Closed </span></td>
<td align="left">Fixed</td>
<td align="left">Jun 13, 2016</td>
<td align="left">Jun 15, 2016</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><a href="https://jira.ez.no/browse/EZP-25383?src=confmacro"><img src="https://jira.ez.no/images/icons/issuetypes/story.png" alt="Story" class="icon" /></a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-25383?src=confmacro">EZP-25383</a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-25383?src=confmacro">Change web server conf to be able to generate from bash</a></td>
<td align="left">Unassigned</td>
<td align="left">André Rømcke</td>
<td align="left"><img src="https://jira.ez.no/images/icons/priorities/major.png" alt="High" class="icon" /></td>
<td align="left"><span class="aui-lozenge aui-lozenge-subtle aui-lozenge-success"> Closed </span></td>
<td align="left">Fixed</td>
<td align="left">Jan 14, 2016</td>
<td align="left">Feb 10, 2016</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><a href="https://jira.ez.no/browse/EZP-23855?src=confmacro"><img src="https://jira.ez.no/images/icons/issuetypes/story.png" alt="Story" class="icon" /></a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-23855?src=confmacro">EZP-23855</a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-23855?src=confmacro">Port ubuntu based containers to debian</a></td>
<td align="left">Unassigned</td>
<td align="left">Vidar Langseid</td>
<td align="left"><img src="https://jira.ez.no/images/icons/priorities/major.png" alt="High" class="icon" /></td>
<td align="left"><span class="aui-lozenge aui-lozenge-subtle aui-lozenge-success"> Closed </span></td>
<td align="left">Fixed</td>
<td align="left">Jan 07, 2015</td>
<td align="left">Mar 04, 2015</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><a href="https://jira.ez.no/browse/EZP-23371?src=confmacro"><img src="https://jira.ez.no/images/icons/issuetypes/story.png" alt="Story" class="icon" /></a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-23371?src=confmacro">EZP-23371</a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-23371?src=confmacro">Provision eZ Publish inside a container</a></td>
<td align="left">Unassigned</td>
<td align="left">Vidar Langseid</td>
<td align="left"><img src="https://jira.ez.no/images/icons/priorities/major.png" alt="High" class="icon" /></td>
<td align="left"><span class="aui-lozenge aui-lozenge-subtle aui-lozenge-success"> Closed </span></td>
<td align="left">Fixed</td>
<td align="left">Sep 24, 2014</td>
<td align="left">Mar 04, 2015</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><a href="https://jira.ez.no/browse/EZP-25665?src=confmacro"><img src="https://jira.ez.no/images/icons/issuetypes/epic.png" alt="Epic" class="icon" /></a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-25665?src=confmacro">EZP-25665</a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-25665?src=confmacro">Docker-Tools / deployment M1 - beta</a></td>
<td align="left">Unassigned</td>
<td align="left">André Rømcke</td>
<td align="left"><img src="https://jira.ez.no/images/icons/priorities/major.png" alt="High" class="icon" /></td>
<td align="left"><span class="aui-lozenge aui-lozenge-subtle aui-lozenge-success"> Closed </span></td>
<td align="left">Obsolete</td>
<td align="left">Apr 09, 2016</td>
<td align="left">Jan 17, 2017</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><a href="https://jira.ez.no/browse/EZP-25943?src=confmacro"><img src="https://jira.ez.no/images/icons/issuetypes/improvement.png" alt="Improvement" class="icon" /></a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-25943?src=confmacro">EZP-25943</a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-25943?src=confmacro">Add Redis support to Docker-Tools</a></td>
<td align="left">Unassigned</td>
<td align="left">André Rømcke</td>
<td align="left"><img src="https://jira.ez.no/images/icons/priorities/major.png" alt="High" class="icon" /></td>
<td align="left"><span class="aui-lozenge aui-lozenge-subtle aui-lozenge-success"> Closed </span></td>
<td align="left">Fixed</td>
<td align="left">Jun 23, 2016</td>
<td align="left">Sep 11, 2016</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><a href="https://jira.ez.no/browse/EZP-23942?src=confmacro"><img src="https://jira.ez.no/images/icons/issuetypes/task.png" alt="Task" class="icon" /></a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-23942?src=confmacro">EZP-23942</a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-23942?src=confmacro">Add a solr container and configure ezp to use legacy_solr</a></td>
<td align="left">Vidar Langseid</td>
<td align="left">Vidar Langseid</td>
<td align="left"><img src="https://jira.ez.no/images/icons/priorities/major.png" alt="High" class="icon" /></td>
<td align="left"><span class="aui-lozenge aui-lozenge-subtle aui-lozenge-complete"> Backlog </span></td>
<td align="left">Unresolved</td>
<td align="left">Jan 28, 2015</td>
<td align="left">Jul 21, 2015</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><a href="https://jira.ez.no/browse/EZP-25869?src=confmacro"><img src="https://jira.ez.no/images/icons/issuetypes/bug.png" alt="Bug" class="icon" /></a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-25869?src=confmacro">EZP-25869</a></td>
<td align="left"><a href="https://jira.ez.no/browse/EZP-25869?src=confmacro">Docker containers has extremely slow IO on Mac/Windows under development use</a></td>
<td align="left">Unassigned</td>
<td align="left">André Rømcke</td>
<td align="left"><img src="https://jira.ez.no/images/icons/priorities/major.png" alt="High" class="icon" /></td>
<td align="left"><span class="aui-lozenge aui-lozenge-subtle aui-lozenge-complete"> Backlog </span></td>
<td align="left">Unresolved</td>
<td align="left">Jun 09, 2016</td>
<td align="left">Oct 24, 2016</td>
<td align="left"></td>
</tr>
</tbody>
</table>

<span id="total-issues-count-367619781"> [17 issues](https://jira.ez.no/secure/IssueNavigator.jspa?reset=true&jqlQuery=component+%3D+%22Deployment+%3E+Docker+Containers%22+AND+project+%3D+EZP+ORDER+BY+status+ASC&src=confmacro "View all matching issues in JIRA.") </span>

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>
6.  <span>[Content items, Content Types and Fields](31430275.html)</span>
7.  <span>[Field Types reference](Field-Types-reference_31430495.html)</span>

 Developer : Integer Field Type 



This Field Type represents an integer value.

| Name      | Internal name | Expected input |
|-----------|---------------|----------------|
| `Integer` | `ezinteger`   | `integer`      |

## Description

This Field Type stores numeric values which will be provided as integers.

## PHP API Field Type 

### Input expectations

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>integer</code></td>
<td align="left"><p><code>2397</code></p></td>
</tr>
</tbody>
</table>

### Value object

##### Properties

The Value class of this field type contains the following properties:

| Property | Type  | Description                                                           |
|----------|-------|-----------------------------------------------------------------------|
| `$value` | `int` | This property will be used to store the value provided as an integer. |

**Value object content example**

``` brush:
$integer->value = 8
```

##### Constructor

The `Integer``\Value` constructor will initialize a new Value object with the value provided. It expects a numeric, integer value.

**Constructor example**

``` brush:
use eZ\Publish\Core\FieldType\Integer;
 
// Instantiates a Integer Value object
$integerValue = new Integer\Value( 8 );
```

### Hash format

Hash value of this Field Type is simply integer value as a string.

Example:

> `"8"`

### String representation

String representation of the Field Type's value will return the integer value as a string.

Example:

> `"8"`

### Validation

This Field Type supports `IntegerValueValidator`, defining maximal and minimal float value:

| Name              | Type  | Default value                                                                                      | Description                                                                |
|-------------------|-------|----------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|
| `minIntegerValue` | `int` | `0`                                                                                                | This setting defines the minimum value this FieldType will allow as input. |
| `maxIntegerValue` | `int` | `false  /` <span class="status-macro aui-lozenge aui-lozenge-current">V1.5.2, V1.6.1</span> `null` | This setting defines the maximum value this FieldType will allow as input. |

**Example of validator configuration in PHP**

``` brush:
$validatorConfiguration = array(
    "minIntegerValue" => 1,
    "maxIntegerValue" => 24
);
```

### Settings

This Field Type does not support settings.

 

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : Internationalization 



# Introduction

eZ Platform offers the ability of creating different language versions of all content in the repository.

## Using multiple languages

The system allows for multiple language versions (translations) of a Content item to be created. Translations are created per version of the item, so each version of the content can have a different set of translations.

At minimum, a version always has one translation which by default is the *initial/main* translation. Further versions can be added, but only for languages that have previously been <span class="confluence-link"> </span>[<span class="confluence-link">added to the global translation list</span>](https://doc.ez.no/display/USER/6.+Creating+content%2C+advanced#id-6.Creatingcontent,advanced-Addingtranslations), that is a list of all languages available in the system. The maximum number of languages in the system is 64.

Different translations of the same Content item can be edited separately. This means that different users can work on translations into different languages at the same time.

## Translatable and untranslatable Fields

Language versions actually concern translating values of the Fields of a Content item. Every Field in its definition in a Content Type can be set to be Translatable or not.

Translating the Field values is natural in some cases, for example for the body of an article. However, there are Fields where translating is impractical, for instance images without text, numbers, e-mail addresses and so on. Platform still gives the possibility to mark all Fields as translatable regardless of their Field Type. It is only the user's (content manager's) decision to exclude the translation possibility for those Fields where it makes no sense.

When a Field is not flagged as Translatable, its value will be copied from the initial/main translation when a new language version is created. This copied value cannot be modified. When a Field is Translatable, its value in a new language version will have to be entered by the user.

For example, let's say that you need to store information about marathon contestants and their results. You build a "contestant" Content Type using the following Fields: name, photo, age, nationality, time reached. Allowing the translation of anything else than nationality would be pointless, since the values stored by the other Fields are the same regardless of the language used to describe the runner. In other words, the name, photo, age and time reached would be the same in, for example, both English and Norwegian.

### Access control

It is possible to control whether a User or User group is able to translate content or not. This can be done by adding a Language limitation to Policies that allow creating or editing content. This limitation lets you define which Role can work with which languages in the system. (For more information of the permissions system, see [Permissions](https://doc.ez.no/display/DEVELOPER/Repository#Repository-Permissions).)

In addition, it is also possible to control access to the global translation list by using the Content/Translations Policy. This makes it possible to allow users other than the site administrator to add and remove translations that can be used.

## How to create different language versions?

The multilanguage system operates based on a global translation list that contains all languages available in the installation. Languages can be added to this list from the Admin Panel in the user interface. **The new language must then be added to the** **[SiteAccess](SiteAccess_31429665.html)** **configuration**. Once this is done, any user with proper permissions can create Content item versions in these languages in the user interface.

## How to make translations available to the visitor?

Once more than one language is defined in the global translation list and there is content in different languages, the question is how can this be exposed to use by the visitor. There are two ways to do this:

1.  Implement a mechanism called **<span class="confluence-link">Language Switcher</span>**. It lets you create links that allow switching between different translations of a Content item.
2.  If you want to have completely separate versions of the website, each with content in its own language, you can use siteaccesses. In this case, depending on the uri used to access the website, a different site will open, with a language set in configuration settings. All Content items will then be displayed in this primary language.

## Multilanguage and permissions

[LanguageLimitation](LanguageLimitation_31430465.html) allows you to limit users' editing rights depending on the language of the Content item. See [Permissions](https://doc.ez.no/display/DEVELOPER/Repository#Repository-Permissions) and [List of Limitations](List-of-Limitations_31430459.html) for more information.

# Configuration

One of the basic ways of using multiple languages is setting up a separate siteaccess for each language.

## <span><span><span>Explicit *translation siteaccesses*</span></span></span>

<span><span><span><span>Configuration is not mandatory, but can help to distinguish which siteaccesses can be considered </span>*translation siteaccesses*<span>.</span></span></span></span>

**ezplatform.yml**

``` brush:
ezpublish:
    siteaccess:
        default_siteaccess: eng
        list:
            - ezdemo_site
            - eng
            - fre
            - ezdemo_site_admin

        groups:
            ezdemo_frontend_group:
                - ezdemo_site
                - eng
                - fre

    # ...

    system:
        # Specifying which SiteAccesses are used for translation
        ezdemo_frontend_group:
            translation_siteaccesses: [fre, eng]
        eng:
            languages: [eng-GB]
        fre:
            languages: [fre-FR, eng-GB]
        ezdemo_site:
            languages: [eng-GB]
```

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
**Note**: Top prioritized language is always used for as the siteaccess language reference (e.g. `fre-FR` for `fre` siteaccess in the example above).

If several translation siteaccesses share the same language reference, **the first declared siteaccess always wins**.

## More complex translation setup

There are some cases where your siteaccesses share settings (repository, content settings, etc.), but you don't want all of them to share the same `translation_siteaccesses` setting. This can be for example the case when you use separate siteaccesses for mobile versions of a website.

Solution is as easy as defining new groups:

**ezplatform.yml**

``` brush:
ezpublish:
    siteaccess:
        default_siteaccess: eng
        list:
            - ezdemo_site
            - eng
            - fre
            - mobile_eng
            - mobile_fre
            - ezdemo_site_admin

        groups:
            # This group can be used for common front settings
            ezdemo_common_group:
                - ezdemo_site
                - eng
                - fre
                - mobile_eng
                - mobile_fre

            ezdemo_frontend_group:
                - ezdemo_site
                - eng
                - fre

            ezdemo_mobile_group
                - mobile_eng
                - mobile_fre

    # ...

    system:
        # Translation SiteAccesses for regular frontend
        ezdemo_frontend_group:
            translation_siteaccesses: [fre, eng]

        # Translation SiteAccesses for mobile frontend
        ezdemo_mobile_group:
            translation_siteaccesses: [mobile_fre, mobile_eng]

        eng:
            languages: [eng-GB]
        fre:
            languages: [fre-FR, eng-GB]
        ezdemo_site:
            languages: [eng-GB]

        mobile_eng:
            languages: [eng-GB]
        mobile_fre:
            languages: [fre-FR, eng-GB]
```

## Using implicit *related siteaccesses*

If `translation_siteaccesses` setting is not provided, implicit *related siteaccesses* will be used instead. Siteaccesses are considered *related* if they share:

-   The same repository
-   The same root location Id (see [Multisite feature](Multisite_31430389.html))

## Fallback languages and missing translations

When setting up siteaccesses with different language versions, you can specify a list of preset languages for each siteaccess. When this siteaccess is used, the system will go through this list. If a Content item is unavailable in the first (prioritized) language, it will attempt to use the next language in the list, and so on. Thanks to this you can have a fallback in case of a lacking translation.

You can also assign a Default content availability flag to Content Types (available in the Admin Panel). When this flag is assigned, Content items of this type will be available even when they do not have a language version in any of the languages configured for the current siteaccess.

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Note that if a language is not provided in the list of prioritized languages and it is not the Content item's first language, the URL alias for this content in this language will not be generated.

This is different than in legacy, where this behavior was covered by a global control switch [`ShowUntranslatedObjects`](https://doc.ez.no/eZ-Publish/Technical-manual/4.x/Reference/Configuration-files/site.ini/RegionalSettings/ShowUntranslatedObjects/(language)/eng-GB).

# Usage

## Language Switcher

### <span>Description</span>

<span>A Content item can be translated into several languages. Those languages are configured in the system and exposed in siteaccesses via a prioritized list of languages:</span>

**ezplatform.yml**

``` brush:
ezpublish
    system:
        eng:
            languages: [eng-GB]
        # In fre siteaccess, fre-FR is always preferred, and fallback to eng-GB if needed.
        fre:
            languages: [fre-FR, eng-GB]
```

<span><span>When visiting a Content item, it may be useful to let the user switch from one translation to another, more appropriate to them. This is precisely the goal of the language switcher.</span></span>

<span><span><span>The language switcher relies on the </span>[Cross-SiteAccess linking feature](https://doc.ez.no/display/DEVELOPER/SiteAccess#SiteAccess-Cross-siteacesslinks)<span> to generate links to the Content item's translation, and on </span><span class="confluence-link">[RouteReference feature](Internationalization_31429671.html)</span><span>.
</span></span></span>

Tip

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<span><span><span>If you install the DemoBundle with at least 2 different languages, you will be able to see the Language Switcher and to test it.</span></span></span>

### In a template

<span>To generate a language switch link, you need to generate the </span>`RouteReference`<span>, with the </span>`language`<span> parameter. This can easily be done with </span>`ez_route()`<span> Twig function:</span>

``` brush:
{# Given that "location" variable is a valid Location object #}
<a href="{{ url( ez_route( location, {"language": "fre-FR"} ) ) }}">{{ ez_content_name( content ) }}</a>

{# Generating a link to a declared route instead of Location #}
<a href="{{ url( ez_route( 'my_route', {"language": "fre-FR"} ) ) }}">My link</a>
```

<span><span>You can also omit the route, in this case, the current route will be used (i.e. switch the current page):</span></span>

``` brush:
{# Using Twig named parameters #}
<a href="{{ url( ez_route( params={"language": "fre-FR"} ) ) }}">My link</a>

{# Identical to the following, using ordered parameters #}
<a href="{{ url( ez_route( null, {"language": "fre-FR"} ) ) }}">My link</a>
```

### Using sub-requests

When using sub-requests, you lose the context of the master request (e.g. current route, current location, etc.). This is because sub-requests can be displayed separately, with ESI or Hinclude.

If you want to render language switch links in a sub-request with a correct `RouteReference`, you must pass it as an argument to your sub-controller from the master request.

``` brush:
{# Render the language switch links in a sub-controller #}
{{ render( controller( 'AcmeTestBundle:Default:languages', {'routeRef': ez_route()} ) ) }}
```

``` brush:
namespace Acme\TestBundle\Controller;

use eZ\Bundle\EzPublishCoreBundle\Controller;
use eZ\Publish\Core\MVC\Symfony\Routing\RouteReference;

class DefaultController extends Controller
{
    public function languagesAction( RouteReference $routeRef )
    {
        return $this->render( 'AcmeTestBundle:Default:languages.html.twig', array( 'routeRef' => $routeRef ) );
    }
}
```

``` brush:
{# languages.html.twig #}

{# Looping over all available languages to display the links #}
{% for lang in ezpublish.availableLanguages %}
    {# This time, we alter the "siteaccess" parameter directly. #}
    {# We get the right siteaccess with the help of ezpublish.translationSiteAccess() helper #}
    {% do routeRef.set( "siteaccess", ezpublish.translationSiteAccess( lang ) ) %}
    <a href="{{ url( routeRef ) }}">{{ lang }}</a><br />
{% endfor %}
```

-   `ezpublish.translationSiteAccess( language )` returns the siteaccess name for provided language (or `null` if it cannot be found)
-   `ezpublish.availableLanguages()` returns the list of available languages.

### Using PHP

<span>You can easily generate language switch links from PHP too, with the </span>`RouteReferenceGenerator`<span> service:</span>

``` brush:
// Assuming we're in a controller
/** @var \eZ\Publish\Core\MVC\Symfony\Routing\Generator\RouteReferenceGeneratorInterface $routeRefGenerator */
$routeRefGenerator = $this->get( 'ezpublish.route_reference.generator' );
$routeRef = $routeRefGenerator->generate( $location, array( 'language' => 'fre-FR' ) );
$link = $this->generateUrl( $routeRef );
```

<span><span>
</span></span>

<span><span>You can also retrieve all available languages with the </span>`TranslationHelper`<span>:</span></span>

``` brush:
/** @var \eZ\Publish\Core\Helper\TranslationHelper $translationHelper */
$translationHelper = $this->get( 'ezpublish.translation_helper' );
$availableLanguages = $translationHelper->getAvailableLanguages();
```

## `ez_trans_prop` Twig helper

`ez_trans_prop()` is a generic, low level Twig helper which corrects the translated value of a multi valued(translations) property.

See [ez\_trans\_prop](ez_trans_prop_32114049.html) reference for more information.

 

## Translating UI of eZ Platform

#### Installing new UI translations

If you want to install a new language in your project, you just have to install the corresponding package.

For example, if you want to translate your application into French, you just have to run:

    composer require ezplatform-i18n/ezplatform-i18n-fr_fr

and then clear the cache.

Now you can reload your eZ Platform administration page which will be translated in French (if your browser is configured to fr\_FR.)

#### In-context UI translation

<span class="status-macro aui-lozenge aui-lozenge-current">V1.8</span>

Since eZ Platform 1.7.0, the interface has been fully translatable. Version 1.8.0 introduces official support for <a href="http://crowdin.com">Crowdin</a> as a translation management system. In addition, it integrates support for in-context translation, a feature that allows you to translate strings from the interface, *in context*.

To learn how to contribute to a translation using Crowdin, see [Contributing translations](Contributing-translations_34079215.html).

 

#### In this topic:

-   [Introduction](#Internationalization-Introduction)
    -   [Using multiple languages](#Internationalization-Usingmultiplelanguages)
    -   [Translatable and untranslatable Fields](#Internationalization-TranslatableanduntranslatableFields)
        -   [Access control](#Internationalization-Accesscontrol)
    -   [How to create different language versions?](#Internationalization-Howtocreatedifferentlanguageversions?)
    -   [How to make translations available to the visitor?](#Internationalization-Howtomaketranslationsavailabletothevisitor?)
    -   [Multilanguage and permissions](#Internationalization-Multilanguageandpermissions)
-   [Configuration](#Internationalization-Configuration)
    -   [Explicit translation siteaccesses](#Internationalization-Explicittranslationsiteaccesses)
    -   [More complex translation setup](#Internationalization-Morecomplextranslationsetup)
    -   [Using implicit related siteaccesses](#Internationalization-Usingimplicitrelatedsiteaccesses)
    -   [Fallback languages and missing translations](#Internationalization-Fallbacklanguagesandmissingtranslations)
-   [Usage](#Internationalization-Usage)
    -   [Language Switcher](#Internationalization-LanguageSwitcher)
        -   [Description](#Internationalization-Description)
        -   [In a template](#Internationalization-Inatemplate)
        -   [Using sub-requests](#Internationalization-Usingsub-requests)
        -   [Using PHP](#Internationalization-UsingPHP)
    -   [ez\_trans\_prop Twig helper](#Internationalization-ez_trans_propTwighelper)
    -   [Translating UI of eZ Platform](#Internationalization-TranslatingUIofeZPlatform)

## Attachments:

<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [incontext-translation-ezplatform-crowdin.png](attachments/31429671/33554862.png) (image/png)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>
4.  <span>[Creating a Tweet Field Type](Creating-a-Tweet-Field-Type_31429766.html)</span>

 Developer : Introduce a template 



In order to display data of our Field Type from templates, we need to create and register a template for it. You can find documentation about [FieldType templates](Field-Type-template_31430773.html), as well as on [<span class="confluence-link">importing settings from a bundle</span>](Importing-settings-from-a-bundle_31429803.html)<span class="confluence-link"> </span>.

In a couple words, such a template must:

-   extend `         EzPublishCoreBundle::content_fields.html.twig       `

-   define a dedicated Twig block for the type, named by convention `<TypeIdentifier_field>`. In our case, `eztweet_field`

-   be registered in parameters

## The template: `Resources/views/fields/eztweet.tpl`

The first thing we will do is create the template. It will basically define the default display of a tweet. Remember that <a href="https://confluence.ez.no/display/DEVELOPER/ez_render_field#ez_render_field-Overrideafieldtemplateblock">field type templates can be overridden</a> in order to tweak what is displayed and how.

Each Field Type template receives a set of variables that can be used to achieve the desired goal. The variable we care about is `field`, an instance of `eZ\Publish\API\Repository\Values\Content\Field`. In addition to its own metadata (`id`, `fieldDefIdentifier`, etc.), it exposes the Field Value (`Tweet\Value`) through the `value` property.

This would work as a primitive template:  

``` brush:
{% block eztweet_field %}
{% spaceless %}
    {{ field.value.contents|raw }}
{% endspaceless %}
{% endblock %}
```

`field.value.contents` is piped through the `raw` twig operator, since the variable contains HTML code. Without it, the HTML markup would be visible directly, since twig escapes variables by default. Notice that we nest our code within a `spaceless` tag, so that we can format our template in a readable manner without jeopardizing the display with unwanted spaces.

### Using the content fields helpers

Even though the above will work just fine, a couple of helpers will help us get something a bit more flexible. The <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Bundle/EzPublishCoreBundle/Resources/views/content_fields.html.twig">EzPublishCoreBundle::content_fields.html.twig</a> template, where the native Field Type templates are implemented, provides a couple of helpers: `simple_block_field`, `simple_inline_field` and `field_attributes`. The first two are used to display a field either as a block or inline. `field_attributes` makes it easier to use the attr variable that contains additional (HTML) attributes for the field.

Let's consider that we will display the value as a block element.

First, we need to make our template inherit from `content_fields.html.twig`. Then, we will create a `field_value` variable that will be used by the helper to print out the content inside the markup. And that's it. The helper will use `field_attributes` to add the HTML attributes to the generated `div`.

 

``` brush:
{% block eztweet_field %}
{% spaceless %}
    {% set field_value %}
        {{ field.value.contents|raw }}
    {% endset %}
    {{ block( 'simple_block_field' ) }}
{% endspaceless %}
{% endblock %}
```

`fieldValue` is set to the markup we had above, using a `{% set %}` block. We then call the `block` function to process the `simple_block_field` template block.

## Registering the template

As explained in the <a href="https://confluence.ez.no/display/DEVELOPER/Field+Type+template#FieldTypetemplate-Registeringyourtemplate">FieldType template documentation</a>, a FieldType template needs to be registered in the eZ Publish semantic configuration. The most basic way to do this would be to do so in `app/config/ezplatform.yml`:

**app/config/ezplatform.yml**

``` brush:
ezpublish:
    global:
        field_templates:
            - { template: "EzSystemsTweetFieldTypeBundle:fields:eztweet.html.twig"}
```

However, this is far from ideal. We want this to be part of our bundle, so that no manual configuration is required. For that to happen, we need to make our bundle extend the eZ Platform semantic configuration. To do so, we are going to make our bundle's dependency injection extension (`DependencyInjection/EzSystemsTweetFieldTypeExtension.php`) implement `Symfony\Component\DependencyInjection\Extension\PrependExtensionInterface`. This interface will let us prepend bundle configuration:

**DependencyInjection/EzSystemsTweetFieldTypeExtension.php**

``` brush:
use Symfony\Component\DependencyInjection\Extension\PrependExtensionInterface;
use Symfony\Component\Yaml\Yaml;

class EzSystemsTweetFieldTypeExtension extends Extension implements PrependExtensionInterface
{
    public function prepend( ContainerBuilder $container )
    {
        $config = Yaml::parse( __DIR__ . '/../Resources/config/ezpublish_field_templates.yml' );
        $container->prependExtensionConfig( 'ezpublish', $config );
    }
}
```

The last thing to do is move the template mapping from `app/config/ezplatform.yml` to `Resources/config/ezpublish_field_templates.yml`:

``` brush:
system:
    default:
        field_templates:
            - {template: "EzSystemsTweetFieldTypeBundle:fields:eztweet.html.twig"}
```

Notice that the `ezpublish` yaml block was deleted. This is because we already import our configuration under the `ezpublish` namespace in the prepend method.

You should now be able to display a content item with this Field Type from the frontoffice, with a fully functional embed:

<span class="confluence-embedded-file-wrapper"><img src="attachments/31429779/31429778.png" class="confluence-embedded-image" /></span>

**Tutorial path**

## Attachments:

<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [fieldtype tutorial, final result.PNG](attachments/31429779/31429778.png) (image/png)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : Introduction 



So, what is eZ Platform actually? And what is eZ Enterprise? Why should you bother with them? What makes them special? Read through this introduction to find out.

 

-   [What is eZ Platform?](31429699.html)
-   [What is eZ Platform Enterprise Edition?](31429701.html)
-   [Why eZ?](31429703.html)

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[API](API_31429524.html)</span>

 Developer : JS Client 



The JavaScript REST API Client is a JavaScript library meant to ease the use of the eZ Platform REST API. For now, it can only be used in a web browser.

See [Using the JavaScript REST API Client](Using-the-JavaScript-REST-API-Client_31430299.html) for a guide on how to use the client, and view the <a href="http://ezsystems.github.io/javascript-rest-client/">generated JS API Client reference</a>.

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>
6.  <span>[Content items, Content Types and Fields](31430275.html)</span>
7.  <span>[Field Types reference](Field-Types-reference_31430495.html)</span>

 Developer : Keyword Field Type 



This Field Type represents keywords.

| Name      | Internal name | Expected input    |
|-----------|---------------|-------------------|
| `Keyword` | `ezkeyword`   | `string[]|string` |

## Description

This Field Type stores one or several comma-separated keywords as a string or array of strings.

## PHP API Field Type 

### Input expectations

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><pre><code>string</code></pre></td>
<td align="left"><code>&quot;documentation&quot;</code></td>
</tr>
<tr class="even">
<td align="left"><code>string</code></td>
<td align="left"><p><code>&quot;php, eZ Publish, html5&quot;</code></p></td>
</tr>
<tr class="odd">
<td align="left"><code>string[]</code></td>
<td align="left"><code>array( &quot;eZ Systems&quot;, &quot;Enterprise&quot;, &quot;User Experience Management&quot; )</code></td>
</tr>
</tbody>
</table>

### Value object

##### Properties

The Value class of this Field Type contains the following properties:

| Property | Type       | Description                            |
|----------|------------|----------------------------------------|
| `$value` | `string[]` | Holds an array of keywords as strings. |

**Value object content example**

``` brush:
use eZ\Publish\Core\FieldType\Keyword\Value;
 
// Instantiates a Value object
$keywordValue = new Value();
 
// Sets an array of keywords as a value
$keyword->value = array( "php", "css3", "html5", "eZ Publish" );
```

##### Constructor

<span>The **`Keyword`**</span>**`\Value`**<span> constructor will initialize a new Value object with the value provided.</span>

<span>It expects a list of keywords, either comma-separated in a string or as an array of strings.</span>

**Constructor example**

``` brush:
use eZ\Publish\Core\FieldType\Keyword\Value;
 
// Instantiates a Value object with an array of keywords
$keywordValue = new Value( array( "php5", "css3", "html5" ) );
 
// Instantiates a Value object with a list of keywords in a string
// This is equivalent to the example above
$keywordValue = new Value( "php5,css3,html5" );
```

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Repository](Repository_31432023.html)</span>
5.  <span>[List of Limitations](List-of-Limitations_31430459.html)</span>

 Developer : LanguageLimitation 



A Limitation to specify if the User has access to Content in a specific language.

|                 |                                                                         |
|-----------------|-------------------------------------------------------------------------|
| Identifier      | `Language`                                                              |
| Value Class     | `eZ\Publish\API\Repository\Values\User\Limitation\LanguageLimitation`   |
| Type Class      | `eZ\Publish\Core\Limitation\LanguageLimitationType`                     |
| Criterion used  | `eZ\Publish\API\Repository\Values\Content\Query\Criterion\LanguageCode` |
| Role Limitation | no                                                                      |

###### Possible values

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">Value</td>
<td align="left">UI value</td>
<td align="left">Description</td>
</tr>
<tr class="even">
<td align="left"><code>&lt;Language_code&gt;</code></td>
<td align="left"><code>&lt;LanguageCode_name&gt;</code></td>
<td align="left"><p>All valid language codes can be set as value(s)</p></td>
</tr>
</tbody>
</table>

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Search](Search_31429673.html)</span>
5.  <span>[Search Engines](Search-Engines_32112955.html)</span>

 Developer : Legacy Search Engine Bundle 



**Legacy Search Engine** is the default search engine, it is SQL based and uses Doctrine's database connection. So its connections are, and should be, defined in the same way as for storage engine, and no further specific configuration is needed.

Its features and performance are limited, and if you have specific search or performance needs you should rather look towards using [Solr](Solr-Bundle_31430592.html).

## <span style="color: rgb(0,98,147);">Configuring repository with the legacy search engine</span>

<span style="color: rgb(0,98,147);">S</span>earch can be configured independently from storage, and the following configuration example shows both the default values, and how you configure legacy as the search engine:

**ezpublish.yml**

``` brush:
ezpublish:
    repositories:
        main:
            storage:
                engine: legacy
                connection: default
            search:
                engine: legacy
                connection: default
```

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Repository](Repository_31432023.html)</span>

 Developer : List of Limitations 



<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Limitation</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><a href="BlockingLimitation_31430461.html">BlockingLimitation</a></td>
<td align="left">Generic limitation that always tells the permissions system that the user has no access, causing it to continue to the next policy.</td>
</tr>
<tr class="even">
<td align="left"><p><a href="ContentTypeLimitation_31430463.html">ContentTypeLimitation</a></p></td>
<td align="left"><span>Limits content access depending on its Content Type.</span></td>
</tr>
<tr class="odd">
<td align="left"><p><a href="LanguageLimitation_31430465.html">LanguageLimitation</a></p></td>
<td align="left"><span>Limits content access depending on its Language.</span></td>
</tr>
<tr class="even">
<td align="left"><p><a href="LocationLimitation_31430467.html">LocationLimitation</a></p></td>
<td align="left"><span>Limits content access depending on its Location.</span></td>
</tr>
<tr class="odd">
<td align="left"><a href="NewObjectStateLimitation_31430469.html">NewObjectStateLimitation</a></td>
<td align="left"><span>Limits content ObjectState assignment access depending on new state.</span></td>
</tr>
<tr class="even">
<td align="left"><p><a href="NewSectionLimitation_31430471.html">NewSectionLimitation</a></p></td>
<td align="left"><span>Limits content Section assignment access depending on new Section.</span></td>
</tr>
<tr class="odd">
<td align="left"><p><a href="ObjectStateLimitation_31430473.html">ObjectStateLimitation</a></p></td>
<td align="left"><span>Limits content access depending on its ObjectStates.</span></td>
</tr>
<tr class="even">
<td align="left"><p><a href="OwnerLimitation_31430475.html">OwnerLimitation</a></p></td>
<td align="left"><span>Limits content access depending on its owner; access is only granted to the owner of the content.</span></td>
</tr>
<tr class="odd">
<td align="left"><p><a href="ParentContentTypeLimitation_31430477.html">ParentContentTypeLimitation</a></p></td>
<td align="left"><span>Limits content (create) access depending on parent location Content Type; access is only granted if the parent is of this type of content.</span></td>
</tr>
<tr class="even">
<td align="left"><p><a href="ParentDepthLimitation_31430480.html">ParentDepthLimitation</a></p></td>
<td align="left"><span>Limits content (create) access depending on parent location depth; access is only granted if the parent is at a given depth of the tree structure.</span></td>
</tr>
<tr class="odd">
<td align="left"><p><a href="ParentOwnerLimitation_31430482.html">ParentOwnerLimitation</a></p></td>
<td align="left"><span>Limits content (create) access depending on parent location <span>content</span> owner; access is only granted if to the owner of the Content item's parent.</span></td>
</tr>
<tr class="even">
<td align="left"><p><a href="ParentUserGroupLimitation_31430484.html">ParentUserGroupLimitation</a></p></td>
<td align="left"><span>Limits content (create) access depending on parent location <span>content</span> owner's User group; access is only granted to a User in the same User group as owner of <span>the Content item's </span>parent.</span></td>
</tr>
<tr class="odd">
<td align="left"><p><a href="SectionLimitation_31430486.html">SectionLimitation</a></p></td>
<td align="left">Limits content access depending on its Section.</td>
</tr>
<tr class="even">
<td align="left"><p><a href="SiteAccessLimitation_31430488.html">SiteAccessLimitation</a></p></td>
<td align="left">Limits access to an action depending on siteaccess, typically used for user/login.</td>
</tr>
<tr class="odd">
<td align="left"><p><a href="SubtreeLimitation_31430490.html">SubtreeLimitation</a></p></td>
<td align="left"><span>Limits content access depending on its subtree.</span></td>
</tr>
<tr class="even">
<td align="left"><a href="UserGroupLimitation_31430492.html">UserGroupLimitation</a></td>
<td align="left"><span>Limits content access depending on its owner's User group; access is only granted to a User in the same User group as the owner.</span></td>
</tr>
</tbody>
</table>

c

 

#### In this topic:

#### Related topics:

[Permissions](https://doc.ez.no/display/DEVELOPER/Repository#Repository-Permissions)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Cookbook](Cookbook_31429528.html)</span>

 Developer : Listening to Core events 



# Description

When you interact with the Public API, and with the content Repository in particular, **Signals** may be sent out, allowing you to react on actions triggered by the Repository. Those signals can be received by dedicated services called **Slots**.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
To learn more about SignalSlot in eZ Platform, please refer to the [dedicated documentation page](Content-Rendering_31429679.html#ContentRendering-Extensibility).

[Signals reference](Repository_31432023.html#Repository-SignalsReference)

This recipe will describe how to register a Slot for a dedicated Signal.

# Solution

## Registering a Slot for a given Signal

As described in the [SignalSlot documentation](Repository_31432023.html#Repository-SignalSlots), a Slot is roughly like an event listener and must extend `eZ\Publish\Core\SignalSlot\Slot`.

A typical implementation is the following:

**OnPublishSlot**

``` brush:
namespace Acme\TestBundle\Slot;
 
use eZ\Publish\Core\SignalSlot\Slot as BaseSlot;
use eZ\Publish\Core\SignalSlot\Signal;
use eZ\Publish\API\Repository\ContentService;
 
class OnPublishSlot extends BaseSlot
{
    /**
     * @var \eZ\Publish\API\Repository\ContentService
     */
    private $contentService;

    public function __construct( ContentService $contentService )
    {
        $this->contentService = $contentService;
    }
 
    public function receive( Signal $signal )
    {
        if ( !$signal instanceof Signal\ContentService\PublishVersionSignal )
        {
            return;
        }

        // Load published content
        $content = $this->contentService->loadContent( $signal->contentId, null, $signal->versionNo );
        // Do stuff with it...
    }
}
```

`OnPublishSlot` now needs to be registered as a service in the ServiceContainer and identified as a valid Slot:

**services.yml (in your bundle)**

``` brush:
parameters:
    my.onpublish_slot.class: Acme\TestBundle\Slot\OnPublishSlot
 
services:
    my.onpublish_slot:
        class: %my.onpublish_slot.class%
        arguments: [@ezpublish.api.service.content]
        tags:
            - { name: ezpublish.api.slot, signal: ContentService\PublishVersionSignal }
```

Service tag **`ezpublish.api.slot`** identifies your service as a valid Slot. The signal part (mandatory) says that this slot is listening to **`ContentService\PublishVersionSignal`** (shortcut for `\eZ\Publish\Core\SignalSlot\Signal\ContentService\PublishVersionSignal`).

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Internal signals emitted by Repository services are always relative to `eZ\Publish\Core\SignalSlot\Signal` namespace.

Hence `ContentService\PublishVersionSignal` means `eZ\Publish\Core\SignalSlot\Signal\ContentService\PublishVersionSignal`.

Tip

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
You can register a slot for any kind of signal by setting `signal` to `*` in the service tag.

## Using a basic Symfony event listener

eZ Platform comes with a generic slot that converts signals (including ones defined by user code) to regular event objects and exposes them via the EventDispatcher. This makes it possible to implement a simple event listener/subscriber if you're more comfortable with this approach.

All you need to do is to implement an event listener or subscriber and register it.

# Example

This very simple example will just log the received signal.

**services.yml (in your bundle)**

``` brush:
parameters:
    my.signal_listener.class: Acme\TestBundle\EventListener\SignalListener
 
services:
    my.signal_listener:
        class: %my.signal_listener.class%
        arguments: [@logger]
        tags:
            - { name: kernel.event_subscriber }
```

``` brush:
<?php
namespace Acme\TestBundle\EventListener;

use eZ\Publish\Core\MVC\Symfony\Event\SignalEvent;
use eZ\Publish\Core\MVC\Symfony\MVCEvents;
use Psr\Log\LoggerInterface;
use Symfony\Component\EventDispatcher\EventSubscriberInterface;

class SignalListener implements EventSubscriberInterface
{
    /**
     * @var \Psr\Log\LoggerInterface
     */
    private $logger;

    public function __construct( LoggerInterface $logger )
    {
        $this->logger = $logger;
    }

    public function onAPISignal( SignalEvent $event )
    {
        $signal = $event->getSignal();
        // You may want to check the signal type here to react accordingly
        $this->logger->debug( 'Received Signal: ' . print_r( $signal, true ) );
    }

    public static function getSubscribedEvents()
    {
        return array(
            MVCEvents::API_SIGNAL => 'onAPISignal'
        );
    }
}
```

#### In this topic:

-   [Description](#ListeningtoCoreevents-Description)
-   [Solution](#ListeningtoCoreevents-Solution)
    -   [Registering a Slot for a given Signal](#ListeningtoCoreevents-RegisteringaSlotforagivenSignal)
    -   [Using a basic Symfony event listener](#ListeningtoCoreevents-UsingabasicSymfonyeventlistener)
-   [Example](#ListeningtoCoreevents-Example)

#### Related topics:

<span class="confluence-link">[Events](Content-Rendering_31429679.html#ContentRendering-Extensibility)</span>

<span class="confluence-link">[Signal-Slot](Repository_31432023.html#Repository-SignalSlots)</span>

[Signals reference](Repository_31432023.html#Repository-SignalsReference)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Repository](Repository_31432023.html)</span>
5.  <span>[List of Limitations](List-of-Limitations_31430459.html)</span>

 Developer : LocationLimitation 



A Limitation to specify if the User has access to Content with a specific Location, in case of `content/create` the parent Location is evaluated.

|                 |                                                                       |
|-----------------|-----------------------------------------------------------------------|
| Identifier      | `Node`                                                                |
| Value Class     | `eZ\Publish\API\Repository\Values\User\Limitation\LocationLimitation` |
| Type Class      | `eZ\Publish\Core\Limitation\LocationLimitationType`                   |
| Criterion used  | `eZ\Publish\API\Repository\Values\Content\Query\Criterion\LocationId` |
| Role Limitation | no                                                                    |

###### Possible values

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">Value</td>
<td align="left">UI value</td>
<td align="left">Description</td>
</tr>
<tr class="even">
<td align="left"><code>&lt;Location_id&gt;</code></td>
<td align="left"><code>&lt;Location_name&gt;</code></td>
<td align="left"><p>All valid Location ids can be set as value(s)</p></td>
</tr>
</tbody>
</table>

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Cookbook](Cookbook_31429528.html)</span>

 Developer : Making cross-origin HTTP requests 



# Description

eZ Publish ships with <a href="https://github.com/nelmio/NelmioCorsBundle">NelmioCorsBundle</a>, a Symfony open-source bundle that provides support for <a href="http://www.w3.org/TR/cors/">CORS (Cross Origin Resource Sharing)</a>. The REST API is pre-configured to respond to such requests, as long as you customize the allowed origins as explained below.

## What is CORS

Supported by most modern browsers, this W3C specification defines a set of custom headers that, under specific circumstances, allow HTTP requests between different hosts. The main use-case is execution of AJAX code from one site towards another.

A couple links about it:

-    <a href="http://www.w3.org/TR/cors/">W3C specification</a>
-   an excellent <a href="http://www.html5rocks.com/en/tutorials/cors/">tutorial about CORS on html5rocks.com</a>
-   <a href="https://developer.mozilla.org/en-US/docs/HTTP/Access_control_CORS">overview of CORS on developer.mozilla.org</a>

# Solution

## Configuration

Since CORS support is provided by a 3rd party bundle, we re-use the semantical configuration it provides. You can read more about it on the <a href="https://github.com/nelmio/NelmioCorsBundle/blob/master/README.md">NelmiCorsBundle's README</a> file.

The origin of a request is one of the main criteria for allowing or blocking a cross origin request. Such requests will come with an Origin HTTP header, automatically added by the browser, that gets approved/blocked by the server. By default, all cross origin requests will be blocked.

### Granting an origin default access

To allow a specific host to execute cross-origin requests, you need to add this host to the `nelmio_cors.default.allow_origin` configuration array in `config.yml`. As an example, in order to allow requests from <a href="http://example.com," class="uri">http://example.com,</a> one would add those lines to `ezpublish/config/config.yml`:

``` brush:
nelmio_cors:
    defaults:
        allow_origin: [ 'http://example.com' ] 
```

### Granting CORS access to your own HTTP resources

The Cors bundle is of course perfectly safe to use for any non-eZ HTTP resource you would like to expose.
Follow the instructions in <a href="https://github.com/nelmio/NelmioCorsBundle/blob/master/README.md#configuration">NelmioCorsBundle's configuration chapter</a>.

#### In this topic:

-   [Description](#Makingcross-originHTTPrequests-Description)
    -   [What is CORS](#Makingcross-originHTTPrequests-WhatisCORS)
-   [Solution](#Makingcross-originHTTPrequests-Solution)
    -   [Configuration](#Makingcross-originHTTPrequests-Configuration)
        -   [Granting an origin default access](#Makingcross-originHTTPrequests-Grantinganorigindefaultaccess)
        -   [Granting CORS access to your own HTTP resources](#Makingcross-originHTTPrequests-GrantingCORSaccesstoyourownHTTPresources)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[API](API_31429524.html)</span>
4.  <span>[eZ Platform Public PHP API](eZ-Platform-Public-PHP-API_31429583.html)</span>
5.  <span>[Public API Guide](Public-API-Guide_31430303.html)</span>

 Developer : Managing Content 



In the following recipes, you will see how to create Content, including complex fields like XmlText or Image.

## Identifying to the repository with a login and a password

As seen earlier, the Repository executes operations with a user's credentials. In a web context, the currently logged-in user is automatically identified. In a command line context, you need to manually log a user in. We have already seen how to manually load and set a user using its ID. If you would like to identify a user using their username and password instead, this can be achieved in the following way:

**authentication**

``` brush:
$user = $userService->loadUserByCredentials( $user, $password );
$repository->setCurrentUser( $user );
```

<span class="status-macro aui-lozenge aui-lozenge-current">V1.6</span>

Since v1.6.0, as the `setCurrentUser` method is deprecated, you need to use the following code:

**authentication**

``` brush:
$permissionResolver = $repository->getPermissionResolver();
$user = $userService->loadUserByCredentials( $user, $password );
$permissionResolver->setCurrentUserReference($user);
```

## Creating content

Full code

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<a href="https://github.com/ezsystems/CookbookBundle/blob/master/Command/CreateContentCommand.php" class="uri">https://github.com/ezsystems/CookbookBundle/blob/master/Command/CreateContentCommand.php</a>

We will now see how to create Content using the Public API. This example will work with the default Folder (ID 1) Content Type from eZ Platform.

``` brush:
/** @var $repository \eZ\Publish\API\Repository\Repository */
$repository = $this->getContainer()->get( 'ezpublish.api.repository' );
$contentService = $repository->getContentService();
$locationService = $repository->getLocationService();
$contentTypeService = $repository->getContentTypeService();
```

We first need the required services. In this case: `ContentService`, `LocationService` and `ContentTypeService`.

### The ContentCreateStruct

As explained in [eZ Platform Public PHP API](eZ-Platform-Public-PHP-API_31429583.html), Value Objects are read only. Dedicated objects are provided for Update and Create operations: structs, like `ContentCreateStruct` or `UpdateCreateStruct`. In this case, we need to use a `ContentCreateStruct`. 

``` brush:
$contentType = $contentTypeService->loadContentTypeByIdentifier( 'article' );
$contentCreateStruct = $contentService->newContentCreateStruct( $contentType, 'eng-GB' );
```

We first need to get the <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/ContentType/ContentType.html"><code>ContentType</code></a> we want to create a `Content` with. To do so, we use <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/ContentTypeService.html#method_loadContentTypeByIdentifier"><code>ContentTypeService::loadContentTypeByIdentifier()</code></a>, with the wanted `ContentType` identifier, like 'article'. We finally get a ContentTypeCreateStruct using <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/ContentService.html#method_newContentCreateStruct"><code>ContentService::newContentCreateStruct()</code></a>, providing the Content Type and a Locale Code (eng-GB).

### Setting the fields values

``` brush:
$contentCreateStruct->setField( 'title', 'My title' );
$contentCreateStruct->setField( 'intro', $intro );
$contentCreateStruct->setField( 'body', $body );
```

Using our create struct, we can now set the values for our Content item's Fields, using the <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/ContentCreateStruct.html#method_setField"><code>setField()</code></a> method. For now, we will just set the title. `setField()` for a TextLine Field simply expects a string as input argument. More complex Field Types, like Author or Image, expect different input values.

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
The `         ContentCreateStruct::setField()       ` method can take several type of arguments.

In any case, whatever the Field Type is, a Value of this type can be provided. For instance, a TextLine\\Value can be provided for a TextLine\\Type. Depending on the Field Type implementation itself, more specifically on the `fromHash()` method every Field Type implements, various arrays can be accepted, as well as primitive types, depending on the Type.

### Setting the Location

In order to set a Location for our object, we must instantiate a <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/LocationCreateStruct.html"><code>LocationCreateStruct</code></a>. This is done with `LocationService::newLocationCreateStruct()`, with the new Location's parent ID as an argument.

``` brush:
$locationCreateStruct = $locationService->newLocationCreateStruct( 2 );
```

### Creating and publishing

To actually create our Content in the Repository, we need to use `ContentService::createContent()`. This method expects a `ContentCreateStruct`, as well as a `LocationCreateStruct`. We have created both in the previous steps.

``` brush:
$draft = $contentService->createContent( $contentCreateStruct, array( $locationCreateStruct ) );
$content = $contentService->publishVersion( $draft->versionInfo );
```

The LocationCreateStruct is provided as an array, since a Content item can have multiple locations.

`createContent()`returns a new Content Value Object, with one version that has the DRAFT status. To make this Content visible, we need to publish it. This is done using `ContentService::publishVersion()`. This method expects a `VersionInfo` object as its parameter. In our case, we simply use the current version from `$draft`, with the `versionInfo` property.

## Updating Content

Full code

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<a href="https://github.com/ezsystems/CookbookBundle/blob/master/Command/UpdateContentCommand.php" class="uri">https://github.com/ezsystems/CookbookBundle/blob/master/Command/UpdateContentCommand.php</a>

We will now see how the previously created Content can be updated. To do so, we will create a new draft for our Content, update it using a <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/ContentUpdateStruct.html"><code>ContentUpdateStruct</code></a>, and publish the updated Version.

``` brush:
$contentInfo = $contentService->loadContentInfo( $contentId );
$contentDraft = $contentService->createContentDraft( $contentInfo );
```

To create our draft, we need to load the Content item's ContentInfo using `ContentService::loadContentInfo()`. We can then use `ContentService::createContentDraft()` to add a new Draft to our Content.

``` brush:
// instantiate a content update struct and set the new fields
$contentUpdateStruct = $contentService->newContentUpdateStruct();
$contentUpdateStruct->initialLanguageCode = 'eng-GB'; // set language for new version
$contentUpdateStruct->setField( 'title', $newTitle );
$contentUpdateStruct->setField( 'body', $newBody );
```

To set the new values for this version, we request a `ContentUpdateStruct` from the `ContentService` using the `newContentUpdateStruct()` method. Updating the values hasn't changed: we use the `setField()` method.

``` brush:
$contentDraft = $contentService->updateContent( $contentDraft->versionInfo, $contentUpdateStruct );
$content = $contentService->publishVersion( $contentDraft->versionInfo );
```

We can now use `ContentService::updateContent()` to apply our `ContentUpdateStruct` to our draft's `VersionInfo`. Publishing is done exactly the same way as for a new content, using `ContentService::publishVersion()`.

## Handling translations

In the two previous examples, you have seen that we set the ContentUpdateStruct's `initialLanguageCode` property. To translate an object to a new language, set the locale to a new one.

**translating**

``` brush:
$contentUpdateStruct->initialLanguageCode = 'ger-DE';
$contentUpdateStruct->setField( 'title', $newtitle );
$contentUpdateStruct->setField( 'body', $newbody );
```

It is possible to create or update content in multiple languages at once. There is one restriction: only one language can be set a version's language. This language is the one that will get a flag in the back office. However, you can set values in other languages for your attributes, using the `setField` method's third argument.

**update multiple languages**

``` brush:
// set one language for new version
$contentUpdateStruct->initialLanguageCode = 'fre-FR';

$contentUpdateStruct->setField( 'title', $newgermantitle, 'ger-DE' );
$contentUpdateStruct->setField( 'body', $newgermanbody, 'ger-DE' );

$contentUpdateStruct->setField( 'title', $newfrenchtitle );
$contentUpdateStruct->setField( 'body', $newfrenchbody );
```

Since we don't specify a locale for the last two fields, they are set for the `UpdateStruct`'s `initialLanguageCode`, fre-FR.

## Creating Content containing an image

Full code

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<a href="https://github.com/ezsystems/CookbookBundle/blob/master/Command/CreateImageCommand.php" class="uri">https://github.com/ezsystems/CookbookBundle/blob/master/Command/CreateImageCommand.php</a>

As explained above, the `setField()` method can accept various values: an instance of the Field Type's Value class, a primitive type, or a hash. The last two depend on what the `Type::acceptValue()` method is build up to handle. TextLine can, for instance, accept a simple string as an input value. In this example, you will see how to set an Image value.

We assume that we use the default image class. Creating our Content, using the Content Type and a ContentCreateStruct, has been covered above, and can be found in the full code. Let's focus on how the image is provided.

``` brush:
$file = '/path/to/image.png';

$value = new \eZ\Publish\Core\FieldType\Image\Value(
    array(
        'path' => '/path/to/image.png',
        'fileSize' => filesize( '/path/to/image.png' ),
        'fileName' => basename( 'image.png' ),
        'alternativeText' => 'My image'
    )
);
$contentCreateStruct->setField( 'image', $value );
```

This time, we create our image by directly providing an <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/Core/FieldType/Image/Value.html"><code>Image\Value</code></a> object. The values are directly provided to the constructor using a hash with predetermined keys that depend on each Type. In this case: the path where the image can be found, its size, the file name, and an alternative text.

Images also implement a static <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/Core/FieldType/Image/Value.html#method_fromString"><code>fromString()</code></a> method that will, given a path to an image, return an `Image\Value` object.

``` brush:
$value = \eZ\Publish\Core\FieldType\Image\Value::fromString( '/path/to/image.png' );
```

But as said before, whatever you provide `setField()` with is sent to the `acceptValue()` method. This method really is the entry point to the input formats a Field Type accepts. In this case, you could have provided setField with either a hash, similar to the one we provided the Image\\Value constructor with, or the path to your image, as a string.

``` brush:
$contentCreateStruct->setField( 'image', '/path/to/image.png' );
 
// or
 
$contentCreateStruct->setField( 'image', array(
    'path' => '/path/to/image.png',
    'fileSize' => filesize( '/path/to/image.png' ),
    'fileName' => basename( 'image.png' ),
    'alternativeText' => 'My image'
);
```

## Create Content with XML Text

Full code

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<a href="https://github.com/ezsystems/CookbookBundle/blob/master/Command/CreateXMLContentCommand.php" class="uri">https://github.com/ezsystems/CookbookBundle/blob/master/Command/CreateXMLContentCommand.php</a>

Another very commonly used Field Type is the rich text one, `XmlText`.

**working with xml text**

``` brush:
$xmlText = <<< EOX
<?xml version='1.0' encoding='utf-8'?>
<section>
<paragraph>This is a <strong>image test</strong></paragraph>
<paragraph><embed view='embed' size='medium' object_id='$imageId'/></paragraph>
</section>
EOX;
$contentCreateStruct->setField( 'body', $xmlText );
```

As for the last example above, we use the multiple formats accepted by `setField()`, and provide our XML string as is. The only accepted format as of 5.0 is internal XML, the one stored in the Legacy database.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
The XSD for the internal XML representation can be found in the kernel: <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Publish/Core/FieldType/XmlText/Input/Resources/schemas/ezxml.xsd" class="uri">https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Publish/Core/FieldType/XmlText/Input/Resources/schemas/ezxml.xsd</a>.

We embed an image in our XML, using the `<embed>` tag, providing an image Content ID as the `object_id` attribute.

Using a custom format as input

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
More input formats will be added later. The API for that is actually already available: you simply need to implement the <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/Core/FieldType/XmlText/Input.html"><code>XmlText\Input</code></a> interface. It contains one method, <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/Core/FieldType/XmlText/Input.html#method_getInternalRepresentation"><code>getInternalRepresentation()</code></a>, that must return an internal XML string. Create your own bundle, add your implementation to it, and use it in your code!

``` brush:
$input = new \My\XmlText\CustomInput( 'My custom format string' );
$contentCreateStruct->setField( 'body', $input );
```

## Deleting Content

``` brush:
$contentService->deleteContent( $contentInfo );
```

<a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/ContentService.html#method_deleteContent"><code>ContentService::deleteContent()</code></a> method expects a `ContentInfo` as an argument. It will delete the given Content item, all of its Locations, as well as all of the Content item's Locations' descendants and their associated Content.

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Use with caution!

**
**

#### In this topic:

-   [Identifying to the repository with a login and a password](#ManagingContent-Identifyingtotherepositorywithaloginandapassword)
-   [Creating content](#ManagingContent-Creatingcontent)
    -   [The ContentCreateStruct](#ManagingContent-TheContentCreateStruct)
    -   [Setting the fields values](#ManagingContent-Settingthefieldsvalues)
    -   [Setting the Location](#ManagingContent-SettingtheLocation)
    -   [Creating and publishing](#ManagingContent-Creatingandpublishing)
-   [Updating Content](#ManagingContent-UpdatingContent)
-   [Handling translations](#ManagingContent-Handlingtranslations)
-   [Creating Content containing an image](#ManagingContent-CreatingContentcontaininganimage)
-   [Create Content with XML Text](#ManagingContent-CreateContentwithXMLText)
-   [Deleting Content](#ManagingContent-DeletingContent)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Get Started with eZ Platform](Get-Started-with-eZ-Platform_31429520.html)</span>
4.  <span>[Step 1: Installation](31429538.html)</span>

 Developer : Manual Installation Guides 



### Introduction

Hi! You are about to install eZ Platform on your machine and this guide is here to make sure that the whole process of preparation and installation is fast and easy. This guide consists of a three paths that differ slightly; you should choose the one that meets your operating system:

[Microsoft Windows](https://doc.ez.no/display/DEVELOPER/Manual+Installation+on+Windows), [Mac OS X](Installation-Guide-for-OS-X_31431738.html) or other [Unix-Based Systems](Installation-Guide-for-Unix-Based-Systems_31431755.html).

 

 

**Installation guides can be followed with any eZ Symfony distribution, you can find a list of available distributions from eZ in a table below:**

| Type                                                                                     | Archive                                                                                                                                   | License                                                                                       | GIT */ Composer*                                                                                                                                                                                                 |
|------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| eZ Platform<span style="color: rgb(128,128,128);"> *- "clean"*</span>                    | <a href="http://share.ez.no/downloads/downloads">share.ez.no/downloads/downloads</a>                                | GPL                                                                                           | <a href="https://github.com/ezsystems/ezplatform">ezsystems/ezplatform</a> (<a href="https://github.com/ezsystems/ezplatform/blob/master/INSTALL.md">INSTALL.md</a>) |
| eZ Platform<span style="color: rgb(128,128,128);"> *- "demo"*</span>                     | <span style="color: rgb(128,128,128);">*Available via Git / Composer*</span>                                                              | GPL                                                                                           | <a href="https://github.com/ezsystems/ezplatform-demo">ezsystems/ezplatform-demo</a>                                                                                                       |
| eZ Platform Enterprise Edition<span style="color: rgb(128,128,128);"> *- "clean"*</span> | <span style="color: rgb(153,153,153);"><a href="https://support.ez.no/Downloads">support.ez.no/Downloads</a></span> | BUL <span style="color: rgb(128,128,128);">(***requires eZ Enterprise subscription)***</span> | <a href="https://github.com/ezsystems/ezstudio">ezsystems/ezstudio</a> (<a href="https://github.com/ezsystems/ezstudio/blob/master/INSTALL.md">INSTALL.md</a>)       |
| eZ Platform Enterprise Edition - <span style="color: rgb(128,128,128);">*"demo"*</span>  | <span style="color: rgb(153,153,153);"><a href="https://support.ez.no/Downloads">support.ez.no/Downloads</a></span> | BUL <span style="color: rgb(128,128,128);">(***requires eZ Enterprise subscription)***</span> | <a href="https://github.com/ezsystems/ezstudio-demo">ezsystems/ezstudio-demo</a>                                                                                                           |

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Get Started with eZ Platform](Get-Started-with-eZ-Platform_31429520.html)</span>
4.  <span>[Step 1: Installation](31429538.html)</span>
5.  <span>[Manual Installation Guides](Manual-Installation-Guides_31431727.html)</span>

 Developer : Manual Installation on Windows 



## Preparation:

### 1. Set up PHP

This step requires the modification of two files: Apache2 configuration file and `php.ini`.
These files can be edited using a terminal editor like vi or nano, or a simple text editor. file name is **httpd.conf **and by default it is located in this directory:

``` brush:
C:\Program Files\Apache Software Foundation\Apache2.2\conf
```

a. Uncomment the following line:

``` brush:
LoadModule php5_module libexec/apache2/libphp5.so
```

b. Locate php.ini file. By default it should be in the following directory:

``` brush:
C:\program files\php\php.ini
```

c. Open the file in a text editor and locate `date.timezone` and `pdo_mysql.default_socket` and provide them with values as in the example below:

``` brush:
date.timezone = "Europe/Warsaw"
pdo_mysql.default_socket = /tmp/mysql.sock
```

d. Increase `memory_limit` value for eZ Platform:

``` brush:
memory_limit = 4G
```

### 2. Set up virtual host and start Apache2

a. Edit Apache2 configuration file:

``` brush:
c:\Program Files\Apache Software Foundation\Apache2.2\conf
```

b. Uncomment and modify the following lines:

``` brush:
LoadModule vhost_alias_module libexec/apache2/mod_vhost_alias.so
LoadModule rewrite_module libexec/apache2/mod_rewrite.so
```

c. Comment the following line:

``` brush:
Include /private/etc/apache2/extra/httpd-vhosts.conf
```

d. Add the following line to the file:

``` brush:
Include /private/etc/apache2/users/*.conf
```

 

### 3. Start Apache2 daemon using Command Line

``` brush:
httpd.exe
```

### 4. Install Composer globally

Composer is a dependency manager that allows you to install packages directly in the project. It is also checking all packages' versions on a regular basis to make sure they are up-to-date and to avoid inconsistencies.

``` brush:
curl -sS https://getcomposer.org/installer | php
php -d memory_limit=-1 composer.phar
```

### 5. Create a new database for eZ Platform

Create new database (you can substitute `ez1` with the database name you want to use):

``` brush:
mysql -uroot -ppassword -e "CREATE DATABASE ez1"
```

### 6. Install additional requirements for eZ Platform

a. Install PEAR/PECL extension:

``` brush:
cd c:\program files\php\php.ini
curl -O https://pear.php.net/go-pear.phar
php -d detect_unicode=0 go-pear.phar
php install-pear-nozlib.phar
pear channel-update pear.php.net
pecl channel-update pecl.php.net
pear upgrade-all
pear config-set auto_discover 1
```

b. Edit `php.ini` and add following line:

``` brush:
extension=intl.so
```

c. Enable opcache extension for PHP (suggested, but not required) by adding:

``` brush:
zend_extension=opcache.so
```

## Installation:

### 
7. Install eZ Platform

a. Download archive from <a href="http://share.ez.no/downloads/downloads">share.ez.no/downloads</a>. Extract the eZ Platform archive to a directory, then execute post install scripts.

``` brush:
cd /<directory>/
php -d memory_limit=-1 composer.phar run-script post-install-cmd
```

 

b. Copy the virtual host template:

``` brush:
COPY c:\Program Files\Apache Software Foundation\Apache2.2\vhost.template c:\Program Files\Apache Software Foundation\Apache2.2\users/ez1.lh.conf
```

d. Modify virtual host file **vhost.template. **

Replace the `---USER_ID---` variable (used in lines 10 and 17) with your current user ID. Use `whoami` command to get effective user ID of the currently logged user. If you want to use the default virtual host template (delivered with eZ Platform package) all you have to do is set up lines 7, 8, 9, 10, 17, 25 and 33:

e. Restart Apache 2 server:

``` brush:
httpd.exe -k restart
```

f. Install required dependencies using Composer:

``` brush:
composer install
```

When Composer asks you for the token you must log in to your GitHub account and edit your profile. Go to the Personal access tokens link and Generate new token with default settings. Be aware that the token will be shown only once, so do not refresh the page until you paste the token into Composer prompt. This operation is performed only once when you install eZ Platform for the first time.

h. Install eZ Platform:

``` brush:
php app/console ezplatform:install clean
```

You will be able to see your page under <a href="http://ez1.lh" class="uri">http://ez1.lh</a> (or the address you chose in preparation). Please note that a clean install of eZ Platform doesn’t include DemoBundle anymore.






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>
6.  <span>[Content items, Content Types and Fields](31430275.html)</span>
7.  <span>[Field Types reference](Field-Types-reference_31430495.html)</span>

 Developer : MapLocation Field Type 



This Field Type represents a geographical location.

| Name          | Internal name    | Expected input |
|---------------|------------------|----------------|
| `MapLocation` | `ezgmaplocation` | `mixed`        |

## Description

This Field Type makes possible to store and retrieve a geographical location.

As input it expects two float values, latitude, longitude, and a string value in third place, corresponding to the name or address of the location.

## PHP API Field Type 

### Input expectations

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>array</code></td>
<td align="left"><pre><code>array( &#39;latitude&#39; =&gt; 59.928732, &#39;longitude&#39; =&gt; 10.777888, &#39;address&#39; =&gt; &quot;eZ Systems Norge&quot; )</code></pre></td>
</tr>
</tbody>
</table>

### Value object

##### Properties

The Value class of this Field Type contains the following properties:

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Property</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>$latitude </code></td>
<td align="left"><code>float</code></td>
<td align="left">This property will store the latitude value of the map location reference.</td>
</tr>
<tr class="even">
<td align="left"><pre><code>$longitude</code></pre></td>
<td align="left"><code>float</code></td>
<td align="left">This property will store the longitude value of the map location reference.</td>
</tr>
<tr class="odd">
<td align="left"><code>$address</code></td>
<td align="left"><code>string</code></td>
<td align="left">This property will store the address of map location.</td>
</tr>
</tbody>
</table>

##### Constructor

<span>The **`MapLocation`**</span>**`\Value`**<span> constructor will initialize a new Value object with the values provided. Two floats and a string are expected.
</span>

**Constructor example**

``` brush:
// Instantiates a MapLocation Value object
$MapLocationValue = new MapLocation\Value(
                        array(
                            'latitude' => 59.928732,
                            'longitude' => 10.777888,
                            'address' => "eZ Systems Norge"
                        )
                    );
```

## Template rendering

The template called by [the **ez\_render\_field()** Twig function](ez_render_field_32114041.html) while rendering a Map Location field accepts the following the parameters:

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Parameter</th>
<th align="left">Type</th>
<th align="left">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>mapType</code></td>
<td align="left"><code>string</code></td>
<td align="left"><code>&quot;ROADMAP&quot;</code></td>
<td align="left"><a href="https://developers.google.com/maps/documentation/javascript/maptypes#BasicMapTypes">One of the GMap type of map</a></td>
</tr>
<tr class="even">
<td align="left"><code>showMap</code></td>
<td align="left"><code>boolean</code></td>
<td align="left"><code>true</code></td>
<td align="left">Whether to show a Google Map</td>
</tr>
<tr class="odd">
<td align="left"><code>showInfo</code></td>
<td align="left"><code>booolean</code></td>
<td align="left"><code>true</code></td>
<td align="left">Whether to show a latitude, longitude and the address outside of the map</td>
</tr>
<tr class="even">
<td align="left"><code>zoom</code></td>
<td align="left"><code>integer</code></td>
<td align="left"><code>13</code></td>
<td align="left">The initial zoom level on the map</td>
</tr>
<tr class="odd">
<td align="left"><code>draggable</code></td>
<td align="left"><code>boolean</code></td>
<td align="left"><code>true</code></td>
<td align="left"><p><span class="c">Whether to enable draggable map<br />
</span></p></td>
</tr>
<tr class="even">
<td align="left"><code>width</code></td>
<td align="left"><code>string|false</code></td>
<td align="left"><code>&quot;500px&quot;</code></td>
<td align="left"><p><span class="c">The width of the rendered map with its unit (for example &quot;500px&quot; or &quot;50em&quot;),</span> <span class="c">set to false to not set any width style inline.</span></p></td>
</tr>
<tr class="odd">
<td align="left"><code>height</code></td>
<td align="left"><code>string|false</code></td>
<td align="left"><code>&quot;200px&quot;</code></td>
<td align="left"><p><span class="c">The height of the rendered map with its unit (for example &quot;200px&quot; or &quot;20em&quot;),</span> <span class="c">set to false to not set any height style inline.</span></p></td>
</tr>
<tr class="even">
<td align="left">scrollWheel</td>
<td align="left"><span>boolean</span></td>
<td align="left">true</td>
<td align="left"><span class="status-macro aui-lozenge aui-lozenge-current">COMING IN EZP-26068</span> Allows you to disable scroll wheel starting to zoom when mouse comes over the map as user scrolls down a page.</td>
</tr>
</tbody>
</table>

Example:

``` brush:
{{ ez_render_field(content, 'location', {'parameters': {'width': '100%', 'height': '330px', 'showMap': true, 'showInfo': false}}) }}
```

### Configuration

<span class="status-macro aui-lozenge aui-lozenge-current">THIS FEATURE IS COMING IN EZP-26068</span><span> </span>

| Config                                                                                      | Site Access/Group aware | Description                                                                                                                                                                                                                                                                            |
|---------------------------------------------------------------------------------------------|-------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span class="pl-smi">api\_keys</span><span>.</span><span class="pl-smi">google\_maps</span> | yes                     | Google maps requires use of a API key for severing maps to web pages, this setting allows you to specify your personal <a href="https://developers.google.com/maps/documentation/javascript/get-api-key">Google Maps API key</a> used during template rendering. |

<span>Example use:</span>

**ezplatform.yml**

``` brush:
ezpublish:
    system:
        site_group:
            api_keys: { google_maps: "MY_KEY" }
```

<span>
</span>

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>
6.  <span>[Content items, Content Types and Fields](31430275.html)</span>
7.  <span>[Field Types reference](Field-Types-reference_31430495.html)</span>

 Developer : Media Field Type 



This Field Type represents and handles media (audio/video) binary file.

| Name    | Internal name | Expected input |
|---------|---------------|----------------|
| `Media` | `ezmedia`     | `mixed`        |

## Description

This Field Type represents and handles a media (audio/video) binary file.

It is capable of handling following types of files:

-   Apple QuickTime
-   Adobe Flash
-   Microsoft Windows Media
-   Real Media
-   Silverlight
-   HTML5 Video
-   HTML5 Audio

## PHP API Field Type 

### Input expectations

| Type                                    | Description                                                                                          | Example                           |
|-----------------------------------------|------------------------------------------------------------------------------------------------------|-----------------------------------|
| `string`                                | Path to the media file.                                                                              | `/Users/jane/butterflies.mp4`     |
| `eZ\Publish\Core\FieldType\Media\Value` | <span>Media FieldType Value Object with path to the media file as the value of `id` property.</span> | See `Value` object section below. |

### Value object

##### Properties

**`eZ\Publish\Core\FieldType\Media\Value`** offers the following properties.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Note that both **`Media`** and **`BinaryFile`** Value and Type inherit from the **`BinaryBase`** abstract Field Type and share common properties.

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Property</th>
<th align="left">Type</th>
<th align="left">Description</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>id</code></td>
<td align="left">string</td>
<td align="left"><p>Media file identifier. This ID depends on the <a href="https://doc.ez.no/display/DEVELOPER/Clustering#Clustering-Binaryfilesclustering">IO Handler</a> that is being used. With the native, default handlers (FileSystem and Legacy), the ID is the file path, relative to the binary file storage root dir (<code>var/&lt;vardir&gt;/storage/original</code> by default).</p></td>
<td align="left">application/63cd472dd7819da7b75e8e2fee507c68.<span>mp4</span></td>
</tr>
<tr class="even">
<td align="left"><code>fileName</code></td>
<td align="left">string</td>
<td align="left">The human-readable file name, as exposed to the outside. Used when sending the file for download in order to name the file.</td>
<td align="left">butterflies.mp4</td>
</tr>
<tr class="odd">
<td align="left"><code>fileSize</code></td>
<td align="left">int</td>
<td align="left">File size, in bytes.</td>
<td align="left">1077923</td>
</tr>
<tr class="even">
<td align="left"><code>mimeType</code></td>
<td align="left">string</td>
<td align="left">The file's mime type.</td>
<td align="left"><p>video/mp4</p></td>
</tr>
<tr class="odd">
<td align="left"><code>uri</code></td>
<td align="left">string</td>
<td align="left"><p>The binary file's HTTP uri. If the URI doesn't include a host or protocol, it applies to the request domain.</p>
<p><strong><strong>The URI is not publicly readable, and must NOT be used to link to the file for download.</strong></strong> Use <code>ez_render_field</code> to generate a valid link to the download controller.</p></td>
<td align="left">/var/ezdemo_site/storage/original/application/63cd472dd7819da7b75e8e2fee507c68.<span>mp4</span></td>
</tr>
<tr class="even">
<td align="left"><code>hasController</code></td>
<td align="left">boolean</td>
<td align="left"><p><span>Whether the media has a controller when being displayed.</span></p></td>
<td align="left">true</td>
</tr>
<tr class="odd">
<td align="left"><code>autoplay</code></td>
<td align="left">boolean</td>
<td align="left"><p><span>Whether the media should be automatically played.</span></p></td>
<td align="left">true</td>
</tr>
<tr class="even">
<td align="left"><code>loop</code></td>
<td align="left">boolean</td>
<td align="left"><p><span>Whether the media should be played in a loop.</span></p></td>
<td align="left">false</td>
</tr>
<tr class="odd">
<td align="left"><code>height</code></td>
<td align="left">int</td>
<td align="left"><p><span>Height of the media.</span></p></td>
<td align="left">300</td>
</tr>
<tr class="even">
<td align="left"><code>width</code></td>
<td align="left">int</td>
<td align="left"><p><span>Width of the media.</span></p></td>
<td align="left">400</td>
</tr>
<tr class="odd">
<td align="left"><code>path</code></td>
<td align="left">string</td>
<td align="left"><p><strong><span style="color: rgb(255,0,0);">deprecated</span><br />
</strong>Renamed to <code>id</code> starting from eZ Publish 5.2. Can still be used, but it is recommended not to use it anymore as it will be removed.</p></td>
<td align="left"> </td>
</tr>
</tbody>
</table>

### Hash format

The hash format mostly matches the value object. It has the following keys:

-   `id`
-   `path` (for backwards compatibility)
-   `fileName`
-   `fileSize`
-   `mimeType`
-   `uri`
-   `hasController`
-   `autoplay`
-   `loop`
-   `height`
-   `width`

### Validation

The Field Type supports `FileSizeValidator`, defining maximum size of media file in bytes:

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"><div class="tablesorter-header-inner">
Name
</div></th>
<th align="left"><div class="tablesorter-header-inner">
Type
</div></th>
<th align="left"><div class="tablesorter-header-inner">
Default value
</div></th>
<th align="left"><div class="tablesorter-header-inner">
Description
</div></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>maxFileSize</code></td>
<td align="left"><code>int</code></td>
<td align="left"><span>false</span></td>
<td align="left">Maximum size of the file in bytes.</td>
</tr>
</tbody>
</table>

**Example of using Media Field Type validator in PHP**

``` brush:
use eZ\Publish\Core\FieldType\Media\Type;
 
$contentTypeService = $repository->getContentTypeService();
$mediaFieldCreateStruct = $contentTypeService->newFieldDefinitionCreateStruct( "media", "ezmedia" );

// Setting maximum file size to 5 megabytes
$mediaFieldCreateStruct->validatorConfiguration = array(
    "FileSizeValidator" => array(
        "maxFileSize" => 5 * 1024 * 1024
    )
);
```

### Settings

The Field Type supports `mediaType` setting, defining how the media file should be handled in output.

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"><div class="tablesorter-header-inner">
Name
</div></th>
<th align="left"><div class="tablesorter-header-inner">
Type
</div></th>
<th align="left"><div class="tablesorter-header-inner">
Default value
</div></th>
<th align="left"><div class="tablesorter-header-inner">
Description
</div></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>mediaType</code></td>
<td align="left"><code>mixed</code></td>
<td align="left"><pre><code>Type::TYPE_HTML5_VIDEO</code></pre></td>
<td align="left">Type of the media, accepts one of the predefined constants.</td>
</tr>
</tbody>
</table>

List of all available `mediaType` constants defined in **`eZ\Publish\Core\FieldType\Media\Type`** class:

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"><div class="tablesorter-header-inner">
Name
</div></th>
<th align="left"><div class="tablesorter-header-inner">
Description
</div></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><pre><code>TYPE_FLASH</code></pre></td>
<td align="left">Adobe Flash</td>
</tr>
<tr class="even">
<td align="left"><pre><code>TYPE_QUICKTIME</code></pre></td>
<td align="left">Apple QuickTime</td>
</tr>
<tr class="odd">
<td align="left"><pre><code>TYPE_REALPLAYER</code></pre></td>
<td align="left">Real Media</td>
</tr>
<tr class="even">
<td align="left"><pre><code>TYPE_SILVERLIGHT</code></pre></td>
<td align="left">Silverlight</td>
</tr>
<tr class="odd">
<td align="left"><pre><code>TYPE_WINDOWSMEDIA</code></pre></td>
<td align="left"><p>Microsoft Windows Media</p></td>
</tr>
<tr class="even">
<td align="left"><pre><code>TYPE_HTML5_VIDEO</code></pre></td>
<td align="left">HTML5 Video</td>
</tr>
<tr class="odd">
<td align="left"><pre><code>TYPE_HTML5_AUDIO</code></pre></td>
<td align="left"><p>HTML5 Audio</p></td>
</tr>
</tbody>
</table>

**Example of using Media Field Type settings in PHP**

``` brush:
use eZ\Publish\Core\FieldType\Media\Type;
 
$contentTypeService = $repository->getContentTypeService();
$mediaFieldCreateStruct = $contentTypeService->newFieldDefinitionCreateStruct( "media", "ezmedia" );

// Setting Adobe Flash as the media type
$mediaFieldCreateStruct->fieldSettings = array(
    "mediaType" => Type::TYPE_FLASH,
);
```

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Migrating to eZ Platform - Follow the Ibex!](31429532.html)</span>

 Developer : Migration from eZ Publish 



eZ Publish was eZ Platform's predecessor, a CMS in development for five major versions and several years.

Users of eZ Publish will find eZ Platform largely similar to what they know. The improvements and enhancements did not turn the fundamental concepts underlying the system, such as the content model, upside down. However, specific features, solutions and recipes may work differently between the two versions.

The release of eZ Platform brought about an inevitable disruption in backwards compatibility with eZ Publish. This means that the process of migrating existing installations requires more effort than simply upgrading from one version to another. Here you can find details on moving existing Publish-powered websites to eZ Platform.

## Changes overview

### Incompatibilities with legacy

eZ Platform represents the 6th generation of eZ Publish, and while the 5th generation had* *a major focus on backwards code compatibility with the 3rd and 4th generations *(legacy)*, the 6th generation does not.

The 6th generation is aimed at being fully backwards compatible on the following:

-   **Content** from 4th and later 5th generation installation
-   **Code** from 5th generation system when written for *Platform (Symfony) stack*

The specific incompatibilities

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
The specific changes that will be migrated and are incompatible with legacy are: 

-   XmlText fields have been replaced with a new [<span class="confluence-link">RichText</span>](RichText-Field-Type_31430537.html)field
-   Page field (ezflow) has been replaced by the [<span class="confluence-link">LandingPage</span>](31430521.html)field, and is now provided by our commercial product <a href="http://ezstudio.com/">eZ Platform Enterprise Edition</a>
-   Incremental future improvements to the database schema to improve features and scalability of the content repository 

Together these major improvements make it practically impossible to run eZ Platform side by side with eZ Publish legacy, like it was possible in 5.x series. *For these reasons we recommend that you use eZ Publish Enterprise 5.4  (<a href="https://support.ez.no/Public/Service-Life">which is supported until end of 2021</a>) if you don't have the option to remake your web application yet, or want to do it gradually.*

## Migration Path

### From legacy (4.x or 5.x) to Platform stack (5.4/2014.11)

If you are coming directly from legacy (4.x), you need to follow the best practice 5.x Platform migration path and do the following:

-   Rewrite custom Field Types for the new Platform stack, see <span class="confluence-link">[Field Type Tutorial](Creating-a-Tweet-Field-Type_31429766.html)</span>
-   Rewrite custom web front end to use the new Platform/Symfony stack, see <span class="confluence-link">[Beginner Tutorial](Building-a-Bicycle-Route-Tracker-in-eZ-Platform_31431606.html)</span>
-   Rewrite custom admin modules to use the new Platform/Symfony stack
    -   And if you do this while on 5.x, you can use several of the [available legacy migration features](https://doc.ez.no/display/EZP/Legacy+code+and+features) to make the new code appear in legacy admin

See Upgrade documentation on how to perform the actual upgrade: [Upgrade (eZ Publish Platform page)](https://doc.ez.no/display/EZP/Upgrade)

### From Platform stack (5.4/2014.11) to eZ Platform

As eZ Platform introduced completely new user interfaces with greatly improved user experience, the following custom developments needs to be made if you have customization needs:

-   Write UI code for custom Field Types for the new Javascript-based editorial interface, see <span class="confluence-link"> </span>[Extending PlatformUI with new navigation](Extending-PlatformUI-with-new-navigation_31430235.html) and [Creating Landing Page blocks (Enterprise)](31430614.html)
-   Adjust custom admin modules for the new Symfony-based admin interface

For a detailed guide through these developments see [Upgrading from 5.4.x and 2014.11 to 16.xx](Upgrading-from-5.4.x-and-2014.11-to-16.xx_31430322.html) 

 

<span class="confluence-embedded-file-wrapper image-right-wrapper confluence-embedded-manual-size"><img src="attachments/31430320/31431651.png" class="confluence-embedded-image image-right" height="250" /></span>

## Attachments:

<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [Gondola.png](attachments/31430320/31431651.png) (image/png)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : Multisite 



# Introduction

With eZ Platform it is possible to serve multiple, completely different sites using one eZ Platform instance and database.

Each site will have its own content root, at a lower level than the default one (Location ID 2). One backoffice can be used for each site, but it is also possible to use a global one.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
This feature is a reimplementation of the <a href="http://doc.ez.no/eZ-Publish/Technical-manual/4.x/Reference/Configuration-files/site.ini/SiteAccessSettings/PathPrefix">PathPrefix</a> one that existed in eZ Publish Legacy.

# Configuration

The feature is configured in `ezplatform.yml`, either at siteaccess or siteaccess group level:

``` brush:
ezpublish:
    system:
        ezdemo_site_group:
            content:
                tree_root:
                    # Root locationId. Default is top locationId
                    location_id: 123
                    # Every URL aliases starting with those prefixes will be considered 
                    # being outside of the subtree starting at root_location.
                    # Default value is an empty array.
                    # Prefixes are not case sensitive.
                    excluded_uri_prefixes: [ /media, /images ]
```

#### `content.tree_root.location_id`

This parameter sets the Location ID of the content root. The API is jailed within this root, and nothing above this level will be accessible by default. This parameter can be filtered using the `excluded_uri_prefixes` parameter described below.

#### `content.tree_root.excluded_uri_prefixes`

Use this parameter to exclude a list of URIs from the root jail defined using `location_id` described above. Add as many locations pathString as you like. In the example above, the Media and Images folders will be accessible using their own URI even though they're not below `tree_root.location_id`.

Note

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Leading slashes (`/`) are automatically trimmed internally by eZ Platform, so they can be ignored.

# Usage

## Multisite Design

eZ Platform does not apply a [Legacy template fallback](https://doc.ez.no/display/EZP/Legacy+template+fallback) like eZ Publish did. You can, however, have different designs in your multisite installation if you organize the view configuration with the use of siteaccesses.

You can see how this is done on the example of a multisite that contains two blogs with different designs, but sharing some templates. Let's assume you have a siteaccess called `second_site`. You can organize your templates in the following folder structure:

``` brush:
views
 |- pagelayout.html.twig
     |- full
         |- blog.html.twig
         |- blog_post.html.twig
     |- second_site
         |- pagelayout.html.twig
         |- full
             |- blog_post.html.twig
```

Now you can use this view configuration (stored e.g. in a `views.yml` file):

``` brush:
ezpublish:
    system:
        default:
            pagelayout: pagelayout.html.twig
            content_view:
                full:
                    blog:
                        template: "full/blog.html.twig"
                        match:
                            Identifier\ContentType: [blog]
                    blog_post:
                        template: "full/blog_post.html.twig"
                        match:
                            Identifier\ContentType: [blog_post]
        second_site:
            pagelayout: second_site/pagelayout.html.twig
            content_view:
                full:
                    blog_post:
                        template: "second_site/full/blog_post.html.twig"
                        match:
                            Identifier\ContentType: [blog_post]
```

This config defines views that will be used for the `second_site` siteaccess: a separate `second_site/pagelayout.html.twig` and a template to be used for blog posts. When no view is defined under `second_site`, such as in the case of the `blog` Content Type, the template defined under `default` will apply. `default` will also be used for all siteaccesses other than `second_site`.

To load the base layout in templates you now need to use `{% extends noLayout == true ? viewbaseLayout : pagelayout %}`.

## <span id="Multisite-SettingTheIndexPage" class="confluence-anchor-link"></span>Setting the Index Page

The Index Page is the page shown when the root index / is accessed.
You can configure the Index Page separately for each siteaccess. Put the parameter `index_page` in your `ezplatform.yml` file, under the right siteaccess category.

**ezplatform.yml**

``` brush:
ezpublish:
    system:
        mygreat_site:
            languages:
                - eng-US
            #The page to show when accessing IndexPage (/)
            index_page: /yourURIPage
```

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
If not specified, the `index_page` is the configured content root.

#### In this topic:

-   [Introduction](#Multisite-Introduction)
-   [Configuration](#Multisite-Configuration)
-   [Usage](#Multisite-Usage)
    -   [Multisite Design](#Multisite-MultisiteDesign)
    -   [Setting the Index Page](#Multisite-SettingTheIndexPageSettingtheIndexPage)

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Repository](Repository_31432023.html)</span>
5.  <span>[List of Limitations](List-of-Limitations_31430459.html)</span>

 Developer : NewObjectStateLimitation 



A Limitation to specify if the User has access to (assigning) a given `ObjectState` (to Content).

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
<span>In the `state/assign` Policy you can combine this with `ObjectStateLimitation` to limit both from and to values.</span>

<span style="font-size: 10.0pt;line-height: 13.0pt;">
</span>

|                 |                                                                             |
|-----------------|-----------------------------------------------------------------------------|
| Identifier      | `NewState`                                                                  |
| Value Class     | `eZ\Publish\API\Repository\Values\User\Limitation\NewObjectStateLimitation` |
| Type Class      | `eZ\Publish\Core\Limitation\NewObjectStateLimitationType`                   |
| Criterion used  | n/a                                                                         |
| Role Limitation | no                                                                          |

###### Possible values

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">Value</td>
<td align="left">UI value</td>
<td align="left">Description</td>
</tr>
<tr class="even">
<td align="left"><code>&lt;State_id&gt;</code></td>
<td align="left"><code>&lt;State_name&gt;</code></td>
<td align="left"><p>All valid state ids can be set as value(s)</p></td>
</tr>
</tbody>
</table>

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Repository](Repository_31432023.html)</span>
5.  <span>[List of Limitations](List-of-Limitations_31430459.html)</span>

 Developer : NewSectionLimitation 



A Limitation to specify if the User has access to (assigning) a given Section (to Content).

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
<span>In the `section/assign` Policy you can combine this with `SectionLimitation` to limit both from and to values.</span>

<span style="font-size: 10.0pt;line-height: 13.0pt;">
</span>

|                 |                                                                         |
|-----------------|-------------------------------------------------------------------------|
| Identifier      | `NewSection`                                                            |
| Value Class     | `eZ\Publish\API\Repository\Values\User\Limitation\NewSectionLimitation` |
| Type Class      | `eZ\Publish\Core\Limitation\NewSectionLimitationType`                   |
| Criterion used  | n/a                                                                     |
| Role Limitation | no                                                                      |

###### Possible values

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">Value</td>
<td align="left">UI value</td>
<td align="left">Description</td>
</tr>
<tr class="even">
<td align="left"><code>&lt;Session_id&gt;</code></td>
<td align="left"><code>&lt;Session_name&gt;</code></td>
<td align="left"><p>All valid section ids can be set as value(s)</p></td>
</tr>
</tbody>
</table>

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>
6.  <span>[Content items, Content Types and Fields](31430275.html)</span>
7.  <span>[Field Types reference](Field-Types-reference_31430495.html)</span>

 Developer : Null Field Type 



This Field Type is used as fallback and for testing purposes.

| Name   | Internal name | Expected input type |
|--------|---------------|---------------------|
| `Null` | `variable`    | `mixed`             |

## Description

As integration with Legacy Stack requires that all Field Types are also also handled on 5.x stack side, Null Field Type is provided as a dummy for legacy Field Types that are not really implemented on 5.x side.

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Null Field Type will accept anything provided as a value, but will not store anything to the database, nor will it read any data from the database.

This Field Type does not have its own fixed internal name. Its identifier is instead configured as needed by passing it as an argument to the constructor.

Following example shows how Null Field Type is used to configure dummy implementations for `ezcomcomments` and `ezpaex` legacy datatypes:

**Null Fieldtype example configuration**

``` brush:
parameters:
    ezpublish.fieldType.eznull.class: eZ\Publish\Core\FieldType\Null\Type

services:
    ezpublish.fieldType.ezcomcomments:
        class: %ezpublish.fieldType.eznull.class%
        parent: ezpublish.fieldType
        arguments: [ "ezcomcomments" ]
        tags:
            - {name: ezpublish.fieldType, alias: ezcomcomments}
    ezpublish.fieldType.ezpaex:
        class: %ezpublish.fieldType.eznull.class%
        parent: ezpublish.fieldType
        arguments: [ "ezpaex" ]
        tags:
            - {name: ezpublish.fieldType, alias: ezpaex}
```

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Repository](Repository_31432023.html)</span>
5.  <span>[List of Limitations](List-of-Limitations_31430459.html)</span>

 Developer : ObjectStateLimitation 



A Limitation to specify if the User has access to Content with a specific ObjectState.

|                 |                                                                          |
|-----------------|--------------------------------------------------------------------------|
| Identifier      | `State`                                                                  |
| Value Class     | `eZ\Publish\API\Repository\Values\User\Limitation\ObjectStateLimitation` |
| Type Class      | `eZ\Publish\Core\Limitation\ObjectStateLimitationType`                   |
| Criterion used  | `eZ\Publish\API\Repository\Values\Content\Query\Criterion\ObjectStateId` |
| Role Limitation | no                                                                       |

###### Possible values

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">Value</td>
<td align="left">UI value</td>
<td align="left">Description</td>
</tr>
<tr class="even">
<td align="left"><code>&lt;ObjectState_id&gt;</code></td>
<td align="left"><code>&lt;ObjectState_name&gt;</code></td>
<td align="left"><p>All valid <code>ObjectState</code> ids can be set as value(s)</p></td>
</tr>
</tbody>
</table>

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Extending eZ Platform](Extending-eZ-Platform_31429689.html)</span>

 Developer : Other CMS Extensions vs. the eZ Way 



Contributing to the doc

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
This part of the documentation is still a <span class="status-macro aui-lozenge aui-lozenge-current">WORK-IN-PROGRESS</span>. Would you like to contribute to it?

If you have any thoughts or tips to share, let us know in the comments below, visit our <a href="http://ez-community-on-slack.herokuapp.com/">Slack channel</a> or take a look at other ways to [Contribute to Documentation](https://doc.ez.no/display/DEVELOPER/Contribute+to+Documentation).

JIRA issue for this content ?

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[API](API_31429524.html)</span>
4.  <span>[eZ Platform Public PHP API](eZ-Platform-Public-PHP-API_31429583.html)</span>
5.  <span>[Public API Guide](Public-API-Guide_31430303.html)</span>

 Developer : Other recipes 



## Assigning Section to content

Full code

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<a href="https://github.com/docb22/ez-publish-cookbook/tree/master/EzSystems/CookBookBundle/Command/AssignContentToSectionCommand.php">https://github.com/ezsystems/CookbookBundle/tree/master/Command/AssignContentToSectionCommand.php</a>

The Section that a Content item belongs to can be set during creation, using the `ContentCreateStruct::$sectionId` property. However, as for many Repository objects properties, the Section can't be changed using a `ContentUpdateStruct`. The reason is still the same: changing a Content item's Section will affect the subtrees referenced by its Locations. For this reason, it is required that you use the SectionService to change the Section of a Content item.

**assign section to content**

``` brush:
$contentInfo = $contentService->loadContentInfo( $contentId );
$section = $sectionService->loadSection( $sectionId );
$sectionService->assignSection( $contentInfo, $section );
```

This operation involves the `SectionService`, as well as the `ContentService`.

**assign section to content**

``` brush:
$contentInfo = $contentService->loadContentInfo( $contentId );
```

We use `ContentService::loadContentInfo()` to get the Content we want to update the Section for.

**assign section to content**

``` brush:
$section = $sectionService->loadSection( $sectionId );
```

`SectionService::loadSection()` is then used to load the Section we want to assign our Content to. Note that there is no `SectionInfo` object. Sections are quite simple, and we don't need to separate their metadata from their actual data. However, `SectionCreateStruct` and <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/Content/SectionUpdateStruct.html"><code>SectionUpdateStruct</code></a> objects must still be used to create and update Sections.

**assign section to content**

``` brush:
$sectionService->assignSection( $contentInfo, $section );
```

The actual update operation is done using `SectionService::assignSection()`, with the `ContentInfo` and the Section as arguments.

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
`SectionService::assignSection()` won't return the updated Content, as it has no knowledge of those objects. To get the Content with the newly assigned Location, you need to reload the `ContentInfo` using <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/ContentService.html#method_loadContentInfo"><code>ContentService::loadContentInfo()</code></a>. This is also valid for descendants of the Content item. If you have any stored in your execution state, you need to reload them. Otherwise you would be using outdated Content data.

## Creating a Content Type

Full code

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<a href="https://github.com/ezsystems/CookbookBundle/blob/master/Command/CreateContentTypeCommand.php" class="uri">https://github.com/ezsystems/CookbookBundle/blob/master/Command/CreateContentTypeCommand.php</a>

Creating a `ContentType` is actually almost more complex than creating Content. It really isn't as common, and didn't "deserve" the same kind of API as Content did.

Let's split the code in three major parts.

``` brush:
try
{
    $contentTypeGroup = $contentTypeService->loadContentTypeGroupByIdentifier( 'content' );
}
catch ( \eZ\Publish\API\Repository\Exceptions\NotFoundException $e )
{
    $output->writeln( "content type group with identifier $groupIdentifier not found" );
    return;
}


$contentTypeCreateStruct = $contentTypeService->newContentTypeCreateStruct( 'mycontenttype' );
$contentTypeCreateStruct->mainLanguageCode = 'eng-GB';
$contentTypeCreateStruct->nameSchema = '<title>';
$contentTypeCreateStruct->names = array(
    'eng-GB' => 'My content type'
);
$contentTypeCreateStruct->descriptions = array(
    'eng-GB' => 'Description for my content type',
);
```

First, we need to load the `ContentTypeGroup` our `ContentType` will be created in. We do this using <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/ContentTypeService.html#method_loadContentTypeGroupByIdentifier"><code>ContentTypeService::loadContentTypeGroupByIdentifier()</code></a>, which gives us back a `ContentTypeGroup` object. As for content, we then request a `ContentTypeCreateStruct` from the `ContentTypeService`, using `ContentTypeService::newContentTypeCreateStruct()`, with the desired identifier as the argument. 

Using the create struct's properties, we can set the Type's properties:

-   the main language (`mainLanguageCode`) for the Type is set to eng-GB,
-   the content name generation pattern (`nameSchema`) is set to '&lt;title&gt;': Content items of this type will be named the same as their 'title' field.
-   the human-readable name for our Type is set using the `names` property. We give it a hash, indexed by the locale ('eng-GB') the name is set in. This locale must exist in the system.
-   the same way that we have set the `names` property, we can set human-readable descriptions, again as hashes indexed by locale code.

The next big part is to add FieldDefinition objects to our Content Type.

``` brush:
// add a TextLine Field with identifier 'title'
$titleFieldCreateStruct = $contentTypeService->newFieldDefinitionCreateStruct( 'title', 'ezstring' );
$titleFieldCreateStruct->names = array( 'eng-GB' => 'Title' );
$titleFieldCreateStruct->descriptions = array( 'eng-GB' => 'The Title' );
$titleFieldCreateStruct->fieldGroup = 'content';
$titleFieldCreateStruct->position = 10;
$titleFieldCreateStruct->isTranslatable = true;
$titleFieldCreateStruct->isRequired = true;
$titleFieldCreateStruct->isSearchable = true;
$contentTypeCreateStruct->addFieldDefinition( $titleFieldCreateStruct );


// add a TextLine Field body field
$bodyFieldCreateStruct = $contentTypeService->newFieldDefinitionCreateStruct( 'body', 'ezstring' );
$bodyFieldCreateStruct->names = array( 'eng-GB' => 'Body' );
$bodyFieldCreateStruct->descriptions = array( 'eng-GB' => 'Description for Body' );
$bodyFieldCreateStruct->fieldGroup = 'content';
$bodyFieldCreateStruct->position = 20;
$bodyFieldCreateStruct->isTranslatable = true;
$bodyFieldCreateStruct->isRequired = true;
$bodyFieldCreateStruct->isSearchable = true;
$contentTypeCreateStruct->addFieldDefinition( $bodyFieldCreateStruct );
```

We need to create a `FieldDefinitionCreateStruct` object for each `FieldDefinition` our `ContentType` will be made of. Those objects are obtained using <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/ContentTypeService.html#method_newFieldDefinitionCreateStruct"><code>ContentTypeService::newFieldDefinitionCreateStruct()</code></a>. This method expects the FieldDefinition identifier and its type as arguments. The identifiers match the ones from eZ Publish 4 (`ezstring` for TextLine, etc.).

Each field's properties are set using the create struct's properties:

-   `names` and `descriptions` are set using hashes indexed by the locale code, and with the name or description as an argument.
-   The `fieldGroup` is set to 'content'
-   Fields are ordered using the `position` property, ordered numerically in ascending order. We set it to an integer.
-   The translatable, required and searchable boolean flags are set using their respective property: `isTranslatable`, `isRequired` and `isSearchable`.

Once the properties for each create struct are set, the field is added to the Content Type create struct using <a href="http://apidoc.ez.no/sami/trunk/NS/html/eZ/Publish/API/Repository/Values/ContentType/ContentTypeCreateStruct.html#method_addFieldDefinition"><code>ContentTypeCreateStruct::addFieldDefinition()</code></a>.

``` brush:
try
{
    $contentTypeDraft = $contentTypeService->createContentType( $contentTypeCreateStruct, array( $contentTypeGroup ) );
    $contentTypeService->publishContentTypeDraft( $contentTypeDraft );
}
catch ( \eZ\Publish\API\Repository\Exceptions\UnauthorizedException $e )
{
    $output->writeln( "<error>" . $e->getMessage() . "</error>" );
}
catch ( \eZ\Publish\API\Repository\Exceptions\ForbiddenException $e )
{
    $output->writeln( "<error>" . $e->getMessage() . "</error>" );
}
```

The last step is the same as for Content: we create a Content Type draft using `ContentTypeService::createContentType()`, with the `ContentTypeCreateStruct` and an array of `ContentTypeGroup` objects are arguments. We then publish the Content Type draft using `ContentTypeService::publishContentTypeDraft()`.

 

#### In this topic:

-   [Assigning Section to content](#Otherrecipes-AssigningSectiontocontent)
-   [Creating a Content Type](#Otherrecipes-CreatingaContentType)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Repository](Repository_31432023.html)</span>
5.  <span>[List of Limitations](List-of-Limitations_31430459.html)</span>

 Developer : OwnerLimitation 



A Limitation to specify that only the owner of the Content item gets a certain access right.

|                 |                                                                                                |
|-----------------|------------------------------------------------------------------------------------------------|
| Identifier      | `Owner`                                                                                        |
| Value Class     | `eZ\Publish\API\Repository\Values\User\Limitation\OwnerLimitation`                             |
| Type Class      | `eZ\Publish\Core\Limitation\OwnerLimitationType`                                               |
| Criterion used  | `eZ\Publish\API\Repository\Values\Content\Query\Criterion\UserMetadata( UserMetadata::OWNER )` |
| Role Limitation | no                                                                                             |

###### Possible values

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">Value</td>
<td align="left">UI value</td>
<td align="left">Description</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">&quot;self&quot;</td>
<td align="left"><p>Only the User who is the owner gets access</p></td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">&quot;session&quot;</td>
<td align="left"><p>Same as &quot;self&quot;</p></td>
</tr>
</tbody>
</table>

###### Legacy compatibility notes:

1.  "session" is deprecated and works exactly like "self" in Public API since it has no knowledge of user Sessions
2.  A User is no longer automatically assumed to be the owner of themselves and gets access to edit themselves when the Owner limitation is used in Public API

Workaround for the OwnerLimitation on Users

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
To make sure the User gets access to themselves when using OwnerLimitation across 4.x and 5.x, the solution is to change the User to be the owner of their own Content item.

This is accomplished using a privileged user to do the following API calls:

``` brush:
$user = $userService->loadUser( $userId );
$contentMetadataUpdateStruct = $contentService->newContentMetadataUpdateStruct();
$contentMetadataUpdateStruct->ownerId = $user->id;
$contentService->updateContentMetadata( $user->getVersionInfo()->getContentInfo(), $contentMetadataUpdateStruct );
```

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>
4.  <span>[Extending PlatformUI with new navigation](Extending-PlatformUI-with-new-navigation_31430235.html)</span>

 Developer : Paginate results 



By default, the Search Service returns 25 results so, without pagination, the current interface allows you to view only the 25 Locations. To add the pagination, we need to modify the whole component *stack* to accept an offset parameter and to use it:

-   the Symfony Controller and the routing configuration should accept an `offset` parameter and the search query should be built with it
-   the JavaScript application should also have a route with an `offset` parameter
-   this `offset` should be used in the view service when doing the AJAX request
-   the server side code should generate the pagination links and the view should handle those links as the Location links [in the previous step](Build-the-content-list_31430249.html).

### Symfony controller and routing configuration to accept an `offset` parameter

As you can see in the <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/commit/3c447588bff4e021ea16ec7f18ab23e812a4bf40">corresponding commit</a>, this is a purely Symfony-related task where we have to modify the `routing.yml` to accept an optional parameter and the action to use it.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
This is detailed in the <a href="http://symfony.com/doc/current/book/controller.html">Symfony Controller documentation</a>.

### JavaScript application routing to accept an `offset` parameter

The PlatformUI application does not support route with optional parameters, so as a result we are forced to declare a new route which will accept the new parameter. To do that, we have to modify the application plugin to add a second route called <span class="blob-code-inner"><span class="pl-s"><span class="pl-pds"> </span>`eZConfListOffset`<span class="pl-pds"> </span></span></span>:

**ezconf-listappplugin.js**

``` brush:
            // adding a new route so that we don't have anything else to change
            // and we can manage the default `offset` value in the view service
            app.route({
                name: "eZConfListOffset",
                path: "/ezconf/list/:offset",
                view: "ezconfListView",
                service: Y.eZConf.ListViewService,
                sideViews: {'navigationHub': true, 'discoveryBar': false},
                callbacks: ['open', 'checkUser', 'handleSideViews', 'handleMainView'],
            });
```

The new route is very similar to the existing one with the exception of its `path` property.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
The route placeholder concept is documented in the <a href="http://yuilibrary.com/yui/docs/router/">YUI Router component</a>.

### Change the view service to use the `offset` parameter

Depending on which route is matched, an offset parameter might be available. The matched route parameters are available in the request object stored in the `request` attribute of the view service. So to work with both the <span class="blob-code-inner"><span class="pl-s">`eZConfList`<span class="pl-pds"> route and the <span class="blob-code-inner"><span class="pl-s">`eZConfListOffset`<span class="pl-pds"> </span></span></span>route, the view service has to check if an offset was passed and to use 0 as its default value if none is provided. Once that is done, it can build the URI to use to do the AJAX request. The `_load` method then becomes:</span></span></span>

**\_load method in ezconf-listviewservice.js**

``` brush:
        _load: function (callback) {
            // the request allows to retrieve the matched parameters
            var offset = this.get('request').params.offset,
                uri;

            if ( !offset ) {
                offset = 0;
            }
            uri = this.get('app').get('apiRoot') + 'list/' + offset;

            Y.io(uri, {
                method: 'GET',
                on: {
                    success: function (tId, response) {
                        this._parseResponse(response);
                        callback(this);
                    },
                    failure: this._handleLoadFailure,
                },
                context: this,
            });
        },
```

At this point, the interface in the browser should remain the same, but by using for instance the URL `/ez#/ezconf/list/10`, you check that the offset is correctly taken into account.

### <span class="blob-code-inner"><span class="pl-s"><span class="pl-pds">Pagination links</span></span></span>

<span class="blob-code-inner"><span class="pl-s"><span class="pl-pds">To have working pagination links, the first thing to do is to change the server side code to generate them. In the <span class="blob-code-inner"><span class="pl-s"><span class="pl-pds"><a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/commit/7e6f510ca3cf6e9f17ba2e6932d2e9148f5f9860">corresponding commit</a> we also define the default limit at 10 elements.</span></span></span> Like for the Location links, the server side code is not really able to generate a link in the JavaScript application, so we have to generate the markup with the offset as metadata so that the view can recognize and correctly handle those links. So those links get a `data-offset` attribute with the corresponding offset:
</span></span></span>

``` brush:
{% block content %}
<!-- [...] this list is generated, removed here to keep this code short -->

<ul class="ezconf-list-pagination">
    <li class="ezconf-list-page ezconf-list-previous">
    {% if previous is not same as(false) %}
        <a href="{{ path('list', {offset: previous}) }}" class="ezconf-list-page-link" data-offset="{{ previous }}">&laquo; Previous</a>
    {% else %}
        <span>&laquo; Previous</span>
    {% endif %}
    </li>
    <li class="ezconf-list-page ezconf-list-next">
    {% if next %}
        <a href="{{ path('list', {offset: next}) }}" class="ezconf-list-page-link" data-offset="{{ next }}">Next &raquo;</a>
    {% else %}
        <span>Next &raquo;</span>
    {% endif %}
    </li>
</ul>
{% endblock %}
```

After, we just have to change the view code to handle a *tap* on the next/previous links and when this happens, we can again fire the<span class="pl-s"><span class="pl-pds"> </span>`navigateTo`<span class="pl-pds"> application level event to ask the view service to trigger the navigation but this time to the `eZConfListOffset` route with the given `offset`, this is done with:</span></span>

**Pagination links handling in ezconf-listview.js**

``` brush:
YUI.add('ezconf-listview', function (Y) {
    Y.namespace('eZConf');

    Y.eZConf.ListView = Y.Base.create('ezconfListView', Y.eZ.ServerSideView, [], {
        events: {
            '.ezconf-list-location': {
                'tap': '_navigateToLocation'
            },
            '.ezconf-list-page-link': {
                'tap': '_navigateToOffset' // new event detected
            },
        },

        _navigateToOffset: function (e) {
            var offset = e.target.getData('offset');

            e.preventDefault();
            this.fire('navigateTo', {
                routeName: 'eZConfListOffset',
                routeParams: {
                    offset: offset,
                },
            });
        },

        // ... the rest remains unchanged, removed to keep the code short
    });
});
```

After this change, the pagination should work as expected and you should be able to navigate through the complete list of Locations.

Results and next step

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
The resulting code can be seen in <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/releases/tag/7_pagination">the <code>7_pagination</code> tag on GitHub</a>, this step result can also be viewed as <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/compare/6_2_list_server...7_pagination">a diff between tags <code>6_2_list_server</code> and <code>7_pagination</code></a>.

The next and final step is to [add a way for the user to filter by Content Type](Filter-by-Content-Type_31430253.html).

**Tutorial path**






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Cookbook](Cookbook_31429528.html)</span>

 Developer : Paginating API search results 



# Description

When listing content (e.g. blog posts), pagination is a very common use case and is usually painful to implement by hand.

For this purpose eZ Platform recommends the use of <a href="https://github.com/whiteoctober/Pagerfanta">Pagerfanta library</a> and <a href="https://github.com/ezsystems/ezpublish-kernel/tree/master/eZ/Publish/Core/Pagination/Pagerfanta">proposes adapters for it</a>.

# Solution

``` brush:
<?php
namespace Acme\TestBundle\Controller;
 
use eZ\Publish\Core\Pagination\Pagerfanta\ContentSearchAdapter;
use Pagerfanta\Pagerfanta;
use eZ\Bundle\EzPublishCoreBundle\Controller;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion\ContentTypeIdentifier;
use eZ\Publish\API\Repository\Values\Content\Query;
 
class DefaultController extends Controller
{
    public function myContentListAction( $locationId, $viewType, $layout = false, array $params = array() )
    {
        // First build the search query.
        // Let's search for folders, sorted by publication date.
        $query = new Query();
        $query->criterion = new ContentTypeIdentifier( 'folder' );
        $query->sortClauses = array( new SortClause\DatePublished() );
 
        // Initialize the pager.
        // We pass the ContentSearchAdapter to it.
        // ContentSearchAdapter is built with your search query and the SearchService.
        $pager = new Pagerfanta( 
            new ContentSearchAdapter( $query, $this->getRepository()->getSearchService() ) 
        );
        // Let's list 2 folders per page, even if it doesn't really make sense ;-)
        $pager->setMaxPerPage( 2 );
        // Defaults to page 1 or get "page" query parameter
        $pager->setCurrentPage( $this->getRequest()->get( 'page', 1 ) );
 
        return $this->render(
            'AcmeTestBundle::my_template.html.twig',
            array(
                'totalFolderCount' => $pager->getNbResults(),
                'pagerFolder' => $pager,
                'location' => $this->getRepository()->getLocationService()->loadLocation( $locationId ),
            ) + $params
        );
    }
}
```

**my\_template.html.twig**

``` brush:
{% block content %}
    <h1>Listing folder content objects: {{ totalFolderCount }} objects found.</h1>
 
    <div>
        <ul>
        {# Loop over the page results #}
        {% for folder in pagerFolder %}
            <li>{{ ez_content_name( folder ) }}</li>
        {% endfor %}
        </ul>
    </div>
 
    {# Only display pagerfanta navigator if needed. #}
    {% if pagerFolder.haveToPaginate() %}
    <div class="pagerfanta">
        {{ pagerfanta( pagerFolder, 'twitter_bootstrap_translated', {'routeName': location} ) }}
    </div>
    {% endif %}
 
{% endblock %}
```

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
For more information and examples, have a look at <a href="https://github.com/whiteoctober/Pagerfanta/blob/master/README.md">PagerFanta documentation</a>.

## Adapters

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Adapter class name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><pre><code>eZ\Publish\Core\Pagination\Pagerfanta\ContentSearchAdapter</code></pre></td>
<td align="left">Makes the search against passed Query and returns <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Publish/API/Repository/Values/Content/Content.php">Content</a> objects.</td>
</tr>
<tr class="even">
<td align="left"><pre><code>eZ\Publish\Core\Pagination\Pagerfanta\ContentSearchHitAdapter</code></pre></td>
<td align="left">Same as ContentSearchAdapter but returns instead <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Publish/API/Repository/Values/Content/Search/SearchHit.php">SearchHit</a> objects.</td>
</tr>
<tr class="odd">
<td align="left"><pre><code>eZ\Publish\Core\Pagination\Pagerfanta\LocationSearchAdapter</code></pre></td>
<td align="left">Makes a Location search against passed Query and returns Location objects.</td>
</tr>
<tr class="even">
<td align="left"><pre><code>eZ\Publish\Core\Pagination\Pagerfanta\LocationSearchHitAdapter</code></pre></td>
<td align="left">Same as LocationSearchAdapter but returns instead <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Publish/API/Repository/Values/Content/Search/SearchHit.php">SearchHit</a> objects.</td>
</tr>
</tbody>
</table>

 

 

#### In this topic:

-   [Description](#PaginatingAPIsearchresults-Description)
-   [Solution](#PaginatingAPIsearchresults-Solution)
    -   [Adapters](#PaginatingAPIsearchresults-Adapters)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Repository](Repository_31432023.html)</span>
5.  <span>[List of Limitations](List-of-Limitations_31430459.html)</span>

 Developer : ParentContentTypeLimitation 



A Limitation to specify if the User has access to Content whose parent Location contains a specific Content Type, used by `content/create`.

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
This limitation combined with `ContentTypeLimitation` allows you to define business rules like allowing users to create "Blog Post" within a "Blog." If you also combine it with `ParentOwnerLimitation`, you effectively limit access to create Blog Posts in the users' own Blogs.

|                 |                                                                                |
|-----------------|--------------------------------------------------------------------------------|
| Identifier      | `ParentClass`                                                                  |
| Value Class     | `eZ\Publish\API\Repository\Values\User\Limitation\ParentContentTypeLimitation` |
| Type Class      | `eZ\Publish\Core\Limitation\ParentContentTypeLimitationType`                   |
| Criterion used  | n/a                                                                            |
| Role Limitation | no                                                                             |

###### Possible values

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">Value</td>
<td align="left">UI value</td>
<td align="left">Description</td>
</tr>
<tr class="even">
<td align="left"><code>&lt;ContentType_id&gt;</code></td>
<td align="left"><code>&lt;ContentType_name&gt;</code></td>
<td align="left"><p>All valid Content Type ids can be set as value(s)</p></td>
</tr>
</tbody>
</table>

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Repository](Repository_31432023.html)</span>
5.  <span>[List of Limitations](List-of-Limitations_31430459.html)</span>

 Developer : ParentDepthLimitation 



A Limitation to specify if the User has access to creating Content under a parent Location within a specific depth of the tree, used for `content/create` permission.

|                 |                                                                          |
|-----------------|--------------------------------------------------------------------------|
| Identifier      | `ParentDepth`                                                            |
| Value Class     | `eZ\Publish\API\Repository\Values\User\Limitation\ParentDepthLimitation` |
| Type Class      | `eZ\Publish\Core\Limitation\ParentDepthLimitationType`                   |
| Criterion used  | n/a                                                                      |
| Role Limitation | no                                                                       |

###### Possible values

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">Value</td>
<td align="left">UI value</td>
<td align="left">Description</td>
</tr>
<tr class="even">
<td align="left"><code>&lt;int&gt;</code></td>
<td align="left"><code>&lt;int&gt;</code></td>
<td align="left"><p>All valid integers can be set as value(s)</p></td>
</tr>
</tbody>
</table>

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Repository](Repository_31432023.html)</span>
5.  <span>[List of Limitations](List-of-Limitations_31430459.html)</span>

 Developer : ParentOwnerLimitation 



A Limitation to specify that only the Users who owns all parent Locations of a Content item gets a certain access right, used for `content/create` permission.

|                                                            |                                                                          |
|------------------------------------------------------------|--------------------------------------------------------------------------|
| Identifier                                                 | `ParentOwner`                                                            |
| Value Class                                                | `eZ\Publish\API\Repository\Values\User\Limitation\ParentOwnerLimitation` |
| Type Class                                                 | `eZ\Publish\Core\Limitation\ParentOwnerLimitationType`                   |
| Criterion used                                             | n/a                                                                      |
| <span style="color: rgb(0,51,102);">Role Limitation</span> | no                                                                       |

###### Possible values

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">Value</td>
<td align="left">UI value</td>
<td align="left">Description</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">&quot;self&quot;</td>
<td align="left"><p>Only the User who is the owner of all parent Locations gets access</p></td>
</tr>
<tr class="odd">
<td align="left">2</td>
<td align="left">&quot;session&quot;</td>
<td align="left"><p>Same as &quot;self&quot;</p></td>
</tr>
</tbody>
</table>

###### Legacy compatibility notes

1.  "session" is deprecated and works exactly like "self" in Public API since it has no knowledge of user Sessions
2.  User is no longer auto assumed to be owner of himself and get access create children of own user content object when `Owner` limitation is used in Public API

Workaround for the ParentOwner Limitation on Users (when a User is the parent of the content being created)

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
To make sure the User gets access to themselves when using (Parent)OwnerLimitation across 4.x and 5.x, the solution is to change the User to be the owner of their own Content item.

This is accomplished using a privileged user to do the following API calls:

``` brush:
$user = $userService->loadUser( $userId );
$contentMetadataUpdateStruct = $contentService->newContentMetadataUpdateStruct();
$contentMetadataUpdateStruct->ownerId = $user->id;
$contentService->updateContentMetadata( $user->getVersionInfo()->getContentInfo(), $contentMetadataUpdateStruct );
```

 

 

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Repository](Repository_31432023.html)</span>
5.  <span>[List of Limitations](List-of-Limitations_31430459.html)</span>

 Developer : ParentUserGroupLimitation 



A Limitation to specify that only Users with at least one common *direct* User group with the owner of the parent Location of a Content item get a certain access right, used by `content/create` permission.

|                                                            |                                                                              |
|------------------------------------------------------------|------------------------------------------------------------------------------|
| Identifier                                                 | `ParentGroup`                                                                |
| Value Class                                                | `eZ\Publish\API\Repository\Values\User\Limitation\ParentUserGroupLimitation` |
| Type Class                                                 | `eZ\Publish\Core\Limitation\ParentUserGroupLimitationType`                   |
| Criterion used                                             | n/a                                                                          |
| <span style="color: rgb(0,51,102);">Role Limitation</span> | no                                                                           |

###### Possible values

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">Value</td>
<td align="left">UI value</td>
<td align="left">Description</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">&quot;self&quot;</td>
<td align="left"><p>Only a User who has at least one common <em>direct</em> user group with owner of the parent Location gets access</p></td>
</tr>
</tbody>
</table>

 

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : Performance 



# Introduction

eZ Platform can be tuned and set up in different ways so that it is able to run on just about any somewhat modern configuration. What follows is an incomplete list of performance recommendations that we intend to gradually expand upon.

*All tips are valid for both development and production setup unless otherwise noted.*

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
If you are in a hurry then the single most important recommendations on this page is:

-   General: Use PHP 7.x, and dump optimized composer autoload classmap
-   Dev: U<span>se a full web server with vhost </span>
-   Cluster: Reduce latency to Redis/Memcached, use Varnish, and use [Solr](Solr-Bundle_31430592.html)

# <span style="color: rgb(0,98,147);">Client</span>

-   Always use an up-to-date browser *(and an up-to-date operating system so you have access to latest browser versions)*
-   If possible, use a fast, stable internet connection, a flaky or overcrowded connection will slow down UI

# Server

Overall, for production setup:

-   Always use reverse proxy, and strongly prefer to use Varnish.
    -   Compared to the built-in Symfony Proxy in php it is much faster, is able to queue up requests coming in for same fresh/invalidated resource
    -   With <a href="https://github.com/ezsystems/ezplatform-http-cache">ezplatform-http-cache</a> support for xkey & grace provides more stable performance in read/write scenarios
-   Set up eZ Platform in [cluster mode](Clustering_31430387.html) if you need to handle more traffic than what a single server can handle on spikes of traffic.
    -   See recommendation for Memcached/Redis and Search below

## Web server

-   Even for development use Nginx/Apache, as php built-in webserver\* is only able to handle one request at a time.
    -   *\* as exposed via Symfony's "`server:*`" commands*
-   Use a recent version of Nginx, set up https, and enable http/2 to reduce connection latency on parallel requests.

## PHP

-   Use PHP 7.0 *(or, better yet, PHP 7.1 if available).*
-   Always enable opcache for php-fpm/mod\_php.
-   Prefer php-fpm and web server using it over fast-cgi for lower overall memory usage.

## Composer

-   Keep Composer up to date.
-   Always dump optimized class map using c`omposer dump-autoload --optimize` or relevant flags on `composer install/update`.

## Memcached/Redis

-   Memcached/Redis is recommended over filesystem cache even with single server, as it offers overall better performance for operations invalidating cache.
    -   But pure read performance is slower, especially if not optimizing next point.
-   Reduce latency where you can, for instance place memcached/redis on same servers as running php.
    -   This is important for eZ Publish 5.x and eZ Platform 1.x which uses Stash cache library, eZ Platform 2.x which uses Symfony Cache is far less affected by this.

## Search

-   Use [Solr Bundle and Solr](Solr-Bundle_31430592.html) to greatly offload your database and get more stable performance on your install

 

#### In this topic:

-   [Introduction](#Performance-Introduction)
-   [Client](#Performance-Client)
-   [Server](#Performance-Server)
    -   [Web server](#Performance-Webserver)
    -   [PHP](#Performance-PHP)
    -   [Composer](#Performance-Composer)
    -   [Memcached/Redis](#Performance-Memcached/Redis)
    -   [Search](#Performance-Search)

#### Related:

-   [Clustering](Clustering_31430387.html)
-   [Requirements](31429536.html)

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Community Resources](Community-Resources_31429530.html)</span>

 Developer : Professional Training Services 



If you need training or coaching, QA, project support, audit or any other form of consulting to improve your experience with eZ products and enhance your eZ-powered site, contact our <a href="http://ez.no/Services/Consulting">Professional Services</a> to get help from true eZ experts.

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[API](API_31429524.html)</span>
4.  <span>[eZ Platform Public PHP API](eZ-Platform-Public-PHP-API_31429583.html)</span>

 Developer : Public API Guide 



The public API will give you an easy access to the eZ Platform content repository. This repository is the core component that manages content, Locations, Sections, Content Types, Users, User groups, and Roles. It also provides a new, clear interface for plugging in custom Field Types.

 
The public API is built on top of a layered architecture, including a persistence API that abstracts storage. By using the public API, you are sure that your code will be forward compatible with future releases based on enhanced, scalable and high-performance storage engines. Applications based on the public API are also fully backwards compatible by using the included storage engine based on the current kernel and database model.

## About this Guide

The objective of this Public API Guide is to progressively lead you through useful, everyday business logic, using the API in concrete recipes: obtaining a Location from a Content item, fetching a set of Content items, creating a User, and so on.

For each recipe, newly introduced elements will be explained in detail, including the required API components (services, value objects, etc.). 

### Suggested tools

In addition to this cookbook, we strongly recommend that you use a full featured PHP IDE, such as Eclipse or PHPStorm. It will provide you information on every piece of code you use, including objects and classes documentation. We have paid very careful attention to PHPDoc throughout this API, and such a tool is a very valuable help when using this API.

On top of this, generated public API documentation can be found online, in various formats:

-   doxygen: <a href="http://apidoc.ez.no/doxygen/trunk/NS/html/" class="uri">http://apidoc.ez.no/doxygen/trunk/NS/html/</a>
-   sami: <a href="http://apidoc.ez.no/sami/trunk/NS/html/" class="uri">http://apidoc.ez.no/sami/trunk/NS/html/</a>

 

-   [Getting started with the Public API](Getting-started-with-the-Public-API_31430305.html)
-   [Browsing, finding, viewing](31430307.html)
-   [Managing Content](Managing-Content_31430309.html)
-   [Working with Locations](Working-with-Locations_31430311.html)
-   [Other recipes](Other-recipes_31430313.html)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[API](API_31429524.html)</span>
4.  <span>[REST API Guide](REST-API-Guide_31430286.html)</span>

 Developer : REST API Authentication 



The REST API supports two authentication methods: session, and basic. 

-   **Session-based authentication** is meant to be used for AJAX operations. It will let you re-use the visitor's session to execute operations with their permissions.
-   **Basic authentication** is often used when writing cross-server procedures, when one remote application executes operations on one/several eZ Platform instances (remote publishing, maintenance, etc).

Session-based is the default authentication method, as this is needed for UI.

## Session based authentication

This authentication method requires a Session cookie to be sent with each request.

If this authentication method is used with a web browser, this session cookie is automatically available as soon as your visitor logs in. Add it as a cookie to your REST requests, and the user will be authenticated.

### Logging in

It is also possible to create a session for the visitor if they aren't logged in yet. This is done by sending a <span style="color: rgb(0,0,255);">**`POST`**</span> request to <span style="color: rgb(255,102,0);">`/user/sessions`</span>. Logging out is done using a **<span style="color: rgb(0,0,255);">`DELETE`</span>** request on the same resource.

More information

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<a href="https://github.com/ezsystems/ezp-next/blob/master/doc/specifications/rest/REST-API-V2.rst#123%C2%A0%C2%A0%C2%A0session-based-authentication">Session-based authentication chapter of the REST specifications</a>

## HTTP Basic authentication

To enable HTTP Basic authentication, you need to edit app`/config/security.yml`, and add/uncomment the following block. Note that this is enabled by default.

**ezplatform.yml**

``` brush:
        ezpublish_rest:
            pattern: ^/api/ezp/v2
            stateless: true
            ezpublish_http_basic:
                realm: eZ Publish REST API
```

Basic authentication requires the username and password to be sent *(username:password)*, based 64 encoded, with each request, as explained in <a href="http://tools.ietf.org/html/rfc2617">RFC 2617</a>.

Most HTTP client libraries as well as REST libraries do support this method one way or another.

**Raw HTTP request with basic authentication**

``` brush:
GET / HTTP/1.1
Host: api.example.com
Accept: application/vnd.ez.api.Root+json
Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==
```

#### In this topic:

-   [Session based authentication](#RESTAPIAuthentication-Sessionbasedauthentication)
    -   [Logging in](#RESTAPIAuthentication-Loggingin)
-   [HTTP Basic authentication](#RESTAPIAuthentication-HTTPBasicauthentication)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[API](API_31429524.html)</span>
4.  <span>[REST API Guide](REST-API-Guide_31430286.html)</span>

 Developer : REST API Countries list 



Countries list is a REST service that gives access to an <a href="http://en.wikipedia.org/wiki/ISO_3166">ISO-3166</a> formatted list of world countries. It is useful when presenting a country options list from any application.

## Get the list of countries

To send a GET request to the REST API Countries list, you have to provide the Content Type header `application/vnd.ez.api.CountriesList+xml`.

**Countries list request**

``` brush:
Resource: /api/ezp/v2/services/countries
Method: GET
Content-Type: application/vnd.ez.api.CountriesList+xml
```

See the [General REST usage documentation page](General-REST-usage_31430291.html) for further information.<a href="https://gist.github.com/bdunogier/8665017#example"></a>

### Usage example

 

**Countries list request**

``` brush:
GET /api/ezp/v2/services/countries 
Host: example.com 
Accept: application/vnd.ez.api.CountriesList+xml
```

 

The HTTP response will it be with a 200 OK Header.

**Countries list response headers**

``` brush:
HTTP/1.1 200 
Content-Type: application/vnd.ez.api.CountriesList+xml
```

 

And the body of the Response is XML formatted country list with names and codes according to the ISO-3166 standard. 

ISO-3166

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
The **country codes** can be represented either as a two-letter code (alpha-2) which is recommended as the general purpose code, a three-letter code (alpha-3) which is more closely related to the country name and a three digit numeric code (numeric-3) which can be useful if you need to avoid using Latin script.

See <a href="http://www.iso.org/iso/home/standards/country_codes/country_codes_glossary.htm">the ISO-3166 glossary</a> for more information.
 

**Body XML Response**

``` brush:
<CountriesList>
  <Country id="AF">
    <name>Afghanistan</name
    <alpha2>AF</alpha2>
    <alpha3>AFG</alpha3>
    <idc>93</idc>
  </Country>
  <Country id="AX">
    <name>Åland</name
    <alpha2>AX</alpha2>
    <alpha3>ALA</alpha3>
    <idc>358</idc>
  </Country>
  ...
</CountriesList>
```

 

 

#### In this topic:

-   [Get the list of countries](#RESTAPICountrieslist-Getthelistofcountries)
    -   [Usage example](#RESTAPICountrieslist-Usageexample)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[API](API_31429524.html)</span>

 Developer : REST API Guide 



The REST API v2 introduced in eZ Platform allows you to interact with an eZ Platform installation using the HTTP protocol, following a <a href="http://en.wikipedia.org/wiki/Representational_state_transfer">REST</a> interaction model.

## Accessing the REST API

The REST API is available at the URI `/api/ezp/v2` . HTTPS is available as long as your server is properly configured. Refer to the <span class="confluence-link">[Getting started with the REST API](Getting-started-with-the-REST-API_31430289.html)</span> page to start using the API.

## Basics

REST (**RE**presentational **S**tate **T**ransfer) is a web services architecture that follows the HTTP Protocol very closely. The eZ Platform REST API supports both <a href="http://www.json.org/">JSON</a> and <a href="http://www.w3.org/XML/">XML</a> in terms of request format.

### Resources

The API provides a set of URIs, each of them identifying and providing access to operations on a certain resource. For instance, the URI `/content/objects/59` will allow you to interact with the Content with ID 59, while `/content/types/1` will allow you to interact with the Content Type with ID 1.

### HTTP verbs

It uses HTTP verbs ( **`GET`** , **`POST`** , but also **`PUT`** , **`DELETE`** , etc...), as well as HTTP headers to specify the type of request. Depending on the used HTTP verb, different actions will be possible. Example:

-   `        GET  /content/objects/2     ` will provide you with data about Content \#2,
-   `        PATCH  /content/objects/2     ` will update the Content \#2's metadata (section, main language, main location...),
-   `        DELETE  /content/objects/2     ` will delete Content \#2,
-   `        COPY  /content/objects/2     ` will create a copy of this Content.

Caution with custom HTTP verbs

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Using custom HTTP verbs, those besides the standard (GET, POST, PUT, DELETE, OPTIONS, TRACE), can cause issues with several HTTP proxies, network firewall/security solutions and simpler web servers. To avoid issues with this REST API allows you to set these using a HTTP header instead using HTTP verb POST. Example: `X-HTTP-Method-Override: PUBLISH`

 

### Media type headers

On top of verbs, HTTP request headers will allow you to personalize the request's behavior. On every resource, you can use the Accept header to indicate which format you want to communicate in, JSON or XML. This header is also used to specify the response type you want the server to send when multiple ones are available.

-   `Accept: application/vnd.ez.api.Content+xml     ` to get **Content** (full data, fields included) as **XML**
-   `Accept: application/vnd.ez.api.ContentInfo+json     ` to get **ContentInfo** (metadata only) as **JSON**

More information

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<a href="https://github.com/ezsystems/ezp-next/blob/master/doc/specifications/rest/REST-API-V2.rst#111%C2%A0%C2%A0%C2%A0media-types">REST specifications chapter &quot;Media Types&quot;</a>

### Other headers

Other headers will be used in HTTP requests for specifying the siteaccess to interact with, and of course [authentication credentials](REST-API-Authentication_31430293.html).

Responses returned by the API will also use custom headers to indicate information about the executed operation.

 

#### In this topic:

-   [Accessing the REST API](#RESTAPIGuide-AccessingtheRESTAPI)
-   [Basics](#RESTAPIGuide-Basics)
    -   [Resources](#RESTAPIGuide-Resources)
    -   [HTTP verbs](#RESTAPIGuide-HTTPverbs)
    -   [Media type headers](#RESTAPIGuide-Mediatypeheaders)
    -   [Other headers](#RESTAPIGuide-Otherheaders)

#### Related topics:

-   [REST API reference](REST-API-reference_31430594.html)
-   [Getting started with the REST API](Getting-started-with-the-REST-API_31430289.html)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[API](API_31429524.html)</span>
4.  <span>[REST API Guide](REST-API-Guide_31430286.html)</span>

 Developer : REST API reference 



The complete reference (specification) of the REST API resources is found bundled with your software, or online:

REST API reference

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Path to where you can find specification of the version you have:

`vendor/ezsystems/ezpublish-kernel/doc/specifications/rest/REST-API-V2.rst`

Online version for latest version:

`https://github.com/ezsystems/ezpublish-kernel/blob/master/doc/specifications/rest/REST-API-V2.rst`

## About the REST specification structure

Resources are grouped by chapters: <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/doc/specifications/rest/REST-API-V2.rst#content">Content</a>, <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/doc/specifications/rest/REST-API-V2.rst#content-types">Content Types</a> and <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/doc/specifications/rest/REST-API-V2.rst#user-management">User</a>. In each of those chapters, you will first get an overview, with a table crossing every resource with every applicable HTTP verb, and giving you a summary of the action.

Then throughout the chapter, grouped into sub-chapters, is the detailed documentation for every resource, with:

-   The resource string
-   The HTTP verb with override, if applicable
-   A description of what this resource does
-   Which headers are supported, and how to use them
-   Which error codes can occur
-   Most of the time, a request + response example

 

 

#### Related topics:

[REST API Guide](REST-API-Guide_31430286.html)

[Getting started with the REST API](Getting-started-with-the-REST-API_31430289.html)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>
6.  <span>[Content items, Content Types and Fields](31430275.html)</span>
7.  <span>[Field Types reference](Field-Types-reference_31430495.html)</span>

 Developer : Rating Field Type 



This Field Type is used to provide rating functionality.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Rating Field Type does not provide the APIs for actual rating, this part is provided by Legacy Stack extension that can be found at <a href="https://github.com/ezsystems/ezstarrating" class="uri">https://github.com/ezsystems/ezstarrating</a>.

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Internal name</th>
<th align="left">Expected input</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>Rating</code></td>
<td align="left"><p><code>ezsrrating</code></p></td>
<td align="left"><code>boolean</code></td>
</tr>
</tbody>
</table>

## PHP API Field Type 

### Input expectations

| Type      | Description                                  | Example |
|-----------|----------------------------------------------|---------|
| `boolean` | Denotes if the rating is enabled or disabled | `true`  |

### Value Object

##### Properties

**`eZ\Publish\Core\FieldType\Rating\Value`** offers the following properties.

| Property     | Type      | Description                                               | Example |
|--------------|-----------|-----------------------------------------------------------|---------|
| `isDisabled` | `boolean` | <span>Denotes if the rating is enabled or disabled</span> | `true`  |

### Hash format

Hash matches the Value Object, having only one property:

-   `isDisabled`

### Settings

The Field Type does not support settings.

### Validation

The Field Type does not support validation.

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : Recommendation 



The Recommendation Bundle extends the functionality of eZ with a recommendation engine, powered by <a href="https://yoochoose.com/">YOOCHOOSE</a>. It allows you to track the way visitors use your website and suggests recommended content to them based on their behavior.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
See <a href="https://yoochoose.com/Personalization-Solution/Documentation" class="uri">https://yoochoose.com/Personalization-Solution/Documentation</a> to learn how the recommendation engine works from the YOOCHOOSE side.

# Installing the Recommendation Bundle

The Recommendation Bundle is installed in a similar way as any other Symfony bundle.

## Requirements

-   PHP 5.4.4 *or higher PHP 5.x version*
-   Symfony 2.7 *or higher Symfony* 2.x version** *
    *
-   eZ Platform/Enterprise v1.0+, with the REST API configured to use sessions and publicly open to the YOOCHOOSE servers
-   A YOOCHOOSE license

This bundle is independent from the `ezrecommendation` extension used in legacy, and does not require it.

## Step 1: Installation

**1.** Run the following from your eZ Platform installation root *(here with most recent 1.x release)*:

``` brush:
composer require --no-update ezsystems/recommendation-bundle:^1.0.0
composer update --prefer-dist
```

**2.** Enable the bundle in `app/AppKernel.php`:

``` brush:
$bundles = array(
    // existing bundles
    new EzSystems\RecommendationBundle\EzSystemsRecommendationBundle()
);
```

**3.** Import additional routing by adding following lines to your `routing.yml` file:

``` brush:
recommendationBundleRestRoutes:
    resource: "@EzSystemsRecommendationBundle/Resources/config/routing_rest.yml"
    prefix:   %ezpublish_rest.path_prefix%
```

Keep in mind that legacy support is disabled by default. To enable legacy search engine (requires `ezpublish-kernel` bundle) uncomment these lines in the bundle's `services.yml`:

``` brush:
# ez_recommendation.legacy.search_engine:
#     class: ezpSearchEngine
#     factory_class: EzSystems\RecommendationBundle\eZ\Publish\LegacySearch\LegacySearchFactory
#     factory_method: build
#     arguments: [@ezpublish_legacy.kernel]

# ez_recommendation.legacy.recommendation_search_engine:
#     class: EzSystems\RecommendationBundle\eZ\Publish\LegacySearch\RecommendationLegacySearchEngine
#     arguments:
#         - @ez_recommendation.client.yoochoose_notifier
#         - @ez_recommendation.legacy.search_engine

# ez_recommendation.legacy.search_configuration_mapper:
#     class: EzSystems\RecommendationBundle\eZ\Publish\LegacySearch\ConfigurationMapper
#     arguments:
#         - @ez_recommendation.legacy.recommendation_search_engine
#         - @ezpublish.siteaccess
#     tags:
#         - { name: kernel.event_subscriber }
```

## Step 2: Configuration

The bundle's configuration is siteaccess-aware. This is an example of settings *(config.yml)*:

``` brush:
ez_recommendation:
    system:
        default:
            yoochoose:
                customer_id: "12345"
                license_key: "1234-5678-9012-3456-7890"
            server_uri: "http://example.com"
            recommender:
                included_content_types: ["blog", "article"]
```

The following parameters need to be included in the settings file:

| Parameter                            | Description                                                                                                                   |
|--------------------------------------|-------------------------------------------------------------------------------------------------------------------------------|
| yoochoose.customer\_id               | Your YOOCHOOSE customer ID.                                                                                                   |
| yoochoose.license\_key               | Your YOOCHOOSE license key.                                                                                                   |
| server\_uri                          | The URI your site's REST API can be accessed from.                                                                            |
| recommender.included\_content\_types | Content Types on which the tracking script will be shown. See [Tracking](#Recommendation-Tracking)below for more information. |

If content's author or image are stored in different field, you can specify it in **parameters.yml:**

**Format**

``` brush:
    ez_recommendation.field_identifiers:
        {field fetched by controller (image or author)}
             {content type}: {field with value}
```

For example:

**Actual example**

``` brush:
    ez_recommendation.field_identifiers:
         author:
             article: authors
         image:
             article: thumbnail
             blog_post: main_image
```

### Advanced configuration

You can select advanced options for YOOCHOOSE back end using the following settings:

``` brush:
ez_recommendation:
    api_endpoint: 'https://admin.yoochoose.net'
    recommender:
        api_endpoint: 'http://reco.yoochoose.net'
        consume_timeout: 20
    tracking:
        api_endpoint: 'http://event.yoochoose.net'
        script_url: 'cdn.yoochoose.net/yct.js'
```

Changing any of these parameters without a valid reason will break all calls to YOOCHOOSE. It can be useful to test the API by mocking the service, or if you have a hosted version of YOOCHOOSE Recommendation service.

## Step 3: Clear `prod` cache

While Symfony `dev` environment keeps track of changes to yml files, `prod` does not, so to make sure Symfony reads the new config, clear cache:

``` brush:
php app/console --env=prod clear:cache
```

# Using the Recommendation Bundle

## Initial Setup

Your content structure must be mapped to the YOOCHOOSE domain model. This must be done in collaboration with YOOCHOOSE.

## Indexing

**Public** content is automatically indexed. When necessary, eZ Platform will notify YOOCHOOSE of changes to content. Initial import is to be managed with your YOOCHOOSE sales representative. Note that your server's REST API will need to be open to the YOOCHOOSE servers for indexing to be possible.

## <span id="Recommendation-Tracking" class="confluence-anchor-link"></span>Tracking

Events from the site need to be sent to YOOCHOOSE so that recommendations can be adapted to visitors. Tracking can be set up in multiple ways, depending on existing constraints.

`EzSystemsRecommendationBundle` delivers a Twig extension which helps integrate the tracking functionality into your site.

#### To enable tracking

**1.** Place the following snippet of code somewhere in the HEAD section of your header template:

``` brush:
{% if content is defined %}
    {{ yc_track_user(content.id) }}
{% endif %}
```

**2.** Configure settings under the `recommender.included_content_types` parameter (see the `               default_settings.yml             ` file delivered with this bundle). Here you can define for which Content Types tracking script will be shown.

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
In the YOOCHOOSE documentation you can find more information about <a href="https://doc.yoochoose.net/display/PUBDOC/1.+Tracking+Events">tracking in general</a> and about the <a href="https://doc.yoochoose.net/display/PUBDOC/Tracking+with+yc.js">generic asynchronous javascript tracker</a>.

Additionally, in case of missing content owner ID, there's an option in `default_settings.yml` to set up the default content author:

``` brush:
    ez_recommendation.default.author_id: 14   # ID: 14 is default ID of admin user
```

## Displaying

In order to allow displaying recommendations on your site you must add portions of scripts which will integrate the recommender engine with your site.

Implementation is very easy and can be performed in just a few steps (assuming that the `EzSystemsRecommendationBundle` is properly configured and enabled in `AppKernel.php`):

#### To enable displaying recommendations

**1.** Add the following JavaScript assets to your header template:

``` brush:
{% javascripts
    ...

    '%kernel.root_dir%/../vendor/components/handlebars.js/handlebars.min.js'
    '@EzSystemsRecommendationBundle/Resources/public/js/recommendationtemplaterenderer.js'
    '@EzSystemsRecommendationBundle/Resources/public/js/recommendationtemplatehelper.js'
    '@EzSystemsRecommendationBundle/Resources/public/js/recommendationrestclient.js'
%}
```

**2.** Place a dedicated Twig helper in the place where you want to display recommendations:

``` brush:
{{ yc_show_recommendations(
    contentId = content.id,
    scenario = '',
    limit = '',
    contentType = '',
    template = '',
    fields = []
) }}
```

#### Parameters

| Parameter   | Type   | Description                                                                                                                                                                                                                                           |
|-------------|--------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| contentId   | int    | In content-based views the Twig variable holding the content ID (the content you want to get recommendations for).                                                                                                                                    |
| scenario    | string | Scenario used to display recommendations. You can create custom scenarios at the YOOCHOOSE dashboard.                                                                                                                                                 |
| limit       | int    | Number of recommendations to show.                                                                                                                                                                                                                    |
| contentType | string | Content Types you are expecting in response.                                                                                                                                                                                                          |
| template    | string | HandleBars template name (your templates are stored in the` ezsystems/recommendation-bundle/Resources/public/views` directory. Take a look at `default.html.twig` which includes a default template that can be used to prepare customized versions). |
| fields      | array  | Fields which are required and will be requested from the recommender engine. These field names are also used inside HandleBars templates.                                                                                                             |

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Sample integration can take the following form:

``` brush:
{{ yc_show_recommendations(
    contentId = content.id,
    scenario = 'popular',
    limit = 5,
    contentType = 'article',
    template = 'default',
    fields = ['ez_publishedDate', 'ez_url', 'title', 'image', 'author', 'intro']
) }}
```

You can also bypass named arguments using standard value passing as arguments.

#### Item ID

The item ID is usually set to the viewed ContentId. Depending on requirements, it can be set to a different value, in collaboration with YOOCHOOSE.

#### Displaying image aliases

Displaying image variations defined with image aliases is not currently supported out of the box.

You can work around this limitation by creating your own template (based on <a href="https://github.com/ezsystems/ezstudio-demo/blob/master/app/Resources/EzSystemsRecommendationBundle/views/recommendations.html.twig" class="uri">https://github.com/ezsystems/ezstudio-demo/blob/master/app/Resources/EzSystemsRecommendationBundle/views/recommendations.html.twig</a>) or your own Twig extension (based on <a href="https://github.com/ezsystems/EzSystemsRecommendationBundle/blob/master/Twig/RecommendationTwigExtension.php#L214" class="uri">https://github.com/ezsystems/EzSystemsRecommendationBundle/blob/master/Twig/RecommendationTwigExtension.php#L214</a>).

If you want to access a specific image alias through API, you need to add the `image` parameter to the request url with name of alias as its value, for example:

`/api/ezp/v2/ez_recommendation/v1/contenttypes/16?lang=eng-GB&fields=title,description,image,intro,name&page=1&page_size=20&image=rss`

to retrieve the `rss` alias of the image.

<span class="status-macro aui-lozenge aui-lozenge-current">V1.6</span>

As of v1.6, one more parameter is available: `sa`, which takes the siteaccess name and defines the siteaccess whose content will be displayed.

## Troubleshooting

Most operations are logged via the `ez_recommendation` <a href="http://symfony.com/doc/current/cookbook/logging/channels_handlers.html">Monolog channel</a>. To log everything about Recommendation to `dev.recommendation.log`, add the following to your `config.yml`:

``` brush:
monolog:
    handlers:
        ez_recommendation:
            type:   stream
            path:   "%kernel.logs_dir%/%kernel.environment%.recommendation.log"
            channels: [ez_recommendation]
            level: info
```

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
You can replace `info` with `debug` for more verbosity.

 

 

#### In this topic:

-   [Installing the Recommendation Bundle](#Recommendation-InstallingtheRecommendationBundle)
    -   [Requirements](#Recommendation-Requirements)
    -   [Step 1: Installation](#Recommendation-Step1:Installation)
    -   [Step 2: Configuration](#Recommendation-Step2:Configuration)
        -   [Advanced configuration](#Recommendation-Advancedconfiguration)
    -   [Step 3: Clear prod cache](#Recommendation-Step3:Clearprodcache)
-   [Using the Recommendation Bundle](#Recommendation-UsingtheRecommendationBundle)
    -   [Initial Setup](#Recommendation-InitialSetup)
    -   [Indexing](#Recommendation-Indexing)
    -   [Tracking](#Recommendation-TrackingTracking)
    -   [Displaying](#Recommendation-Displaying)
    -   [Troubleshooting](#Recommendation-Troubleshooting)

#### Further information:

<a href="http://docs.ezreco.apiary.io/">API doc for YOOCHOOSE Service</a>

<a href="https://doc.yoochoose.net/display/PUBDOC/Developer+Guide">Developer Guides for YOOCHOOSE Service</a>






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[API](API_31429524.html)</span>
4.  <span>[Field Type API and best practices](Field-Type-API-and-best-practices_31430767.html)</span>

 Developer : Register Field Type 



# Introduction

This document explains how to register a custom Field Type in eZ Platform. It will not contain the development part as it is already covered [in the API section](Field-Type-API-and-best-practices_31430767.html).

Please be sure you first have read the [basic documentation on how to develop a custom Field Type](Field-Type-API-and-best-practices_31430767.html).

# Service container configuration

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
To be able to declare a FieldType, you need to have <a href="http://symfony.com/doc/master/book/page_creation.html#the-bundle-system">registered a bundle in your application kernel</a>.

This bundle needs to expose some configuration for the service container somehow (read <a href="http://symfony.com/doc/master/book/service_container.html#importing-other-container-configuration-resources">related Symfony documentation</a>)

## Basic configuration

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
This part relates to the [base FieldType class that interacts with the Publish API](Field-Type-API-and-best-practices_31430767.html#FieldTypeAPIandbestpractices-PublicAPIinteraction).

Let's take a basic example from `ezstring` configuration.

``` brush:
parameters:
    ezpublish.fieldType.ezstring.class: eZ\Publish\Core\FieldType\TextLine\Type
 
services:
    ezpublish.fieldType.ezstring:
        class: %ezpublish.fieldType.ezstring.class%
        parent: ezpublish.fieldType
        tags:
            - {name: ezpublish.fieldType, alias: ezstring}
```

So far, this is a regular service configuration but 2 parts worth particular attention.

-   `parent`

As described in the <a href="http://symfony.com/doc/master/components/dependency_injection/parentservices.html">Symfony Dependency Injection Component documentation</a>, the `parent` config key indicates that you want your service to inherit from the parent's dependencies, including constructor arguments and method calls. This is actually a helper avoiding repetition in your field type configuration and keeping consistency between all field types.

-   `tags`

Tagging your field type service with **`ezpublish.fieldType`** is mandatory to be recognized by the API loader as a regular field type, the `alias` key being simply the *fieldTypeIdentifier* (formerly called *datatype string*)

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Basic field types configuration is located in <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Bundle/EzPublishCoreBundle/Resources/config/fieldtypes.yml">EzPublishCoreBundle/Resources/config/fieldtypes.yml</a>.

## Legacy Storage Engine

### Converter

As stated in [Field Type API & best practices](Field-Type-API-and-best-practices_31430767.html#FieldTypeAPIandbestpractices-LegacyStorageconversion), a conversion of Field Type values is needed in order to properly store the data into the *old* database schema (aka *Legacy Storage*).

Those converters also need to be correctly exposed as services.

**Field Type converter for ezstring**

``` brush:
parameters:
    ezpublish.fieldType.ezstring.converter.class: eZ\Publish\Core\Persistence\Legacy\Content\FieldValue\Converter\TextLine
 
services:
    ezpublish.fieldType.ezstring.converter:
        class: %ezpublish.fieldType.ezstring.converter.class%
        tags:
            - {name: ezpublish.storageEngine.legacy.converter, alias: ezstring, lazy: true, callback: '::create'}
```

Here again we need to tag our converter service, with **`ezpublish.storageEngine.legacy.converter`** tag this time.

As for the tag attributes:

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Attribute name</th>
<th align="left">Usage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>alias</code></td>
<td align="left">Represents the <em>fieldTypeIdentifier</em> (just like for the FieldType service)</td>
</tr>
<tr class="even">
<td align="left"><code>lazy</code></td>
<td align="left"><p>Boolean indicating if the converter should be lazy loaded or not.</p>
<p>Performance wise, it is recommended to set it to <strong>true</strong> unless you have very specific reasons.</p></td>
</tr>
<tr class="odd">
<td align="left"><code>callback</code></td>
<td align="left"><p>If <code>lazy</code> is set to true, it represents the callback that will be called to build the converter. <a href="http://php.net/manual/en/language.types.callable.php">Any valid callback</a> can be used.</p>
<p>Note that if the callback is defined in the converter class, the class name can be omitted.<br />
This way, in the example above, the full callback will be resolved to <code>eZ\Publish\Core\Persistence\Legacy\Content\FieldValue\Converter\TextLine::create</code></p></td>
</tr>
</tbody>
</table>

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
The converter configuration for basic field types are located in <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Bundle/EzPublishCoreBundle/Resources/config/storage_engines.yml">EzPublishCoreBundle/Resources/config/storage_engines.yml</a>.

### External storage

A Field Type has the [ability to store its value (or part of it) in external data sources](Field-Type-API-and-best-practices_31430767.html#FieldTypeAPIandbestpractices-Storingexternaldata). This is made possible through the `eZ\Publish\SPI\FieldType\FieldStorage` interface. Thus, if one wants to use this functionality, he needs to define a service implementing this interface and tagged as **`ezpublish.fieldType.externalStorageHandler`** to be recognized by the Repository.

Here is an example for **ezurl** field type:

**External storage handler for ezurl**

``` brush:
parameters:
    ezpublish.fieldType.ezurl.externalStorage.class: eZ\Publish\Core\FieldType\Url\UrlStorage
 
services:
    ezpublish.fieldType.ezurl.externalStorage:
        class: %ezpublish.fieldType.ezurl.externalStorage.class%
        tags:
            - {name: ezpublish.fieldType.externalStorageHandler, alias: ezurl}
```

The configuration is straight forward. Nothing specific except the **`ezpublish.fieldType.externalStorageHandler `**tag, the `alias` attribute still begin the *fieldTypeIdentifier*.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<span>External storage configuration for basic field types is located in </span><a href="https://github.com/ezsystems/ezp-next/blob/master/eZ/Bundle/EzPublishCoreBundle/Resources/config/fieldtypes.yml">EzPublishCoreBundle/Resources/config/fieldtypes.yml</a><span>.</span>

### Gateway based storage

As stated in the [Field Type best practices](Field-Type-API-and-best-practices_31430767.html#FieldTypeAPIandbestpractices-GatewaybasedStorage), in order to be storage agnostic and external storage handler should use a *storage gateway*. This can be done by implementing another service implementing <span>`eZ\Publish\Core\FieldType\StorageGateway` and being tagged as `ezpublish.fieldType.externalStorageHandler.gateway`.</span>

**Storage gateway for ezurl**

``` brush:
parameters:
    ezpublish.fieldType.ezurl.storage_gateway.class: eZ\Publish\Core\FieldType\Url\UrlStorage\Gateway\LegacyStorage
 
services:
    ezpublish.fieldType.ezurl.storage_gateway:
        class: %ezpublish.fieldType.ezurl.storage_gateway.class%
        tags:
            - {name: ezpublish.fieldType.externalStorageHandler.gateway, alias: ezurl, identifier: LegacyStorage}
```

| Attribute name | Usage                                                                                                |
|----------------|------------------------------------------------------------------------------------------------------|
| `alias`        | <span>Represents the </span>*fieldTypeIdentifier*<span> (just like for the FieldType service)</span> |
| `identifier`   | Identifier for the gateway.                                                                          
                  Must be unique per storage engine. *LegacyStorage* is the convention name for Legacy Storage Engine.  |

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<span>For this to work properly, your storage handler must inherit from </span><span>`eZ\Publish\Core\FieldType\GatewayBasedStorage`.</span>

<span>Also note that there can be several gateways per field type (one per storage engine basically).</span>

<span><span>The gateway configuration for basic field types are located in </span><a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Bundle/EzPublishCoreBundle/Resources/config/storage_engines.yml">EzPublishCoreBundle/Resources/config/storage_engines.yml</a><span>.</span></span>

 

 

#### In this topic:

-   [Introduction](#RegisterFieldType-Introduction)
-   [Service container configuration](#RegisterFieldType-Servicecontainerconfiguration)
    -   [Basic configuration](#RegisterFieldType-Basicconfiguration)
    -   [Legacy Storage Engine](#RegisterFieldType-LegacyStorageEngine)
        -   [Converter](#RegisterFieldType-Converter)
        -   [External storage](#RegisterFieldType-Externalstorage)
        -   [Gateway based storage](#RegisterFieldType-Gatewaybasedstorage)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>
4.  <span>[Creating a Tweet Field Type](Creating-a-Tweet-Field-Type_31429766.html)</span>

 Developer : Register the Field Type as a service 



To complete the implementation, we must register our Field Type with Symfony by creating a service for it.

Services are by default declared by bundles in `Resources/config/services.yml`.

Using a dedicated file for the Field Type services

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
In order to be closer to the kernel best practices, we could declare our Field Type services in a custom `fieldtypes.yml` file.

All we have to do is instruct the bundle to actually load this file in addition to `services.yml` (or instead of `services.yml`!). This is done in the extension definition file, `         DependencyInjection/EzSystemsTweetFieldTypeExtension.php`, in the `         load()` method.

Inside this file, find this line:

``` brush:
$loader->load('services.yml');
```

This is where our bundle tells Symfony that when parameters are loaded, `services.yml` should be loaded from `Resources/config/` (defined above). Either replace the line, or add a new one with:

``` brush:
$loader->load('fieldtypes.yml');
```

 

Like most API components, Field Types use the <a href="http://symfony.com/doc/current/components/dependency_injection/tags.html">Symfony 2 service tag mechanism</a>.

The principle is quite simple: a service can be assigned one or several tags, with specific parameters. When the dependency injection container is compiled into a PHP file, tags are read by `CompilerPass` implementations that add extra handling for tagged services. Each service tagged as `       ezpublish.fieldType` is added to a <a href="http://martinfowler.com/eaaCatalog/registry.html">registry</a> using the alias argument as its unique identifier (`ezstring`, `ezxmltext`, etc.).  Each Field Type must also inherit from the abstract ezpublish.fieldType service. This ensures that the initialization steps shared by all Field Types are executed.

Here is the service definition for our Tweet type:

 

**Resources/config/services.yml**

``` brush:
parameters:
    ezsystems.tweetfieldtypebundle.fieldType.eztweet.class: EzSystems\TweetFieldTypeBundle\eZ\Publish\FieldType\Tweet\Type
 
services:
    ezsystems.tweetfieldtypebundle.fieldType.eztweet:
        parent: ezpublish.fieldType
        class: %ezsystems.tweetfieldtypebundle.fieldType.eztweet.class%
        tags:
            - {name: ezpublish.fieldType, alias: eztweet}
```

We take care of namespacing our Field Type with our vendor and bundle name to limit the risk of naming conflicts.

**Tutorial path**






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>
6.  <span>[Content items, Content Types and Fields](31430275.html)</span>
7.  <span>[Field Types reference](Field-Types-reference_31430495.html)</span>

 Developer : Relation Field Type 



This Field Type represents a relation to a Content item.

| Name       | Internal name      | Expected input |
|------------|--------------------|----------------|
| `Relation` | `ezobjectrelation` | `mixed`        |

## Description

This Field Type makes it possible to store and retrieve the value of relation to a Content item.

## PHP API Field Type 

### Input expectations

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>string</code></td>
<td align="left"><pre><code>&quot;150&quot;</code></pre></td>
</tr>
<tr class="even">
<td align="left"><code>integer</code></td>
<td align="left"> 150</td>
</tr>
</tbody>
</table>

### Value object

##### Properties

The Value class of this Field Type contains the following properties:

| Property                | Type              | Description                                                                                       |
|-------------------------|-------------------|---------------------------------------------------------------------------------------------------|
| `$destinationContentId` | `string|int|null` | This property will be used to store the value provided, which will represent the related content. |

**Value object content example**

``` brush:
$relation->destinationContentId = $contentInfo->id;
```

##### Constructor

The `Relation``\Value` constructor will initialize a new Value object with the value provided. It expects a mixed value.

**Constructor example**

``` brush:
// Instantiates a Relation Value object
$relationValue = new Relation\Value( $contentInfo->id );
```

### Validation

This Field Type validates whether the provided relation exists, but before it does that it will check that the value is either string or int.

### Settings

The field definition of this Field Type can be configured with two options:

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Type</th>
<th align="left">Default value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>selectionMethod</code></td>
<td align="left"><code>int</code></td>
<td align="left"><code>self::SELECTION_BROWSE</code></td>
<td align="left"><p>This setting defines the selection method. It expects an integer (0/1). 0 stands for <code>self::SELECTION_BROWSE</code>, 1 stands for <code>self::SELECTION_DROPDOWN</code>.</p>
<p> </p>
<div class="confluence-information-macro confluence-information-macro-information">
<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
<div class="confluence-information-macro-body">
<p>NOTE: Dropdown not implemented in Platform UI yet, only browse is used currently.</p>
</div>
</div></td>
</tr>
<tr class="even">
<td align="left"><code>selectionRoot</code></td>
<td align="left"><code>string</code></td>
<td align="left"><code>null</code></td>
<td align="left">This setting defines the selection root.</td>
</tr>
</tbody>
</table>

**Relation FieldType example settings**

``` brush:
use eZ\Publish\Core\FieldType\Relation\Type;

$settings = array(
    "selectionMethod" => 1,
    "selectionRoot" => null
);
```

Note: These settings are meant for future use in user interface when allowing users to select relations.

 

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>
6.  <span>[Content items, Content Types and Fields](31430275.html)</span>
7.  <span>[Field Types reference](Field-Types-reference_31430495.html)</span>

 Developer : RelationList Field Type 



This Field Type represents one or multiple relations to content.

| Name           | Internal name          | Expected input |
|----------------|------------------------|----------------|
| `RelationList` | `ezobjectrelationlist` | `mixed`        |

## Description

This Field Type makes possible to store and retrieve values of relation to content.

## PHP API Field Type 

### Input expectations

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"><div class="tablesorter-header-inner">
Type
</div></th>
<th align="left"><div class="tablesorter-header-inner">
Description
</div></th>
<th align="left"><div class="tablesorter-header-inner">
Example
</div></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>int|string</code></td>
<td align="left">Id of the related Content item</td>
<td align="left"><code>42</code></td>
</tr>
<tr class="even">
<td align="left"><code>array</code></td>
<td align="left">An array of related Content IDs</td>
<td align="left"><code>array( 24, 42 )</code></td>
</tr>
<tr class="odd">
<td align="left"><pre><code>eZ\Publish\API\Repository\Values\Content\ContentInfo</code></pre></td>
<td align="left"><p>ContentInfo instance of the related Content</p></td>
<td align="left"> </td>
</tr>
<tr class="even">
<td align="left"><code>eZ\Publish\Core\FieldType\RelationList\Value</code></td>
<td align="left">RelationList Field Type Value Object</td>
<td align="left">See Value Object documentation section below.</td>
</tr>
</tbody>
</table>

### Value Object

##### Properties

`eZ\Publish\Core\FieldType\RelationList\Value` contains following properties.

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Property</th>
<th align="left">Type</th>
<th align="left">Description</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><code>destinationContentIds</code></p></td>
<td align="left"><code>array</code></td>
<td align="left">An array of related Content ids</td>
<td align="left"><code>array( 24, 42 )</code></td>
</tr>
</tbody>
</table>

**Value object content example**

``` brush:
$relationList->destinationContentId = array( 
    $contentInfo1->id,
    $contentInfo2->id,
    170
);
```

##### Constructor

The `RelationList``\Value` constructor will initialize a new Value object with the value provided. It expects a mixed array as value.

**Constructor example**

``` brush:
// Instantiates a RelationList Value object
$relationListValue = new RelationList\Value(
    array(
        $contentInfo1->id,
        $contentInfo2->id,
        170     
    )
);
```

### Validation

This Field Type validates if the `selectionMethod` specified is 0 (`self::SELECTION_BROWSE)` or 1 (`self::SELECTION_DROPDOWN)`. A validation error is thrown if the value does not match.

Also validates if the `selectionDefaultLocation` specified is <span class="s2">`null`, `string` or `integer`</span>. If the type validation fails a validation error is thrown.

And validates if the value specified in `selectionContentTypes` is an array. If not, a validation error in given.

### Settings

The field definition of this Field Type can be configured with following options:

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Type</th>
<th align="left">Default value</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><code>selectionMethod</code></p></td>
<td align="left"><code>mixed</code></td>
<td align="left"><pre><code>SELECTION_BROWSE</code></pre></td>
<td align="left">Method of selection in the administration interface</td>
</tr>
<tr class="even">
<td align="left"><p><code>selectionDefaultLocation</code></p></td>
<td align="left"><code>string|integer</code></td>
<td align="left"><code>null</code></td>
<td align="left">Id of the default Location for the selection when using administration interface</td>
</tr>
<tr class="odd">
<td align="left"><p><code>selectionContentTypes</code></p></td>
<td align="left"><code>array</code></td>
<td align="left"><code>array()</code></td>
<td align="left">An array of ContentType ids that are allowed for related Content</td>
</tr>
</tbody>
</table>

Following selection methods are available:

| Name                | Description                                                                                                   |
|---------------------|---------------------------------------------------------------------------------------------------------------|
| SELECTION\_BROWSE   | Selection will use browse mode                                                                                |
| SELECTION\_DROPDOWN | Selection control will use dropdown control containing the Content list in the default Location for selection |

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
NOTE: Dropdown not implemented in Platform UI yet, only browse is used currently.

**Example of using settings in PHP**

``` brush:
use eZ\Publish\Core\FieldType\RelationList\Type;

$settings = array(
    "selectionMethod" => Type::SELECTION_BROWSE,
    "selectionDefaultLocation" => null,
    "selectionContentTypes" => array()
 );
```

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Releases](Releases_31429534.html)</span>

 Developer : Release Notes 



This section lists release notes for the latest and previous versions of eZ Enterprise and eZ Platform.

Read about <a href="http://ez.no/Blog/eZ-Systems-Release-Cycles-and-Version-Names-Simplified">Release Cycles and Version Names</a> on our blog!

 

-   [eZ Platform v1.8.0](eZ-Platform-v1.8.0_33555269.html)
-   [eZ Platform v1.7.0 LTS](eZ-Platform-v1.7.0-LTS_32868941.html)
-   [eZ Platform and eZ Enterprise v1.6.0](eZ-Platform-and-eZ-Enterprise-v1.6.0_32867909.html)
-   [eZ Enterprise Release notes](eZ-Enterprise-Release-notes_31430108.html)
-   [eZ Platform Release notes](eZ-Platform-Release-notes_31429935.html)

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>

 Developer : Releases 



Here you can find release notes for the latest versions of <a href="https://ezplatform.com/">eZ Platform</a> and <a href="http://ez.no/Products/eZ-Platform-Enterprise-Edition2">eZ Platform EE</a>:

-   [Release Notes](Release-Notes_32867905.html)
    -   [eZ Platform v1.8.0](eZ-Platform-v1.8.0_33555269.html)
    -   [eZ Platform v1.7.0 LTS](eZ-Platform-v1.7.0-LTS_32868941.html)
    -   [eZ Platform and eZ Enterprise v1.6.0](eZ-Platform-and-eZ-Enterprise-v1.6.0_32867909.html)
    -   [eZ Enterprise Release notes](eZ-Enterprise-Release-notes_31430108.html)
    -   [eZ Platform Release notes](eZ-Platform-Release-notes_31429935.html)
-   [Updating eZ Platform](Updating-eZ-Platform_31431770.html)

Release notes for legacy products (eZ Platform's predecessors, "eZ Publish Platform" and "eZ Publish") are available here:

-   [Developer documentation for eZ Publish Platform (version 5.x)](https://doc.ez.no/display/EZP/eZ+Publish+5.x+Developer+Documentation)
-   [Developer documentation for eZ Publish (*legacy*)](https://doc.ez.no/eZ-Publish/)

 

**Release FAQ**

*Question*: Prior to the Long Term Support (LTS) release of eZ Platform v1.7.0, I see several different product names. How can I learn more about changes to product naming and features over the years?

*Answer:* eZ Platform and eZ Platform Enterprise Edition are the names of the latest versions. eZ Systems has a rich history of innovation and growth, represented by several iterations over almost two decades. As a result, it may be helpful to read more about that history if you are interested in the versions released prior to eZ Platform and eZ Platform Enterprise Edition version 1.7.0 (LTS) released on December 15, 2016, to help you navigate the product names and features from the past. Open Source Community Member and eZ Partner Gaetano Giunta (CTO of Kaliop UK) has contributed a recent blog post which you may find helpful: <a href="http://kaliop.co.uk/blog/A-rose-by-any-other-name" class="uri">http://kaliop.co.uk/blog/A-rose-by-any-other-name</a>






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : Repository 



# Introduction

## <span id="Repository-Locations" class="confluence-anchor-link"></span>Locations

A Content item could not function in the system without having a place – a Location – assigned to it. When a new Content item is published, a new Location is automatically created and the item is placed in it.

Together, all Locations form a tree which is the basic way of organizing Content in the system and specific to eZ products. Every published Content item has a Location and, as a consequence, also a place in this tree.

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
<sup>A\\ Content\\ item\\ receives\\ a\\ Location\\ only\\ once\\ it\\ has\\ been\\ published.\\ This\\ means\\ that\\ a\\ freshly\\ created\\ draft\\ does\\ not\\ have\\ a\\ Location\\ yet.</sup>

A Content item can have more than one Location. This can be used to have the same content in two or more places in the tree, for example an article at the same time on the front page and in the archive. Even in such a case, one of these places is always the Main Location.

The tree is hierarchical, with an empty root Location (which is not assigned any Content item) and a structure of dependent Locations below it. Every Location (aside from the root) has one parent Location and can have any number of children. There are no Locations outside this tree.

### Top level Locations

Top level Locations are direct children of the root of the tree. The root has ID Location 1, is not related to any Content items and should not be used directly.

Under this root there are preset top level Locations in each installation which cannot be deleted:

<span class="confluence-embedded-file-wrapper"><img src="attachments/31432023/32112932.png" class="confluence-embedded-image" /></span>

#### Content

"Content" is the top level Location for the actual contents of a site. This part of the tree is typically used for organizing folders, articles, information pages, etc. This means that it contains the actual content structure of the site, which can be viewed by selecting the "Content structure" tab in the Content mode interface. The default ID number of the "Content" Location is 2; it references a "Folder" Content item.

#### Media

"Media" is the top level Location which stores and organizes information that is frequently used by Content items located below the "Content" node. It usually contains images, animations, documents and other files. They can be viewed by selecting the "Media library" tab in the Content mode interface. The default ID number of the "Media" Location is 43; it references a "Folder" Content item.

#### Users

<span class="confluence-embedded-file-wrapper"><img src="attachments/31432023/32112931.png" class="confluence-embedded-image" /></span>

"Users" is the top level Location that contains the built-in system for managing user accounts. A user is simply a Content item of the "User account" Content Type. The users are organized within "User group" Content items below this Location. In other words, the "Users" Location contains the actual users and user groups, which can be viewed by selecting the "Users" tab in the Admin Panel. The default identification number of the "Users" Location is 5; it references a "User group" Content item.

#### Other top level Locations

Another top level location, with the ID 48, corresponds to "Setup" and is not regularly used to store content.

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
You should not add any more content directly below Location 1, but instead store any content under one of those top-level Locations.

### Location visibility

Location visibility is a mechanism which allows you to control which parts of the content tree are available to the visitor.

Given that once a Content item is published, it cannot be un-published, limiting visibility is the only method used to withdraw content from the website without moving it to Trash. When the Location of a Content item is hidden, any access to it will be denied, preventing the system from displaying it.

Visibility needs not be set individually for every Location. Instead, when a Location is hidden, all of its descendants in the tree will be hidden as well. This means that a Location can have one of three different visibility statuses:

-    Visible

-    Hidden

-    Hidden by superior

By default all Locations are Visible. If a Location is made invisible manually, its status is set to Hidden. At the same time all Locations under it will change status to Hidden by superior.

From the visitor's perspective a Location behaves the same whether its status is Hidden or Hidden by superior – it will be unavailable in the website. The difference is that a Location Hidden by superior cannot be revealed manually. It will only become visible once all of its ancestor Locations are made Visible again.

A Hidden by superior status does not override a Hidden status. This means that if a Location is Hidden manually and later one of its ancestors is Hidden as well, the first Location's status does not change – it remains Hidden (not Hidden by superior). If the ancestor Location is made visible again, the first Location still remains Hidden.

The way visibility works can be illustrated using the following scenarios:

##### Hiding a visible Location

<span class="confluence-embedded-file-wrapper"><img src="attachments/31432023/32112933.png" alt="Hiding a visible Location" class="confluence-embedded-image" /></span>

When you hide a Location that was visible before, it will get the status Hidden. Underlying Locations will be marked Hidden by superior. The visibility status of underlying Locations that were already Hidden or Hidden by superior will not be changed.

##### Hiding a Location which is Hidden by superior

<span class="confluence-embedded-file-wrapper"><img src="attachments/31432023/32112934.png" alt="Hiding a Location which is Hidden by superior" class="confluence-embedded-image" /></span>

 

When you explicitly hide a Location which was Hidden by superior, it will get the status Hidden. Since the underlying Locations are already either Hidden or Hidden by superior, their visibility status will not be changed.

##### Revealing a Location with a visible ancestor

<span class="confluence-embedded-file-wrapper"><img src="attachments/31432023/32112935.png" alt="Revealing a Location with a visible ancestor" class="confluence-embedded-image" /></span>

 

When you reveal a Location which has a visible ancestor, this Location and its children will become visible. However, underlying Locations that were explicitly hidden by a user will retain the Hidden status (and their children will be remain Hidden by superior).

##### Revealing a Location with a Hidden ancestor

<span class="confluence-embedded-file-wrapper"><img src="attachments/31432023/32112936.png" alt="Revealing a Location with a Hidden ancestor" class="confluence-embedded-image" /></span>

 

When you reveal a Location that has a Hidden ancestor, it will **not** become Visible itself. Because it still has invisible ancestors, its status will change to Hidden by superior.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
In short: a Location can only be Visible when all of its ancestors are Visible as well.

#### Visibility mechanics

The visibility mechanics are controlled by two flags: Hidden flag and Invisible flag. The Hidden flag informs whether the node has been hidden by a user or not. A raised Invisible flag means that the node is invisible either because it was hidden by a user or by the system. Together, the flags represent the three visibility statuses:

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Hidden flag</th>
<th align="left">Invisible flag</th>
<th align="left">Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">-</td>
<td align="left">-</td>
<td align="left">The Location is visible.</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">1</td>
<td align="left">The Location is invisible and it was hidden by a user.</td>
</tr>
<tr class="odd">
<td align="left">-</td>
<td align="left">1</td>
<td align="left"><p>The Location is invisible and it was hidden by the system because its ancestor is hidden/invisible.</p></td>
</tr>
</tbody>
</table>

Visibility and permissions

<span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
The Location visibility flag is not permission-based and thus acts as a simple potential filter. **It is not meant to restrict access to content**.

If you need to restrict access to a given Content item, use **Sections** or **Object states**, which are permission-based.

## Content Relations

Content items are located in a tree structure through the Locations they are placed in. However, Content items themselves can also be related to one another.

A Relation can be created between any two Content items in the repository. This feature is typically used in situations when you need to connect and/or reuse information that is scattered around in the system. For example, it allows you to add images to news articles. Instead of using a fixed set of image attributes, the images are stored as separate Content items outside the article.

There are different types of Relations available in the system. First of all, content can be related on item or on Field level.

Relations at Field level are created using one of two special Field Types: Content relation (single) and Content relations (multiple). As the names suggest, such Fields allow you to select one or more other Content items in the Field value, which will be linked to these Fields. Content relation (single) is an example of a one-to-one relationship, and Content relations (multiple) – a one-to-many relationship.

Relations at item level can be of three different types:

1.  Common relations are created between two Content items using the Public API.
2.  RichText linked relations are created using a Field of the RichText type. Whenever an internal link (a link to another Location or Content item) is inserted into a Field represented by this Field Type, the system will automatically create a relation of this type. Note that such a relation is automatically removed from the system when the corresponding link is removed from the Content item.
3.  RichText embedded relations also use a RichText Field. Whenever an Embed element is inserted into a Field represented by this Field Type, the system will automatically create a relation of this type, that is relate the embedded Content item to the one that is being edited. Note that a relation of this type is automatically removed from the system when the corresponding element is removed.

## Sections

Sections are used to divide Content items in the tree into groups that are more easily manageable by content editors. Division into Sections allows you, among others, to set permissions for only a part of the tree.

Technically, a Section is simply a triplet: a number, a name and an identifier. Content items are placed in Sections by being assigned the Section ID, with one item able to be in only one Section.

When a new Content item is created, its Section ID is set to the default Section (which is usually Standard). When the item is published it is assigned to the same Section as its parent. Because Content must always be in a Section, unassigning happens by choosing a different Section to move it into . If a Content item has multiple Location assignments then it is always the Section ID of the item referenced by the parent of the main Location that will be used. In addition, if the main Location of a Content item with multiple Location assignments is changed then the Section ID of that item will be updated.

Sections can only be removed if no Content items are assigned to them. Even then, it should be done carefully. When a Section is deleted, it is only its definition itself that will be removed. Other references to the Section will remain and thus the system will most likely be in an inconsistent state.That is why removing Sections may corrupt permission settings, template output and other things in the system.

Section ID numbers are not recycled. If a Section is removed, its ID number will not be reused when a new Section is created.

<span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img src="attachments/30708643/30711786.png" alt="Sections screen" class="confluence-embedded-image image-center" width="500" /></span>

## Permissions

Permissions in Platform form one of the most advanced permissions systems around, allowing you to define very fine-grained rights for your Editors, Visitors, Members and other users.

### Overview

In the permission system a User by default does not have access to anything. To get access they need to inherit Roles, typically assigned to the User Group they belong to.

### Model

#### Roles

First part of the permission model is the Roles, and they consist of the following parts:

    RoleLimitation *- RoleAssignment >- Role -< Policy -*< Limitation

-   A Role assignment can optionally have a Limitation, <span style="color: rgb(128,128,128);">Role Limitation examples: </span>[SubTreeLimitation](SubtreeLimitation_31430490.html)<span style="color: rgb(128,128,128);"> or </span>[SectionLimitation](SectionLimitation_31430486.html)
-   A Role can have several assignments, <span style="color: rgb(128,128,128);">Role example: Editor, Member, ProSubscriber
    </span>
-   A Role consists of several Policies, <span style="color: rgb(128,128,128);">Policy example: content/read/\*, content/edit/\* (where \* refers to full access, that is no Limitation)</span>
-   A Policy optionally consists of several Limitations, <span style="color: rgb(128,128,128);">Limitation example:</span>[ContentTypeLimitation](ContentTypeLimitation_31430463.html),[SectionLimitation](SectionLimitation_31430486.html),[OwnerLimitation](OwnerLimitation_31430475.html)
    -   Note that when a Policy has more than one Limitation, all of them have to apply, or the Policy will not work. For example, a [Location Limitation](LocationLimitation_31430467.html) on Location 1/2 and [Subtree Limitation](SubtreeLimitation_31430490.html) on 1/2/55 cannot work together, because no Location can satisfy both those requirements at the same time.

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
If you want to combine more that one Limitation with the **or** relation, not **and**, you can split your Policy into two, each with one of these Limitations.

Role Policies Map

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
<span style="color: rgb(0,0,0);">See [Role Policies Map](Role-Policies-Map_32867837.html) for further informations.
</span>

#### Users

Second part of the model is made up of Users and User Groups:

    User -*< UserGroup

-   A User can be member of several User Groups<span style="color: rgb(128,128,128);">, User Group examples: Administrator Users, Member Users, ProSubscriber Users</span>

#### Role assignments

Last part on the permission model is the fact that Role assignments can be assigned to both Users and User Groups:

    User - RoleAssignment - UserGroup

 

Best Practice

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Best practice is to avoid assigning Roles to Users directly, and instead to make sure you model your content *(types, structure, sections, etc.)* in a way that can be reflected in generic roles. Besides being much easier to manage and keep on top of security-wise, this also makes sure your system performs best. *The more Role assignments and complex Policies you add for a given User, the more complex the search/load queries powering the whole CMS will be, as they always take permissions into account.*

## Persistence Cache

<span class="confluence-embedded-file-wrapper image-left-wrapper"><img src="attachments/31432023/32112970.png" class="confluence-embedded-image image-left" /></span>

#### Layers

Persistence cache can best be described as an implementation of `SPI\Persistence` that decorates the main backend implementation *(currently: "Legacy Storage Engine")*.

As shown in the illustration, this is done in the exact same way as the SignalSlot feature is a custom implementation of API\\Repository decorating the main Repository. In the case of Persistence Cache, instead of sending events on calls passed on to the decorated implementation, most of the load calls are cached, and calls that perform changes purge the affected caches. This is done using a Cache service which is provided by StashBundle; this Service wraps around the Stash library to provide Symfony logging / debugging functionality, and allows cache handlers *(Memcached, Redis, Filesystem, etc.)* to be configured using Symfony configuration. For how to reuse this Cache service in your own custom code, see below.

#### Transparent cache

With the persistence cache, just like with the HTTP cache, eZ Platform tries to follow principles of "Transparent caching", this can shortly be described as a cache which is invisible to the end user and to the admin/editors of eZ Platform where content is always returned "fresh". In other words, there should be no need to manually clear the cache like it was frequently the case with eZ Publish 4.x. This is possible thanks to an interface that follows CRUD *(Create Read Update Delete)* operations per domain, and the fact that the number of other operations capable of affecting a certain domain is kept to a minimum.

##### Entity stored only once

To make the transparent caching principle as effective as possible, entities are, as much as possible, only stored once in cache by their primary id. Lookup by a<span> <span>lternative identifiers (`identifier`, `remoteId`, etc.) is only cached with the identifier as cache key and primary `id` as its cache value, and </span> </span>compositions<span> <span> *(list of objects)* usually keep only the array of primary id's as their cache value.</span> </span>

<span>This means a couple of things:</span>

-   <span>Memory consumption is kept low</span>
-   Cache purging logic is kept simple (For example: `$sectionService->delete( 3 )` clears "section/3" cache entry)
-   Lookup by `identifier` and list of objects needs several cache lookups to be able to assemble the result value
-   Cache warmup usually takes several page loads to reach full as identifier is first cached, then the object

#### What is cached?

Persistence cache aims at caching most `SPI\Persistence` calls used in common page loads, including everything needed for permission checking and url alias lookups.

Notes:

-   `UrlWildCardHandler` is not currently cached
-   Currently in case of transactions this is handled very simply by clearing all cache on rollback, this can be improved in the future if needed.
-   Some tree/batch operations will cause clearing all persistence cache, this will be improved in the future when we change to a cache service cable of cache tagging.
-   Search is not defined as Persistence and the queries themselves are not planned to be cached. Use [Solr](Solr-Bundle_31430592.html) which does this for you to improve scale and offload your database.

*For further details on which calls are cached or not, and where/how to contribute additional caches, check out the <a href="https://github.com/ezsystems/ezpublish-kernel/tree/master/eZ/Publish/Core/Persistence/Cache">source</a>.*

# Configuration

## Content Repository Configuration

The **content repository** is where all your content is been stored. It is the heart of eZ Platform which you interact with using Public API.

To store data, the content repository **uses a storage engine** that can virtually can work with any kind of storage (RDBMS, NoSQL, etc.). eZ Publish 5 came with a relational storage engine, compatible with v4.x: the **Legacy storage engine**, which is the default.

You can define several repositories within a single application. However, you can only use one per site.

### Configuration examples

#### Using default values

**ezplatform.yml**

``` brush:
ezpublish:
    repositories:
        # Defining repository with alias "main"
        # Default storage engine is used, with default connection
        # Equals to:
        # main: { engine: legacy, connection: <defaultConnectionName> }
        main: ~

    system:
        # All members of my_siteaccess_group will use "main" repository
        # No need to set "repository", it will take the first defined repository by default
        my_siteaccess_group:
            # ...
```

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
If no repository is specified for a siteaccess or siteaccess group, the first defined repository (under `ezpublish.repositories`) will be used.

#### All explicit

**ezplatform.yml**

``` brush:
doctrine:
    dbal:
        default_connection: my_connection_name
        connections:
            my_connection_name:
                driver:   pdo_mysql
                host:     localhost
                port:     3306
                dbname:   my_database
                user:     my_user
                password: my_password
                charset:  UTF8

            another_connection_name:
                # ...

ezpublish:
    repositories:
        first_repository: { engine: legacy, connection: my_connection_name, config: {} }
        second_repository: { engine: legacy, connection: another_connection_name, config: {} }

    # ...

    system:
        my_first_siteaccess:
            repository: first_repository

            # ...

        my_second_siteaccess:
            repository: second_repository
```

#### Legacy storage engine

<span>Legacy storage engine uses <a href="http://docs.doctrine-project.org/projects/doctrine-dbal/en/latest/">Doctrine DBAL</a> (Database Abstraction Layer). Database settings are supplied by <a href="https://github.com/doctrine/DoctrineBundle">DoctrineBundle</a>. As such, you can refer to <a href="https://github.com/doctrine/DoctrineBundle/blob/master/Resources/doc/configuration.rst#doctrine-dbal-configuration">DoctrineBundle's documentation</a>.</span>

ORM

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Doctrine ORM is **not** provided by default. If you want to use it, you will need to add `doctrine/orm` as a dependency in your `composer.json`.

<span>
</span>

### <span id="Repository-Field_groups_configuration" class="confluence-anchor-link"></span>Field groups configuration

<span class="status-macro aui-lozenge aui-lozenge-current">V1.3</span>

Field groups, used in content and Content Type editing, can be configured from the repository section. Values entered there are field group *identifiers*:

``` brush:
repositories:
  default:
    fields_groups:
      list: [content, features, metadata]
      default: content
```

These identifiers can be given human-readable values and translated. Those values will at the moment be used when editing Content Types. The translation domain is `ezplatform_fields_groups`.
This file will define English names for field groups:

**app/Resources/translations/ezplatform\_fields\_groups.en.yml**

``` brush:
content: Content
metadata: Metadata
user_data: User data
```

### Limit of archived Content item versions

<span class="status-macro aui-lozenge aui-lozenge-current">V1.7</span>

`default_version_archive_limit` controls the number of archived versions per Content item that will be stored in the repository, by default set to 5. This setting is configured in the following way (typically in `ezplatform.yml`):

``` brush:
ezpublish:
    repositories:
        default:
            options:
                default_version_archive_limit: 10
```

This limit is enforced on publishing a new version and only covers archived versions, not drafts.

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
Don't set this number too high, with LegacyStorageEngine you'll get performance degradation if you store too many versions. Default value of 5 is in general the recommended value, but the less content you have overall, the more you can increase this to, for instance, 25 or even 50.

## Persistence cache configuration

Tech Note

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Current implementation uses a caching library called <a href="http://stash.tedivm.com/">Stash</a> (via <a href="https://github.com/tedivm/TedivmStashBundle">StashBundle</a>). Stash supports the following cache backends: FileSystem, Memcache, APC, Sqlite, Redis** **and BlackHole.

 

*Use of Memcached (or, experimentally, Redis) is a requirement for use in Clustering setup. For an overview of this feature, see [Clustering](Clustering_31430387.html). *

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
When eZ Platform changes to another PSR-6 based cache system in the future, then configuration documented below will change.

**Cache service**

The cache system is exposed as a "cache" service, and can be reused by any other service as described in the <span class="confluence-link"> [Using Cache service](#Repository-Usingcacheservice) </span> section.

### Configuration

By default, configuration currently uses **FileSystem**, with` %kernel.cache_dir%/stash` to store cache files.

The configuration is placed in `app/config/config.yml` and looks like this:

**Default config.yml**

``` brush:
stash:
    caches:
        default:
            drivers:
                - FileSystem
            inMemory: true
            registerDoctrineAdapter: false
```

Note for "inMemory" cache with long running scripts

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Use `inMemory` with caution, and avoid it completely for long running scripts for the following reasons:

-   It does not have any limits, so can result in the application running out of PHP memory.
-   <span>Its cache pool is by design a PHP variable and is not shared across requests/processes/servers, so data becomes stale if any other concurrent activity happens towards the repository.</span>

#### Multi repository setup

In `ezplatform.yml` you can specify which cache pool you want to use on a siteaccess or sitegroup level. The following example shows use in a sitegroup:

**ezplatform.yml site group setting**

``` brush:
ezpublish:
    system:
        # "site_group" refers to the group configured in site access
        site_group:
            # "default" refers to the cache pool, the one configured on stash.caches above
            cache_pool_name: "default"
```

One cache pool for each repository

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
If your installation has several repositories *(databases)*, make sure every group of sites using different repositories also uses a different cache pool.

### Stash cache backend configuration

#### General settings

To check which cache settings are available for your installation, run the following command in your terminal:

``` brush:
php app/console config:dump-reference stash
```

#### <span>FileSystem</span>

This cache backend uses the local filesystem, by default the Symfony cache folder. As this is per server, it **does not support** [**multi server (<span class="confluence-link">cluster</span>) setups**](Clustering_31430387.html)!

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
**We strongly discourage you from storing cache files on NFS**, as it defeats the purpose of the cache: speed.

##### <span style="color: rgb(51,51,51);">Available settings</span>

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><pre><code>path</code></pre></td>
<td align="left">The path where the cache is placed; default is <code>%kernel.cache_dir%/stash</code>, effectively <code>app/cache/&lt;env&gt;/stash</code></td>
</tr>
<tr class="even">
<td align="left"><pre><code>dirSplit</code></pre></td>
<td align="left">Number of times the cache key should be split up to avoid having too many files in each folder; default is 2.</td>
</tr>
<tr class="odd">
<td align="left"><pre><code>filePermissions</code></pre></td>
<td align="left">The permissions of the cache file; default is 0660.</td>
</tr>
<tr class="even">
<td align="left"><pre><code>dirPermissions</code></pre></td>
<td align="left">The permission of the cache file directories (see dirSplit); default is 0770.</td>
</tr>
<tr class="odd">
<td align="left"><pre><code>memKeyLimit</code></pre></td>
<td align="left"><p>Limit on how many key to path entries are kept in memory during execution at a time to avoid having to recalculate the path on key lookups; default is 200.</p></td>
</tr>
<tr class="even">
<td align="left"><pre><code>keyHashFunction</code></pre></td>
<td align="left">Algorithm used for creating paths; default is md5. Use crc32 on Windows to avoid path length issues.<code>                                                     </code></td>
</tr>
</tbody>
</table>

Issues with Microsoft Windows

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
If you are using a Windows OS, you may encounter an issue regarding **long paths for cache directory name**. The paths are long because Stash uses md5 to generate unique keys that are sanitized really quickly.

Solution is to **change the hash algorithm** used by Stash.

**Specifying key hash function**

``` brush:
stash:
    caches:
        default:
            drivers:
                - FileSystem
            inMemory: true
            registerDoctrineAdapter: false
            FileSystem:
                keyHashFunction: 'crc32'
```

**This configuration is only recommended for Windows users**.
Note: You can also define the **path** where you want the cache files to be generated to be able to get even shorter system path for cache files.

 

#### FileSystem cache backend troubleshooting

By default, Stash Filesystem cache backend stores cache to a sub-folder named after the environment (`i.e. app/cache/dev`, `app/cache/prod`). This can lead to the following issue: if different environments are used for operations, persistence cache (manipulating content, mostly) will be affected and cache can become inconsistent.

To prevent this, there are 2 solutions:

 

###### **1. []()Manual**

**Always** use the same environment, for web, command line, cronjobs etc.

###### **2 . Share stash cache across Symfony environments (prod / dev / ..)**

Either by using another Stash cache backend, or by setting Stash to use a shared cache folder that does not depend on the environment.

In `ezplatform.yml`:

``` brush:
stash:
    caches:
        default:
            FileSystem:
                path: "%kernel.root_dir%/cache/common"
```

This will store stash cache to `app/cache/common.`

#### APC & APCu

This cache backend is using shard memory with APC's user cache feature. As this is per server, it **does not support [multi server (<span class="confluence-link">cluster</span>) setups](Clustering_31430387.html)** .

Not supported because of following limitation

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
As APC(u) user cache is not shared between processes, it is not possible to clear the user cache from CLI, even if you set <span style="color: rgb(0,0,0);"> `apc.enable_cli` to On</span>. That is why publishing content from a command line script won't let you properly clear SPI Persistence cache.

Please also note that the default value for `apc.shm_size` is 128MB. However, 256MB is recommended for APC to work properly. For more details please refer to the <a href="http://www.php.net/manual/en/apc.configuration.php#ini.apc.shm-size">APC configuration manual</a>.

 

**Available settings**

|                                             |                                                                                                                                                |
|---------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|
| `                 ttl               `       | The time to live of the cache in seconds; default is 500 (8.3 minutes)                                                                         |
| `                 namespace               ` | A namespace to prefix cache keys with to avoid key conflicts with other eZ Platform sites on same eZ Platform installation; default is `null`. |

#### <span class="inline-comment-marker" data-ref="2f3adfb4-7947-42db-969e-9f484390d409">Redis</span>

<span class="status-macro aui-lozenge aui-lozenge-error aui-lozenge-subtle">EXPERIMENTAL</span>

This cache backend is using <a href="http://redis.io/">Redis, a in-memory data structure store</a>, via <a href="https://pecl.php.net/package/redis">Redis pecl extension</a>. This is an alternative cache solution for [multi server (<span class="confluence-link">cluster</span>) setups](Clustering_31430387.html), besides using Memcached.

**Available settings**

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><code>                 servers               </code></td>
<td align="left"><p>Array of Redis servers:</p>
<p><code>                   server                 </code>: Host or IP of your Redis server<br />
<code>                   port                 </code>: Port that Redis is listening to (default: 6379)<br />
<code style="line-height: 1.42857;">                   ttl                 </code>: Optional float value of connection timeout in seconds<br />
<code>                   socket                 </code> <span>: Optional boolean value to specify if server refers to a socket (default: false)</span></p></td>
</tr>
<tr class="even">
<td align="left"><code>                 password               </code></td>
<td align="left">Optional setting if there is a password to connection to a given Redis server in plain text over the network.</td>
</tr>
<tr class="odd">
<td align="left"><strong>database</strong></td>
<td align="left">Optional setting to specify a given Redis database to use.</td>
</tr>
</tbody>
</table>

**Example**

**config.yml example**

``` brush:
stash:
    caches:
        default:
            drivers: [ Redis ]
            Redis:
                servers:
                    -
                        server: 'redis1.ez.no'
                        port: 6379
                    -
                        server: 'redis2.ez.no'
                        port: 6379
```

#### Memcache(d)

This cache backend is using <a href="http://memcached.org/">Memcached, a distributed caching solution</a>. This is the main supported cache solution for [multi server (<span class="confluence-link">cluster</span>) setups](Clustering_31430387.html), besides using Redis.

Note

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Stash supports both the <a href="http://php.net/memcache">php-memcache</a> and <a href="http://php.net/memcached">php-memcached</a> extensions. **However** only php-memcached is officially supported as php-memcache is missing many features and is less stable.

**Available settings**

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><code>                 servers               </code></td>
<td align="left"><p>Array of Memcached servers, with host/IP, port and weight</p>
<p><code>                   server                 </code>: Host or IP of your Memcached server<br />
<code>                   port                 </code>: Port that Memcached is listening to (defaults to 11211)<br />
<code>                   weight                 </code>: Weight of the server, when using several Memcached servers</p></td>
</tr>
<tr class="even">
<td align="left"><code>                 prefix_key               </code></td>
<td align="left"><span>A namespace to prefix cache keys with to avoid key conflicts with other eZ Platform sites on same eZ Platform installation (default is an empty string). </span><br />
<span>Must be the same on all servers with the same installation.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-prefix-key">See Memcached prefix_key option</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span> </span> </span></td>
</tr>
<tr class="odd">
<td align="left"><code>                 compression               </code></td>
<td align="left">default true. <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-compression">See Memcached compression option</a> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span></td>
</tr>
<tr class="even">
<td align="left"><code>                 libketama_compatible               </code></td>
<td align="left">default false.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-libketama-compatible">See Memcached libketama_compatible option</a> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span></td>
</tr>
<tr class="odd">
<td align="left"><code>                 buffer_writes               </code></td>
<td align="left">default false.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-buffer-writes">See Memcached buffer_writes option</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span> </span></td>
</tr>
<tr class="even">
<td align="left"><code>                 binary_protocol               </code></td>
<td align="left">default false.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-binary-protocol">See Memcached binary_protocol option</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span> </span></td>
</tr>
<tr class="odd">
<td align="left"><code>                 no_block               </code></td>
<td align="left">default false.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-no-block">See Memcached no_block option</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span> </span></td>
</tr>
<tr class="even">
<td align="left"><code>                 tcp_nodelay               </code></td>
<td align="left">default false.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-tcp-nodelay">See Memcached tcp_nodelay option</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span> </span></td>
</tr>
<tr class="odd">
<td align="left"><code>                 connection_timeout               </code></td>
<td align="left">default 1000.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-connection-timeout">See Memcached connection_timeout option</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span> </span></td>
</tr>
<tr class="even">
<td align="left"><code>                 retry_timeout               </code></td>
<td align="left">default 0.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-memcached-timeout">See Memcached retry_timeout option</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span> </span></td>
</tr>
<tr class="odd">
<td align="left"><code>                 send_timeout               </code></td>
<td align="left">default 0.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-send-timeout">See Memcached send_timeout option</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span> </span></td>
</tr>
<tr class="even">
<td align="left"><code>                 recv_timeout               </code></td>
<td align="left"><p>default 0.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-recv-timeout">See Memcached recv_timeout option</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span> </span></p></td>
</tr>
<tr class="odd">
<td align="left"><code>                 poll_timeout               </code></td>
<td align="left">default 1000.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-poll-timeout">See Memcached poll_timeout option</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span> </span></td>
</tr>
<tr class="even">
<td align="left"><code>                 cache_lookups               </code></td>
<td align="left">default false.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-cache-lookups">See Memcached cache_lookups option</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span> </span></td>
</tr>
<tr class="odd">
<td align="left"><strong><code>server_failure_limit</code></strong></td>
<td align="left">default 0.<span> </span> <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-server-failure-limit">See PHP Memcached documentation</a> <span> <strong>*</strong> <span style="color: rgb(128,128,0);"> </span><br />
</span></td>
</tr>
<tr class="even">
<td align="left"><strong><span style="color: rgb(34,34,34);"> <code>socket_send_size </code><br />
</span></strong></td>
<td align="left">See <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-socket-send-size">Memcached socket_send_size option</a> *</td>
</tr>
<tr class="odd">
<td align="left"><strong><code>socket_recv_size</code></strong></td>
<td align="left">See <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-socket-recv-size">Memcached socket_recv_size option</a> *</td>
</tr>
<tr class="even">
<td align="left"><strong><code>serializer</code></strong></td>
<td align="left">See <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-serializer">Memcached serializer option</a> *</td>
</tr>
<tr class="odd">
<td align="left"><strong><code>hash</code></strong></td>
<td align="left">See <a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-hash">Memcached hash option</a> *</td>
</tr>
<tr class="even">
<td align="left"><strong><code>distribution</code></strong></td>
<td align="left"><p>Specifies the method of distributing item keys to the servers. See<a href="http://www.php.net/manual/en/memcached.constants.php#memcached.constants.opt-distribution">Memcached distribution option</a> *</p></td>
</tr>
</tbody>
</table>

 

**\*** All settings except `servers `are only available with memcached PHP extension. For more information on these settings and which version of php-memcached they are available in, see: <a href="http://php.net/Memcached" class="uri">http://php.net/Memcached</a> <span style="color: rgb(128,128,0);">
</span>

 

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
When using Memcache cache backend, you *may* use inMemory to reduce network traffic as long as you are aware of its limitations mentioned above.

#### Example with Memcache(d)

Note that `app/config/config.yml` contains the default stash configuration. To apply the configuration below, make sure you update the existing configuration, or remove it if you want to use another configuration file.

``` brush:
stash:
    caches:
        default:
            drivers: [ Memcache ]
            inMemory: true
            registerDoctrineAdapter: false
            Memcache:
                prefix_key: ezdemo_
                retry_timeout: 1
                servers:
                    -
                        server: 127.0.0.1
                        port: 11211
```

Connection errors issue

<span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
If memcached does display connection errors when using the default (ascii) protocol, then switching to binary protocol *(in the stash configuration and memcached daemon)* should resolve the issue.

# Usage

## Using Cache Service

Using the internal cache service allows you to use an interface and to not have to care whether the system has been configured to place the cache in Memcached or on File system. And as eZ Platform requires that instances use a cluster-aware cache in Cluster setup, you can safely assume your cache is shared *(and invalidated)* across all web servers.

Interface will change in the future

<span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
Current implementation uses a caching library called <a href="http://stash.tedivm.com/">Stash</a>, via <a href="https://github.com/tedivm/TedivmStashBundle">StashBundle</a>. We plan to move to a PSR-6 compatible cache service capable of supporting cache Tagging and multi get/set in the future, when that happens the interface of the cache service will change!

Use unique vendor prefix for Cache key!

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
When reusing the cache service within your own code, it is very important to not conflict with the cache keys used by others. That is why the example of usage below starts with a unique "myApp" key. For the namespace of your own cache, you must do the same! So never clear cache using the cache service without your key specified, otherwise you'll clear all cache.

#### Get Cache service

#### Via Dependency injection

In your Symfony services configuration you can simply define that you require the "cache" service in your configuration like so:

**yml configuration**

``` brush:
    myApp.myService:
        class: %myApp.myService.class%
        arguments:
            - @ezpublish.cache_pool
```

The "cache" service is an instance of the following class: `Tedivm\StashBundle\Service\CacheService`

#### Via Symfony Container

Like any other service, it is also possible to get the "cache" service via container like so:

**Getting the cache service in PHP**

``` brush:
/** @var $cacheService \Tedivm\StashBundle\Service\CacheService */
$cacheService = $container->get('ezpublish.cache_pool');
```

### Using the cache service

Example usage of the cache service:

**Example**

``` brush:
    $cacheItem = $cacheService->getItem('myApp', 'object', $id);
    $myObject = $cacheItem->get();
    if ($cacheItem->isMiss()) {
        $myObject = $container->get('my_app.backend_service')->loadObject($id)
        $cacheItem->set($myObject);
    }
    return $myObject;
```

For more info on usage, take a look at <a href="http://stash.tedivm.com/">Stash's documentation</a>.

### Clearing Persistence cache

Persistence cache uses a separate Cache Pool decorator which by design prefixes cache keys with "ez\_spi". Clearing persistence cache can thus be done in the following way:

**getting the cache service in php**

``` brush:
/** @var $cacheService \eZ\Publish\Core\Persistence\Cache\CacheServiceDecorator */
$cacheService = $container->get('ezpublish.cache_pool.spi.cache.decorator');
 
// To clear all cache
$cacheService->clear();
 
// To clear a specific cache item (check source code in eZ\Publish\Core\Persistence\Cache\*Handlers for further info)
$cacheService->clear('content', 'info', $contentId);

// Stash cache is hierarchical, so you can clear all content/info cache like so:
$cacheService->clear('content', 'info');
```

## Binary files URL handling

### IO URL decoration

By default, images and binary files referenced by content will be served from the same server as the application, like `           /var/ezdemo_site/storage           /images/3/6/4/6/6463-1-eng-GB/kidding.png         `. This is the default semantic configuration:

``` brush:
ezpublish:
    system:
        default:
            io:
                url_prefix: "$var_dir$/$storage_dir$"
```

<span> `$var_dir$` and `$storage_dir$` are dynamic, [siteaccess-aware settings](https://doc.ez.no/display/DEVELOPER/SiteAccess#SiteAccess-DynamicSettingsInjection), and will be replaced by those settings value in the execution context.</span>

 

<span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
URL decorators are an eZ Platform features. If an image field is displayed via a legacy callback or legacy template, no decoration will be applied.

<span>
</span>

### <span>Using a static server for images</span>

<span> <span>One common use-case is to use an optimized nginx to serve images in an optimized way. The example image above could be made available as `                http://static.example.com/                images/3/6/4/6/6463-1-eng-GB/kidding.png             `, by setting up a server that uses `ezpublish/ezpublish_legacy/var/ezdemo_site/storage`. The eZ Platform configuration would be as follows:</span> </span>

``` brush:
ezpublish:
    system:
        default:
            io:
                url_prefix: "http://static.example.com/"
```

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
#### Legacy compatiblity

Legacy still requires non-absolute path to store images (var/site/storage/images/etc.). In order to work around this, a `UrlRedecorator`, that converts back and forth between the legacy uri prefix and the one in use in the application has been added. It is used in all places where a legacy URL is returned/expected, and takes care of making sure the value is as expected.

<span style="color: rgb(0,98,147);">Internals</span>

Any `BinaryFile` returned by the public API is prefixed with the value of this setting, internally stored as `           ezsettings.scope.io.url_prefix`.

#### Dynamic container settings

Those settings are siteaccess-aware.

##### `io.url_prefix`

Default value: <span> `$var_dir$/$storage_dir$`
Example: `             /var/ezdemo_site/storage           ` </span>

<span> <span> <span>Used to configure the default URL decorator service (</span> `               ezpublish.core.io.default_url_decorator` <span>, used by all binarydata handlers to generate the URI of loaded files. It is always interpreted as an absolute URI, meaning that unless it contains a scheme (<span class="nolink">http://,</span> ftp://), it will be prepended with a '/'.</span> </span> </span>

##### `io.legacy_url_prefix`

Default value: `           $var_dir$/$storage_dir$         `
Example: `           var/ezdemo_site/storage         `

<span>Used by the legacy storage engine to convert images public URI to a format it understands. Unlike io.url\_prefix, it is not an absolute link. Cannot be overridden using semantic configuration. <span>Changing this value will break compatibility for the legacy backoffice.</span> </span>

##### `io.root_dir`

<span> <span> <span>Example: `                 %ezpublish_legacy.root_dir%/$var_dir$/$storage_dir$               `
Default value: `/var/www/ezpublish/ezpublish_legacy/var/ezdemo_site/storage` </span> </span> </span>

<span> <span> <span>Physical path where binary files are stored on disk. Cannot be overridden using semantic configuration. Changing this value will break compatibility for the legacy backoffice.</span> </span> </span>

#### <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/doc/specifications/io/io_url_decoration.md#services"></a>Services

##### URL decorators

An UrlDecorator decorates and undecorates a given string (url) in some way. It has two mirror methods: `decorate` and `undecorate`.

Two implementations are provided: `Prefix`, and `AbsolutePrefix`. They both add a prefix to a URL, but `AbsolutePrefix` will ensure that unless the prefix is an external URL, the result will be prepended with /.

Three UrlDecorator services are introduced:

-   `             ezpublish.core.io.prefix_url_decorator` used by the binarydata handlers to decorate all uris sent out by the API. Uses AbsolutePrefix.
-   `             ezpublish.core.io.image_fieldtype.legacy_url_decorator` used via the UrlRedecorator (see below) by various legacy elements (Converter, Storage Gateway, etc.) to generate its internal storage format for uris. Uses a Prefix, not an AbsolutePrefix, meaning that no leading / is added.

In addition, a UrlRedecorator service, `           ezpublish.core.io.image_fieldtype.legacy_url_redecorator`, uses both decorators above to convert URIs between what is used on the new stack, and what format legacy expects (relative urls from the ezpublish root).

## Regenerating URL Aliases

The command ezplatform:regenerate:legacy\_storage\_url\_aliases command regenerates URL aliases for Locations and migrates existing custom Location and global URL aliases to a separate database table. The separate table must be named `__migration_ezurlalias_ml` and should be created manually to be identical (but empty) as the existing table `ezurlalias_ml` before the command is executed.

After the script finishes, to complete migration the table should be renamed to `ezurlalias_ml` manually. Using available options for `action` argument, you can back up custom Location and global URL aliases separately and inspect them before restoring them to the migration table. They will be stored in backup tables named `__migration_backup_custom_alias` and `__migration_backup_global_alias` (created automatically).

It is also possible to skip custom Location and global URL aliases altogether and regenerate only automatically created URL aliases for Locations (use the `autogenerate` action to achieve this). During the script execution the database should not be modified. Since this script can potentially run for a very long time, to avoid memory exhaustion run it in production environment using the `--env=prod` switch.

# Reference

## Services: Public API

The Public API exposes Symfony services for all of its repository services.

| Service id                           | Type                                           |
|--------------------------------------|------------------------------------------------|
| `ezpublish.api.service.content`      | `eZ\Publish\API\Repository\ContentService`     |
| `ezpublish.api.service.content_type` | `eZ\Publish\API\Repository\ContentTypeService` |
| `ezpublish.api.service.location`     | `eZ\Publish\API\Repository\LocationService`    |
| `ezpublish.api.service.url_alias`    | `eZ\Publish\API\Repository\UrlAliasService`    |
| `ezpublish.api.service.field_type`   | `eZ\Publish\API\Repository\FieldTypeService`   |
| `ezpublish.api.service.language`     | `eZ\Publish\API\Repository\Language`           |
| `ezpublish.api.service.object_state` | `eZ\Publish\API\Repository\ObjectState`        |
| `ezpublish.api.service.role`         | `eZ\Publish\API\Repository\Role`               |
| `ezpublish.api.service.search`       | `eZ\Publish\API\Repository\Search`             |
| `ezpublish.api.service.section`      | `eZ\Publish\API\Repository\Section`            |
| `ezpublish.api.service.trash`        | `eZ\Publish\API\Repository\Trash`              |
| `ezpublish.api.service.url_wildcard` | `eZ\Publish\API\Repository\UrlWildcard`        |
| `ezpublish.api.service.user`         | `eZ\Publish\API\Repository\User`               |

## Signals Reference

You can find the reference for **all available signals** that you can listen to, triggered by ("Public") Repository API in eZ Platform, in their dedicated page: [Signals Reference](Signals-Reference_32113983.html).

## Limitations Reference

Limitations are crucial building blocks of the [permissions system](https://doc.ez.no/display/DEVELOPER/Repository#Repository-Permissions) in eZ Platform. They provide the restrictions you can apply to a given access right to limit the right according to certain conditions.

Limitations consist of two parts:

-   `Limitation` (Value)
-   `LimitationType`

Certain limitations also serve as RoleLimitations, which means they can be used to limit the rights of a Role assignment. Currently this covers `Subtree` and `Section` limitations.

`Limitation` represents the value, while `LimitationType` deals with the business logic surrounding how it actually works and is enforced.
`LimitationTypes` have two modes of operation in regards to permission logic (see `eZ\Publish\SPI\Limitation\Type` interface for more info):

| Method                             | Use                                                                                                                                                                                                               |
|------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `           evaluate         `     | <span>Evaluating if the user has access to a given object in a certain context (for instance the context can be Locations when the object is `Content`), under the condition of the `Limitation` value(s).</span> |
| `           getCriterion         ` | <span>Generates a `Criterion` using `Limitation` value and current user which `SearchService` by default applies to search criteria for filtering search based on permissions.</span>                             |

### List of Limitations

**See [List of Limitations](List-of-Limitations_31430459.html)**

# Extensibility

## Permissions

Two parts of the permissions system are extensible from a programmatic perspective: Policies and Limitations

-   Policies: [<span class="confluence-link">Custom Policies can be added for use in your own code</span>](#Repository-Custompolicies), <span style="color: rgb(128,128,128);">custom Policy example: comment/create</span>
-   [Limitations](List-of-Limitations_31430459.html): You can extend existing Policies, and hence extend the permissions of the CMS, <span style="color: rgb(128,128,128);">example could be adding a SubscriptionLimitation to content/read Policy</span>

## Custom Policies

### Description

eZ content repository uses the concept of Roles and Policies in order to authorize a user to do something (e.g. read content).

-   A Role is composed of Policies and can be assigned to a User or a User Group.
-   A Policy is composed of a combination of **module** and **function** (e.g. `content/read`, `content` being the module and `read` being the function).
-   Depending on **module** and **function** combination, a Policy can also be composed of Limitations.

It is possible for any bundle to expose available Policies via a `PolicyProvider` which can be added to EzPublishCoreBundle's DIC extension.

### PolicyProvider

A `PolicyProvider` is an object providing a hash containing declared modules, functions and limitations.

-   Each Policy provider provides a collection of permission *modules*.
-   Each module can provide *functions* (e.g. "content/read": "content" is the module, "read" is the function)
-   Each function can provide a collection of Limitations.

Policies configuration hash contains declared these modules, functions and Limitations.
First level key is the module name, value is a hash of available functions, with function name as key.
Function value is an array of available Limitations, identified by the alias declared in LimitationType service tag.
If no Limitation is provided, value can be `null` or an empty array.

``` brush:
[
    "content" => [
        "read" => ["Class", "ParentClass", "Node", "Language"],
        "edit" => ["Class", "ParentClass", "Language"]
    ],
    "custom_module" => [
        "custom_function_1" => null,
        "custom_function_2" => ["CustomLimitation"]
    ],
]
```

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Limitations need to be implemented as *limitation types* and declared as services identified with `ezpublish.limitationType` tag. Name provided in the hash for each Limitation is the same value set in `alias` attribute in the service tag.

### Example

``` brush:
namespace Acme\FooBundle\AcmeFooBundle\Security;

use eZ\Bundle\EzPublishCoreBundle\DependencyInjection\Configuration\ConfigBuilderInterface;
use eZ\Bundle\EzPublishCoreBundle\DependencyInjection\Security\PolicyProvider\PolicyProviderInterface;

class MyPolicyProvider implements PolicyProviderInterface
{
    public function addPolicies(ConfigBuilderInterface $configBuilder)
    {
        $configBuilder->addConfig([
             "custom_module" => [
                 "custom_function_1" => null,
                 "custom_function_2" => ["CustomLimitation"],
             ],
         ]);
    }
}
```

### YamlPolicyProvider

<span>An abstract class based on YAML is provided: </span> `eZ\Bundle\EzPublishCoreBundle\DependencyInjection\Security\PolicyProvider\YamlPolicyProvider` <span>.
</span> <span>It defines an abstract </span> `getFiles()` <span> method. </span>

<span>Extend `YamlPolicyProvider` and implement `getFiles()` to return absolute paths to your YAML files.</span>

``` brush:
namespace Acme\FooBundle\AcmeFooBundle\Security;

use eZ\Bundle\EzPublishCoreBundle\DependencyInjection\Security\PolicyProvider\YamlPolicyProvider;

class MyPolicyProvider extends YamlPolicyProvider
{
    protected function getFiles()
    {
        return [
             __DIR__ . '/../Resources/config/policies.yml',
         ];
    }
}
```

**AcmeFooBundle/Resources/config/policies.yml**

``` brush:
custom_module:
    custom_function_1: ~
    custom_function_2: [CustomLimitation]
```

#### <span>Extending existing policies</span>

A `PolicyProvider` may provide new functions to a module, and additional Limitations to an existing function. 
**It is however strongly encouraged to add functions to your own Policy modules.**

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
It is not possible to remove an existing module, function or limitation from a Policy.

### Integrating the PolicyProvider into EzPublishCoreBundle

<span>For a PolicyProvider to be active, it must be properly declared in EzPublishCoreBundle.
A bundle just has to retrieve CoreBundle's DIC extension and call </span> `addPolicyProvider()` <span>. This must be done in the bundle's </span> `build()` <span> method.</span>

``` brush:
namespace Acme\FooBundle\AcmeFooBundle;

use Symfony\Component\HttpKernel\Bundle\Bundle;

class AcmeFooBundle extends Bundle
{
    public function build(ContainerBuilder $container)
    {
        parent::build($container);

        // ...
 
        // Retrieve "ezpublish" container extension.
        $eZExtension = $container->getExtension('ezpublish');
        // Add the policy provider.
        $eZExtension->addPolicyProvider(new MyPolicyProvider());
    }
}
```

### <span>Core policies</span>

<span> <span>Policies used internally in repository services are defined in </span> `             EzPublishCoreBundle/Resources/config/policies.yml           ` <span>.</span> </span>

## SPI and API repositories

Those repositories are read-only split of `ezsystems/ezpublish-kernel`, made available to make dependencies easier and more lightweight.

### API

This package is a split of the eZ Publish 5 public API. It includes the **services interfaces** and **domain objects** from the `eZ\Publish\API` namespace.
It offers a lightweight way to make your project depend on the eZ API and Domain objects, without depending on the whole ezpublish-kernel.
The repository is read-only, automatically updated from <a href="https://github.com/ezsystems/ezpublish-kernel" class="uri">https://github.com/ezsystems/ezpublish-kernel</a>.

Requiring ezpublish-api in your project:

``` brush:
"require": {
    "ezsystems/ezpublish-api": "~5.0"
}
```

### SPI

This package is a split of the eZ Publish 5 SPI (persistence interfaces).

It can be used as a dependency, instead of the whole ezpublish-kernel, by packages implementing **custom eZ Publish storage engines**, or by any package that requires **classes from the eZ\\Publish\\SPI namespace**.

The repository is read-only, automatically updated from <a href="https://github.com/ezsystems/ezpublish-kernel" class="uri">https://github.com/ezsystems/ezpublish-kernel</a>.

Requiring ezpublish-api in your project:

``` brush:
"require": {
    "ezsystems/ezpublish-spi": "~5.0"
}
```

 

## Signal Slots

The Signal-Slot system provides a means for realizing loosely coupled dependencies in the sense that a code entity A can react on an event occurring in code entity B, without A and B knowing each other directly. This works by dispatching event information through a central third instance, the so called dispatcher:

<span class="confluence-embedded-file-wrapper image-center-wrapper"><img src="attachments/31432023/32113045.png" class="confluence-embedded-image image-center" /></span>

 

In the shown schematics, object B and one other object are interested in a certain signal. B is a so-called Slot that can be announced to be interested in receiving a Signal (indicated by the circular connector to the dispatcher). Object A now sends the corresponding Signal. The Dispatcher takes care of realizing the dependency and informs the Slot A (and one other Slot) about the occurrence of the Signal.

Signals roughly equal events, while Slots roughly equal event handlers. An arbitrary number (0…n) of Slots can listen for a specific Signal. Every object that receives the Dispatcher as a dependency can send signals. However, the following conditions apply (that typically do not apply to event handling systems):

-   A Slot cannot return anything to the object that issued a signal
-   It is not possible for a Slot to stop the propagation of a Signal, i.e. all listening Slots will eventually receive the Signal

Those two conditions allow the asynchronous processing of Slots. That means: It is possible to determine, by configuration, that a Slot must not receive a Signal in the very same moment it occurs, but to receive it on a later point in time, maybe after other Signals from a queue have been processed or even on a completely different server.

### Signal

A Signal represents a specific event, e.g. that a content version has been published. It consists of information that is significant to the event, e.g. the content ID and version number. Therefore, a Signal is represented by an object of a class that is specific to the Signal and that extends from `eZ\Publish\Core\SignalSlot\Signal`. The full qualified name of the Signal class is used to uniquely identify the Signal. For example, the class `eZ\Publish\Core\SignalSlot\Signal\ContentService\PublishVersionSignal` identifies the example Signal.

In order to work properly with asynchronous processing, Signals must not consist of any logic and must not contain complex data structures (such as further objects and resources). Instead, they must be exportable using the `__set_state()` method, so that it is possible to transfer a Signal to a different system.

Note

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Signals can theoretically be sent by any object that gets hold of a SignalDispatcher (`eZ\Publish\Core\SignalSlot\SignalDispatcher`). However, at a first stage, **Signals are only sent by special implementations of the Public API to indicate core events**. These services must and will be used by default and will wrap the original service implementations.

### Slot

A Slot extends the system by realizing functionality that is executed when a certain Signal occurs. To implement a Slot, you must create a class that derives from `eZ\Publish\Core\SignalSlot\Slot`. The full qualified name of the Slot class is also used as the unique identifier of the Slot. The Slot base class requires you to implement the single method `receive()`. When your Slot is configured to listen to a certain Signal and this Signal occurs, the `receive()` method of your Slot is called.

Inside the `receive()` method of your Slot you can basically realize any kind of logic. However, it is recommended that you only dispatch the action to be triggered to a dedicated object. This allows you to trigger the same action from within multiple Slots and to re-use the implementation from a completely different context.

Note that, due to the nature of Signal-Slot, the following requirements must be fulfilled by your Slot implementation:

-   A Slot must not return anything to the Signal issuer
-   A Slot must be aware that it is potentially executed delayed or even on a different server

**Important**: A single Slot should not take care of processing more than one Signal. Instead, if you need to trigger same or similar actions as different Signals occur. you should encapsulate these actions into a dedicated class, of which your Slots receive an instance to trigger this action.

### Example: Updating URL aliases

Updating URL aliases is a typical process that can be realized through a Signal-Slot extension for different reasons:

-   The action must be triggered on basis of different events (e.g. content update, location move, etc.)
-   Direct implementation would involve complex dependencies between otherwise unrelated services
-   The action is not critical to be executed immediately, but can be made asynchronous, if necessary

As a first step it needs to be determined for which Signals we need to listen in order to update URL aliases. Some of them are:

-   `eZ\Publish\Core\SignalSlot\Signal\ContentService\PublishVersionSignal`
-   `eZ\Publish\Core\SignalSlot\Signal\LocationService\CopySubtreeSignal`
-   `eZ\Publish\Core\SignalSlot\Signal\LocationService\MoveSubtreeSignal`
-   …

There are of course additional Signals that trigger an update of URL aliases, but these are left out for simplicity here.

Now that we identified some Signals to react upon, we can start implementing Slots for these signals. For the first Signal, which is issued as soon as a new version of Content is published, there exists a method in `eZ\Publish\SPI\Persistence\Content\UrlAlias\Handler` for exactly that purpose: `publishUrlAliasForLocation()`. The Signal contains the ID of the content item and its newly published version number. Using this information, the corresponding Slot can fulfill its purposes with the following steps:

1.  Load the corresponding content and its locations
2.  Call the URL alias creation method for each location

To achieve this, the Slot has 2 dependencies:

-   `eZ\Publish\SPI\Persistence\Content\Handler`
    to load the content itself in order to retrieve the names
-   `eZ\Publish\SPI\Persistence\Content\Location\Handler`
    to load the locations
-   `eZ\Publish\SPI\Persistence\Content\UrlAlias\Handler`
    to create the aliases for each location

So, a stub for the implementation could look like this:

``` brush:
namespace Acme\TestBundle\Slot;

use eZ\Publish\Core\SignalSlot\Slot as BaseSlot;
use eZ\Publish\API\Repository\Repository;
use eZ\Publish\SignalSlot\Signal;

class CreateUrlAliasesOnPublishSlot extends BaseSlot
{
    /**
     * @var \eZ\Publish\API\Repository\Repository
     */
    private $repository;
    public function __construct( Repository $repository )
    {
        $this->repository = $repository;
    }

    public function receive( Signal $signal )
    {
        if ( !$signal instanceof Signal\ContentService\PublishVersionSignal )
        {
            return;
        }
        // Load content
        // Load locations
        // Create URL aliases
    }
}
```

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
In order to make the newly created Slot react on the corresponding Signal, the following steps must be performed:

1.  Make the Slot available through the Symfony service container as a service
2.  Register the Slot to react to the Signal of type `eZ\Publish\Core\SignalSlot\Signal\ContentService\PublishVersionSignal`

See the [Listening to Core events](Listening-to-Core-events_31429796.html) recipe in the developer cookbook for more information.

 

 

 

 

Important note about template matching

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
**Template matching will NOT work if your content contains a Field Type that is not supported by the repository**. It can be the case when you are in the process of a migration from eZ Publish 4.x, where custom datatypes have been developed.

In this case the repository will throw an exception, which is caught in the `ViewController`, <span>and *if* you are using LegacyBridge it will end up doing a </span> [**<span class="confluence-link">fallback to legacy kernel</span>**](https://doc.ez.no/display/EZP/Legacy+template+fallback).

The list of Field Types supported out of the box [is available here](Field-Types-reference_31430495.html).

-   [Introduction](#Repository-Introduction)
    -   [Locations](#Repository-LocationsLocations)
        -   [Top level Locations](#Repository-ToplevelLocations)
        -   [Location visibility](#Repository-Locationvisibility)
    -   [Content Relations](#Repository-ContentRelations)
    -   [Sections](#Repository-Sections)
    -   [Permissions](#Repository-Permissions)
        -   [Overview](#Repository-Overview)
        -   [Model](#Repository-Model)
    -   [Persistence Cache](#Repository-PersistenceCache)
-   [Configuration](#Repository-Configuration)
    -   [Content Repository Configuration](#Repository-ContentRepositoryConfiguration)
        -   [Configuration examples](#Repository-Configurationexamples)
        -   [Field groups configuration](#Repository-Field_groups_configurationFieldgroupsconfiguration)
        -   [Limit of archived Content item versions](#Repository-LimitofarchivedContentitemversions)
    -   [Persistence cache configuration](#Repository-Persistencecacheconfiguration)
        -   [Configuration](#Repository-Configuration.1)
        -   [Stash cache backend configuration](#Repository-Stashcachebackendconfiguration)
-   [Usage](#Repository-Usage)
    -   [Using Cache Service](#Repository-UsingCacheService)
        -   [Using the cache service](#Repository-Usingthecacheservice)
        -   [Clearing Persistence cache](#Repository-ClearingPersistencecache)
    -   [Binary files URL handling](#Repository-BinaryfilesURLhandling)
        -   [IO URL decoration](#Repository-IOURLdecoration)
        -   [Using a static server for images](#Repository-Usingastaticserverforimages)
    -   [Regenerating URL Aliases](#Repository-RegeneratingURLAliases)
-   [Reference](#Repository-Reference)
    -   [Services: Public API](#Repository-Services:PublicAPI)
    -   [Signals Reference](#Repository-SignalsReference)
    -   [Limitations Reference](#Repository-LimitationsReference)
        -   [List of Limitations](#Repository-ListofLimitations)
-   [Extensibility](#Repository-Extensibility)
    -   [Permissions](#Repository-Permissions.1)
    -   [Custom Policies](#Repository-CustomPolicies)
        -   [Description](#Repository-Description)
        -   [PolicyProvider](#Repository-PolicyProvider)
        -   [Example](#Repository-Example)
        -   [YamlPolicyProvider](#Repository-YamlPolicyProvider)
        -   [Integrating the PolicyProvider into EzPublishCoreBundle](#Repository-IntegratingthePolicyProviderintoEzPublishCoreBundle)
        -   [Core policies](#Repository-Corepolicies)
    -   [SPI and API repositories](#Repository-SPIandAPIrepositories)
        -   [API](#Repository-API)
        -   [SPI](#Repository-SPI)
    -   [Signal Slots](#Repository-SignalSlots)
        -   [Signal](#Repository-Signal)
        -   [Slot](#Repository-Slot)
        -   [Example: Updating URL aliases](#Repository-Example:UpdatingURLaliases)

#### Related:

-   [Overview of steps to set up Cluster](Steps-to-set-up-Cluster_31432321.html) [:](#Repository-Persistencecacheconfiguration)
    -   [Set up DFS IO Handler](Clustering_31430387.html)
    -   [Set up Varnish](HTTP-Cache_31430152.html#HTTPCache-UsingVarnish)
    -   <span class="confluence-link"> [Configure sessions](Sessions_31429667.html) </span>

## Attachments:

<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [admin\_panel\_users.png](attachments/31432023/32112931.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [content\_structure\_media\_library.png](attachments/31432023/32112932.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [node\_visibility\_hide.png](attachments/31432023/32112933.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [node\_visibility\_hide\_invisible.png](attachments/31432023/32112934.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [node\_visibility\_unhide1.png](attachments/31432023/32112935.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [node\_visibility\_unhide2.png](attachments/31432023/32112936.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [SPI Cache.png](attachments/31432023/32112970.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [schematics.png](attachments/31432023/32113045.png) (image/png)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Community Resources](Community-Resources_31429530.html)</span>

 Developer : Resources 



-   **<a href="https://ezplatform.com/" class="uri">https://ezplatform.com/</a> - The Developer Hub**
    The best place to start for all things eZ Platform!
    -   Downloads
    -   Developer Blog
    -   <a href="http://ez-community-on-slack.herokuapp.com/">eZ Community Slack team<br />
        </a>The place to discuss eZ Platform with Community members, developers, and other like-minded individuals.
-   **<a href="http://ez.no">ez.no</a> - The corporate website for eZ Systems**
    Here you can find overviews of the products, contact information, and a wealth of additional <a href="http://ez.no/Resources/">resources</a>such as use cases, webinars and e-books.
    -   <a href="http://ez.no/Blog">eZ Blog</a> - Current insights from the eZ world.
    -   <a href="http://ez.no/Partner-Portal">Partner Portal</a> - For eZ Business Partners with a knowledge and sales resource repository.
    -   <a href="http://share.ez.no/" class="uri">http://share.ez.no/</a> - The Legacy (ez Publish) Portal

 

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Cookbook](Cookbook_31429528.html)</span>

 Developer : Retrieving root location 



# Description

Knowledge of the root location is important since it can be a starting point for API queries, or even links to home page, but as eZ Platform can be used [for multisite development](Multisite_31430389.html), the **root location can vary**.

By default, the root location ID is `2`, but as it can be easily be changed by configuration, **the best practice is to retrieve it dynamically**.

# Solution

## Retrieving root location ID

Root location ID can be retrieved easily from <span class="confluence-link"> </span><span class="confluence-link"><span class="confluence-link"><span class="confluence-link"><span class="confluence-link">[ConfigResolver](https://doc.ez.no/display/DEVELOPER/SiteAccess#SiteAccess-Configuration)</span></span></span></span>. The parameter name is `           content.tree_root.location_id         `.

**In a controller**

``` brush:
<?php
namespace Acme\TestBundle\Controller;

use eZ\Bundle\EzPublishCoreBundle\Controller;


class DefaultController extends Controller
{
    public function fooAction()
    {
        // ...
 
        $rootLocationId = $this->getConfigResolver()->getParameter( 'content.tree_root.location_id' );
 
        // ...
    }
}
```

## Retrieving the root location

### From a template

Root location is exposed in the [global Twig helper](https://doc.ez.no/display/DEVELOPER/Design#Design-TwigHelper).

**Making a link to homepage**

``` brush:
<a href="{{ path( ezpublish.rootLocation ) }}" title="Link to homepage">Home page</a>
```

### From a controller

``` brush:
<?php
namespace Acme\TestBundle\Controller;

use eZ\Bundle\EzPublishCoreBundle\Controller;

class DefaultController extends Controller
{
    public function fooAction()
    {
        // ...

        $rootLocation = $this->getRootLocation();

        // ...
    }
}
```

 

 

#### In this topic:

-   [Description](#Retrievingrootlocation-Description)
-   [Solution](#Retrievingrootlocation-Solution)
    -   [Retrieving root location ID](#Retrievingrootlocation-RetrievingrootlocationID)
    -   [Retrieving the root location](#Retrievingrootlocation-Retrievingtherootlocation)
        -   [From a template](#Retrievingrootlocation-Fromatemplate)
        -   [From a controller](#Retrievingrootlocation-Fromacontroller)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>
6.  <span>[Content items, Content Types and Fields](31430275.html)</span>
7.  <span>[Field Types reference](Field-Types-reference_31430495.html)</span>

 Developer : RichText Field Type 



<span style="color: rgb(0,0,0);">This Field Type validates and stores structured rich text, and exposes it in several formats.</span>

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Internal name</th>
<th align="left">Expected input</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><pre><code>RichText</code></pre></td>
<td align="left"><pre><code>ezrichtext</code></pre></td>
<td align="left"><pre><code>mixed</code></pre></td>
</tr>
</tbody>
</table>

## PHP API Field Type 

### Input expectations

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Description</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><pre><code>string</code></pre></td>
<td align="left">XML document in one of the Field Type's input formats as a string.</td>
<td align="left">See the example below.</td>
</tr>
<tr class="even">
<td align="left"><pre><code>DOMDocument</code></pre></td>
<td align="left"><p><span><span>XML document in one of the Field Type's input formats as a</span></span></p>
<p><strong><code>DOMDocument</code></strong> object.</p></td>
<td align="left">See the example below.</td>
</tr>
<tr class="odd">
<td align="left"><pre><code>eZ\Publish\Core\FieldType\RichText\Value</code></pre></td>
<td align="left">An instance of the Field Type's <strong><code>Value</code></strong> object.</td>
<td align="left">See the example below.</td>
</tr>
</tbody>
</table>

##### Input formats

<span style="color: rgb(0,0,0);">Field Type works with XML and also expects an XML value as input, whether as a string, **`DOMDocument`**<span> object or <span>Field Type's </span>**`Value`**<span> object. When the value is given as a string or a **`DOMDocument`**<span style="color: rgb(0,0,0);"> object, it </span>will be checked for conformance with one of the supported input formats, then dispatched to the appropriate converter, to be converted to the Field Type's internal format. No conversion will be performed if providing the value in Field Type's internal format or as <span>Field Type's </span>**`Value`**<span> object. In the latter case it will be expected that **`Value`**<span style="color: rgb(0,0,0);"> object holds the value in Field Type's internal format.</span></span></span></span></span>

<span style="color: rgb(0,0,0);"><span><span>Currently supported input formats are described in the table below:</span></span></span>

| Name                       | Description                                                                                                                                                                   |
|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| eZ Publish Docbook variant | FieldType's internal format                                                                                                                                                   |
| XHTML5 editing format      | Typically used with in-browser HTML editor                                                                                                                                    |
| Legacy eZXML format        | Compatibility with legacy eZXML format, used by <span class="confluence-link"> </span>[XmlText Field Type](XmlText-Field-Type_31430551.html)<span style="color: rgb(0,0,0);"> 
                              </span>                                                                                                                                                                        |

##### Example of the Field Type's internal format

``` brush:
<?xml version="1.0" encoding="UTF-8"?>
<section xmlns="http://docbook.org/ns/docbook"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         xmlns:ezxhtml="http://ez.no/xmlns/ezpublish/docbook/xhtml"
         xmlns:ezcustom="http://ez.no/xmlns/ezpublish/docbook/custom"
         version="5.0-variant ezpublish-1.0">
    <title ezxhtml:level="2">This is a title.</title>
    <para ezxhtml:class="paraClass">This is a paragraph.</para>
</section>
```

##### Example of the Field Type's XHTML5 edit format

<span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
This format is used by eZ Platform Online Editor and will change with its needs as we continue to evolve this part of the UI.

<span style="color: rgb(0,0,0);">
</span>

``` brush:
<?xml version="1.0" encoding="UTF-8"?>
<section xmlns="http://ez.no/namespaces/ezpublish5/xhtml5/edit">
    <h2>This is a title.</h2>
    <p class="paraClass">This is a paragraph.</p>
</section>
```

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
For more information about internal format and input formats, see <a href="https://github.com/ezsystems/ezpublish-kernel/tree/master/eZ/Publish/Core/FieldType/Tests/RichText/Converter/Xslt/_fixtures">Field Type's conversion test fixtures on GitHub</a>.

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
For example, ezxml does not use explicit level attributes for &lt;header&gt; elements, instead &lt;header&gt; element levels are indicated through the level of nesting inside &lt;section&gt; elements.

##### Example of using XML document in internal format as a string

``` brush:
...
 
$contentService = $repository->getContentService();
$contentTypeService = $repository->getContentTypeService();
 
$contentType = $contentTypeService->loadContentTypeByIdentifier( "article" );
$contentCreateStruct = $contentService->newContentCreateStruct( $contentType, "eng-GB" );
 
$inputString = <<<DOCBOOK
<?xml version="1.0" encoding="UTF-8"?>
<section xmlns="http://docbook.org/ns/docbook"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         xmlns:ezxhtml="http://ez.no/xmlns/ezpublish/docbook/xhtml"
         xmlns:ezcustom="http://ez.no/xmlns/ezpublish/docbook/custom"
         version="5.0-variant ezpublish-1.0">
    <title ezxhtml:level="2">This is a title.</title>
    <para ezxhtml:class="paraClass">This is a paragraph.</para>
</section>
DOCBOOK;
 
$contentCreateStruct->setField( "description", $inputString );
 
...
```

### Value object

<span style="color: rgb(0,0,0);">**`eZ\Publish\Core\FieldType\RichText\Value`** offers following properties:</span>

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Property</th>
<th align="left">Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><pre><code>xml</code></pre></td>
<td align="left"><pre><code>DOMDocument</code></pre></td>
<td align="left">Internal format value as an instance of <span><code>DOMDocument</code>.</span></td>
</tr>
</tbody>
</table>

## REST API specifics

### Creating or updating Content

<span style="color: rgb(0,0,0);">When creating RichText content with the REST API, it is possible to provide data as a string, using the "`xml`" fieldValue key:</span>

``` brush:
<fieldValue>
    <value key="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;section xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:ezxhtml="http://ez.no/xmlns/ezpublish/docbook/xhtml" xmlns:ezcustom="http://ez.no/xmlns/ezpublish/docbook/custom" version="5.0-variant ezpublish-1.0"&gt;
&lt;title ezxhtml:level="2"&gt;This is a title.&lt;/title&gt;
&lt;/section&gt;
</value>
</fieldValue>
```

<span style="color: rgb(0,0,0);">When the value given over REST API is transformed into a <span>Field Type's </span>**`Value`**<span> object, it will be treated as a string. This means you can use any supported input format for input over REST</span> API.</span>

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
For further informations <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/doc/specifications/rich_text/ezdocbook.md">about the internal implementation of RichText Field Type, see in the doc/ directory</a>

<span style="color: rgb(0,0,0);">
</span>

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Repository](Repository_31432023.html)</span>

 Developer : Role Policies Map 



## Retrieving the Role Policies

To retrieve the Roles Policies, on a working eZ Platform instance, in dev environment open the file `app/cache/dev/appDevDebugProjectContainer.xml`

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
<span style="color: rgb(0,0,0);">If you can not find the file, please reload the homepage. The cache will be regenerated.</span>

Then open it and look for `ezpublish.api.role.policy_map`, it will look like this:

**ezpublish.api.role.policy\_map entry in the app/cache/dev/appDevDebugProjectContainer.xml file**

``` brush:
    <parameter key="ezpublish.api.role.policy_map" type="collection">
        <parameter key="content" type="collection">           
        <parameter key="read" type="collection">
        <parameter key="Class">true</parameter>
```

-   The 1st sublevel ("content") is a module.
-   The 2nd sublevel ("read") is a function.
-   The 3rd sublevel ("Class") is a limitation.

## Module, function and limitations

Each Module contains functions, and for each function, you have limitations. The default values are shown below.

There are 4 modules:

-   content
-   section
-   state
-   user

### Content

content Module
### Functions

### Limitations

 
Class
Section
Owner
Node
Subtree
Group
Language
Other Limitations
read
true
true
true
true
true
<span class="inline-comment-marker" data-ref="5af04e85-5364-46a4-a366-7df785d9a977">true</span>
-
-   State

diff
true
true
true
true
true
-
-
-
view\_embed
true
true
true
true
true
-
-
-
create
true
true
-
true
true
-
true
-   <span class="pl-s1"> <span class="pl-s">ParentOwne*r* </span>*<span class="pl-s"> </span>*</span>
-   ParentGroup<span class="pl-s1">
    </span>
-   ParentClass<span class="pl-s1">
    </span>
-   ParentDepth<span class="pl-s1">
    </span>

edit
true
true
true
true
true
true
true
-   State

<span class="status-macro aui-lozenge aui-lozenge-current">V1.8</span>

publish

true
true
true
true
true
true
true
-   State

manage\_locations
true
true
true
 
true
-
-
-
hide
true
true
true
true
true
true
true
-   State

translate
true
true
true
true
true
 
true
-
remove
true
true
true
true
true
-
-
-   State

versionread
true
true
true
true
true
-
-
-   <span class="inline-comment-marker" data-ref="4dac4d00-ef7d-4303-b864-200ac70fa719">Status</span>

versionremove
true
true
true
treu
true
-
-
-   Status

pdf
true
true
true
true
true
-
-
-

### Section

section Module
Function
Limitations
assign
-   <span class="pl-s1"><span class="pl-s">Class</span><span class="pl-k"> </span><span class="pl-s">
    </span></span>
-   <span class="pl-s1"><span class="pl-s">Section</span> *<span class="pl-s1"> </span>*</span>
-   <span class="pl-s1"> <span class="pl-s">Owner</span>*<span class="pl-c1"> </span>*</span>
-   <span class="pl-s1"><span class="pl-c1">NewSection</span></span><span class="pl-s1"><span class="pl-c1">
    </span></span>

### State

 

state Module
 Function
Limitations
 assign
-   Class
-   Section
-   Owner
-   NewSection

### User

user Module
 Function
Limitations
 login
-   Siteaccess

#### In this topic:

-   [Retrieving the Role Policies](#RolePoliciesMap-RetrievingtheRolePolicies)
-   [Module, function and limitations](#RolePoliciesMap-Module,functionandlimitations)
    -   [Content](#RolePoliciesMap-Content)
    -   [Functions](#RolePoliciesMap-Functions)
    -   [Limitations](#RolePoliciesMap-Limitations)
    -   [Section](#RolePoliciesMap-Section)
    -   [State](#RolePoliciesMap-State)
    -   [User](#RolePoliciesMap-User)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Search](Search_31429673.html)</span>

 Developer : Search Criteria Reference 



**Criteria** are the filters for Content and Location Search, for generic use of API Search see [<span class="confluence-link">Search Criteria and Sort Clauses</span>](Search_31429673.html#Search-SearchCriteriaandSortClauses)<span class="confluence-link"> </span>.

A Criterion consist of two parts just like <span class="confluence-link">SortClause</span> and FacetBuilder:

-   The API Value: `Criterion`
-   Specific handler per search engine: `Criterion Handler`

`Criterion` represents the value you use in the API, while `CriterionHandler` deals with the business logic in the background translating the value to something the Search engine can understand.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Implementation and availability of a handler typically depends on search engine capabilities and limitations, currently only Legacy (SQL) Search Engine exists, and for instance its support for FullText and Field Criterion is not optimal and it is advised to avoid heavy use of these until future search engine arrives.

### Common concepts for most Criteria

For how to use each and every Criterion see the list below, as it depends on the Criterion Value constructor, but *in general* you should be aware of the following common concepts:

-   `target`: Exposed if the given Criterion supports targeting a specific sub field, example: FieldDefinition or Meta Data identifier
-   `value`: The value(s) to *filter* on, this is typically a  `scalar` or `array` of` scalars.`
-   `operator`: Exposed on some Criteria
    -   All operators can be seen as constants on `eZ\Publish\API\Repository\Values\Content\Query\Criterion\Operator`, at time of writing: `IN, EQ, GT, GTE, LT, LTE, LIKE, BETWEEN, CONTAINS`
    -   Most Criteria do not expose this and select `EQ` **or** `IN` depending on if value is `scalar` **or** `array`
    -   `IN` & `BETWEEN         `always acts on an `array` of values, while the other operators act on single `scalar` value
-   <span> `valueData` : <span class="pl-s1"> <span class="pl-c">Additional value data, required by some Criteria, MapLocationDistance for instance</span> </span> </span>

 

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
In the Legacy search engine, the field index/sort key column is limited to 255 characters by design.
Due to this storage limitation, searching content using the eZ Country Field Type or Keyword when there are multiple values selected may not return all the expected results.

<span> <span class="pl-s1"> <span class="pl-c">
</span> </span> </span>

### List of Criteria

The list below reflects Criteria available in the `eZ\Publish\API\Repository\Values\Content\Query\Criterion` namespace (it is also possible to <span class="confluence-link">make a custom Criterion</span>):

#### Only for LocationSearch

| Criterion                 | Constructor arguments description                                                                                                                                                      |
|---------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `Location\Depth`          | `operator` (`IN, EQ, GT, GTE, LT, LTE, BETWEEN`), `value` being the Location depth(s) as an integer(s).                                                                                |
| `Location\IsMainLocation` | Whether or not the Location is a Main Location                                                                                                                                         
                             `value` (`Location\IsMainLocation::MAIN`, `Location\IsMainLocation::NOT_MAIN`).                                                                                                         |
| `Location\Priority`       | Priorities are integers that can be used for sorting in ascending or descending order. What is higher or lower priority in relation to the priority number is left to the user choice. 
                             `operator` (`GT, GTE, LT, LTE, BETWEEN`), `value` being the location priority(s) as an integer(s).                                                                                      |

 

#### Common

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Criterion</th>
<th align="left">Constructor arguments description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>ContentId</code></td>
<td align="left"><span> <code>value </code>being scalar(s) representing the Content id.</span></td>
</tr>
<tr class="even">
<td align="left"><code>ContentTypeGroupId</code></td>
<td align="left"><code>value </code>being <span> scalar(s) representing the Content Typ eGroup id.</span></td>
</tr>
<tr class="odd">
<td align="left"><code>ContentTypeId</code></td>
<td align="left"><code>value </code>being <span> scalar(s) representing the Content Type id.</span></td>
</tr>
<tr class="even">
<td align="left"><code>           ContentTypeIdentifier                </code></td>
<td align="left"><code>value </code>being <span> string(s) representing the Content Type identifier, example: &quot;article&quot;.</span></td>
</tr>
<tr class="odd">
<td align="left"><code>DateMetadata</code></td>
<td align="left"><span> <code>target (</code> <code>DateMetadata</code> </span> <span> <code>::MODIFIED</code> <code>, DateMetadata</code> </span> <code>::CREATED), operator</code> (<code>IN, EQ, GT, GTE, LT, LTE</code>, <code>           BETWEEN</code>), <code>           value</code> being <span>integer</span>(s) representing unix timestamp.</td>
</tr>
<tr class="even">
<td align="left"><code>Field</code></td>
<td align="left"><p><span> <code>target</code> <code>(</code>FieldDefinition identifier</span> <code>), operator</code> <span> (</span> <code>                   IN, EQ, GT, GTE, LT, LTE</code>, LIKE, <span> </span> <code>             BETWEEN, CONTAINS</code>), <code>             value</code> <span> being</span> <span> scalar(s) relevant for the field.</span></p></td>
</tr>
<tr class="odd">
<td align="left"><code>FieldRelation</code></td>
<td align="left"><span> <code>target</code> <code>(</code>FieldDefinition identifier</span> <code>), operator</code> <span> (</span> <code>                 IN</code> <code>                 , CONTAINS</code>), <code>                 value</code> <span> being</span> <span> array of scalars representing Content id of relation.<br />
<em>Use of <code>IN</code> means relation needs to have one of the provided ID's, while <code>CONTAINS</code> implies it needs to have all provided id's.</em> </span></td>
</tr>
<tr class="even">
<td align="left"><code>FullText</code></td>
<td align="left"><p><code>value</code> being the string to search for, <code>properties</code> is array to set additional properties for use with future search engines like Solr/ElasticSearch.</p></td>
</tr>
<tr class="odd">
<td align="left"><code>LanguageCode</code></td>
<td align="left"><code>value</code> being string(s) representing Language Code(s) on the Content (<em>not</em> on <a href="https://jira.ez.no/browse/EZP-23524">Fields</a>), <code>matchAlwaysAvailable</code> as boolean.</td>
</tr>
<tr class="even">
<td align="left"><code>LocationId</code></td>
<td align="left"><code>value</code> being <span> scalar(s) representing the Location id.</span></td>
</tr>
<tr class="odd">
<td align="left"><code>LocationRemoteId</code></td>
<td align="left"><code>value</code> being <span> string(s) representing the Location Remote id.</span></td>
</tr>
<tr class="even">
<td align="left"><code>LogicalAnd</code></td>
<td align="left">A <span> <code>LogicalOperator</code> that takes <code>array</code> of other Criteria, makes sure all Criteria match.</span></td>
</tr>
<tr class="odd">
<td align="left"><code>LogicalNot</code></td>
<td align="left"><span>A </span> <span> <code>LogicalOperator</code> that takes <code>array</code> of other Criteria, makes sure none of the Criteria match.</span></td>
</tr>
<tr class="even">
<td align="left"><code>LogicalOr</code></td>
<td align="left"><span>A </span> <span> <code>LogicalOperator</code> that takes <code>array</code> of other Criteria, makes sure one of the Criteria match.</span></td>
</tr>
<tr class="odd">
<td align="left"><code>MapLocationDistance</code></td>
<td align="left"><span> <code>target</code> <code>(</code>FieldDefinition identifier</span> <code>), operator</code> <span> (</span> <code>           IN, EQ, GT, GTE, LT, LTE</code>, <code>           BETWEEN</code>), <code> distance</code> <span> as</span> <span> float(s) from a position using <code> latitude            </code> <span> as</span> <span> float</span> <code>,</code> <code>             longitude</code> <span> as</span> <span> float as arguments<br />
</span> </span></td>
</tr>
<tr class="even">
<td align="left"><code>MatchAll</code></td>
<td align="left"><em>No arguments, mainly for internal use when no <code>filter</code> or <code>query</code> is provided on <code>Query</code> object.</em></td>
</tr>
<tr class="odd">
<td align="left"><code>MatchNone</code></td>
<td align="left"><em><em>No arguments, m</em>ainly for internal use by <a href="BlockingLimitation_31430461.html">BlockingLimitation</a>.</em></td>
</tr>
<tr class="even">
<td align="left"><code>ObjectStateId</code></td>
<td align="left"><code>value</code> being <span> string(s) representing the Content ObjectState id.</span></td>
</tr>
<tr class="odd">
<td align="left"><code>ParentLocationId</code></td>
<td align="left"><p><span>value being scalar(s) representing the Parent's Location id</span></p></td>
</tr>
<tr class="even">
<td align="left"><code>RemoteId</code></td>
<td align="left"><code>value</code> being <span> string(s) representing the Content Remote id.</span></td>
</tr>
<tr class="odd">
<td align="left"><code>SectionId</code></td>
<td align="left"><code>value</code> being <span> scalar(s) representing the Content Section id.</span></td>
</tr>
<tr class="even">
<td align="left"><code>Subtree</code></td>
<td align="left"><code>value</code> being <span> string(s) representing the Location id in which you can filter. <em>If the Location Id is  /1/2/20/42, you will filter everything under 42.</em><br />
</span></td>
</tr>
<tr class="odd">
<td align="left"><code>UserMetadata</code></td>
<td align="left"><span> <code>target (UserMetadata           </code> </span> <span> <code>::OWNER</code> <code>, UserMetadata           </code> </span> <code>::GROUP , UserMetadata</code> <code>::MODIFIER</code>), <code>operator</code> (<code>IN, EQ</code> <code>),</code> <code> value</code> <span> being </span> <span>scalars</span> <span>(s) representing the User or User Group id(s).</span></td>
</tr>
<tr class="even">
<td align="left"><code>Visibility</code></td>
<td align="left"><span> <code>value (Visibility           </code> </span> <span> <code>::VISIBLE</code> <code>, Visibility           </code> </span> <code>::HIDDEN),</code> <em>Note: This acts on all assigned locations when used with ContentSearch, meaning hidden content will be returned if it has a location which is visible. Use LocationSearch to avoid this.</em></td>
</tr>
</tbody>
</table>

#### In this topic:

-   [Common concepts for most Criteria](#SearchCriteriaReference-CommonconceptsformostCriteria)
-   [List of Criteria](#SearchCriteriaReference-ListofCriteria)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Search](Search_31429673.html)</span>

 Developer : Search Engines 



#### Available search engines:

-   [Solr Bundle](Solr-Bundle_31430592.html)
-   [ElasticSearch Bundle](ElasticSearch-Bundle_31430579.html)
-   [Legacy Search Engine Bundle](Legacy-Search-Engine-Bundle_31430581.html)

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : Search 



# Introduction

eZ Platform exposes very powerful Search API, allowing both Full Text search and querying the content repository using several built-in <span class="confluence-link">Criteria</span> and <span class="confluence-link">Sort Clauses</span>. These are supported across several search engines, allowing you to plug in another search engine without changing your code.

## Available Search Engines

Currently 3 search engines exists on their own eZ Platform Bundles:

1.  [Legacy](Legacy-Search-Engine-Bundle_31430581.html), a database-powered search engines for basic needs.
2.  [Solr](Solr-Bundle_31430592.html), an integration providing better overall performance, much better scalability and support for more advance search capabilities <span class="status-macro aui-lozenge aui-lozenge-success">RECOMMENDED</span>
3.  [ElasticSearch](ElasticSearch-Bundle_31430579.html), similar to Solr integration, however currently not under active development <span class="status-macro aui-lozenge aui-lozenge-error">EXPERIMENTAL, NOT SUPPORTED</span>

 

 

# Usage

## Search Criteria and Sort Clauses

<span class="confluence-link">Search <span class="confluence-link">Criteria</span></span><span class="confluence-link"> </span> and <span class="confluence-link">Sort Clauses</span> are `value` object classes used for building Search Query, to define filter criteria and ordering of the result set. eZ Platform provides a number of standard Criteria and Sort Clauses that you can use out of the box and that should cover the majority of use cases.

**Example of standard ContentId criterion**

``` brush:
<?php

namespace eZ\Publish\API\Repository\Values\Content\Query\Criterion;

use eZ\Publish\API\Repository\Values\Content\Query\Criterion;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion\Operator\Specifications;
use eZ\Publish\API\Repository\Values\Content\Query\CriterionInterface;

/**
 * A criterion that matches content based on its id
 *
 * Supported operators:
 * - IN: will match from a list of ContentId
 * - EQ: will match against one ContentId
 */
class ContentId extends Criterion implements CriterionInterface
{
    /**
     * Creates a new ContentId criterion
     *
     * @param int|int[] $value One or more content Id that must be matched.
     *
     * @throws \InvalidArgumentException if a non numeric id is given
     * @throws \InvalidArgumentException if the value type doesn't match the operator
     */
    public function __construct( $value )
    {
        parent::__construct( null, null, $value );
    }

    public function getSpecifications()
    {
        $types = Specifications::TYPE_INTEGER | Specifications::TYPE_STRING;
        return array(
            new Specifications( Operator::IN, Specifications::FORMAT_ARRAY, $types ),
            new Specifications( Operator::EQ, Specifications::FORMAT_SINGLE, $types ),
        );
    }

    public static function createFromQueryBuilder( $target, $operator, $value )
    {
        return new self( $value );
    }
}
```

### Search Engine Handling of Search Criteria and Sort Clauses

As <span class="confluence-link">Search Criteria</span> and <span class="confluence-link">Sort Clauses</span> are `value` objects which are used to define the Query from API perspective, they are are common for all storage engines. Each storage engine needs to implement its own `handler` for corresponding Criterion and Sort Clause `value` object, which will be used to translate the value object into storage specific search query.

**Example of ContentId criterion handler in Legacy Storage Engine**

``` brush:
<?php

namespace eZ\Publish\Core\Search\Legacy\Content\Common\Gateway\CriterionHandler;

use eZ\Publish\Core\Search\Legacy\Content\Common\Gateway\CriterionHandler;
use eZ\Publish\Core\Search\Legacy\Content\Common\Gateway\CriteriaConverter;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion;
use eZ\Publish\Core\Persistence\Database\SelectQuery;

/**
 * Content ID criterion handler
 */
class ContentId extends CriterionHandler
{
    /**
     * Check if this criterion handler accepts to handle the given criterion.
     *
     * @param \eZ\Publish\API\Repository\Values\Content\Query\Criterion $criterion
     *
     * @return boolean
     */
    public function accept( Criterion $criterion )
    {
        return $criterion instanceof Criterion\ContentId;
    }


    /**
     * Generate query expression for a Criterion this handler accepts
     *
     * accept() must be called before calling this method.
     *
     * @param \eZ\Publish\Core\Search\Legacy\Content\Common\Gateway\CriteriaConverter $converter
     * @param \eZ\Publish\Core\Persistence\Database\SelectQuery $query
     * @param \eZ\Publish\API\Repository\Values\Content\Query\Criterion $criterion
     *
     * @return \eZ\Publish\Core\Persistence\Database\Expression
     */
    public function handle( CriteriaConverter $converter, SelectQuery $query, Criterion $criterion )
    {
        return $query->expr->in(
            $this->dbHandler->quoteColumn( "id", "ezcontentobject" ),
            $criterion->value
        );
    }
}
```

**Example of ContentId criterion handler in Solr Storage engine**

``` brush:
<?php

namespace EzSystems\EzPlatformSolrSearchEngine\Query\Content\CriterionVisitor;

use EzSystems\EzPlatformSolrSearchEngine\Query\CriterionVisitor;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion\Operator;

/**
 * Visits the ContentId criterion
 */
class ContentIdIn extends CriterionVisitor
{
    /**
     * CHeck if visitor is applicable to current criterion
     *
     * @param Criterion $criterion
     *
     * @return boolean
     */
    public function canVisit( Criterion $criterion )
    {
        return
            $criterion instanceof Criterion\ContentId &&
            ( ( $criterion->operator ?: Operator::IN ) === Operator::IN ||
              $criterion->operator === Operator::EQ );
    }


    /**
     * Map field value to a proper Solr representation
     *
     * @param Criterion $criterion
     * @param CriterionVisitor $subVisitor
     *
     * @return string
     */
    public function visit( Criterion $criterion, CriterionVisitor $subVisitor = null )
    {
        return '(' .
            implode(
                ' OR ',
                array_map(
                    function ( $value )
                    {
                        return 'id:"' . $value . '"';
                    },
                    $criterion->value
                )
            ) .
            ')';
    }
}
```

### Custom Criteria and Sort Clauses

Sometimes you will find that standard <span class="confluence-link"><span class="confluence-link">Search Criteria</span></span> and <span class="confluence-link">Sort Clauses</span> provided with eZ Publish are not sufficient for you needs. Most often this will be the case if you have developed a custom <span class="confluence-link">Field Type</span> using external storage, which therefore can not be searched using standard Field Criterion.

On use of Field Criterion/SortClause with large databases

<span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
Field Criterion/SortClause does not perform well by design when using SQL database, so if you have a large database and want to use them you either need to use Solr search engine, or develop your own Custom Criterion / Sort Clause to avoid use of attributes (Fields) database table, and instead uses a custom simplified table which can handle the amount of data you have.

In this case you can implement a custom Criterion or Sort Clause, together with the corresponding handlers for the storage engine you are using.

### Difference between Content and Location Search

These are two basic types of searches, you can either search for Locations or for Content. Each has dedicated methods in Search Service:

| Type of search | Method in Search Service |
|----------------|--------------------------|
| Content        | `findContent()`          |
| Content        | `findSingle()`           |
| Location       | `findLocations()`        |

All Criteria and Sort Clauses will be accepted with Location Search, but not all of them can be used with Content Search. Reason for this is that while one Location always has exactly one Content item, one Content item can have multiple Locations. In this context some Criteria and Sort Clauses would produce ambiguous queries and such will therefore not be accepted by Content Search.

Content Search will explicitly refuse to accept Criteria and Sort Clauses implementing these abstract classes:

-   eZ\Publish\API\Repository\Values\Content\Query\Criterion\Location

-   eZ\Publish\API\Repository\Values\Content\SortClause\Criterion\Location

### How to configure your own Criterion and Sort Clause Handlers

After you have implemented your Criterion / Sort Clause and its handler, you will need to configure the handler for the service container using dedicated service tags for each type of search. Doing so will automatically register it and handle your Criterion / Search Clause when it is given as a parameter to one of the Search Service methods.

Available tags for Criterion handlers in Legacy Storage Engine are:

-   `ezpublish.search.legacy.gateway.criterion_handler.content`
-   `ezpublish.search.legacy.gateway.criterion_handler.location`

Available tags for Sort Clause handlers in Legacy Storage Engine are:

-   `ezpublish.search.legacy.gateway.sort_clause_handler.content`
-   `ezpublish.search.legacy.gateway.sort_clause_handler.location`

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
You will find all the native handlers and the tags for the Legacy Storage Engine available in the eZ/Publish/Core/settings/storage\_engines/legacy<span class="separator">/</span>**search\_query\_handlers.yml** file.

#### Example of registering ContentId Criterion handler, common for both Content and Location Search

**Registering Criterion handler**

``` brush:
services:
    ezpublish.search.legacy.gateway.criterion_handler.common.content_id:
        class: eZ\Publish\Core\Search\Legacy\Content\Common\Gateway\CriterionHandler\ContentId
        arguments: [@ezpublish.api.storage_engine.legacy.dbhandler]
        tags:
          - {name: ezpublish.search.legacy.gateway.criterion_handler.content}
          - {name: ezpublish.search.legacy.gateway.criterion_handler.location}
```

#### Example of registering Depth Sort Clause handler for Location Search

**Registering Sort Clause handler**

``` brush:
ezpublish.search.legacy.gateway.sort_clause_handler.location.depth:
    class: eZ\Publish\Core\Search\Legacy\Content\Location\Gateway\SortClauseHandler\Location\Depth
    arguments: [@ezpublish.api.storage_engine.legacy.dbhandler]
    tags:
        - {name: ezpublish.search.legacy.gateway.sort_clause_handler.location}
```

See also

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
See also <a href="http://symfony.com/doc/current/book/service_container.html#service-parameters">Symfony documentation about Service Container</a> for passing parameters

 

### Criteria Independence Example

With eZ Publish you can have multiple location content. Criterions do not relate to others criterion you can  use the Public API and Criterion to search this content, it can lead to a comportement you are not expecting.

Example of Criterions not relating to each other:

 

There is a Content with two Locations: Location A and Location B

-   Location A is visible
-   Location B is hidden

 

Searching with LocationId criterion with Location B id and Visibility criterion with Visibility::VISIBLE will return the Content because conditions are satisfied:

-   Content has Location B
-   Content is visible (it has Location A that is visible)

 

``` brush:
<?php
 
use eZ\Publish\API\Repository\Values\Content\Query;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion\LogicalAnd;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion\LocationId;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion\Visibility;
 
/** @var string|int $locationBId */
/** @var \eZ\Publish\API\Repository\Repository $repository */

$searchService = $repository->getSearchService();
 
$query = new Query(
    array(
        'filter' => new LogicalAnd(
            array(
                new LocationId( $locationBId ),
                new Visibility( Visibility::VISIBLE ),
            )
        )
    )
);
 
$searchResult = $searchService->findContent( $query );
 
// Content is found
$content = $searchResult->searchHits[0];
```

## Reindexing

To (re)create the search engine index for configured search engines (per siteaccess repository), use the `php app/console ezplatform:reindex` command.

# Reference

## Search Criteria Reference

See the [dedicated page with Search Criteria reference](Search-Criteria-Reference_32113988.html).

## Sort Clauses Reference

See the [dedicated page with Sort Clauses reference](Sort-Clauses-Reference_32113990.html).

 

#### In this topic:

-   [Introduction](#Search-Introduction)
    -   [Available Search Engines](#Search-AvailableSearchEngines)
-   [Usage](#Search-Usage)
    -   [Search Criteria and Sort Clauses](#Search-SearchCriteriaandSortClauses)
        -   [Search Engine Handling of Search Criteria and Sort Clauses](#Search-SearchEngineHandlingofSearchCriteriaandSortClauses)
        -   [Custom Criteria and Sort Clauses](#Search-CustomCriteriaandSortClauses)
        -   [Difference between Content and Location Search](#Search-DifferencebetweenContentandLocationSearch)
        -   [How to configure your own Criterion and Sort Clause Handlers](#Search-HowtoconfigureyourownCriterionandSortClauseHandlers)
        -   [Criteria Independence Example](#Search-CriteriaIndependenceExample)
    -   [Reindexing](#Search-Reindexing)
-   [Reference](#Search-Reference)
    -   [Search Criteria Reference](#Search-SearchCriteriaReference)
    -   [Sort Clauses Reference](#Search-SortClausesReference)

#### Related topics:

[Legacy Search Engine Bundle](Legacy-Search-Engine-Bundle_31430581.html)

[Solr Bundle](Solr-Bundle_31430592.html)

[ElasticSearch Bundle](ElasticSearch-Bundle_31430579.html)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Repository](Repository_31432023.html)</span>
5.  <span>[List of Limitations](List-of-Limitations_31430459.html)</span>

 Developer : SectionLimitation 



A Limitation to specify if the User has access to Content within a specific Section.

|                 |                                                                      |
|-----------------|----------------------------------------------------------------------|
| Identifier      | `Section`                                                            |
| Value Class     | `eZ\Publish\API\Repository\Values\User\Limitation\SectionLimitation` |
| Type Class      | `eZ\Publish\Core\Limitation\SectionLimitationType`                   |
| Criterion used  | `eZ\Publish\API\Repository\Values\Content\Query\Criterion\SectionId` |
| Role Limitation | yes                                                                  |

###### Possible values

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">Value</td>
<td align="left">UI value</td>
<td align="left">Description</td>
</tr>
<tr class="even">
<td align="left"><code>&lt;Session_id&gt;</code></td>
<td align="left"><code>&lt;Session_name&gt;</code></td>
<td align="left"><p>All valid section ids can be set as value(s)</p></td>
</tr>
</tbody>
</table>

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : Security 



# Introduction

eZ Platform offers security and access control for your website using a complex permission system which allows you to define very fine-grained rights for all your users.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
See [Permissions](https://doc.ez.no/display/DEVELOPER/Repository#Repository-Permissions) for more information.

# Configuration

<span>To use Symfony authentication with eZ Platform, the configuration goes as follows:</span>

**app/config/security.yml**

``` brush:
security:
    firewalls:
        ezpublish_front:
            pattern: ^/
            anonymous: ~
            form_login:
                require_previous_session: false
            logout: ~
```

**app/config/routing.yml**

``` brush:
login:
    path:   /login
    defaults:  { _controller: ezpublish.security.controller:loginAction }
login_check:
    path:   /login_check
logout:
    path:   /logout
```

Note

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
You can fully customize the routes and/or the controller used for login. However, remember to match `login_path`, `check_path` and `logout.path` from `security.yml`.

See <a href="http://symfony.com/doc/2.3/reference/configuration/security.html">security configuration reference</a> and <a href="http://symfony.com/doc/2.3/book/security.html#using-a-traditional-login-form">standard login form documentation</a>.

 

# Usage

Authentication is provided using the Symfony Security component.

## Authentication using Symfony Security component

<a href="http://symfony.com/doc/2.3/book/security.html#using-a-traditional-login-form"><span>Native and universal </span> <code>form_login</code></a> <span> is used, in conjunction with an extended </span> `DaoAuthenticationProvider` <span> (DAO stands for </span> *Data Access Object* <span>), the </span> `RepositoryAuthenticationProvider` <span>. Native behavior of </span> `DaoAuthenticationProvider` <span> has been preserved, making it possible to still use it for pure Symfony applications.</span>

### <span>Security controller</span>

A `SecurityController` is used to manage all security-related actions and is thus used to display login form. It is pretty straightforward and follows all standards explained in <a href="http://symfony.com/doc/2.3/book/security.html#using-a-traditional-login-form">Symfony security documentation</a>.

Base template used is `EzPublishCoreBundle:Security:login.html.twig` and stands as follows:

``` brush:
{% extends layout %}

{% block content %}
    {% block login_content %}
        {% if error %}
            <div>{{ error.message|trans }}</div>
        {% endif %}

        <form action="{{ path( 'login_check' ) }}" method="post">
        {% block login_fields %}
            <label for="username">{{ 'Username:'|trans }}</label>
            <input type="text" id="username" name="_username" value="{{ last_username }}" />

            <label for="password">{{ 'Password:'|trans }}</label>
            <input type="password" id="password" name="_password" />

            <input type="hidden" name="_csrf_token" value="{{ csrf_token("authenticate") }}" />

            {#
                If you want to control the URL the user
                is redirected to on success (more details below)
                <input type="hidden" name="_target_path" value="/account" />
            #}

            <button type="submit">{{ 'Login'|trans }}</button>
        {% endblock %}
        </form>
    {% endblock %}
{% endblock %}
```

<span> <span>The layout used by default is </span> `%ezpublish.content_view.viewbase_layout%` <span> (empty layout) but can be configured easily together with the login template:</span> </span>

**ezplatform.yml**

``` brush:
ezpublish:
    system:
        my_siteaccess:
            user:
                layout: "AcmeTestBundle::layout.html.twig"
                login_template: "AcmeTestBundle:User:login.html.twig"
```

#### Redirection after login

By default, Symfony redirects to the <a href="http://symfony.com/doc/2.3/reference/configuration/security.html">URI configured in <code>security.yml</code> as <code>default_target_path</code></a>. If not set, it will default to `/`.

This setting can be set by siteaccess, via <span class="confluence-link"> </span>[<span class="confluence-link">`default_page` setting</span>](Bundles_31430133.html#Bundles-Defaultpage).

 

### Access control

See the [documentation on access control](https://doc.ez.no/display/DEVELOPER/Repository#Repository-Permissions).

### Remember me

It is possible to use the `remember_me` functionality. For this you can refer to the <a href="http://symfony.com/doc/2.3/cookbook/security/remember_me.html">Symfony cookbook on this topic</a>.

If you want to use this feature, you must at least extend the login template in order to add the required checkbox:

``` brush:
{# your_login_template.html.twig #}
{% extends "EzPublishCoreBundle:Security:login.html.twig" %}

{% block login_fields %}
    {{ parent() }}
    <input type="checkbox" id="remember_me" name="_remember_me" checked />
    <label for="remember_me">Keep me logged in</label>
{% endblock %}
```

### Login handlers / SSO

Symfony provides native support for <a href="http://symfony.com/doc/2.3/book/security.html#using-multiple-user-providers">multiple user providers</a>. This makes it easy to integrate any kind of login handlers, including SSO and existing third-party bundles (e.g. <a href="https://github.com/Maks3w/FR3DLdapBundle">FR3DLdapBundle</a>, <a href="https://github.com/hwi/HWIOAuthBundle">HWIOauthBundle</a>, <a href="https://github.com/FriendsOfSymfony/FOSUserBundle">FOSUserBundle</a>, <a href="http://github.com/BeSimple/BeSimpleSsoAuthBundle">BeSimpleSsoAuthBundle</a>, etc.).

Further explanation can be found in the <span class="confluence-link">[multiple user providers recipe](Authenticating-a-user-with-multiple-user-providers_31429790.html)</span>.

### Integration with Legacy

-   When **not** in legacy mode, legacy `user/login` and `user/logout` views are deactivated.
-   Authenticated user is injected in legacy kernel.

## Authentication with Legacy SSO Handlers

To be able to use your legacy SSO (Single Sign-on) handlers, use the following config in your `ezpublish/config/security.yml`:

**Use your legacy SSO handlers**

``` brush:
security:
    firewalls:
        ezpublish_front:
            pattern: ^/
            anonymous: ~
            # Adding the following entry will activate the use of old SSO handlers.
            ezpublish_legacy_sso: ~ 
```

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
If you need to<a href="http://share.ez.no/learn/ez-publish/using-a-sso-in-ez-publish">create your legacy SSO Handler, please read this entry</a>

#### In this topic:

-   [Introduction](#Security-Introduction)
-   [Configuration](#Security-Configuration)
-   [Usage](#Security-Usage)
    -   [Authentication using Symfony Security component](#Security-AuthenticationusingSymfonySecuritycomponent)
        -   [Security controller](#Security-Securitycontroller)
        -   [Access control](#Security-Accesscontrol)
        -   [Remember me](#Security-Rememberme)
        -   [Login handlers / SSO](#Security-Loginhandlers/SSO)
        -   [Integration with Legacy](#Security-IntegrationwithLegacy)
    -   [Authentication with Legacy SSO Handlers](#Security-AuthenticationwithLegacySSOHandlers)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Under the Hood: How eZ Platform Works](31429659.html)</span>
5.  <span>[Content Model: Content is King!](31429709.html)</span>
6.  <span>[Content items, Content Types and Fields](31430275.html)</span>
7.  <span>[Field Types reference](Field-Types-reference_31430495.html)</span>

 Developer : Selection Field Type 



This Field Type represents a single selection or multiple choices from a list of options.

| Name        | Internal name | Expected input type |
|-------------|---------------|---------------------|
| `Selection` | `ezselection` | `mixed`             |

## Description

The Selection Field Type stores single selections or multiple choices from a list of options, by populating a hash with the list of selected values.

## PHP API Field Type

### Input expectations

| Type    | Example         |
|---------|-----------------|
| `array` | `array( 1, 2 )` |

### Value object

##### Properties

The Value class of this Field Type contains the following properties:

| Property     | Type    | Description                                                                                                                 |
|--------------|---------|-----------------------------------------------------------------------------------------------------------------------------|
| `$selection` | `int[]` | This property will be used for the list of selections, which will be a list of integer values, or one single integer value. |

**Value object content examples**

``` brush:
// Single selection
$value->selection = 1; 
 
// Multiple selection
$value->selection = array( 1, 4, 5 ); 
```

##### Constructor

The `Selection\Value` constructor accepts an array of selected element identifiers.

**Constructor example**

``` brush:
// Instanciates a selection value with items #1 and #2 selected
$selectionValue = new Selection\Value( array( 1, 2 ) );
```

##### String representation

String representation of this Field Type is its list of selections as a string, concatenated with a comma.

Example:

> `"1,2,24,42"`

### Hash format

Hash format of this Field Type is the same as Value object's **`selection`** property.

**Example of value in hash format**

``` brush:
$hash = array( 1, 2 );
```

### Validation

This Field Type validates the input, verifying if all selected options exist in the field definition and checks if multiple selections are allowed in the Field definition.
If any of these validations fail, a `ValidationError`<span class="p">  </span>is thrown, specifying the error message, and for the case of the option validation a list with the invalid options is also presented.

### Settings

------------------------------------------------------------------------

| Name         | Type      | Default value | Description                                                    |
|--------------|-----------|---------------|----------------------------------------------------------------|
| `isMultiple` | `boolean` | `false`       | Used to allow or deny multiple selection from the option list. |
| `options`    | `hash`    | `array()`     | Stores the list of options defined in the field definition.    |

**Selection Field Type example settings**

``` brush:
use eZ\Publish\Core\FieldType\Selection\Type;
 
$settings = array(
    "isMultiple" => true,
    "options" => array(1 => 'One', 2 => 'Two', 3 => 'Three')
);
```

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : Service Container 



# Definition

A service container, (aka **DIC**, *Dependency Injection Container*) is a special object that greatly facilitates dependencies resolution in your application and sits on <a href="http://en.wikipedia.org/wiki/Dependency_injection">Dependency Injection design pattern</a>. Basically, this design pattern proposes to inject all needed objects and configuration into your business logic objects (aka **services**). It avoids the massive use of singletons, global variables or complicated factories and thus makes your code much more readable and testable. It avoids "magic."

The main issue with dependency injection is how to resolve your dependencies for your services. This is where the service container comes into play. The role of a service container is to build and maintain your services and their dependencies. Basically, each time you need a service, you may ask the service container for it, which will either build it with the configuration you provided, or give you an existing instance if it is already available.

# In eZ Platform

eZ Platform uses <a href="http://symfony.com/doc/master/book/service_container.html">Symfony service container</a>.

It is very powerful and highly configurable. We encourage you to read its dedicated documentation as it will help you understand how eZ Platform services are made:

-   <a href="http://symfony.com/doc/master/book/service_container.html">Introduction and basic usage</a>
-   <a href="http://symfony.com/doc/master/components/dependency_injection/index.html">Full documentation of the Dependency Injection Component</a>
-   <a href="http://symfony.com/doc/master/cookbook/service_container/index.html">Cookbook</a>
-   <a href="http://symfony.com/doc/master/reference/dic_tags.html">Base service tags</a>

## Service tags

Service tags in Symfony DIC are a useful way of dedicating services to a specific purpose. They are usually used for extension points.

For instance, if you want to register a <a href="http://twig.sensiolabs.org/doc/advanced.html#creating-extensions">Twig extension</a> to add custom filters, you will need to create the PHP class and declare it as a service in the DIC configuration with the *twig.extension* tag (see <a href="http://symfony.com/doc/master/cookbook/templating/twig_extension.html">Symfony cookbook entry</a> for a full example).

eZ Platform exposes several features this way (see the list of core service tags). This is for example the case for Field Types.

You will find all service tags exposed by Symfony in <a href="http://symfony.com/doc/master/reference/dic_tags.html">its reference documentation</a>.

### Core & API

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Tag name</th>
<th align="left">Usage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><code>router</code></p></td>
<td align="left">Adds a specific router to the chain router</td>
</tr>
<tr class="even">
<td align="left"><p><code>twig.loader</code></p></td>
<td align="left">Registers a template loader for twig</td>
</tr>
<tr class="odd">
<td align="left"><p><code>ezpublish.content_view_provider</code></p></td>
<td align="left">Registers a ContentViewProvider for template selection depending on content/Location being viewed</td>
</tr>
<tr class="even">
<td align="left"><p><code>ezpublish.storageEngine</code></p></td>
<td align="left">Registers a storage engine in the Repository factory</td>
</tr>
<tr class="odd">
<td align="left"><p><code>ezpublish.fieldType</code></p></td>
<td align="left">Registers a Field Type</td>
</tr>
</tbody>
</table>

### Legacy

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Tag name</th>
<th align="left">Usage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><p><code>ezpublish.storageEngine.legacy.converter</code></p></td>
<td align="left">Registers a converter for a Field Type in legacy storage engine</td>
</tr>
<tr class="even">
<td align="left"><p><code>ezpublish.fieldType.externalStorageHandler</code></p></td>
<td align="left">Registers an external storage handler for a Field Type</td>
</tr>
<tr class="odd">
<td align="left"><p><code>ezpublish.fieldType.externalStorageHandler.gateway</code></p></td>
<td align="left">Registers an external storage gateway for a Field Type in legacy storage engine</td>
</tr>
</tbody>
</table>

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : Sessions 



# Introduction

Sessions are handled by the Symfony2 framework, specifically API and underlying session handlers provided by HTTP Foundation component. This is further enhanced in eZ Platform with support for siteaccess-aware <span class="confluence-link">session cookie configuration</span>.

*Use of Memcached (or experimentally using PDO) as session handler is a requirement in Cluster setup, for details see below. For an overview of clustering feature see [Clustering](Clustering_31430387.html). *

*
*

# Configuration

Symfony offers the possibility to change many session options at application level (i.e. in Symfony <a href="http://symfony.com/doc/master/reference/configuration/framework.html"><code>framework </code>configuration</a>), such as:

-   `cookie_domain`
-   `cookie_path`
-   `cookie_lifetime`
-   `cookie_secure`
-   `cookie_httponly`

However as eZ Platform can be used for setting up several web sites within on Symfony application, session configuration is also possible to define per siteaccess and SiteGroup level.

## <span style="color: rgb(0,98,147);">Session options per siteaccess</span>

All site-related session configuration can be defined per siteaccess and SiteGroup:

**ezplatform.yml**

``` brush:
ezpublish:
    system:
        my_siteaccess:
            session:
                # By default Session name is eZSESSID{siteaccess_hash}
                # with setting below you'll get eZSESSID{name},
                # allowing you to share sessions across SiteAccess
                name: my_session_name
                # These are optional. 
                # If not defined they will fallback to Symfony framework configuration, 
                # which itself fallback to default php.ini settings
                cookie_domain: mydomain.com
                cookie_path: /foo
                cookie_lifetime: 86400
                cookie_secure: false
                cookie_httponly: true
```

## Session name per siteaccess

In 5.x versions prior to 5.3 / 2014.03 the following siteaccess aware session setting where available:

**ezplatform.yml**

``` brush:
ezpublish:
    system:
        my_siteaccess:
            # By default Session name is eZSESSID{siteaccess_hash}
            # with setting below you'll get eZSESSID{name},
            # allowing you to share sessions across SiteAccess
            # This setting is deprecated as of 5.3
            session_name: my_session_name
```

 

*
*

# Usage*
*

## Session handlers

In Symfony, a session handler is configured using `framework.session.handler_id.` Symfony can be configured to use <span>custom handlers</span>, or just fallback to what is configured in PHP by setting it to null (`~`).

### Default configuration

eZ Platform uses the same default configuration as recent versions of Symfony standard distribution. This makes sure you can configure sessions purely in PHP by default, and allows Debian/Ubuntu session file cleanup cronjob to work as intended.

**Default config.yml session configuration**

``` brush:
framework:
    session:
        # handler_id set to null will use default session handler from php.ini
        handler_id:  ~
```

### Recommendations for production setup

#### Single server setup

For single server, default handler should be preferred.

#### Cluster setup

For [Cluster](Clustering_31430387.html) setup we need to configure Sessions to use a backend that is shared between web servers and supports locking. Only options out of the box supporting this in Symfony are the native PHP memcached session save handler provided by the php-memcached extension, and Symfony session handler for PDO (database).

##### Storing sessions in Memcached using php-memcached

For setting up eZ Platform using memcached you'll need to configure the session save handler settings in php.ini as documented <a href="http://php.net/manual/en/memcached.sessions.php">here</a>, optionally tweak <a href="http://fr2.php.net/manual/en/memcached.configuration.php">php-memcached session settings</a>.

##### Storing sessions in Redis using pecl package redis

<span class="status-macro aui-lozenge aui-lozenge-error aui-lozenge-subtle">EXPERIMENTAL</span>

For setting up eZ Platform using <a href="https://pecl.php.net/package/redis">Redis pecl package</a> you'll need to configure the session save handler settings in php.ini as documented <a href="https://github.com/phpredis/phpredis#php-session-handler">here</a>.

##### Alternative storing sessions in database using PDO

While not currently our recommendation from performance perspective, for setups where Database is preferred for storing Sessions, you may use Symfony's PdoSessionHandler.
Below is an configuration example for eZ Platform, but please refer to <a href="http://symfony.com/doc/current/cookbook/configuration/pdo_session_storage.html">documented in Symfony Cookbook documentation</a> for full documentation.

``` brush:
framework:
    session:
        # ...
        handler_id: session.handler.pdo

parameters:
    pdo.db_options:
        db_table:    session
        db_id_col:   session_id
        db_data_col: session_value
        db_time_col: session_time

services:
    pdo:
        class: PDO
        arguments:
            dsn:      "mysql:dbname=<mysql_database>"
            user:     <mysql_user>
            password: <mysql_password>

    session.handler.pdo:
        class:     Symfony\Component\HttpFoundation\Session\Storage\Handler\PdoSessionHandler
        arguments: ["@pdo", "%pdo.db_options%"]
```

 

 

#### In this topic:

-   [Introduction](#Sessions-Introduction)
-   [Configuration](#Sessions-Configuration)
    -   [Session options per siteaccess](#Sessions-Sessionoptionspersiteaccess)
    -   [Session name per siteaccess](#Sessions-Sessionnamepersiteaccess)
-   [Usage](#Sessions-Usage)
    -   [Session handlers](#Sessions-Sessionhandlers)
        -   [Default configuration](#Sessions-Defaultconfiguration)
        -   [Recommendations for production setup](#Sessions-Recommendationsforproductionsetup)

#### Related:

-   [Overview of steps to set up Cluster](Steps-to-set-up-Cluster_31432321.html)[:](#Sessions-Persistencecacheconfiguration)
    -   [Set up DFS IO Handler](Clustering_31430387.html)
    -   [Configure Persistence Cache](Repository_31432023.html#Repository-Persistencecacheconfiguration)
    -   [Set up Varnish](HTTP-Cache_31430152.html#HTTPCache-UsingVarnish)

#### Further resources:

-   <a href="http://symfony.com/doc/current/cookbook/session/index.html">Cookbook Session recipes (symfony.com)</a>
-   <a href="http://symfony.com/doc/current/components/http_foundation/index.html">HTTP Foundation Component documentation (symfony.com)</a>
-   Source code of <a href="https://github.com/symfony/symfony/blob/master/src/Symfony/Component/HttpFoundation/Session/Storage/Handler/NativeFileSessionHandler.php">NativeFileSessionHandler (github.com)</a>
-   <a href="http://symfony.com/doc/current/cookbook/configuration/pdo_session_storage.html">Cookbook Configuration recipe for setting-up PdoSessionHandler (symfony.com)</a>, aka `session.handler.pdo` service






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Get Started with eZ Platform](Get-Started-with-eZ-Platform_31429520.html)</span>
4.  <span>[Step 1: Installation](31429538.html)</span>
5.  <span>[Manual Installation Guides](Manual-Installation-Guides_31431727.html)</span>
6.  <span>[Installation Guide for Unix-Based Systems](Installation-Guide-for-Unix-Based-Systems_31431755.html)</span>

 Developer : Set up Swap on Debian 8.x 



# Overview

Swap space allows your system to utilize the hard drive to supplement capacity when RAM runs short. Composer install will fail if there is insufficient RAM available, but adding swap will allow it to complete installation.

# Solution

Via the command line, you can set up and enable swap on your Debian machine via the following commands (as root):

**Set up Swap**

``` brush:
fallocate -l 4G /swapfile
chmod 600 /swapfile
mkswap /swapfile
swapon /swapfile
echo "/swapfile   none    swap    sw    0   0" >> /etc/fstab
sysctl vm.swappiness=10
echo "vm.swappiness=10" >> /etc/sysctl.conf
sysctl vm.vfs_cache_pressure=50
echo "vm.vfs_cache_pressure=50" >> /etc/sysctl.conf
```

# <span style="color: rgb(0,98,147);">Testing the Result</span>

You should see the changes effected immediately, and can check via the command line:

**Test the Result**

``` brush:
# You should see swap in use now:
free -m

# Swappiness should now be 10
cat /proc/sys/vm/swappiness

# Cache pressure should be set to 50
cat /proc/sys/vm/vfs_cache_pressure
```

#### In this topic:

-   [Overview](#SetupSwaponDebian8.x-Overview)
-   [Solution](#SetupSwaponDebian8.x-Solution)
-   [Testing the Result](#SetupSwaponDebian8.x-TestingtheResult)

#### Related topics:

[Installation Guide for Unix-Based Systems](Installation-Guide-for-Unix-Based-Systems_31431755.html)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>
4.  <span>[Extending PlatformUI with new navigation](Extending-PlatformUI-with-new-navigation_31430235.html)</span>

 Developer : Set up the configuration 



## PlatformUI Configuration files

### JavaScript modules in `yui.yml`

Each component of the PlatformUI application is written as a <a href="http://yuilibrary.com/yui/docs/yui/create.html">YUI module</a>. The YUI module system comes with a dependency system which is used in the PlatformUI application. For instance, the PlatformUI application has a module called `ez-templatebasedview` which provides a base view class to ease the usage of a template. This module is a dependency of most of the views in the application and has itself some dependencies, like for instance the view module from YUI. Those dependencies are expressed in the `yui.yml` configuration and this configuration is meant to be extended / overridden in other bundles. For instance:

**Excerpt of yui.yml**

``` brush:
system:
    default:
        yui:
            modules:                
                ez-templatebasedview:
                    requires: ['ez-texthelper', 'ez-view', 'handlebars', 'template']
                    path: %ez_platformui.public_dir%/js/views/ez-templatebasedview.js
                ez-loginformview:
                    requires: ['ez-templatebasedview', 'node-style', 'loginformview-ez-template']
                    path: %ez_platformui.public_dir%/js/views/ez-loginformview.js
```

<span class="inline-comment-marker" data-ref="736650a3-b2b6-46ac-9bf9-f9904ede18f5">This configuration defines two modules – `ez-templatebasedview` and `ez-loginformview`:</span>

-   `ez-templatebasedview` requires the modules `ez-texthelper`, `ez-view`, `handlebars` and `template`. The source code of this module is in `%ez_platformui.public_dir%/js/views/ez-templatebasedview.js` on the disk;
-   `ez-loginformview` requires the modules `ez-templatebasedview`, `node-style` and `loginformview-ez-template`. The source code of this module is in `%ez_platformui.public_dir%/js/views/ez-loginformview.js` on the disk.

 

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Note that the order of module definitions is not important, `ez-loginformview` can be defined before the `ez-templatebaseview` module even if the latter is a dependency of the former.

Most of the PlatformUI application views use a Handlebars template to generate the HTML markup. In the application the templates are also handled as YUI modules but those modules are special because they are dynamically generated from the regular template files on the disk. For this to work, the YUI module corresponding to a template must have the `type` flag set to `template`. To complete the example above, the template module `loginforview-ez-template` should be defined in the following way:

``` brush:
loginformview-ez-template:
    type: 'template'
    path: %ez_platformui.public_dir%/templates/loginform.hbt
```

### CSS files in `css.yml`

The CSS files used by the application are also listed in `css.yml`, but in the case of CSS files, it's much simpler as this file just lists the CSS files to load, example:

**Excerpt of css.yml**

``` brush:
system:
    default:
        css:
            files:
                - '@eZPlatformUIBundle/Resources/public/css/views/field.css'
                - '@eZPlatformUIBundle/Resources/public/css/views/fields/view/relation.css'
```

## Injecting the extension custom configuration files

To be able to extend the PlatformUI application configuration, the extension bundle has to set up its own configuration handling. For this, you only have to tweak the extension class generated in the bundle [in the first step](Create-the-extension-Bundle_31430237.html) to load the extension bundle's `yui.yml` and `css.yml` and to process their respective content with PlatformUI's configuration. The default empty `yui.yml` and `css.yml` also have to be created so that eZ Platform is still usable.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
If you want to get more details on this operation, you can read the [Exposing SiteAccess-aware configuration for your bundle](Exposing-SiteAccess-aware-configuration-for-your-bundle_31429794.html) recipe.

After this, you just have to make sure the bundle has a `Resources/public` directory to install the assets with the following command:

``` brush:
$ app/console assets:install --symlink
```

Results and next step:

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
The resulting code can be seen in <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/tree/2_configuration">the 2_configuration tag on GitHub</a> (the interesting part is the <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/blob/2_configuration/DependencyInjection/EzSystemsExtendingPlatformUIConferenceExtension.php"><span class="pl-s1"><span class="pl-en">EzSystemsExtendingPlatformUIConferenceExtension</span></span></a> class), this step result can also be viewed as <a href="https://github.com/ezsystems/ExtendingPlatformUIConferenceBundle/compare/1_bundle...2_configuration">a diff between tags <code>1_bundle</code> and <code>2_configuration</code></a>.

After these two first steps, PlatformUI should remain perfectly usable and unchanged. The next step is then [to tweak the PlatformUI Application routing to start implementing the new feature](Alter-the-JavaScript-Application-routing_31430241.html).

**Tutorial path**






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[API](API_31429524.html)</span>
4.  <span>[Field Type API and best practices](Field-Type-API-and-best-practices_31430767.html)</span>

 Developer : Settings schema and allowed validators 



# Internal Field Type conventions and best practices

FieldType-&gt;$settingsSchema and FieldType-&gt;$allowedValidators are intentionally left free-form, to give broadest freedom to Field Type developers. However, for internal Field Types (aka those delivered with eZ Platform), a common standard should be established as best practice. The purpose of this page is to collect and unify this standard.

## Settings schema

The general format of the settings schema of a Field Type is a hashmap of setting names, assigned to their type and default value, e.g.:

    array(
        'myFancySetting' => array(
            'type' => 'int',
            'default' => 23,
        ),
        'myOtherFancySetting' => array(
            'type' => 'string',
            'default' => 'Sindelfingen',
        ),
    );

The type should be either a valid PHP type shortcut (TB discussed) or one of the following special types:

-   Hash (a simple hash map)
-   Choice (an enumeration)
-   &lt;&lt;&lt;YOUR TYPE HERE&gt;&gt;&gt;

 

## Validators

Validators are internally handled through a special ValidatorService … (TBD: Explain service and how it works)

The following validators are available and carry the defined settings … (TBD: Collect validators and their settings)

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Get Started with eZ Platform](Get-Started-with-eZ-Platform_31429520.html)</span>
4.  <span>[Step 1: Installation](31429538.html)</span>
5.  <span>[Manual Installation Guides](Manual-Installation-Guides_31431727.html)</span>
6.  <span>[Installation Guide for Unix-Based Systems](Installation-Guide-for-Unix-Based-Systems_31431755.html)</span>

 Developer : Setup folder rights 



For security reasons, there is no need for web server to have access to write to other directories.

## Set the owner and clean directories*
*

First, change `www-data` to your web server user.

### Clean the cache/ and logs/ directories

``` brush:
$ rm -rf app/cache/* app/logs/* 
```

## Use the right option according to your system.

### A. Using ACL on a *<span class="blob-code-inner"><span class="pl-mb"><span class="x x-first x-last">Linux/BSD </span></span></span>*system that supports chmod +a

**Using ACL on a Linux/BSD system that supports chmod +a**

``` brush:
$ sudo chmod +a "www-data allow delete,write,append,file_inherit,directory_inherit" \
  app/cache app/logs web
$ sudo chmod +a "`whoami` allow delete,write,append,file_inherit,directory_inherit" \
  app/cache app/logs web
```

### B. Using ACL on a *<span class="blob-code-inner"><span class="pl-mb"><span class="x x-first x-last">Linux/BSD </span></span></span>*system that does not support chmod +a

Some systems don't support chmod +a, but do support another utility called setfacl. You may need to enable ACL support on your partition and install setfacl before using it (as is the case with Ubuntu), in this way:

**Using ACL on a Linux/BSD system that does not support chmod +a**

``` brush:
$ sudo setfacl -R -m u:www-data:rwx -m u:`whoami`:rwx \
  app/cache app/logs web
$ sudo setfacl -dR -m u:www-data:rwx -m u:`whoami`:rwx \
  app/cache app/logs web
```

### C. Using chown on *<span class="blob-code-inner"><span class="pl-mb"><span class="x x-first x-last">Linux/BSD/OS X</span></span></span>* systems that don't support ACL

Some systems don't support ACL at all. You will need to set your web server's user as the owner of the required directories:

**Using chown on Linux/BSD/OS X systems that don't support ACL**

``` brush:
$ sudo chown -R www-data:www-data app/cache app/logs web
$ sudo find {app/{cache,logs},web} -type d | xargs sudo chmod -R 775
$ sudo find {app/{cache,logs},web} -type f | xargs sudo chmod -R 664
```

### D. Using chmod <span class="blob-code-inner"><span class="pl-mb"><span class="x x-first x-last"> on a *Linux/BSD/OS X* system where you can't change owner</span></span></span>**
**

If you can't use ACL and aren't allowed to change owner, you can use chmod, making the files writable by everybody. Note that this method really isn't recommended as it allows any user to do anything:

**Using chmod on a Linux/BSD/OS X system where you can't change owner**

``` brush:
$ sudo find {app/{cache,logs},web} -type d | xargs sudo chmod -R 777
$ sudo find {app/{cache,logs},web} -type f | xargs sudo chmod -R 666
```

When using chmod, note that newly created files (such as cache) owned by the web server's user may have different/restrictive permissions. In this case, it may be required to change the umask so that the cache and log directories will be group-writable or world-writable (`umask(0002)` or `umask(0000)` respectively).

It may also possible to add the group ownership inheritance flag so new files inherit the current group, and use `775`/`664` in the command lines above instead of world-writable:

**It may also possible to add the group ownership inheritance flag**

``` brush:
$ sudo chmod g+s {app/{cache,logs},web}
```

### E. Setup folder rights on Windows

For your choice of web server you'll need to make sure web server user has read access to `<root-dir>`, and write access to the following directories:

-   app/cache
-   app/logs

-   [Set the owner and clean directories](#Setupfolderrights-Settheownerandcleandirectories)
    -   [Clean the cache/ and logs/ directories](#Setupfolderrights-Cleanthecache/andlogs/directories)
-   [Use the right option according to your system.](#Setupfolderrights-Usetherightoptionaccordingtoyoursystem.)
    -   [A. Using ACL on a Linux/BSD system that supports chmod +a](#Setupfolderrights-A.UsingACLonaLinux/BSDsystemthatsupportschmod+a)
    -   [B. Using ACL on a Linux/BSD system that does not support chmod +a](#Setupfolderrights-B.UsingACLonaLinux/BSDsystemthatdoesnotsupportchmod+a)
    -   [C. Using chown on Linux/BSD/OS X systems that don't support ACL](#Setupfolderrights-C.UsingchownonLinux/BSD/OSXsystemsthatdon'tsupportACL)
    -   [D. Using chmod on a Linux/BSD/OS X system where you can't change owner](#Setupfolderrights-D.UsingchmodonaLinux/BSD/OSXsystemwhereyoucan'tchangeowner)
    -   [E. Setup folder rights on Windows](#Setupfolderrights-E.SetupfolderrightsonWindows)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Repository](Repository_31432023.html)</span>

 Developer : Signals Reference 



This page references **all available signals** that you can listen to, triggered by ("Public") Repository API in eZ Platform.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
For more information, check the [<span class="confluence-link">SignalSlot </span>](#SignalsReference-Signalslots)<span class="confluence-link">section </span>and the [Listening to Core events](Listening-to-Core-events_31429796.html) recipe.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
All signals are relative to `eZ\Publish\Core\SignalSlot\Signal` namespace.

Transactions

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Signals are sent after transactions are executed, making signals transaction safe.

 

### ContentService

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Signal type</th>
<th align="left">Properties</th>
<th align="left">Triggered by</th>
<th align="left">When</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>ContentService\AddRelationSignal</code></td>
<td align="left"><ul>
<li><code>srcContentId</code> (source contentId, aka referrer)</li>
<li><code>srcVersionNo</code></li>
<li><code>dstContentId</code> (destination contentId, aka target)</li>
</ul></td>
<td align="left"><p><code>ContentService::addRelation()</code></p></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>ContentService\AddTranslationInfoSignal</code></td>
<td align="left">N/A</td>
<td align="left"><code>ContentService::addTranslationInfo()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>ContentService\CopyContentSignal</code></td>
<td align="left"><ul>
<li><code>srcContentId</code> (original content ID)</li>
<li><code>srcVersionNo</code></li>
<li><code>dstContentId</code> (contentId of the copy)</li>
<li><code>dstVersionNo</code></li>
<li><code>dstParentLocationId</code> (locationId where the content has been copied)</li>
</ul></td>
<td align="left"><code>ContentService::copyContent()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>ContentService\CreateContentDraftSignal</code></td>
<td align="left"><ul>
<li><code>contentId</code></li>
<li><code>versionNo</code></li>
<li><code>userId</code> (Id of user used to create the draft, or null - current user)</li>
</ul></td>
<td align="left"><code>ContentService::createContentDraft()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>ContentService\CreateContentSignal</code></td>
<td align="left"><ul>
<li><code>contentId</code></li>
<li><code>versionNo</code></li>
</ul></td>
<td align="left"><code>ContentService::createContent()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>ContentService\DeleteContentSignal</code></td>
<td align="left"><ul>
<li><code>contentId</code></li>
</ul></td>
<td align="left"><code>ContentService::deleteContent()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>ContentService\DeleteRelationSignal</code></td>
<td align="left"><ul>
<li><code>srcContentId</code></li>
<li><code>srcVersionNo</code></li>
<li><code>dstContentId</code></li>
</ul></td>
<td align="left"><code>ContentService::deleteRelation()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>ContentService\DeleteVersionSignal</code></td>
<td align="left"><ul>
<li><code>contentId</code></li>
<li><code>versionNo</code></li>
</ul></td>
<td align="left"><code>ContentService::deleteVersion()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>ContentService\PublishVersionSignal</code></td>
<td align="left"><ul>
<li><code>contentId</code></li>
<li><code>versionNo</code></li>
</ul></td>
<td align="left"><code>ContentService:: publishVersion()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>ContentService\TranslateVersionSignal</code></td>
<td align="left"><ul>
<li><code>contentId</code></li>
<li><code>versionNo</code></li>
<li><code>userId</code></li>
</ul></td>
<td align="left"><code>ContentService::translationVersion()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>ContentService\UpdateContentMetadataSignal</code></td>
<td align="left"><ul>
<li><code>contentId</code></li>
</ul></td>
<td align="left"><code>ContentService::updateContentMetadata()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>ContentService\UpdateContentSignal</code></td>
<td align="left"><ul>
<li><code>contentId</code></li>
<li><code>versionNo</code></li>
</ul></td>
<td align="left"><code>ContentService::updateContent()</code></td>
<td align="left">After</td>
</tr>
</tbody>
</table>

### ContentTypeService

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Signal type</th>
<th align="left">Properties</th>
<th align="left">Triggered by</th>
<th align="left">When</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>ContentTypeService\AddFieldDefinitionSignal</code></td>
<td align="left"><ul>
<li><span>contentTypeDraftId</span></li>
</ul></td>
<td align="left"><p><code>ContentTypeService::addFieldDefinition()</code></p></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>ContentTypeService\AssignContentTypeGroupSignal</code></td>
<td align="left"><ul>
<li><code>contentTypeId</code></li>
<li><code>contentTypeGroupId</code></li>
</ul></td>
<td align="left"><code>ContentTypeService::assignContentTypeGroup()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>ContentTypeService\CopyContentTypeSignal</code></td>
<td align="left"><ul>
<li><code>contentTypeId</code></li>
<li><code>userId</code></li>
</ul></td>
<td align="left"><code>ContentTypeService::copyContentType()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>ContentTypeService\CreateContentTypeDraftSignal</code></td>
<td align="left"><ul>
<li><code>contentTypeId</code></li>
</ul></td>
<td align="left"><code>ContentTypeService::createContentTypeDraft()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>ContentTypeService\CreateContentTypeGroupSignal</code></td>
<td align="left"><ul>
<li><code>groupId</code></li>
</ul></td>
<td align="left"><code>ContentTypeService::createContentTypeGroup()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>ContentTypeService\CreateContentTypeSignal</code></td>
<td align="left"><ul>
<li><code>contentTypeId</code></li>
</ul></td>
<td align="left"><code>ContentTypeService::createContentType()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>ContentTypeService\DeleteContentTypeGroupSignal</code></td>
<td align="left"><ul>
<li><code>contentTypeGroupId</code></li>
</ul></td>
<td align="left"><code>ContentTypeService::deleteContentTypeGroup()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>ContentTypeService\DeleteContentTypeSignal</code></td>
<td align="left"><ul>
<li><code>contentTypeId</code></li>
</ul></td>
<td align="left"><code>ContentTypeService::deleteContentType()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>ContentTypeService\PublishContentTypeDraftSignal</code></td>
<td align="left"><ul>
<li><code>contentTypeDraftId</code></li>
</ul></td>
<td align="left"><code>ContentTypeService::publishContentTypeDraft()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>ContentTypeService\RemoveFieldDefinitionSignal</code></td>
<td align="left"><ul>
<li><code>contentTypeDraftId</code></li>
<li><code>fieldDefinitionId</code></li>
</ul></td>
<td align="left"><code>ContentTypeService::removeFieldDefinition()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>ContentTypeService\UnassignContentTypeGroupSignal</code></td>
<td align="left"><ul>
<li><code>contentTypeId</code></li>
<li><code>contentTypeGroupId</code></li>
</ul></td>
<td align="left"><code>ContentTypeService::unassignContentTypeGroup()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>ContentTypeService\UpdateContentTypeDraftSignal</code></td>
<td align="left"><ul>
<li><code>contentTypeDraftId</code></li>
</ul></td>
<td align="left"><code>ContentTypeService::updateContentTypeDraft()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>ContentTypeService\UpdateContentTypeGroupSignal</code></td>
<td align="left"><ul>
<li><code>contentTypeGroupId</code></li>
</ul></td>
<td align="left"><code>ContentTypeService::updateContentTypeGroup()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>ContentTypeService\UpdateFieldDefinitionSignal</code></td>
<td align="left"><ul>
<li><code>contentTypeDraftId</code></li>
<li><code>fieldDefinitionId</code></li>
</ul></td>
<td align="left"><code>ContentTypeService::updateFieldDefinition()</code></td>
<td align="left">After</td>
</tr>
</tbody>
</table>

### LanguageService

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Signal type</th>
<th align="left">Properties</th>
<th align="left">Triggered by</th>
<th align="left">When</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>LanguageService\CreateLanguageSignal</code></td>
<td align="left"><ul>
<li><code>languageId</code></li>
</ul></td>
<td align="left"><code>LanguageService::createLanguage()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>LanguageService\DeleteLanguageSignal</code></td>
<td align="left"><ul>
<li><code>languageId</code></li>
</ul></td>
<td align="left"><code>LanguageService::deleteLanguage()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>LanguageService\DisableLanguageSignal</code></td>
<td align="left"><ul>
<li><code>languageId</code></li>
</ul></td>
<td align="left"><code>LanguageService::disableLanguage()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>LanguageService\EnableLanguageSignal</code></td>
<td align="left"><ul>
<li><code>languageId</code></li>
</ul></td>
<td align="left"><code>LanguageService::enableLanguage()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>LanguageService\UpdateLanguageNameSignal</code></td>
<td align="left"><ul>
<li><code>languageId</code></li>
<li><code>newName</code></li>
</ul></td>
<td align="left"><code>LanguageService::updateLanguageName()</code></td>
<td align="left"><p>After</p></td>
</tr>
</tbody>
</table>

### LocationService

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Signal type</th>
<th align="left">Properties</th>
<th align="left">Triggered by</th>
<th align="left">When</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>LocationService\CopySubtreeSignal</code></td>
<td align="left"><ul>
<li><code>subtreeId</code> (top locationId of the subtree to be copied)</li>
<li><code>targetParentLocationId</code></li>
</ul></td>
<td align="left"><p><code>LocationService::copySubtree()</code></p></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>LocationService\CreateLocationSignal</code></td>
<td align="left"><ul>
<li><code>contentId</code></li>
<li><code>locationId</code></li>
</ul></td>
<td align="left"><code>LocationService::createLocation()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>LocationService\DeleteLocationSignal</code></td>
<td align="left"><ul>
<li><code>contentId</code></li>
<li><code>locationId</code></li>
</ul></td>
<td align="left"><code>LocationService::deleteLocation()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>LocationService\HideLocationSignal</code></td>
<td align="left"><ul>
<li><code>contentId</code></li>
<li><code>locationId</code></li>
</ul></td>
<td align="left"><code>LocationService::hideLocation()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>LocationService\UnhideLocationSignal</code></td>
<td align="left"><ul>
<li><code>contentId</code></li>
<li><code>locationId</code></li>
</ul></td>
<td align="left"><code>LocationService::unhideLocation()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>LocationService\MoveSubtreeSignal</code></td>
<td align="left"><ul>
<li><code>subtreeId</code></li>
<li><code>newParentLocationId</code></li>
</ul></td>
<td align="left"><code>LocationService::moveSubtree()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>LocationService\SwapLocationSignal</code></td>
<td align="left"><ul>
<li><code>content1Id</code></li>
<li><code>location1Id</code></li>
<li><code>content2Id</code></li>
<li><code>location2Id</code><code></code></li>
</ul></td>
<td align="left"><code>LocationService::swapLocation()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>LocationService\UpdateLocationSignal</code></td>
<td align="left"><ul>
<li><code>contentId</code></li>
<li><code>locationId</code></li>
</ul></td>
<td align="left"><code>LocationService::updateLocation()</code></td>
<td align="left">After</td>
</tr>
</tbody>
</table>

### ObjectStateService

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Signal type</th>
<th align="left">Properties</th>
<th align="left">Triggered by</th>
<th align="left">When</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>ObjectStateService\CreateObjectStateGroupSignal</code></td>
<td align="left"><ul>
<li><code>objectStateGroupId</code></li>
</ul></td>
<td align="left"><code>ObjectStateService::createObjectStateGroup()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>ObjectStateService\CreateObjectStateSignal</code></td>
<td align="left"><ul>
<li><code>objectStateGroupId</code></li>
<li><code>objectStateId</code></li>
</ul></td>
<td align="left"><code>ObjectStateService::createObjectState()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>ObjectStateService\DeleteObjectStateGroupSignal</code></td>
<td align="left"><ul>
<li><code>objectStateGroupId</code></li>
</ul></td>
<td align="left"><code>ObjectStateService::deleteObjectStateGroup()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>ObjectStateService\DeleteObjectStateSignal</code></td>
<td align="left"><ul>
<li><code>objectStateId</code></li>
</ul></td>
<td align="left"><code>ObjectStateService::deleteObjectState()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>ObjectStateService\SetContentStateSignal</code></td>
<td align="left"><ul>
<li><code>contentId</code></li>
<li><code>objectStateGroupId</code></li>
<li><code>objectStateId</code></li>
</ul></td>
<td align="left"><code>ObjectStateService::setContentState()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>ObjectStateService\SetPriorityOfObjectStateSignal</code></td>
<td align="left"><ul>
<li><code>objectStateId</code></li>
<li><code>priority</code></li>
</ul></td>
<td align="left"><code>ObjectStateService::setPriorityOfObjectState()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>ObjectStateService\UpdateObjectStateGroupSignal</code></td>
<td align="left"><ul>
<li><code>objectStateGroupId</code></li>
</ul></td>
<td align="left"><code>ObjectStateService::updateObjectStateGroup()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>ObjectStateService\UpdateObjectStateSignal</code></td>
<td align="left"><ul>
<li><code>objectStateId</code></li>
</ul></td>
<td align="left"><code>ObjectStateService::updateObjectState()</code></td>
<td align="left">After</td>
</tr>
</tbody>
</table>

### RoleService

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Signal type</th>
<th align="left">Properties</th>
<th align="left">Triggered by</th>
<th align="left">When</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>RoleService\AddPolicySignal</code></td>
<td align="left"><ul>
<li><code>roleId</code></li>
<li><code>policyId</code></li>
</ul></td>
<td align="left"><code>RoleService::addPolicy()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>RoleService\AssignRoleToUserGroupSignal</code></td>
<td align="left"><ul>
<li><code>roleId</code></li>
<li><code>userGroupId</code></li>
<li><code>roleLimitation</code></li>
</ul></td>
<td align="left"><code>RoleService::assignRoleToUserGroup()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>RoleService\AssignRoleToUserSignal</code></td>
<td align="left"><ul>
<li><code>roleId</code></li>
<li><code>userId</code></li>
<li><code>roleLimitation</code></li>
</ul></td>
<td align="left"><code>RoleService::assignRoleToUser()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>RoleService\CreateRoleSignal</code></td>
<td align="left"><ul>
<li><code>roleId</code></li>
</ul></td>
<td align="left"><code>RoleService::createRole()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>RoleService\DeleteRoleSignal</code></td>
<td align="left"><ul>
<li><code>roleId</code></li>
</ul></td>
<td align="left"><code>RoleService::deleteRole()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>RoleService\RemovePolicySignal</code></td>
<td align="left"><ul>
<li><code>roleId</code></li>
<li><code>policyId</code></li>
</ul></td>
<td align="left"><code>RoleService::removePolicy()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>RoleService\UnassignRoleFromUserGroupSignal</code></td>
<td align="left"><ul>
<li><code>roleId</code></li>
<li><code>userGroupId</code></li>
</ul></td>
<td align="left"><code>RoleService::unassignRoleFromUserGroup()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>RoleService\UnassignRoleFromUserSignal</code></td>
<td align="left"><ul>
<li><code>roleId</code></li>
<li><code>userId</code></li>
</ul></td>
<td align="left"><code>RoleService::unassignRoleFromUser()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>RoleService\UpdatePolicySignal</code></td>
<td align="left"><ul>
<li><code>policyId</code></li>
</ul></td>
<td align="left"><code>RoleService::updatePolicy()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>RoleService\UpdateRoleSignal</code></td>
<td align="left"><ul>
<li><code>roleId</code></li>
</ul></td>
<td align="left"><code>RoleService::updateRole()</code></td>
<td align="left">After</td>
</tr>
</tbody>
</table>

### SectionService

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Signal type</th>
<th align="left">Properties</th>
<th align="left">Triggered by</th>
<th align="left">When</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>SectionService\AssignSectionSignal</code></td>
<td align="left"><ul>
<li><code>contentId</code></li>
<li><code>sectionId</code></li>
</ul></td>
<td align="left"><code>SectionService::assignSection()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>SectionService\CreateSectionSignal</code></td>
<td align="left"><ul>
<li><code>sectionId</code></li>
</ul></td>
<td align="left"><code>SectionService::createSection()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>SectionService\DeleteSectionSignal</code></td>
<td align="left"><ul>
<li><code>sectionId</code></li>
</ul></td>
<td align="left"><code>SectionService::deleteSection()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>SectionService\UpdateSectionSignal</code></td>
<td align="left"><ul>
<li><code>sectionId</code></li>
</ul></td>
<td align="left"><code>SectionService::updateSection()</code></td>
<td align="left">After</td>
</tr>
</tbody>
</table>

### TrashService

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Signal type</th>
<th align="left">Properties</th>
<th align="left">Triggered by</th>
<th align="left">When</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>TrashService\DeleteTrashItemSignal</code></td>
<td align="left"><ul>
<li><code>trashItemId</code></li>
</ul></td>
<td align="left"><code>TrashService::deleteTrashItem()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>TrashService\EmptyTrashSignal</code></td>
<td align="left">N/A</td>
<td align="left"><code>TrashService::emptyTrash()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>TrashService\RecoverSignal</code></td>
<td align="left"><ul>
<li><code>trashItemId</code></li>
<li><code>newParentLocationId</code></li>
<li><code>newLocationId</code></li>
</ul></td>
<td align="left"><code>TrashService::recover()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>TrashService\TrashSignal</code></td>
<td align="left"><ul>
<li><code>locationId</code></li>
</ul></td>
<td align="left"><code>TrashService::trash()</code></td>
<td align="left">After</td>
</tr>
</tbody>
</table>

### URLAliasService

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Signal type</th>
<th align="left">Properties</th>
<th align="left">Triggered by</th>
<th align="left">When</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>URLAliasService\CreateGlobalUrlAliasSignal</code></td>
<td align="left"><ul>
<li><code>urlAliasId</code></li>
</ul></td>
<td align="left"><code>URLAliasService::createGlobalUrlAlias()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>URLAliasService\CreateUrlAliasSignal</code></td>
<td align="left"><ul>
<li><code>urlAliasId</code></li>
</ul></td>
<td align="left"><code>URLAliasService::createUrlAlias()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>URLAliasService\RemoveAliasesSignal</code></td>
<td align="left"><ul>
<li><code>aliasList</code></li>
</ul></td>
<td align="left"><code>URLAliasService::removeAliases()</code></td>
<td align="left">After</td>
</tr>
</tbody>
</table>

### URLWildcardService

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Signal type</th>
<th align="left">Properties</th>
<th align="left">Triggered by</th>
<th align="left">When</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>URLWildcardService\CreateSignal</code></td>
<td align="left"><ul>
<li><code>urlWildcardId</code></li>
</ul></td>
<td align="left"><code>URLWildcardService::create()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>URLWildcardService\RemoveSignal</code></td>
<td align="left"><ul>
<li><code>urlWildcardId</code></li>
</ul></td>
<td align="left"><code>URLWildcardService::remove()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>URLWildcardService\TranslateSignal</code></td>
<td align="left"><ul>
<li><code>url</code></li>
</ul></td>
<td align="left"><code>URLWildcardService::translate()</code></td>
<td align="left">After</td>
</tr>
</tbody>
</table>

### UserService

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Signal type</th>
<th align="left">Properties</th>
<th align="left">Triggered by</th>
<th align="left">When</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>UserService\AssignUserToUserGroupSignal</code></td>
<td align="left"><ul>
<li><code>userId</code></li>
<li><code>userGroupId</code></li>
</ul></td>
<td align="left"><code>UserService::assignUserToUserGroup()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>UserService\CreateUserGroupSignal</code></td>
<td align="left"><ul>
<li><code>userGroupId</code></li>
</ul></td>
<td align="left"><code>UserService::createUserGroup()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>UserService\CreateUserSignal</code></td>
<td align="left"><ul>
<li><code>userId</code></li>
</ul></td>
<td align="left"><code>UserService::createUser()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>UserService\DeleteUserGroupSignal</code></td>
<td align="left"><ul>
<li><code>userGroupId</code></li>
</ul></td>
<td align="left"><code>UserService::deleteUserGroup()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>UserService\DeleteUserSignal</code></td>
<td align="left"><ul>
<li><code>userId</code></li>
</ul></td>
<td align="left"><code>UserService::deleteUser()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>UserService\MoveUserGroupSignal</code></td>
<td align="left"><ul>
<li><code>userGroupId</code></li>
<li><code>newParentId</code></li>
</ul></td>
<td align="left"><code>UserService::moveUserGroup()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>UserService\UnAssignUserFromUserGroupSignal</code></td>
<td align="left"><ul>
<li><code>userId</code></li>
<li><code>userGroupId</code></li>
</ul></td>
<td align="left"><code>UserService::unAssignUserFromUserGroup()</code></td>
<td align="left">After</td>
</tr>
<tr class="even">
<td align="left"><code>UserService\UpdateUserGroupSignal</code></td>
<td align="left"><ul>
<li><code>userGroupId</code></li>
</ul></td>
<td align="left"><code>UserService::updateUserGroup()</code></td>
<td align="left">After</td>
</tr>
<tr class="odd">
<td align="left"><code>UserService\UpdateUserSignal</code></td>
<td align="left"><ul>
<li><code>userId</code></li>
</ul></td>
<td align="left"><code>UserService::updateUser()</code></td>
<td align="left">After</td>
</tr>
</tbody>
</table>

#### In this topic:

-   [ContentService](#SignalsReference-ContentService)
-   [ContentTypeService](#SignalsReference-ContentTypeService)
-   [LanguageService](#SignalsReference-LanguageService)
-   [LocationService](#SignalsReference-LocationService)
-   [ObjectStateService](#SignalsReference-ObjectStateService)
-   [RoleService](#SignalsReference-RoleService)
-   [SectionService](#SignalsReference-SectionService)
-   [TrashService](#SignalsReference-TrashService)
-   [URLAliasService](#SignalsReference-URLAliasService)
-   [URLWildcardService](#SignalsReference-URLWildcardService)
-   [UserService](#SignalsReference-UserService)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Repository](Repository_31432023.html)</span>
5.  <span>[List of Limitations](List-of-Limitations_31430459.html)</span>

 Developer : SiteAccessLimitation 



A Limitation to specify in which siteaccesses a certain permission applies, used by `user/login`.

|                 |                                                                         |
|-----------------|-------------------------------------------------------------------------|
| Identifier      | `SiteAccess`                                                            |
| Value Class     | `eZ\Publish\API\Repository\Values\User\Limitation\SiteAccessLimitation` |
| Type Class      | `eZ\Publish\Core\Limitation\SiteAccessLimitationType`                   |
| Criterion used  | n/a                                                                     |
| Role Limitation | no                                                                      |

###### Possible values

<table>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left">Value</td>
<td align="left">UI value</td>
<td align="left">Description</td>
</tr>
<tr class="even">
<td align="left"><code>&lt;siteaccess_hash&gt;</code></td>
<td align="left"><code>&lt;siteaccess_name&gt;</code></td>
<td align="left"><p>Hash is calculated in the following way in legacy in default 64bit mode: <code>sprintf( '%u', crc32( $siteAccessName ) )</code></p></td>
</tr>
</tbody>
</table>

###### Legacy compatibility notes

1.  <span> `SiteAccess` Limitation</span> is deprecated and is not used actively in Public API, but is allowed for being able to read / create Limitations for legacy.

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>

 Developer : SiteAccess 



# Introduction

eZ Platform allows you to maintain multiple sites in one installation using a feature called **siteaccesses**.

In short, a siteaccess is a set of configuration settings that is used when the site is reached through a specific address.

When the user accesses the site, the system analyzes the uri and compares it to rules specified in the configuration. If it finds a set of fitting rules, this siteaccess is used.

## What does a siteaccess do?

A siteaccess overrides the default configuration. This means that if the siteaccess does not specify some aspect of the configuration, the default values will be used. The default configuration is also used when no siteaccess can be matched to a situation. 

A siteaccess can decide many things about the website, for example the database, language or var directory that are used.

## How is a siteaccess selected?

A siteaccess is selected using one or more matchers – rules based on the uri or its parts. Example matching criteria are elements of the uri, host name (or its parts), port number, etc.

For detailed information on how siteaccess matchers work, see [Siteaccess Matching](https://doc.ez.no/display/DEVELOPER/SiteAccess#SiteAccess-SiteaccessMatching).

## What can you use siteaccesses for?

Typical uses of a siteaccess are:

-   different language versions of the same site identified by a uri part; one siteaccess for one language
-   two different versions of a website: one siteaccess with a public interface for visitors and one with a restricted interface for administrators

 

Both the rules for siteaccess matching and its effects are located in the main **app/config/ezplatform.yml** configuration file.

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
If you need to change between siteaccesses in Page mode, do not use any functions in the page itself (for example, a language switcher). This may cause unexpected errors. Instead, switch between siteaccesses using the siteaccess bar above the page.

## Use case: multilanguage sites

A site has content in two languages: English and Norwegian. It has one URI per language: <span class="nolink">http://example.com/eng</span> and http://example.com/nor. Uri parts of each language (eng, nor) are mapped to a *siteaccess*, commonly named like the uri part: `eng`, `nor`. Using semantic configuration, each of these siteaccesses can be assigned a prioritized list of languages it should display:

-   The English site would display content in English and ignore Norwegian content;
-   The Norwegian site would display content in Norwegian but also in English *if it does not exist in Norwegian*.

Such configuration would look like this:

``` brush:
ezpublish:
    siteaccess:
        # There are two siteaccess
        list: [eng, nor]
 
        # eng is the default one if no prefix is specified
        default_siteaccess: eng

        # the first URI of the element is used to find a siteaccess with a similar name
        match:
            URIElement: 1


ezpublish:
    # root node for configuration per siteaccess 
    system:
        # Configuration for the 'eng' siteaccess
        eng:
            languages: [eng-GB]
        nor:
            languages: [nor-NO, eng-GB]
```

## The default scope

When no particular context is required, it is fine to use the \`default\` scope instead of specifying a siteaccess.

# Configuration

## Basics

Important

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Configuration is tightly related to the service container.
To fully understand the following content, you need to be familiar with [Symfony's service container](Service-Container_31432100.html) and <a href="http://symfony.com/doc/current/book/service_container.html#service-parameters">its configuration</a>.

Basic configuration handling in eZ Platform is similar to what is commonly possible with Symfony. Regarding this, you can define key/value pairs in <a href="http://symfony.com/doc/current/book/service_container.html#importing-other-container-configuration-resources">your configuration files</a>, under the main **parameters** key (like in **<a href="https://github.com/ezsystems/ezpublish5/blob/master/app/config/parameters.yml.dist">parameters.yml</a>**).

Internally and by convention, keys follow a **dot syntax** where the different segments follow your configuration hierarchy. Keys are usually prefixed by a *namespace* corresponding to your application. Values can be anything, **including arrays and deep hashes**.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
eZ Platform core configuration is prefixed by **ezsettings** namespace, while *internal* configuration (not to be used directly) is prefixed by **ezpublish** namespace.

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
For configuration that is meant to be exposed to an end-user (or end-developer), it's usually a good idea to also <a href="http://symfony.com/doc/current/components/config/definition.html">implement semantic configuration</a>.

Note that it is also possible to <span class="confluence-link">[implement SiteAccess aware semantic configuration](Exposing-SiteAccess-aware-configuration-for-your-bundle_31429794.html)</span>.

### Example

**Configuration**

``` brush:
parameters:
    myapp.parameter.name: someValue
    myapp.boolean.param: true
    myapp.some.hash:
        foo: bar
        an_array: [apple, banana, pear]
```

**Usage from a controller**

``` brush:
// Inside a controller
$myParameter = $this->container->getParameter( 'myapp.parameter.name' );
```

## Dynamic configuration with the ConfigResolver

In eZ Platform it is fairly common to have different settings depending on the current siteaccess (e.g. languages, [view provider](Content-Rendering_31429679.html#ContentRendering-Viewproviderconfiguration) configuration).

### Scope

**Dynamic configuration **can be resolved depending on a *scope*.

Available scopes are (in order of precedence) :

1.  *global*
2.  SiteAccess
3.  SiteAccess group
4.  *default*

It gives the opportunity to define settings for a given siteaccess, for instance, like in the <a href="http://doc.ez.no/eZ-Publish/Technical-manual/4.x/Concepts-and-basics/Configuration">legacy INI override system</a>.

This mechanism is not limited to eZ Platform internal settings (aka ***ezsettings* namespace**) and is applicable for specific needs (bundle-related, project-related, etc.).

<span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
Always prefer semantic configuration especially for internal eZ settings.
Manually editing internal eZ settings is possible, but at your own risk, as unexpected behavior can occur.

### ConfigResolver Usage

Dynamic configuration is handled by a **config resolver**. It consists in a service object mainly exposing `hasParameter()` and `getParameter()` methods. The idea is to check the different *scopes* available for a given *namespace* to find the appropriate parameter.

In order to work with the config resolver, your dynamic settings must comply internally with the following name format: `<namespace>.<scope>.parameter.name`.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
The following configuration is **an example of internal usage** inside the code of eZ Platform.

**Namespace + scope example**

``` brush:
parameters:
    # Some internal configuration
    ezsettings.default.content.default_ttl: 60
    ezsettings.ezdemo_site.content.default_ttl: 3600
 
    # Here "myapp" is the namespace, followed by the siteaccess name as the parameter scope
    # Parameter "foo" will have a different value in ezdemo_site and ezdemo_site_admin
    myapp.ezdemo_site.foo: bar
    myapp.ezdemo_site_admin.foo: another value
    # Defining a default value, for other siteaccesses
    myapp.default.foo: Default value
 
    # Defining a global setting, used for all siteaccesses
    #myapp.global.some.setting: This is a global value
```

``` brush:
// Inside a controller, assuming siteaccess being "ezdemo_site"
/** @var $configResolver \eZ\Publish\Core\MVC\ConfigResolverInterface **/
$configResolver = $this->getConfigResolver();
 
// ezsettings is the default namespace, so no need to specify it
// The following will resolve ezsettings.<siteaccessName>.content.default_ttl
// In the case of ezdemo_site, will return 3600.
// Otherwise it will return the value for ezsettings.default.content.default_ttl (60)
$locationViewSetting = $configResolver->getParameter( 'content.default_ttl' );
 
$fooSetting = $configResolver->getParameter( 'foo', 'myapp' );
// $fooSetting's value will be 'bar'
 
// Force scope
$fooSettingAdmin = $configResolver->getParameter( 'foo', 'myapp', 'ezdemo_site_admin' );
// $fooSetting's value will be 'another value'
 
// Note that the same applies for hasParameter()
```

Both `getParameter()` and `hasParameter()` can take 3 different arguments:

1.  `$paramName` (i.e. the name of the parameter you need)
2.  `$namespace` (i.e. your application namespace, *myapp* in the previous example. If null, the default namespace will be used, which is **ezsettings** by default)
3.  `$scope` (i.e. a siteaccess name. If null, the current siteaccess will be used)

### Inject the ConfigResolver in your services

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
Instead of injecting the whole ConfigResolver service, you may directly [inject your SiteAccess-aware settings (aka dynamic settings) into your own services](https://doc.ez.no/display/DEVELOPER/SiteAccess#SiteAccess-DynamicSettingsInjection).

 

You can use the **ConfigResolver** in your own services whenever needed. To do this, just inject the `ezpublish.config.resolver service`:

``` brush:
parameters:
    my_service.class: My\Cool\Service
 
services:
    my_service:
        class: %my_service.class%
        arguments: [@ezpublish.config.resolver]
```

``` brush:
<?php
namespace My\Cool;
 
use eZ\Publish\Core\MVC\ConfigResolverInterface;
 
class Service
{
    /**
     * @var \eZ\Publish\Core\MVC\ConfigResolverInterface
     */
    private $configResolver;
 
    public function __construct( ConfigResolverInterface $configResolver )
    {
        $this->configResolver = $configResolver;
        $myParam = $this->configResolver->getParameter( 'foo', 'myapp' );
    }
 
    // ...
}
```

## Custom locale configuration

If you need to use a custom locale they can also be configurable in `ezplatform.yml`, adding them to the *conversion map*:

``` brush:
ezpublish:
    # Locale conversion map between eZ Publish format (i.e. fre-FR) to POSIX (i.e. fr_FR). 
    # The key is the eZ Publish locale. Check locale.yml in EzPublishCoreBundle to see natively supported locales.
    locale_conversion:
        eng-DE: en_DE
```

A locale *conversion map* example <a href="https://github.com/ezsystems/ezpublish-kernel/blob/master/eZ/Bundle/EzPublishCoreBundle/Resources/config/locale.yml">can be found in the <code>core</code> bundle, on <code>locale.yml</code></a>.

## Siteaccess Matching

Siteaccess matching is done through **eZ\\Publish\\MVC\\SiteAccess\\Matcher** objects. You can configure this matching and even develop custom matchers.

To be usable, every siteaccess must be provided a matcher.

You can configure siteaccess matching in your main **app/config/ezplatform.yml**:

**ezplatform.yml**

``` brush:
ezpublish:
    siteaccess:
        default_siteaccess: ezdemo_site
        list:
            - ezdemo_site
            - eng
            - fre
            - fr_eng
            - ezdemo_site_admin
        groups:
            ezdemo_site_group:
                - ezdemo_site
                - eng
                - fre
                - fr_eng
                - ezdemo_site_admin
        match:
            Map\URI:
                ezdemo_site: ezdemo_site
                fre: fre
                ezdemo_site_admin: ezdemo_site_admin
```

You need to set several parameters:

-   **ezpublish.siteaccess.default\_siteaccess**
-   **ezpublish.siteaccess.list**
-   *(optional)* **ezpublish.siteaccess.groups**
-   **ezpublish.siteaccess.match**

**ezpublish.siteaccess.default\_siteaccess** is the default siteaccess that will be used if matching was not successful. This ensures that a siteaccess is always defined.

**ezpublish.siteaccess.list** is the list of all available siteaccesses in your website.

*(optional)* **ezpublish.siteaccess.groups** defines which groups siteaccesses belong to. This is useful when you want to mutualize settings between several siteaccesses and avoid config duplication. Siteaccess groups are treated the same as regular siteaccesses as far as configuration is concerned.

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
A siteaccess can be part of several groups.

A siteaccess configuration has always precedence on the group configuration.

**ezpublish.siteaccess.match** <span> holds the matching configuration. It consists in a hash where the key is the name of the matcher class. If the matcher class doesn't start with a </span> **\\** <span>, it will be considered relative to </span> `eZ\Publish\MVC\SiteAccess\Matcher` <span> (e.g. </span> `Map\Host` <span> will refer to </span> <span> `eZ\Publish\MVC\SiteAccess\Matcher\Map\Host`)</span>

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
<span>Every **custom matcher** can be specified with a **fully qualified class name** (e.g. `\My\SiteAccess\Matcher`) or by a **service identifier prefixed by @** (e.g. `@my_matcher_service`).</span>

-   <span>In the case of a fully qualified class name, the matching configuration will be passed in the constructor.</span>
-   <span>In the case of a service, it must implement `eZ\Bundle\EzPublishCoreBundle\SiteAccess\Matcher`. The matching configuration will be passed to `setMatchingConfiguration()`.</span>

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Make sure to type the matcher in correct case. If it is in wrong case like "Uri" instead of "URI," it will happily work on systems like Mac OS X because of case insensitive file system, but will fail when you deploy it to a Linux server. This is a known artifact of <a href="http://www.php-fig.org/psr/psr-0/">PSR-0 autoloading</a> of PHP classes.

### Available matchers

<table>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Description</th>
<th align="left">Configuration</th>
<th align="left">Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>URIElement</code></td>
<td align="left">Maps a URI element to a siteaccess.<br />
This is the default matcher used when choosing<br />
URI matching in setup wizard. </td>
<td align="left"><p>The element number you want to match (starting from 1).</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="brush: php; gutter: false; theme: Eclipse" style="font-size:12px;"><code>ezpublish:
    siteaccess:
        match:
            URIElement: 1</code></pre>
</div>
</div>
<p><span> <strong>Important:</strong> When using a value &gt; 1, it will concatenate the elements with _</span></p></td>
<td align="left"><p><strong>URI:</strong> <code>/ezdemo_site/foo/bar</code></p>
<p>Element number: 1<br />
Matched siteaccess: ezdemo_site</p>
<p>Element number: 2<br />
Matched siteaccess: ezdemo_site_foo</p></td>
</tr>
<tr class="even">
<td align="left"><code>URIText</code></td>
<td align="left">Matches URI using <em>pre</em> and/or <em>post</em> sub-strings<br />
in the first URI segment</td>
<td align="left"><p>The prefix and/or suffix (none are required)</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="brush: php; gutter: false; theme: Eclipse" style="font-size:12px;"><code>ezpublish:
    siteaccess:
        match:
            URIText:
                prefix: foo
                suffix: bar</code></pre>
</div>
</div></td>
<td align="left"><p><strong>URI:</strong> <code>/footestbar/my/content</code></p>
<p>Prefix: foo<br />
Suffix: bar<br />
Matched siteaccess: test </p></td>
</tr>
<tr class="odd">
<td align="left"><code>HostElement</code></td>
<td align="left">Maps an element in the host name to a siteaccess.</td>
<td align="left"><p>The element number you want to match (starting from 1).</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="brush: php; gutter: false; theme: Eclipse" style="font-size:12px;"><code>ezpublish:
    siteaccess:
        match:
            HostElement: 2</code></pre>
</div>
</div></td>
<td align="left"><p><strong>Host name:</strong> <code>www.example.com</code></p>
<p>Element number: 2<br />
Matched siteaccess: example </p></td>
</tr>
<tr class="even">
<td align="left"><code>HostText</code></td>
<td align="left">Matches a siteaccess in the host name,<br />
using <em>pre</em> and/or <em>post</em> sub-strings.</td>
<td align="left"><p>The prefix and/or suffix (none are required)</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="brush: php; gutter: false; theme: Eclipse" style="font-size:12px;"><code>ezpublish:
    siteaccess:
        match:
            HostText:
                prefix: www.
                suffix: .com</code></pre>
</div>
</div></td>
<td align="left"><p><strong>Host name</strong>: <code>www.foo.com</code></p>
<p>Prefix: www.<br />
Suffix: .com<br />
Matched siteaccess: foo </p></td>
</tr>
<tr class="odd">
<td align="left"><code>Map\Host</code></td>
<td align="left">Maps a host name to a siteaccess.</td>
<td align="left"><p>A hash map of host/siteaccess</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="brush: php; gutter: false; theme: Eclipse" style="font-size:12px;"><code>ezpublish:
    siteaccess:
        match:
            Map\Host:
                www.foo.com: foo_front
                adm.foo.com: foo_admin
                www.bar-stuff.fr: bar_front
                adm.bar-stuff.fr: bar_admin</code></pre>
</div>
</div>
<div class="confluence-information-macro confluence-information-macro-warning">
<span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
<div class="confluence-information-macro-body">
<p>In eZ Enterprise, when using the <code>Map\Host</code> matcher, you need to provide the following line in your Twig template (e.g. in the head of the main template file):</p>
<p><code>{{ multidomain_access() }}</code></p>
</div>
</div></td>
<td align="left"><strong>Map</strong>:
<ul>
<li><a href="http://www.foo.com">www.foo.com</a> =&gt; foo_front</li>
<li><a href="http://admin.foo.com">admin.foo.com</a> =&gt; foo_admin </li>
</ul>
<p><strong>Host name</strong>: <a href="http://www.example.com">www.example.com</a></p>
<p>Matched siteaccess: foo_front</p></td>
</tr>
<tr class="even">
<td align="left"><code>Map\URI</code></td>
<td align="left">Maps a URI to a siteaccess</td>
<td align="left"><p>A hash map of URI/siteaccess</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="brush: php; gutter: false; theme: Eclipse" style="font-size:12px;"><code>ezpublish:
    siteaccess:
        match:
            Map\URI:
                something: ezdemo_site
                foobar: ezdemo_site_admin</code></pre>
</div>
</div>
<div class="confluence-information-macro confluence-information-macro-warning">
<span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
<div class="confluence-information-macro-body">
<p>The name of the <code>Map\URI</code> matcher must be the same as the siteaccess name. This also means that only one URI can be addressed by the same matcher.</p>
</div>
</div></td>
<td align="left"><p><strong>URI:</strong> <code>/something/my/content</code></p>
<p>Map:</p>
<ul>
<li>something =&gt; ezdemo_site</li>
<li>foobar =&gt; ezdemo_site_admin</li>
</ul>
<p>Matched siteaccess: ezdemo_site</p></td>
</tr>
<tr class="odd">
<td align="left"><code>Map\Port</code></td>
<td align="left">Maps a port to a siteaccess</td>
<td align="left"><p>A has map of Port/siteaccess</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="brush: php; gutter: false; theme: Eclipse" style="font-size:12px;"><code>ezpublish:
    siteaccess:
        match:
            Match\Port:
                80: foo
                8080: bar</code></pre>
</div>
</div></td>
<td align="left"><p><strong>URL:</strong> <code>             http://ezpublish.dev:8080/my/content           </code></p>
<p>Map:</p>
<ul>
<li>80: foo</li>
<li>8080: bar</li>
</ul>
<p>Matched siteaccess: bar</p></td>
</tr>
<tr class="even">
<td align="left"><code>Regex\Host</code></td>
<td align="left">Matches against a regexp and extracts a portion of it</td>
<td align="left"><p>The regexp to match against<br />
and the captured element to use</p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="brush: php; gutter: false; theme: Eclipse" style="font-size:12px;"><code>ezpublish:
    siteaccess:
        match:
            Regex\Host:
                regex: &quot;^(\\w+_sa)$&quot;
                # Default is 1
                itemNumber: 1</code></pre>
</div>
</div></td>
<td align="left"><p><strong>Host name:</strong> <code>example_sa</code></p>
<p>regex: <code>^(\\w+)_sa$</code><br />
itemNumber: 1</p>
<p>Matched siteaccess: example</p></td>
</tr>
<tr class="odd">
<td align="left"><code>Regex\URI</code></td>
<td align="left">Matches against a regexp and extracts a portion of it</td>
<td align="left"><p><span>The regexp to match against<br />
and the captured element to use</span></p>
<div class="code panel pdl" style="border-width: 1px;">
<div class="codeContent panelContent pdl">
<pre class="brush: php; gutter: false; theme: Eclipse" style="font-size:12px;"><code>ezpublish:
    siteaccess:
        match:
            Regex\URI:
                regex: &quot;^/foo(\\w+)bar&quot;
                # Default is 1
                itemNumber: 1</code></pre>
</div>
</div>
<p><span><br />
</span></p></td>
<td align="left"><p><strong>URI:</strong> <code>/footestbar/something</code></p>
<p>regex: ^/foo(\\w+)bar<br />
itemNumber: 1</p>
<p>Matched siteaccess: test </p></td>
</tr>
</tbody>
</table>

### Compound siteaccess matcher

The Compound siteaccess matcher allows you to combine several matchers together:

-   <a href="http://example.com/en" class="uri">http://example.com/en</a> matches site\_en (match on host=<a href="http://example.com">example.com</a> *and* URIElement(1)=en)
-   <a href="http://example.com/fr" class="uri">http://example.com/fr</a> matches site\_fr (match on host=<a href="http://example.com">example.com</a> *and* URIElement(1)=fr)
-   <a href="http://admin.example.com" class="uri">http://admin.example.com</a> matches site\_admin (match on host=<a href="http://admin.example.com">admin.example.com</a>)

Compound matchers cover the legacy  ***host\_uri*** matching feature.

They are based on logical combinations, or/and, using logical compound matchers:

-   `Compound\LogicalAnd`
-   `Compound\LogicalOr`

Each compound matcher will specify two or more sub-matchers. A rule will match if all the matchers, combined with the logical matcher, are positive. The example above would have used `Map\Host` and `Map\Uri`., combined with a `LogicalAnd`. When both the URI and host match, the siteaccess configured with "match" is used.

**ezplatform.yml**

``` brush:
ezpublish:
    siteaccess:
        match:
            Compound\LogicalAnd:
                # Nested matchers, with their configuration.
                # No need to precise their matching values (true will suffice).
                site_en:
                    matchers:
                        Map\URI:
                            en: true
                        Map\Host:
                            example.com: true
                    match: site_en
                site_fr:
                    matchers:
                        Map\URI:
                            fr: true
                        Map\Host:
                            example.com: true
                    match: site_fr
            Map\Host:
                admin.example.com: site_admin
```

### Matching by request header

It is possible to define which siteaccess to use by setting an **X-Siteaccess** header in your request. This can be useful for REST requests.

In such case, **X-Siteaccess** must be the **siteaccess name** (e.g. *ezdemo\_site*).

### Matching by environment variable

It is also possible to define which siteaccess to use directly via an **EZPUBLISH\_SITEACCESS** environment variable.

This is recommended if you want to get **performance gain** since no matching logic is done in this case.

You can define this environment variable directly from your web server configuration:

**Apache VirtualHost example**

``` brush:
# This configuration assumes that mod_env is activated
<VirtualHost *:80>
    DocumentRoot "/path/to/ezpublish5/web/folder"
    ServerName example.com
    ServerAlias www.example.com
    SetEnv EZPUBLISH_SITEACCESS ezdemo_site
</VirtualHost>
```

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
<span>This can also be done via PHP-FPM configuration file, if you use it. See </span> <a href="http://php.net/manual/en/install.fpm.configuration.php#example-60">PHP-FPM documentation</a> <span> for more information.</span>

Note about precedence

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
 The precedence order for siteaccess matching is the following (the first matched wins):

1.  Request header
2.  Environment variable
3.  Configured matchers

### URILexer and semanticPathinfo

In some cases, after matching a siteaccess, it is neecessary to modify the original request URI. This is for example needed with URI-based matchers since the siteaccess is contained in the original URI and it is not part of the route itself.

The problem is addressed by *analyzing* this URI and by modifying it when needed through the **URILexer** interface.

**URILexer interface**

``` brush:
/**
 * Interface for SiteAccess matchers that need to alter the URI after matching.
 * This is useful when you have the siteaccess in the URI like "/<siteaccessName>/my/awesome/uri"
 */
interface URILexer
{
    /**
     * Analyses $uri and removes the siteaccess part, if needed.
     *
     * @param string $uri The original URI
     * @return string The modified URI
     */
    public function analyseURI( $uri );
    /**
     * Analyses $linkUri when generating a link to a route, in order to have the siteaccess part back in the URI.
     *
     * @param string $linkUri
     * @return string The modified link URI
     */
    public function analyseLink( $linkUri );
}
```

Once modified, the URI is stored in the ***semanticPathinfo*** request attribute, and the original pathinfo is not modified.

# Usage

## Cross-siteacess links

When using the *multisite* feature, it is sometimes useful to be able to **generate cross-links** between the different sites.
This allows you to link different resources referenced in the same content repository, but configured independently with different tree roots.

**Twig example**

``` brush:
 {# Linking a location #} 
<a href="{{ url( 'ez_urlalias', {'locationId': 42, 'siteaccess': 'some_siteaccess_name'} ) }}">{{ ez_content_name( content ) }}</a>

{# Linking a regular route #} 
<a href="{{ url( "some_route_name", {"siteaccess": "some_siteaccess_name"} ) }}">Hello world!</a>
```

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
See <span class="confluence-link">[ez\_urlalias](ez_urlalias_32114047.html) </span>documentation page, for more information about linking to a Location

**PHP example**

``` brush:
namespace Acme\TestBundle\Controller;

use eZ\Bundle\EzPublishCoreBundle\Controller as BaseController;
use Symfony\Component\Routing\Generator\UrlGeneratorInterface;

class MyController extends BaseController
{
    public function fooAction()
    {
        // ...

        $location = $this->getRepository()->getLocationService()->loadLocation( 123 );
        $locationUrl = $this->generateUrl(
            $location,
            array( 'siteaccess' => 'some_siteaccess_name' ),
            UrlGeneratorInterface::ABSOLUTE_PATH
        );

        $regularRouteUrl = $this->generateUrl(
            'some_route_name',
            array( 'siteaccess' => 'some_siteaccess_name' ),
            UrlGeneratorInterface::ABSOLUTE_PATH
        );

        // ...
    }
}
```

     

Important

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
As siteaccess matchers can involve hosts and ports, it is **highly recommended** to generate cross-siteaccess links in an absolute form (e.g. using `url()` Twig helper).

### Troubleshooting

-   The **first matcher succeeding always wins**, so be careful when using *catch-all* matchers like `URIElement`.
-   If passed siteaccess name is not a valid one, an `InvalidArgumentException` will be thrown.
-   If matcher used to match the provided siteaccess doesn't implement `VersatileMatcher`, the link will be generated for the current siteaccess.
-   When using `Compound\LogicalAnd`, all inner matchers **must match**. If at least one matcher doesn't implement `VersatileMatcher`, it will fail.
-   When using `Compound\LogicalOr`, the first inner matcher succeeding will win.

### Under the hood

To implement this feature, a new `VersatileMatcher` was added to allow siteaccess matchers to be able to *reverse-match*.
All existing matchers implement this new interface, except the Regexp based matchers which have been deprecated.

The siteaccess router has been added a `matchByName()` method to reflect this addition. Abstract URLGenerator and `DefaultRouter` have been updated as well.

Note

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Siteaccess router public methods have also been extracted to a new interface, `SiteAccessRouterInterface`.

Landing Page - Known limitation

<span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
In eZ Studio's Landing Page you can encounter a 404 error when clicking a relative link which points to a different siteaccess (if the Content item being previewed does not exist in the previously used siteaccess). This is because detecting siteaccesses when navigating in preview is not functional yet. This is a known limitation that is awaiting resolution.

## Dynamic Settings Injection

Before 5.4, if you wanted to implement a service needing siteaccess-aware settings (e.g. language settings), you needed to inject the whole `ConfigResolver` (`ezpublish.config.resolver`) and get the needed settings from it. This was neither very convenient nor explicit.

The goal of this feature is to allow developers to inject these dynamic settings explicitly from their service definition (yml, xml, annotation, etc.).

### Syntax

Static container parameters follow the `%<parameter_name>%` syntax in Symfony.

Dynamic parameters have the following: `$<parameter_name>[; <namespace>[; <scope>]]$`, default namespace being `ezsettings`, and default scope being the current siteaccess.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
For more information, see [ConfigResolver documentation](https://doc.ez.no/display/DEVELOPER/SiteAccess#SiteAccess-Configuration).

### DynamicSettingParser

This feature also introduces a *DynamicSettingParser* service that can be used for adding support of the dynamic settings syntax.
This service has `ezpublish.config.dynamic_setting.parser` for ID and implements` eZ\Bundle\EzPublishCoreBundle\DependencyInjection\Configuration\SiteAccessAware\DynamicSettingParserInterface`.

### Limitations

A few limitations still remain:

-   <span>It is not possible to use dynamic settings in your semantic configuration (e.g. `config.yml` or `ezplatform.yml`) <span>as they are meant primarily for parameter injection in services.</span> </span>
-   It is not possible to define an array of options having dynamic settings. They will not be parsed. Workaround is to use separate arguments/setters.
-   Injecting dynamic settings in request listeners is **not recommended**, as it won't be resolved with the correct scope (request listeners are **instantiated before SiteAccess match**). Workaround is to inject the ConfigResolver instead, and resolving the setting in your `onKernelRequest` method (or equivalent).

### Examples

#### Injecting an eZ parameter

Defining a simple service needing `languages` parameter (i.e. prioritized languages).

Note

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Internally, `languages` parameter is defined as `ezsettings.<siteaccess_name>.languages`, `ezsettings` being eZ internal *namespace*.

#### **Before 5.4
**

``` brush:
parameters:
    acme_test.my_service.class: Acme\TestBundle\MyServiceClass

services:
    acme_test.my_service:
        class: %acme_test.my_service.class%
        arguments: [@ezpublish.config.resolver]

namespace Acme\TestBundle;
```

**
**

``` brush:
use eZ\Publish\Core\MVC\ConfigResolverInterface;

class MyServiceClass
{
    /**
 * Prioritized languages
 *
 * @var array
 */
    private $languages;

    public function __construct( ConfigResolverInterface $configResolver )
    {
        $this->languages = $configResolver->getParameter( 'languages' );
    }
}
```

#### After, with setter injection (preferred)

``` brush:
parameters:
    acme_test.my_service.class: Acme\TestBundle\MyServiceClass

services:
    acme_test.my_service:
        class: %acme_test.my_service.class%
        calls:
            - [setLanguages, ["$languages$"]]
```

``` brush:
namespace Acme\TestBundle;

class MyServiceClass
{
    /**
 * Prioritized languages
 *
 * @var array
 */
    private $languages;

    public function setLanguages( array $languages = null )
    {
        $this->languages = $languages;
    }
}
```

 

 

<span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span>
**Important**: Ensure you always add `null` as a default value, especially if the argument is type-hinted.

#### After, with constructor injection

``` brush:
parameters:
    acme_test.my_service.class: Acme\TestBundle\MyServiceClass

services:
    acme_test.my_service:
        class: %acme_test.my_service.class%
        arguments: ["$languages$"]
```

``` brush:
namespace Acme\TestBundle;

class MyServiceClass
{
    /**
 * Prioritized languages
 *
 * @var array
 */
    private $languages;

    public function __construct( array $languages )
    {
        $this->languages = $languages;
    }
}
```

 

 

Tip

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
Setter injection for dynamic settings should always be preferred, as it makes it possible to update your services that depend on them when ConfigResolver is updating its scope (e.g. when previewing content in a given SiteAccess). **However, only one dynamic setting should be injected by setter** <span>.</span>

**Constructor injection will make your service be reset in that case.**

#### <span style="color: rgb(0,98,147);">Injecting 3rd party parameters</span>

 

``` brush:
parameters:
    acme_test.my_service.class: Acme\TestBundle\MyServiceClass
    # "acme" is our parameter namespace.
    # Null is the default value.
    acme.default.some_parameter: ~
    acme.ezdemo_site.some_parameter: foo
    acme.ezdemo_site_admin.some_parameter: bar
 
services:
    acme_test.my_service:
        class: %acme_test.my_service.class%
        # The following argument will automatically resolve to the right value, depending on the current SiteAccess.
        # We specify "acme" as the namespace we want to use for parameter resolving.
        calls:
            - [setSomeParameter, ["$some_parameter;acme$"]]
```

``` brush:
namespace Acme\TestBundle;
class MyServiceClass
{
    private $myParameter;
    public function setSomeParameter( $myParameter = null )
    {
        // Will be "foo" for ezdemo_site, "bar" for ezdemo_site_admin, or null if another SiteAccess.
        $this->myParameter = $myParameter;
    }
}
```

#### In this topic:

-   [Introduction](#SiteAccess-Introduction)
    -   [What does a siteaccess do?](#SiteAccess-Whatdoesasiteaccessdo?)
    -   [How is a siteaccess selected?](#SiteAccess-Howisasiteaccessselected?)
    -   [What can you use siteaccesses for?](#SiteAccess-Whatcanyouusesiteaccessesfor?)
    -   [Use case: multilanguage sites](#SiteAccess-Usecase:multilanguagesites)
    -   [The default scope](#SiteAccess-Thedefaultscope)
-   [Configuration](#SiteAccess-Configuration)
    -   [Basics](#SiteAccess-Basics)
        -   [Example](#SiteAccess-Example)
    -   [Dynamic configuration with the ConfigResolver](#SiteAccess-DynamicconfigurationwiththeConfigResolver)
        -   [Scope](#SiteAccess-Scope)
        -   [ConfigResolver Usage](#SiteAccess-ConfigResolverUsage)
        -   [Inject the ConfigResolver in your services](#SiteAccess-InjecttheConfigResolverinyourservices)
    -   [Custom locale configuration](#SiteAccess-Customlocaleconfiguration)
    -   [Siteaccess Matching](#SiteAccess-SiteaccessMatching)
        -   [Available matchers](#SiteAccess-Availablematchers)
        -   [Compound siteaccess matcher](#SiteAccess-Compoundsiteaccessmatcher)
        -   [Matching by request header](#SiteAccess-Matchingbyrequestheader)
        -   [Matching by environment variable](#SiteAccess-Matchingbyenvironmentvariable)
        -   [URILexer and semanticPathinfo](#SiteAccess-URILexerandsemanticPathinfo)
-   [Usage](#SiteAccess-Usage)
    -   [Cross-siteacess links](#SiteAccess-Cross-siteacesslinks)
        -   [Troubleshooting](#SiteAccess-Troubleshooting)
        -   [Under the hood](#SiteAccess-Underthehood)
    -   [Dynamic Settings Injection](#SiteAccess-DynamicSettingsInjection)
        -   [Syntax](#SiteAccess-Syntax)
        -   [DynamicSettingParser](#SiteAccess-DynamicSettingParser)
        -   [Limitations](#SiteAccess-Limitations)
        -   [Examples](#SiteAccess-Examples)

#### Related topics:

[Cross-siteaccess links](https://doc.ez.no/display/DEVELOPER/SiteAccess#SiteAccess-Cross-siteacesslinks)

<span class="confluence-link">[Setting the Index Page](Multisite_31430389.html#Multisite-SettingTheIndexPage)</span>






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Search](Search_31429673.html)</span>
5.  <span>[Search Engines](Search-Engines_32112955.html)</span>

 Developer : Solr Bundle 



<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
For use with eZ Publish 5.4, go to[the corresponding documentation page](https://doc.ez.no/display/EZP/Solr+Search+Engine+Bundle)which covers the v1.0 version of the bundle compatible with eZ Publish 5.4.

 

## What is Solr Search Engine Bundle?

<a href="https://github.com/ezsystems/ezplatform-solr-search-engine">ezplatform-solr-search-engine</a> as the package is called, aims to be a transparent drop in replacement for the SQL based "Legacy" search engine powering eZ Platform Search API by default. By enabling Solr and re-indexing your content, all your existing Search queries using SearchService, will be powered by Solr automatically. This allows you to scale up your eZ Platform installation and be able to continue development locally against SQL engine, and have a test infrastructure, Staging and Prod powered by Solr, thus removing considerable load from your database so it can focus on more important things, like publishing <img src="images/icons/emoticons/wink.png" alt="(wink)" class="emoticon emoticon-wink" />.

*See [Architecture page](31429707.html)* *for further information on the architecture of eZ Platform.*

## How to set up Solr Search engine

### Step 0: Enable Solr Bundle

Not needed with eZ Platform

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
This step is not needed as of eZ Platform 15.09, however it is kept here for reference in case you have previously disabled the bundle.

 

1.  Check in composer.json if you have the `ezsystems/ezplatform-solr-search-engine` package, if not add/update composer dependencies:

    **command line**

    ``` brush:
    composer require --no-update ezsystems/ezplatform-solr-search-engine:~1.0
    composer update
    ```

    <span class="expand-control-icon"><img src="images/icons/grey_arrow_down.png" class="expand-control-image" /></span><span class="expand-control-text">Instructions for Solr6 beta testing (1/3)</span>

    <span class="status-macro aui-lozenge aui-lozenge-current">SOLR BUNDLE 1.3 TESTING</span>

    **command line**

    ``` brush:
    composer require --update-with-dependencies ezsystems/ezplatform-solr-search-engine:~1.3@alpha
    ```

     

     

2.  Make sure EzPublishSolrSearchEngineBundle is activated with the following line in `app/AppKernel.php` file: new `EzSystems\EzPlatformSolrSearchEngineBundle\EzSystemsEzPlatformSolrSearchEngineBundle()`

### Step 1: Configuring & Starting Solr

 

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Example here is for single core, look to <a href="https://cwiki.apache.org/confluence/display/solr/Solr+Cores+and+solr.xml">Solr</a> <a href="https://wiki.apache.org/solr/CoreAdmin">documentation</a> for configuring Solr in other ways, also see the provided configuration for some examples.

 

First download and extract Solr, **we currently support Solr 4.10.4**:

-   <a href="http://archive.apache.org/dist/lucene/solr/4.10.4/solr-4.10.4.tgz">solr-4.10.4.tgz</a><span style="line-height: 1.4285715;"> or </span><a href="http://archive.apache.org/dist/lucene/solr/4.10.4/solr-4.10.4.zip">solr-4.10.4.zip</a>

<span class="expand-control-icon"><img src="images/icons/grey_arrow_down.png" class="expand-control-image" /></span><span class="expand-control-text">Instructions for Solr6 beta testing (2/3)</span>

<span class="status-macro aui-lozenge aui-lozenge-current">SOLR BUNDLE 1.3 TESTING</span>

For Solr 6 testing please download version we are currently testing *(but any 6.x version should theoretically work)*:

-   <a href="http://archive.apache.org/dist/lucene/solr/6.4.2/solr-6.4.2.tgz">solr-6.4.2.tgz</a><span> or </span><a href="http://archive.apache.org/dist/lucene/solr/6.4.2/solr-6.4.2.zip">solr-6.4.2.zip</a>

 

Secondly, copy configuration files needed for eZ Solr Search Engine bundle, *here from the root of your project to the place you extracted Solr*:

**Command line example**

``` brush:
# Make sure to change the /opt/solr/ path with where you have placed Solr
cp -R vendor/ezsystems/ezplatform-solr-search-engine/lib/Resources/config/solr/* /opt/solr/example/solr/collection1/conf/

/opt/solr/bin/solr start -f 
```

<span class="expand-control-icon"><img src="images/icons/grey_arrow_down.png" class="expand-control-image" /></span><span class="expand-control-text">Instructions for Solr6 beta testing (3/3)</span>

<span class="status-macro aui-lozenge aui-lozenge-current">SOLR BUNDLE 1.3 TESTING</span>

**Command line example**

``` brush:
# Make sure to change the /opt/solr/ path with where you have placed Solr
mkdir -p /opt/solr/server/ez/template
cp -R vendor/ezsystems/ezplatform-solr-search-engine/lib/Resources/config/solr/* /opt/solr/server/ez/template
cp /opt/solr/server/solr/configsets/basic_configs/conf/{currency.xml,solrconfig.xml,stopwords.txt,synonyms.txt,elevate.xml} /opt/solr/server/ez/template
cp /opt/solr/server/solr/solr.xml /opt/solr/server/ez

# Modify solrconfig.xml to remove section that doesn't agree with our schema
sed -i.bak '/<updateRequestProcessorChain name="add-unknown-fields-to-the-schema">/,/<\/updateRequestProcessorChain>/d' /opt/solr/server/ez/template/solrconfig.xml
 
# Start Solr (but apply autocommit settings below first if you need it)
/opt/solr/bin/solr -s ez
/opt/solr/bin/solr create_core -c collection1 -d server/ez/template
```

 

Thirdly, Solr Bundle does not commit solr index changes directly on repository updates, leaving it up to you to tune this using `solrconfig.xml` as best practice suggests, example config:

**solrconfig.xml**

``` brush:
<autoCommit>
  <!-- autoCommit is here left as-is like it is out of the box in Solr, this controls hard commits for durability/replication -->
  <maxTime>${solr.autoCommit.maxTime:15000}</maxTime> 
  <openSearcher>false</openSearcher> 
</autoCommit>

<autoSoftCommit>
  <!-- Soft commits controls mainly when changes becomes visible, by default we change value from -1 (disabled) to 100ms, to try to strike a balance between Solr performance and staleness of HttpCache generated by Solr queries -->
  <maxTime>${solr.autoSoftCommit.maxTime:100}</maxTime> 
</autoSoftCommit>
```

### Step 2: Configuring bundle

The Solr search engine bundle can be configured many ways, in the config further below it assumes you have parameters setup for solr dsn and search engine *(however both are optional)*, example:

**parameters.yml**

``` brush:
    search_engine: solr
    solr_dsn: 'http://localhost:8983/solr'
```

On to configuring the bundle.

#### Single Core example (default)

Out of the box in eZ Platform the following is enabled for simple setup:

**config.yml**

``` brush:
ez_search_engine_solr:
    endpoints:
        endpoint0:
            dsn: %solr_dsn%
            core: collection1
    connections:
        default:
            entry_endpoints:
                - endpoint0
            mapping:
                default: endpoint0
```

#### Shared Core example

In the following example we have decided to separate one language as the installation contains several similar languages, and one very different language that should receive proper language analysis for proper stemming and sorting behavior by Solr:

**config.yml**

``` brush:
ez_search_engine_solr:
    endpoints:
        endpoint0:
            dsn: %solr_dsn%
            core: core0
        endpoint1:
            dsn: %solr_dsn%
            core: core1
    connections:
        default:
            entry_endpoints:
                - endpoint0
                - endpoint1
            mapping:
                translations:
                    jpn-JP: endpoint1
                # Other languages, for instance eng-US and other western languages are sharing core
                default: endpoint0
```

#### Multi Core example

If full language analysis features are preferred, then each language can be configured to separate cores.

*Note: Please make sure to test this setup against single core setup, as it might perform worse than single core if your project uses a lot of language fallbacks per siteaccess, as queries will then be performed across several cores at once.*

**config.yml**

``` brush:
ez_search_engine_solr:
    endpoints:
        endpoint0:
            dsn: %solr_dsn%
            core: core0
        endpoint1:
            dsn: %solr_dsn%
            core: core1
        endpoint2:
            dsn: %solr_dsn%
            core: core2
        endpoint3:
            dsn: %solr_dsn%
            core: core3
        endpoint4:
            dsn: %solr_dsn%
            core: core4
        endpoint5:
            dsn: %solr_dsn%
            core: core5
        endpoint6:
            dsn: %solr_dsn%
            core: core6
    connections:
        default:
            entry_endpoints:
                - endpoint0
                - endpoint1
                - endpoint2
                - endpoint3
                - endpoint4
                - endpoint5
                - endpoint6
            mapping:
                translations:
                    - jpn-JP: endpoint1
                    - eng-US: endpoint2
                    - fre-FR: endpoint3
                    - ger-DE: endpoint4
                    - esp-ES: endpoint5
                # Not really used, but specified here for fallback if more languages are suddenly added by content admins
                default: endpoint0
                # Also use separate core for main languages (differs from content object to content object)
                # This is useful to reduce number of cores queried for always available language fallbacks
                main_translations: endpoint6
```

* *

### Step 3: Configuring repository with the specific search engine

<span>The following is an example of configuring Solr Search Engine, where `connection` name is same as in example above, and engine is set to </span> `solr`:

**ezplatform.yml**

``` brush:
ezpublish:
    repositories:
        default:
            storage: ~
            search:
                engine: %search_engine%
                connection: default
```

`%search_engine%` is a parameter that is configured in `app/config/parameters.yml`, and should be changed from its default value "`legacy`" to "`solr`" to activate Solr as the Search engine.

### Step 4: Clear prod cache

While Symfony dev environment keeps track of changes to yml files, prod does not, so to make sure Symfony reads the new config we clear cache:

``` brush:
php app/console --env=prod cache:clear
```

### Step 5: Run CLI indexing command

Make sure to configure your setup for indexing

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Some exceptions might happen on indexing if you have not configured your setup correctly, here are the most common issues you may encounter:

-   Exception if Binary files in database have an invalid path prefix
    -   Make sure `ezplatform.yml` configuration <span> <span> `var_dir` is configured properly.</span> </span>
    -   <span> <span>If your database is inconsistent in regards to file paths, try to update entries to be correct *(but make sure to make a backup first)*.</span> </span>
-   Exception<span> on unsupported Field Types</span>
    -   <span>Make sure to implement all Field Types in your installation, or to configure missing ones as [<span class="confluence-link">NullType</span> ](Null-Field-Type_31430527.html)if implementation is not needed.</span>
-   <span>Content not immediately available </span>
    -   <span>Solr Bundle is on purpose not committing changes directly on Repository updates *(on indexing)*, but letting you control this using Solr configuration. </span> <span>Adjust Solr</span> **autoSoftCommit ** *visibility of change to search index)* <span> and/or **autoCommit** *(hard commit, for durability and replication) *to balance performance and load on your Solr instance against needs you have for "<a href="https://cwiki.apache.org/confluence/display/solr/Near+Real+Time+Searching">NRT</a>".</span>
-   Running out of memory during indexing
    -   In general <span>make sure to run indexing using prod environment to avoid debuggers and loggers from filing up memory.</span>
    -   Stash: Disable in\_memory cache as recommended on [Persistence cache](Repository_31432023.html#Repository-PersistenceCache) for long running scripts.
    -   Flysystem: An open issue exists where you can find further info <a href="https://jira.ez.no/browse/EZP-25325" class="uri">https://jira.ez.no/browse/EZP-25325</a>

Last step is to execute initial indexation of data:

``` brush:
php app/console --env=prod --siteaccess=<name> ezplatform:solr_create_index
```

<span class="status-macro aui-lozenge aui-lozenge-current">V1.7.0</span>

Since v1.7.0 the `ezplatform:solr_create_index` command is deprecated, use `php app/console ezplatform:reindex` instead:

``` brush:
php app/console --env=prod --siteaccess=<name> ezplatform:reindex
```

## Extending the Solr Search engine Bundle

### Document Field Mappers

<span class="status-macro aui-lozenge aui-lozenge-current aui-lozenge-subtle">SOLR BUNDLE 1.2, AVAILABLE IN EZ PLATFORM V1.7+</span>

As a developer you will often find the need to index some additional data in the search engine. The use cases for this are wide, for example the data could come from an external source *(for example from recommendation system)*, or from an internal source.

The common use case for the latter is indexing data through the Location hierarchy, for example from the parent Location to the child Location, or in the opposite direction, indexing child data on the parent Location. The reason might be you want to find the content with fulltext search, or you want to simplify search for a complicated data model.

To do this effectively, you first need to understand how the data is indexed with Solr Search engine. Documents are indexed per translation, as Content blocks. In Solr, a block is a nested document structure. In our case, parent document represents Content, and Locations are indexed as child documents of the Content. To avoid duplication, full text data is indexed on the Content document only.

Knowing this, you have the option to index additional data on:

-   all block documents (meaning Content and its Locations, all translations)
-   all block documents per translation
-   Content documents
-   Content documents per translation
-   Location documents

Indexing additional data is done by implementing a document field mapper and registering it at one of the five extension points described above. You can create the field mapper class anywhere inside your bundle, as long as when you register it as a service, the "class" parameter" in your `services.yml` matches the correct path. We have three different field mappers. Each mapper implements two methods, by the same name, but accepting different arguments:

-   `ContentFieldMapper`
    -   `::accept(Content $content)`
    -   `::mapFields(Content $content)`
-   `ContentTranslationFieldMapper`
    -   `::accept(Content $content, $languageCode)`
    -   `::mapFields(Content $content, $languageCode)`
-   `LocationFieldMapper`
    -   `::accept(Location $content)`
    -   `::mapFields(Location $content)`

These can be used on the extension points by registering them with the container using service tags, as follows:

-   all block documents
    -   `ContentFieldMapper`
    -   `ezpublish.search.solr.document_field_mapper.block`
-   all block documents per translation
    -   `ContentTranslationFieldMapper`
    -   `ezpublish.search.solr.field_mapper.block_translation`
-   Content documents
    -   `ContentFieldMapper`
    -   `ezpublish.search.solr.document_field_mapper.content`
-   Content documents per translation
    -   `ContentTranslationFieldMapper`
    -   `ezpublish.search.solr.field_mapper.content_translation`
-   Location documents
    -   `LocationFieldMapper`
    -   `ezpublish.search.solr.field_mapper.location`

The following example shows how to index data from the parent Location content, in order to make it available for full text search on the children content. A concrete use case could be indexing webinar data on the webinar events, which are children of the webinar. Field mapper could then look something like this:

``` brush:
 <?php

namespace My\WebinarApp;

use EzSystems\EzPlatformSolrSearchEngine\FieldMapper\ContentFieldMapper;
use eZ\Publish\SPI\Persistence\Content\Handler as ContentHandler;
use eZ\Publish\SPI\Persistence\Content\Location\Handler as LocationHandler;
use eZ\Publish\SPI\Persistence\Content;
use eZ\Publish\SPI\Search;

class WebinarEventTitleFulltextFieldMapper extends ContentFieldMapper
{
    /**
     * @var \eZ\Publish\SPI\Persistence\Content\Type\Handler
     */
    protected $contentHandler;

    /**
     * @var \eZ\Publish\SPI\Persistence\Content\Location\Handler
     */
    protected $locationHandler;

    /**
     * @param \eZ\Publish\SPI\Persistence\Content\Handler $contentHandler
     * @param \eZ\Publish\SPI\Persistence\Content\Location\Handler $locationHandler
     */
    public function __construct(
        ContentHandler $contentHandler,
        LocationHandler $locationHandler
    ) {
        $this->contentHandler = $contentHandler;
        $this->locationHandler = $locationHandler;
    }

    public function accept(Content $content)
    {
        // ContentType with ID 42 is webinar event
        return $content->versionInfo->contentInfo->contentTypeId == 42;
    }

    public function mapFields(Content $content)
    {
        $mainLocationId = $content->versionInfo->contentInfo->mainLocationId;
        $location = $this->locationHandler->load($mainLocationId);
        $parentLocation = $this->locationHandler->load($location->parentId);
        $parentContentInfo = $this->contentHandler->loadContentInfo($parentLocation->contentId);

        return [
            new Search\Field(
                'fulltext',
                $parentContentInfo->name,
                new Search\FieldType\FullTextField()
            ),
        ];
    }
}
```

Since we index full text data only on the Content document, you would register the service like this:

``` brush:
my_webinar_app.webinar_event_title_fulltext_field_mapper:
    class: My\WebinarApp\WebinarEventTitleFulltextFieldMapper
    arguments:
        - '@ezpublish.spi.persistence.content_handler'
        - '@ezpublish.spi.persistence.location_handler'
    tags:
        - {name: ezpublish.search.solr.field_mapper.content}
```

## Providing feedback

After completing the installation you are now free to use your site as usual. If you get any exceptions for missing features, have feedback on performance, or want to discuss, join our community slack channel at <a href="https://ezcommunity.slack.com/messages/ezplatform-use/" class="uri">https://ezcommunity.slack.com/messages/ezplatform-use/</a>

#### In this topic:

-   [What is Solr Search Engine Bundle?](#SolrBundle-WhatisSolrSearchEngineBundle?)
-   [How to set up Solr Search engine](#SolrBundle-HowtosetupSolrSearchengine)
    -   [Step 0: Enable Solr Bundle](#SolrBundle-Step0:EnableSolrBundle)
    -   [Step 1: Configuring & Starting Solr](#SolrBundle-Step1:Configuring&StartingSolr)
    -   [Step 2: Configuring bundle](#SolrBundle-Step2:Configuringbundle)
    -   [Step 3: Configuring repository with the specific search engine](#SolrBundle-Step3:Configuringrepositorywiththespecificsearchengine)
    -   [Step 4: Clear prod cache](#SolrBundle-Step4:Clearprodcache)
    -   [Step 5: Run CLI indexing command](#SolrBundle-Step5:RunCLIindexingcommand)
-   [Extending the Solr Search engine Bundle](#SolrBundle-ExtendingtheSolrSearchengineBundle)
    -   [Document Field Mappers](#SolrBundle-DocumentFieldMappers)
-   [Providing feedback](#SolrBundle-Providingfeedback)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[The Complete Guide to eZ Platform](The-Complete-Guide-to-eZ-Platform_31429526.html)</span>
4.  <span>[Search](Search_31429673.html)</span>

 Developer : Sort Clauses Reference 



**Sort Clauses** are the *sorting options* for Content and Location Search in eZ Platform. For generic use of API Search see <span class="confluence-link">[Search Criteria and Sort Clauses](#SortClausesReference-SearchCriteriaandSortClauses)</span>.

A Sort Clause consists of two parts just like <span class="confluence-link"><span class="confluence-link">Criterion</span> </span>and FacetBuilder:

-   The API Value: `SortClause`
-   Specific handler per search engine: `SortClausesHandler`

The `SortClause` represents the value you use in the API, while `SortClauseHandler` deals with the business logic in the background, translating the value to something the Search engine can understand.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Implementation and availability of a handler sometimes depends on search engine capabilities and limitations.

### Common concepts for all <span>Sort Clauses </span>

For how to use each and every <span>Sort Clause,</span> see list below as it depends on the <span>Sort Clause</span> Value constructor, but *in general* you should be aware of the following common concept:

-   `sortDirection`: The direction to perform the sort, either `Query::SORT_ASC`*(default)* or `         Query::         SORT_DESC`

<span style="color: rgb(102,14,122);">
</span>

<span style="color: rgb(102,14,122);"> </span>

<span class="status-macro aui-lozenge aui-lozenge-current">V1.6.0</span>

You can use the method `SearchService::getSortClauseFromLocation( Location $location )` to return an array of Sort Clauses that you can use on `LocationQuery->sortClauses`.

<span style="color: rgb(102,14,122);">
</span>

### List of <span>Sort Clauses </span>

The list below reflects <span>Sort Clauses</span> available in the `eZ\Publish\API\Repository\Values\Content\Query\SortClause` namespace (it is also possible to <span class="confluence-link">make a custom Sort Clause</span>):

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Arguments starting with "`?`" are optional.

#### Only for LocationSearch

| <span>Sort Clause</span>        | Constructor arguments description |
|---------------------------------|-----------------------------------|
| `Location\Depth `               | ?`sortDirection`                  |
| `           Location\Id `       | <span>?</span>`sortDirection`     |
| `Location\IsMainLocation `      | <span>?</span>`sortDirection`     |
| `           Location\Depth `    | <span>?</span>`sortDirection`     |
| `           Location\Priority ` | <span>?</span>`sortDirection`     |
| `Location\Visibility `          | ?`sortDirection`                  |

 

#### Common

<table>
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"><span>Sort Clause</span></th>
<th align="left">Constructor arguments description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>ContentId</code></td>
<td align="left"><code>?sortDirection</code></td>
</tr>
<tr class="even">
<td align="left"><code>ContentName</code></td>
<td align="left"><span> <code>?sortDirection</code> </span></td>
</tr>
<tr class="odd">
<td align="left"><code>DateModified</code></td>
<td align="left"><code>?sortDirection</code></td>
</tr>
<tr class="even">
<td align="left"><code>           DatePublished         </code></td>
<td align="left"><code>?sortDirection</code></td>
</tr>
<tr class="odd">
<td align="left"><code>Field</code></td>
<td align="left"><p><code>typeIdentifier</code> as string<code>, fieldIdentifier</code> as string<code>, ?sortDirection, ?languageCode </code>as string</p></td>
</tr>
<tr class="even">
<td align="left"><code>MapLocationDistance </code></td>
<td align="left"><span> <code>typeIdentifier</code> <span> as string</span> <code>, fieldIdentifier</code> <span> as string</span> <code>, </code> <code>             latitude</code> <span> as</span> <span> float</span> <code>,</code> <span> </span> <code>             longitude</code> <span> as</span> <span> float, ?</span> </span> <code>sortDirection, ?languageCode</code> <span> as string</span></td>
</tr>
<tr class="odd">
<td align="left"><code>SectionIdentifier</code></td>
<td align="left"><span> ?<code>sortDirection</code> </span></td>
</tr>
<tr class="even">
<td align="left"><code>SectionName</code></td>
<td align="left"><span> ?<code>sortDirection</code> </span></td>
</tr>
</tbody>
</table>

#### In this topic:

-   [Common concepts for all Sort Clauses ](#SortClausesReference-CommonconceptsforallSortClauses)
-   [List of Sort Clauses ](#SortClausesReference-ListofSortClauses)






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Get Started with eZ Platform](Get-Started-with-eZ-Platform_31429520.html)</span>
4.  <span>[Step 1: Installation](31429538.html)</span>

 Developer : Starting eZ Platform 



Once you have your eZ Platform installed, all you need to do to start it is to run your Apache server. Then you can access your eZ Platform's front and back office. To access the UI backend, add `/ez` to your installation URL.

When it comes to the server, you can use the following options:

-   [Web Server](Web-Server_31429554.html)
-   [PHP's built-in server](31429556.html)

 






1.  <span>[Developer](index.html)</span>
2.  <span>[Documentation](Documentation_31429504.html)</span>
3.  <span>[Tutorials](Tutorials_31429522.html)</span>
4.  <span>[Building a Bicycle Route Tracker in eZ Platform](Building-a-Bicycle-Route-Tracker-in-eZ-Platform_31431606.html)</span>
5.  <span>[Part 2: Working on the Ride](31431613.html)</span>

 Developer : Step 1 - Display content of a Ride 



 

 

<span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img src="attachments/31431852/31431849.png?effects=border-simple,blur-border" class="confluence-embedded-image image-center" height="400" /></span>

Now let's inject and display all Points of interest within the view.

-   <span class="TOCOutline">1</span> [Creating the Ride view](#Step1-DisplaycontentofaRide-CreatingtheRideview)
    -   <span class="TOCOutline">1.1.1</span> [What is in this template ?](#Step1-DisplaycontentofaRide-Whatisinthistemplate?)
-   <span class="TOCOutline">1.2</span> [Add a new parameter to your override rule](#Step1-DisplaycontentofaRide-Addanewparametertoyouroverriderule)
-   <span class="TOCOutline">1.3</span> [Check the Ride full view](#Step1-DisplaycontentofaRide-ChecktheRidefullview)
    -   <span class="TOCOutline">1.3.1</span> [Preview in the Admin](#Step1-DisplaycontentofaRide-PreviewintheAdmin)
    -   <span class="TOCOutline">1.3.2</span> [Go to the Ride page](#Step1-DisplaycontentofaRide-GototheRidepage)

<span class="TOCOutline">2</span> [Points Of Interest](#Step1-DisplaycontentofaRide-PointsOfInterest)
-   <span class="TOCOutline">2.1</span> [Create the Point Of Interest (POI) Content Type](#Step1-DisplaycontentofaRide-CreatethePointOfInterest(POI)ContentType)
-   <span class="TOCOutline">2.2</span> [Edit the Ride Content Type](#Step1-DisplaycontentofaRide-EdittheRideContentType)

<span class="TOCOutline">3</span> [Ride view improvements](#Step1-DisplaycontentofaRide-Rideviewimprovements)
-   <span class="TOCOutline">3.1</span> [Display the list of POI](#Step1-DisplaycontentofaRide-DisplaythelistofPOI)
-   <span class="TOCOutline">3.2</span> [Create your Point of Interest line view](#Step1-DisplaycontentofaRide-CreateyourPointofInterestlineview)
-   <span class="TOCOutline">3.3</span> [Integrate the Points of Interest in the Ride view](#Step1-DisplaycontentofaRide-IntegratethePointsofInterestintheRideview)
    -   <span class="TOCOutline">3.3.1</span> [Create the RideController](#Step1-DisplaycontentofaRide-CreatetheRideController)
    -   <span class="TOCOutline">3.3.2</span> [Add the Point Of Interest in the Ride full view](#Step1-DisplaycontentofaRide-AddthePointOfInterestintheRidefullview)

# Creating the Ride view

Create a Twig template app/Resources/views/full/ride.html.twig and paste into it the following HTML and Twig tags:

**ride.html.twig**

``` brush:
{% extends "pagelayout.html.twig" %}
{% block content %}
  <section>
    <div class="container">
      <div class="row regular-content-size">
        <div class="col-xs-10 col-xs-offset-1 row-padding">
          <div class="col-xs-12">
            <div class="col-xs-1 text-left">
              <h2>Ride:</h2>
            </div>
            <div class="col-xs-11 text-left">
              <h2 class="extra-padding-left">{{ ez_content_name( content ) }}</h2>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <section>
    <div id="map-container">
      {{ ez_render_field(content, 'starting_point', {'parameters': { 'height': '330px', 'showMap': true, 'showInfo': false }}
      ) }}
    </div>
  </section>
  <section>
    <div class="container">
      <div class="row regular-content-size">
        <div class="col-xs-10 col-xs-offset-1 padding-box">
          <div class="col-xs-2">
            <div class="box-ride">
              <h3 class="special-number">{{ ez_render_field( content, 'length') }} Km</h3>
              <p class="pre-small special-number special-number-margin"><strong>{{ 'Level' }}</strong></p>
            </div>
          </div>
          <div class="col-xs-10">
            <div class="col-xs-5">
              <p>Created by: {{ ez_field_value( content, 'author') }}</p>
              <p>Start: {{ ez_field_value(content, 'starting_point') }}
              </p>
              <p>End: {{ ez_field_value(content, 'ending_point') }}</p>
            </div>
          </div>
        </div>
        <div class="col-xs-10 col-xs-offset-1 padding-box">
          <div class="col-xs-10">
            <div class="col-xs-2 text-right">
              <p>Description:</p>
            </div>
            <div class="col-xs-10 text-justify">
              {{ ez_render_field( content, 'description') }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
{% endblock %} 
```

### What is in this template ?

You reuse your pagelayout.html.twig template, to have the menu, footer and CSS.

The Ride template is in a block and you use the Twig helpers to render the content of a Ride

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
See the [Twig Functions Reference](Twig-Functions-Reference_32114025.html) for more information on Twig helpers

<span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span>
Note: the Level Field is static for now and uses the translation capacity.

The Starting Point and Ending Point Google Maps rendering is not yet done. You will use the [MapLocation Field Type](MapLocation-Field-Type_31430523.html) to render this Content Type.

## Add a new parameter to your override rule

We still haven't set any matching rule for our new Content Type Ride, so let's add one that will render a specific template for a Ride Content Type. 

**ezplatform.yml**

``` brush:
default:
    content_view:
        full:
            full_ride:
                template: "full/ride.html.twig"
                match:
                    Identifier\ContentType: "ride"
```

## Check the Ride full view

### Preview in the Admin

You can use the Preview while Editing in the Admin to preview your content rendered in the full view.

<span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img src="attachments/31431852/32114375.png" class="confluence-embedded-image confluence-content-image-border image-center" width="505" height="250" /></span>

### Go to the Ride page

You can also go the the URL of the content. It is a URL like this one **http://127.0.0.1:8000/view/content/53/eng-GB/full/true/55** where 53 is the Content ID and 55 is the Location ID of my Ride.
The infos in the URL are http://&lt;yourhost&gt;/view/content/&lt;ContentId&gt;/&lt;language&gt;/full/true/&lt;LocationId&gt;

You will find the Content ID and the Location ID of your Ride in the Admin, under the Details tab.

 
<span class="confluence-embedded-file-wrapper image-center-wrapper confluence-embedded-manual-size"><img src="attachments/31431852/32114372.png?effects=border-simple,blur-border" class="confluence-embedded-image image-center" width="807" height="400" /></span>

# Points Of Interest

Go to Admin Panel &gt; Content Types, and under the "Content"  group, create the Point Of Interest Content Type.

<span class="confluence-embedded-file-wrapper image-left-wrapper"><img src="attachments/31431852/32869547.png" class="confluence-embedded-image image-left" /></span>

 

 

## Create the Point Of Interest (POI) Content Type

A geographical location rides go through. Each ride may be related to as many points of interest as needed.

**Name**: Point of interest
**Identifier**: point\_of\_interest
**Content name pattern**: &lt;name&gt; 

 

Then create all fields with the following information: 

-   **Name**: identifier **name**; field type **textLine **(**Required** / **Searchable** / **Translatable**)
-   **Description**: identifier **description**; field type **Rich Text **(**Searchable** / **Translatable**)
-   **Photo**: identifier **photo**; field type **Image **(**Required**)
-   **Photo Legend**: identifier **legend**; field type **Rich Text **(**Searchable** / **Translatable**)
-   **Place**: identifier **place**; field type **MapLocation **(**Required** / **Searchable**)

 

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
The **content name pattern** defines how the name and URL part of Content items of this type will be built. It may include static strings, as well as references to field definitions, using their identifier.

The value of the fields referenced in the pattern will be used to build the name. Most Field Types are able to render a textual representation of their value, but be aware that it is not implemented for some of them ([Selection Field Type](Selection-Field-Type_31430539.html), [Relation Field Type](Relation-Field-Type_31430533.html), [RelationList Field Type](RelationList-Field-Type_31430535.html)).

Now, validate the Content Type creation form. It will save the Point Of Interest Content Type.
Create some Points Of Interest in the Content tree.

<span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span>
Note that you will need pictures (for the Photo, the image Field) to represent them.

## Edit the Ride Content Type

 Now edit the Ride in order to add a Content Relation Multiple between the two Content Types.

<span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img src="attachments/31431852/32869544.png?effects=border-simple,blur-border" class="confluence-embedded-image" width="547" height="400" /></span>
*Adding a relation between the Ride and the Points of Interest using the Content Relation Multiple*

Then link some Points Of Interests to a Ride in the Admin interface.

# Ride view improvements

## Display the list of POI

<span style="color: rgb(51,51,51);">By default, there are only 4 variables in a view: `noLayout`, `viewbaseLayout`, `content` and `location`.</span>

It is possible to inject whatever variable you want in a specific view.

<span class="aui-icon aui-icon-small aui-iconfont-approve confluence-information-macro-icon"></span>
You will find more info here: [Custom controllers](Content-Rendering_31429679.html#ContentRendering-Customcontrollers) and [View provider configuration](Content-Rendering_31429679.html#ContentRendering-Viewproviderconfiguration).

## Create your Point of Interest line view

Now, we need to create the line view for Point of Interest.

Declare a new override rule into your `app/config/ezplatform.yml`:

**ezplatform.yml**

``` brush:
    system:
        default:
            content_view:
                #full views here
                line:
                    line_point_of_interest:
                        template: 'line/point_of_interest.html.twig'
                        match:
                            Identifier\ContentType: ['point_of_interest']
```

Create your template for the line view of a Point of Interest `app/Resources/views/line/point_of_interest.html.twig`:

**point\_of\_interest.html.twig**

``` brush:
<section>
<div class="col-xs-4 photos-box">
  <a href="#bikeModal{{ content.id }}" class="portfolio-link" data-toggle="modal">
    <div class="caption">
      <div class="caption-content">
        <i class="fa fa-search-plus fa-3x"></i>
      </div>
    </div>
    {{ ez_render_field( content, 'photo', { parameters: { 'alias': 'small'},
    attr: { 'class': 'img-responsive img-rounded', 'alt':'' }}) }}
    {#<img src="images/lyon.png" class="img-responsive img-rounded" alt="">#}
  </a>
</div>

{# MODAL #}
<div class="bike-modal modal fade" id="bikeModal{{ content.id }}" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-content">
    <div class="close-modal" data-dismiss="modal">
      <div class="lr">
        <div class="rl">
        </div>
      </div>
    </div>
    <div class="container">
      <div class="row">
        <div class="col-xs-8 col-xs-offset-2">
          <div class="modal-body text-center">
            <h2>Photo: {{ ez_content_name( content ) }}</h2>
            <hr class="featurette-divider">
            {{ ez_render_field( content, 'photo', { parameters: { 'alias': 'large'},
            attr: { 'class': 'img-responsive img-rounded' }}) }}
            {#<img src="images/lyon.png" class="img-responsive img-centered img-rounded" alt="">#}
            {{ ez_render_field( content, 'description', { attr: { 'class': 'padding-box text-justify' }}) }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</section>
```

## Integrate the Points of Interest in the Ride view

### Create the RideController

In the AppBundle directory, create a PHP file : `/src/AppBundle/Controller/RideController.php`

**/src/AppBundle/Controller/RideController.php**

``` brush:
<?php
namespace AppBundle\Controller;
use eZ\Publish\API\Repository\Values\Content\Query;
use eZ\Publish\API\Repository\Values\Content\Query\Criterion;
use eZ\Bundle\EzPublishCoreBundle\Controller;
use eZ\Publish\API\Repository\Values\Content\Query\SortClause;
use eZ\Publish\Core\Repository\Values\Content\Location;
class RideController extends Controller
{
  /**
   * Action used to display a ride
   *  - Adds the list of all related Points of interest to the response.
   *
   * @param Location $location
   * @param $viewType
   * @param bool $layout
   * @param array $params
   * @return mixed
   */
  public function viewRideWithPOIAction(Location $location, $viewType, $layout = false, array $params = array())
  {
    $repository = $this->getRepository();
    $contentService = $repository->getContentService();
    $currentLocation = $location;
    $currentContent = $contentService->loadContentByContentInfo($currentLocation->getContentInfo());
    $pointOfInterestListId = $currentContent->getFieldValue('pois'); //points of interest
    $pointOfInterestList = array();
    foreach ($pointOfInterestListId->destinationContentIds as $pointId)
    {
      $pointOfInterestList[$pointId] = $contentService->loadContent($pointId);
    }
    return $this->get('ez_content')->viewLocation(
      $location->id,
      $viewType,
      $layout,
      array('pointOfInterestList' => $pointOfInterestList) + $params
    );
  }
}
```

Update the `/app/config/ezplatform.yml` file to mention the RideController

**/app/config/ezplatform.yml**

``` brush:
        default:
            content_view:
                full:
                    full_ride:
                        template: "full/ride.html.twig"
                        controller: "AppBundle:Ride:viewRideWithPOI"
                        match:
                            Identifier\ContentType: "ride"
```

### Add the Point Of Interest in the Ride full view

Add the following lines (at the end of the Ride full view file, before the closing tag

`{% endblock %}`

**/app/Resources/views/full/ride.html.twig**

``` brush:
<section>
<div class="col-xs-4 photos-box">
  <a href="#bikeModal{{ content.id }}" class="portfolio-link" data-toggle="modal">
    <div class="caption">
      <div class="caption-content">
        <i class="fa fa-search-plus fa-3x"></i>
      </div>
    </div>
    {{ ez_render_field( content, 'photo', { parameters: { 'alias': 'small'},
    attr: { 'class': 'img-responsive img-rounded', 'alt':'' }}) }}
    {#<img src="images/lyon.png" class="img-responsive img-rounded" alt="">#}
  </a>
</div>

{# MODAL #}
<div class="bike-modal modal fade" id="bikeModal{{ content.id }}" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-content">
    <div class="close-modal" data-dismiss="modal">
      <div class="lr">
        <div class="rl">
        </div>
      </div>
    </div>
    <div class="container">
      <div class="row">
        <div class="col-xs-8 col-xs-offset-2">
          <div class="modal-body text-center">
            <h2>Photo: {{ ez_content_name( content ) }}</h2>
            <hr class="featurette-divider">
            {{ ez_render_field( content, 'photo', { parameters: { 'alias': 'large'},
            attr: { 'class': 'img-responsive img-rounded' }}) }}
            {#<img src="images/lyon.png" class="img-responsive img-centered img-rounded" alt="">#}
            {{ ez_render_field( content, 'description', { attr: { 'class': 'padding-box text-justify' }}) }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</section>
```

 

Then check the Ride page again to see the Points of Interest !

Remember: http://&lt;yourhost&gt;/view/content/&lt;ContentId&gt;/&lt;language&gt;/full/true/&lt;LocationId&gt;

 

<span class="char" title="Leftwards Black Arrow">⬅</span> Previous: [Working on the Ride introduction page](31431613.html)

Next: [Step 2 - Display the list of Rides on the homepage](Step-2---Display-the-list-of-Rides-on-the-homepage_32866555.html) <span class="confluence-link" title="Black Rightwards Arrow">➡</span>

 

 

**Tutorial path**

## Attachments:

<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [Beginners\_Tutorial-Ride-view.png](attachments/31431852/31431849.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [Edit\_Ride\_-adding\_poi\_relation.png](attachments/31431852/31431850.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [Beginners\_Tutorial\_-\_Bike\_Rides\_-\_2015-07-31\_16.38.00.png](attachments/31431852/31431851.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [details\_tab\_for\_locationid.png](attachments/31431852/32114372.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [Admin-preview-full-ride.png](attachments/31431852/32114375.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [adding-pois-to-the-ride-content-type.png](attachments/31431852/32869544.png) (image/png)
<img src="images/icons/bullet_blue.gif" width="8" height="8" /> [Button-create-content-type.png](attachments/31431852/32869547.png) (image/png)






